<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.5.57" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="author" content="Olamide Akinlade" />

<title>Tree Phenology Assignment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<!-- htmldependencies:E3FAD763 -->
<style>html{ scroll-behavior: smooth; }</style>
<script src="tree_phenology_assignment_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="tree_phenology_assignment_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <div id="quarto-toc-target"></div>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tree Phenology Assignment</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Olamide Akinlade </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Invalid Date</p>
    </div>
  </div>
  
    
  </div>
  


</header>

<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#chapter-3-tree-phenology-analysis" id="toc-chapter-3-tree-phenology-analysis">Chapter 3: Tree Phenology Analysis</a>
  <ul>
  <li><a href="#tree-dormancy" id="toc-tree-dormancy">1.1 Tree Dormancy</a>
  <ul>
  <li><a href="#dormancy-phases" id="toc-dormancy-phases">1.1.1 Dormancy Phases</a></li>
  <li><a href="#physological-processes-that-regulate-dormancy" id="toc-physological-processes-that-regulate-dormancy">1.1.2 Physological processes that regulate dormancy</a></li>
  </ul></li>
  <li><a href="#exercises-on-tree-dormancy" id="toc-exercises-on-tree-dormancy"><strong><em>Exercises on Tree Dormancy</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-4-climate-change-and-impact-projection" id="toc-chapter-4-climate-change-and-impact-projection">Chapter 4: Climate Change and impact projection</a></li>
  <li><a href="#drivers-of-climate-change-include" id="toc-drivers-of-climate-change-include">1.1 Drivers of Climate change include:</a>
  <ul>
  <li><a href="#exercises-on-climate-change" id="toc-exercises-on-climate-change"><strong><em>Exercises on Climate Change</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-5-winter-chill-projections" id="toc-chapter-5-winter-chill-projections">Chapter 5: Winter Chill Projections</a>
  <ul>
  <li><a href="#exercises-on-past-chill-projections" id="toc-exercises-on-past-chill-projections"><strong><em>Exercises on past chill projections</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-6-manual-chill-analysis" id="toc-chapter-6-manual-chill-analysis">Chapter 6: Manual Chill Analysis</a>
  <ul>
  <li><a href="#computing-chilling-hours-from-hourly-temperature-data" id="toc-computing-chilling-hours-from-hourly-temperature-data"><strong><em>Computing Chilling Hours from Hourly Temperature data</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-7-winter-chill-projections" id="toc-chapter-7-winter-chill-projections">Chapter 7: Winter Chill Projections</a>
  <ul>
  <li><a href="#exercises-chill-models" id="toc-exercises-chill-models"><strong><em>Exercises Chill Models</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-8-making-hourly-temperatures" id="toc-chapter-8-making-hourly-temperatures">Chapter 8: Making Hourly Temperatures</a>
  <ul>
  <li><a href="#exercises-on-hourly" id="toc-exercises-on-hourly"><strong><em>Exercises on hourly</em></strong></a></li>
  </ul></li>
  <li><a href="#sunset-time-and-daylength-at-rochester-latitude-43.15n-over-the" id="toc-sunset-time-and-daylength-at-rochester-latitude-43.15n-over-the">sunset time and daylength at Rochester (Latitude: 43.15Â°N) over the</a></li>
  <li><a href="#chapter-9-some-useful-tools-in-r" id="toc-chapter-9-some-useful-tools-in-r">Chapter 9: Some Useful tools in R</a>
  <ul>
  <li><a href="#exercises-on-useful-r-tools" id="toc-exercises-on-useful-r-tools"><strong><em>Exercises on useful R tools</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-10-getting-temperature-data" id="toc-chapter-10-getting-temperature-data">Chapter 10: Getting temperature data</a>
  <ul>
  <li><a href="#exercises-on-getting-temperature-data" id="toc-exercises-on-getting-temperature-data"><strong><em>Exercises on getting temperature data</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-11-getting-temperature-data" id="toc-chapter-11-getting-temperature-data">Chapter 11: Getting temperature data</a>
  <ul>
  <li><a href="#exercises-on-getting-temperature-data-1" id="toc-exercises-on-getting-temperature-data-1"><strong><em>Exercises on getting temperature data</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-12-generating-temperature-scenarios" id="toc-chapter-12-generating-temperature-scenarios">Chapter 12: Generating temperature scenarios</a>
  <ul>
  <li><a href="#exercises-on-getting-temperature-data-2" id="toc-exercises-on-getting-temperature-data-2"><strong><em>Exercises on getting temperature data</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-14-generating-historic-temperature-scenarios" id="toc-chapter-14-generating-historic-temperature-scenarios">Chapter 14: Generating historic temperature scenarios</a>
  <ul>
  <li><a href="#exercises-on-historic-temperature-scenarios" id="toc-exercises-on-historic-temperature-scenarios"><strong><em>Exercises on historic temperature scenarios</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-15-future-temperature-scenarios" id="toc-chapter-15-future-temperature-scenarios">Chapter 15: Future temperature scenarios</a>
  <ul>
  <li><a href="#exercises-on-future-temperature-scenarios" id="toc-exercises-on-future-temperature-scenarios">*<strong>Exercises on future temperature scenarios</strong></a></li>
  </ul></li>
  <li><a href="#chapter-16-generating-cmip6-temperature-scenarios" id="toc-chapter-16-generating-cmip6-temperature-scenarios">Chapter 16: Generating CMIP6 temperature scenarios</a>
  <ul>
  <li><a href="#exercises-on-generating-cmip6-temperature-scenarios" id="toc-exercises-on-generating-cmip6-temperature-scenarios"><strong><em>Exercises on generating CMIP6 temperature scenarios</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-18-plotting-climate-scenarios" id="toc-chapter-18-plotting-climate-scenarios">Chapter 18: Plotting Climate Scenarios</a>
  <ul>
  <li><a href="#exercises-on-plotting-future-projections" id="toc-exercises-on-plotting-future-projections"><strong><em>Exercises on plotting future projections</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-19-chill-model-comparison" id="toc-chapter-19-chill-model-comparison">Chapter 19: Chill model comparison</a>
  <ul>
  <li><a href="#exercises-on-chill-model-comparison" id="toc-exercises-on-chill-model-comparison"><strong><em>Exercises on chill model comparison</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-20-simple-phenology-analysis" id="toc-chapter-20-simple-phenology-analysis">Chapter 20: Simple Phenology Analysis</a>
  <ul>
  <li><a href="#exercises-on-simple-phenology-analysis" id="toc-exercises-on-simple-phenology-analysis"><strong><em>Exercises on simple phenology analysis</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-21-delineating-temperature-response-phases-with-pls-regression" id="toc-chapter-21-delineating-temperature-response-phases-with-pls-regression">Chapter 21: Delineating temperature response phases with PLS regression</a>
  <ul>
  <li><a href="#exercises-on-chill-model-comparison-1" id="toc-exercises-on-chill-model-comparison-1"><strong><em>Exercises on chill model comparison</em></strong></a></li>
  <li><a href="#pls-responded-to-temperatures-indicating-greater-heat-accumulation-which-shows-early-bloom-however-this-is-absent-for-chill-accumulation-because-they-are-not-monotonically-related." id="toc-pls-responded-to-temperatures-indicating-greater-heat-accumulation-which-shows-early-bloom-however-this-is-absent-for-chill-accumulation-because-they-are-not-monotonically-related.">PLS responded to temperatures indicating greater heat accumulation which shows early bloom however this is absent for chill accumulation because they are not monotonically related.</a></li>
  </ul></li>
  <li><a href="#chapter-22-successes-and-limitations-of-pls-regression-analysis" id="toc-chapter-22-successes-and-limitations-of-pls-regression-analysis">Chapter 22: Successes and limitations of PLS regression analysis</a>
  <ul>
  <li><a href="#exercises-on-chill-model-comparison-2" id="toc-exercises-on-chill-model-comparison-2"><strong><em>Exercises on chill model comparison</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-23-pls-regression-with-agroclimatic-metrics" id="toc-chapter-23-pls-regression-with-agroclimatic-metrics">Chapter 23: PLS regression with agroclimatic metrics</a>
  <ul>
  <li><a href="#exercises-on-chill-model-comparison-3" id="toc-exercises-on-chill-model-comparison-3"><strong><em>Exercises on Chill model comparison</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-24-pls-regression-with-agroclimatic-metrics" id="toc-chapter-24-pls-regression-with-agroclimatic-metrics">Chapter 24: PLS regression with agroclimatic metrics</a>
  <ul>
  <li><a href="#exercises-on-examples-of-pls-regression-with-agroclimatic-metrics" id="toc-exercises-on-examples-of-pls-regression-with-agroclimatic-metrics"><strong><em>Exercises on examples of PLS regression with agroclimatic metrics</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-25-pls-regression-with-agroclimatic-metrics" id="toc-chapter-25-pls-regression-with-agroclimatic-metrics">Chapter 25: PLS regression with agroclimatic metrics</a>
  <ul>
  <li><a href="#exercises-on-expected-pls-responsiveness" id="toc-exercises-on-expected-pls-responsiveness"><strong><em>Exercises on expected PLS responsiveness</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-26-evaluating-pls-outputs" id="toc-chapter-26-evaluating-pls-outputs">Chapter 26: Evaluating PLS outputs</a>
  <ul>
  <li><a href="#exercises-on-expected-pls-results" id="toc-exercises-on-expected-pls-results"><strong><em>Exercises on expected PLS results</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-27-the-relative-importance-of-chill-and-heat" id="toc-chapter-27-the-relative-importance-of-chill-and-heat">Chapter 27: The relative importance of chill and heat</a>
  <ul>
  <li><a href="#exercises-on-the-relative-importance-of-chill-and-heat" id="toc-exercises-on-the-relative-importance-of-chill-and-heat"><strong><em>Exercises on the relative importance of chill and heat</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-29-making-valid-tree-phenology-models" id="toc-chapter-29-making-valid-tree-phenology-models">Chapter 29: Making valid tree phenology models</a>
  <ul>
  <li><a href="#exercises-on-making-valid-tree-phenology-models" id="toc-exercises-on-making-valid-tree-phenology-models"><strong><em>Exercises on making valid tree phenology models</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-30-the-phenoflex-model" id="toc-chapter-30-the-phenoflex-model">Chapter 30: The Phenoflex Model</a>
  <ul>
  <li><a href="#exercises-on-making-valid-tree-phenology-models-1" id="toc-exercises-on-making-valid-tree-phenology-models-1"><strong><em>Exercises on making valid tree phenology models</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-31-the-phenoflex-model---a-second-look" id="toc-chapter-31-the-phenoflex-model---a-second-look">Chapter 31: The PhenoFlex model - a second look</a>
  <ul>
  <li><a href="#exercises-on-basic-phenoflex-diagnostics" id="toc-exercises-on-basic-phenoflex-diagnostics"><strong><em>Exercises on basic PhenoFlex diagnostics</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-32-can-we-improve-the-performance-of-phenoflex" id="toc-chapter-32-can-we-improve-the-performance-of-phenoflex">Chapter 32: Can we improve the performance of PhenoFlex</a>
  <ul>
  <li><a href="#exercises-on-improving-the-performance-of-phenoflex" id="toc-exercises-on-improving-the-performance-of-phenoflex"><strong><em>Exercises on improving the performance of PhenoFlex</em></strong></a></li>
  </ul></li>
  <li><a href="#chapter-33-frost-risk-analysis" id="toc-chapter-33-frost-risk-analysis">Chapter 33: Frost risk analysis</a>
  <ul>
  <li><a href="#exercises-on-frost-risk-analysis" id="toc-exercises-on-frost-risk-analysis"><strong><em>Exercises on frost risk analysis</em></strong></a></li>
  </ul></li>
  </ul>
</nav>
<hr />
<section id="chapter-3-tree-phenology-analysis" class="level1">
<h1>Chapter 3: Tree Phenology Analysis</h1>
<section id="tree-dormancy" class="level2">
<h2>1.1 Tree Dormancy</h2>
<p>Winter dormancy may be defined as a trade-off between the length of the growing season and the protection against winter damage. To enter dormancy, vegetative growth is stopped in the late summer or early autumn and the shoots are converted into buds, where the shoot apical meristems are protected by tightly closed and hardened bud scales.</p>
<section id="dormancy-phases" class="level3">
<h3>1.1.1 Dormancy Phases</h3>
<ol type="1">
<li>Dormancy Establishment</li>
<li>Endodormancy 1: Ecodormancy</li>
<li>Growth resumption</li>
</ol>
</section>
<section id="physological-processes-that-regulate-dormancy" class="level3">
<h3>1.1.2 Physological processes that regulate dormancy</h3>
<ol type="a">
<li>Transport</li>
<li>Photohormones</li>
<li>Genetics</li>
<li>Carbohydrates dynamics</li>
</ol>
</section>
</section>
<section id="exercises-on-tree-dormancy" class="level2">
<h2><strong><em>Exercises on Tree Dormancy</em></strong></h2>
<ol type="1">
<li>Put yourself in the place of a breeder who wants to calculate the temperature requirements of a newly released cultivar. Which method will you use to calculate the chilling and forcing periods? Please justify your answer</li>
</ol>
<p>Statistical method is recommended to calculate the temperature requirements (chilling and forcing periods) of a newly released cultivar. This involves using partial least square regression analysis for daily temperatures over a continuous period.</p>
<ol start="2" type="1">
<li>Which are the advantages (2) of the BBCH scale compared with earlier scales?</li>
</ol>
<p>Two advantages of the BBCH scale over traditional scale include: a. It was developed in a general frame for all the species b. It covers the whole development of a plant.</p>
<ol start="3" type="1">
<li>Classify the following phenological stages of sweet cherry according to the BBCH scale:</li>
</ol>
<p>Phenological stages of cherry + Image 1: 51</p>
<ul>
<li><p>Image 2: 63</p></li>
<li><p>Image 3: 87</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="\Users\Home\Downloads\photo_5834526249584805567_y.jpg" class="img-fluid" /></p>
<figcaption>Stages of Cherry</figcaption>
</figure>
</div>
<hr />
</section>
</section>
<section id="chapter-4-climate-change-and-impact-projection" class="level1">
<h1>Chapter 4: Climate Change and impact projection</h1>
</section>
<section id="drivers-of-climate-change-include" class="level1">
<h1>1.1 Drivers of Climate change include:</h1>
<ul>
<li>Sun: Warms the earth through radiation. It is an important driver of climate change on geological timescales, but not of recent climate change.</li>
<li>Aerosols: They are largely dusts. Suspensions of liquid, solid, or mixed particles with highly variable chemical composition and size distribution.</li>
<li>Clouds: Can have both cooling and warming effect.</li>
<li>Ozone: Surface (tropospheric) ozone: constituent of smog, health hazard (bad ozone). Greenhouse gas: presence in the stratosphere has a warming effect. Destroyed by chlorofluorocarbons (CFCs).</li>
<li>Surface albedo: Reflection of radiation by the land surface. Light surfaces (e.g.Â ice, snow) reflect almost all radiation, dark surfaces (ocean, dark soil, forest) very little.</li>
<li>Greenhouse gases: Atmospheric gases that trap heat on Earth. Greenhouse effects warms the planet.</li>
<li>Long-term drivers:</li>
</ul>
<section id="exercises-on-climate-change" class="level2">
<h2><strong><em>Exercises on Climate Change</em></strong></h2>
<ol type="1">
<li>List the main drivers of climate change at the decade to century scale, and briefly explain the mechanism through which the currently most important driver affects our climate.</li>
</ol>
<ul>
<li>Sun</li>
<li>Aerosols</li>
<li>Clouds</li>
<li>Ozone</li>
<li>Surface albedo</li>
<li>Greenhouse gases</li>
<li>Long-term drivers</li>
</ul>
<p>Most important: <strong>GHGs</strong> <strong>Greenhouse effect</strong> + Raises Earthâs mean temperature: +14Â°C instead of -18Â°C without GHGs! + Major GHGs: water vapor, CO2 (carbon dioxide), CH4 (methane), N2O (nitrous oxide)</p>
<ol type="1">
<li>Explain briefly what is special about temperature dynamics of recent decades, and why we have good reasons to be concerned.</li>
</ol>
<p>Since 1901 strong warming (almost) everywhere on Earth.Up to 8Â°C warmer than the 2003-2018 average. Precipitation anomalies (relative to median prec.) for Cologne/Bonn weather station. Some years with dry springs/summer.</p>
<ol type="1">
<li>What does the abbreviation âRCPâ stand for, how are RCPs defined, and what is their role in projecting future climates? Representative Concentration Pathways (RCPs). It is a new greenhouse forcing scenarios in the IPCCâs5th Assessment Report. From RCP to inputs for climate change impact models.</li>
</ol>
<p>Roles of RCP:</p>
<ol type="1">
<li>Briefly describe the 4 climate impact projection methods described in the fourth video.</li>
</ol>
<ul>
<li>Statistical models</li>
<li>Species distribution modeling</li>
<li>Process-based models</li>
<li>Climate analogue analysis</li>
</ul>
<hr />
</section>
</section>
<section id="chapter-5-winter-chill-projections" class="level1">
<h1>Chapter 5: Winter Chill Projections</h1>
<section id="exercises-on-past-chill-projections" class="level2">
<h2><strong><em>Exercises on past chill projections</em></strong></h2>
<ol type="1">
<li>Sketch out three data access and processing challenges that had to be overcome in order to produce chill projections with state-of-the-art methodology.</li>
</ol>
<ul>
<li>Accessing Climate Data for Specific Locations: Previous climate datasets like AFRICLIM and ClimateWizard only provided large-scale data. To get weather data for specific locations without downloading too much extra information, an API was created to quickly access data for single sites</li>
<li>Converting Daily to Hourly Temperature Data: Chill models need hourly temperature data, but many databases only give daily averages. Early methods for converting daily to hourly data werenât very good, especially in areas with unique temperatures. Improved algorithms were developed to estimate hourly temperatures more accurately from daily data</li>
<li>Handling Large Volumes of Climate Model Outputs: Studying different climate futures involves dealing with a lot of data from many climate models, which can be hard to manage. To handle this large amount of data effectively, workflows were streamlined and selective processing techniques were used</li>
</ul>
<ol start="2" type="1">
<li>Outline, in your understanding, the basic steps that are necessary to make such projections.</li>
</ol>
<ul>
<li>Data Collection and Calibration: collect historical weather data and use it to calibrate a weather generator for realistic temperature simulations</li>
<li>Model Selection and Scenario Setup: choose relevant climate models and emission scenarios to explore various future climates</li>
<li>Generate Temperature Projections: downscale climate data, converting it to daily or hourly temperatures as needed for chill calculations</li>
<li>Chill Calculation: apply chill models to estimate chill accumulation across different climate scenarios</li>
<li>Analysis and Visualization: compare chill projections across models and scenarios and visualize the findings</li>
<li>Interpretation: validate projections with observed data where possible and assess agricultural impacts and adaptation needs</li>
</ul>
<hr />
</section>
</section>
<section id="chapter-6-manual-chill-analysis" class="level1">
<h1>Chapter 6: Manual Chill Analysis</h1>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: &#39;dplyr&#39;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from &#39;package:stats&#39;:

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from &#39;package:base&#39;:

    intersect, setdiff, setequal, union</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: &#39;kableExtra&#39;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from &#39;package:dplyr&#39;:

    group_rows</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb8"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Winters_hours_gaps[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Year Month Day Hour Temp_gaps   Temp
1  2008     3   3   10    15.127 15.127
2  2008     3   3   11    17.153 17.153
3  2008     3   3   12    18.699 18.699
4  2008     3   3   13    18.699 18.699
5  2008     3   3   14    18.842 18.842
6  2008     3   3   15    19.508 19.508
7  2008     3   3   16    19.318 19.318
8  2008     3   3   17    17.701 17.701
9  2008     3   3   18    15.414 15.414
10 2008     3   3   19    12.727 12.727</code></pre>
</div>
</div>
<section id="computing-chilling-hours-from-hourly-temperature-data" class="level2">
<h2><strong><em>Computing Chilling Hours from Hourly Temperature data</em></strong></h2>
<ol type="1">
<li>Write a basic function that calculates warm hours (&gt;25Â°C)</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>hourtemps <span class="ot">&lt;-</span> Winters_hours_gaps[,<span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Month&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Day&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Hour&quot;</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Temp&quot;</span>)]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>hourtemps[, <span class="st">&quot;Chilling_Hour&quot;</span>] <span class="ot">&lt;-</span> hourtemps<span class="sc">$</span>Temp <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> hourtemps<span class="sc">$</span>Temp <span class="sc">&lt;=</span> <span class="fl">7.2</span></span></code></pre></div>
</details>
</div>
<p>#calculate warm hours</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>WH<span class="ot">&lt;-</span><span class="cf">function</span>(hourtemps)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  hourtemps[, <span class="st">&quot;Warm_Hour&quot;</span>] <span class="ot">&lt;-</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    hourtemps<span class="sc">$</span>Temp <span class="sc">&gt;=</span> <span class="dv">25</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(hourtemps)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Apply this function to the Winters_hours_gaps dataset</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">WH</span>(hourtemps)[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, ]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Year Month Day Hour   Temp Chilling_Hour Warm_Hour
1  2008     3   3   10 15.127         FALSE     FALSE
2  2008     3   3   11 17.153         FALSE     FALSE
3  2008     3   3   12 18.699         FALSE     FALSE
4  2008     3   3   13 18.699         FALSE     FALSE
5  2008     3   3   14 18.842         FALSE     FALSE
6  2008     3   3   15 19.508         FALSE     FALSE
7  2008     3   3   16 19.318         FALSE     FALSE
8  2008     3   3   17 17.701         FALSE     FALSE
9  2008     3   3   18 15.414         FALSE     FALSE
10 2008     3   3   19 12.727         FALSE     FALSE
11 2008     3   3   20 10.369         FALSE     FALSE
12 2008     3   3   21  9.706         FALSE     FALSE
13 2008     3   3   22  9.040         FALSE     FALSE
14 2008     3   3   23  7.920         FALSE     FALSE
15 2008     3   4    0  6.535          TRUE     FALSE
16 2008     3   4    1  6.687          TRUE     FALSE
17 2008     3   4    2  8.767         FALSE     FALSE
18 2008     3   4    3  9.139         FALSE     FALSE
19 2008     3   4    4  6.788          TRUE     FALSE
20 2008     3   4    5  5.076          TRUE     FALSE
21 2008     3   4    6  3.985          TRUE     FALSE
22 2008     3   4    7  3.775          TRUE     FALSE
23 2008     3   4    8 10.001         FALSE     FALSE
24 2008     3   4    9 13.690         FALSE     FALSE
25 2008     3   4   10 15.796         FALSE     FALSE
26 2008     3   4   11 18.081         FALSE     FALSE
27 2008     3   4   12 19.888         FALSE     FALSE
28 2008     3   4   13 20.841         FALSE     FALSE
29 2008     3   4   14 21.366         FALSE     FALSE
30 2008     3   4   15 21.867         FALSE     FALSE
31 2008     3   4   16 21.604         FALSE     FALSE
32 2008     3   4   17 20.079         FALSE     FALSE
33 2008     3   4   18 17.344         FALSE     FALSE
34 2008     3   4   19 13.930         FALSE     FALSE
35 2008     3   4   20 11.929         FALSE     FALSE
36 2008     3   4   21 10.761         FALSE     FALSE
37 2008     3   4   22  9.854         FALSE     FALSE
38 2008     3   4   23  9.706         FALSE     FALSE
39 2008     3   5    0  7.619         FALSE     FALSE
40 2008     3   5    1  9.509         FALSE     FALSE
41 2008     3   5    2 10.883         FALSE     FALSE
42 2008     3   5    3 12.147         FALSE     FALSE
43 2008     3   5    4 12.606         FALSE     FALSE
44 2008     3   5    5 11.880         FALSE     FALSE
45 2008     3   5    6 11.589         FALSE     FALSE
46 2008     3   5    7 11.029         FALSE     FALSE
47 2008     3   5    8 12.171         FALSE     FALSE
48 2008     3   5    9 14.074         FALSE     FALSE
49 2008     3   5   10 15.533         FALSE     FALSE
50 2008     3   5   11 17.605         FALSE     FALSE</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb14"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(hourtemps<span class="sc">$</span>Warm_Hour)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Extend this function, so that it can take start and end dates as inputs and sums up warm hours between these dates</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb16"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>sum_WH <span class="ot">&lt;-</span> <span class="cf">function</span>(hourtemps, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                   startYEARMODAHO,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                   endYEARMODAHO)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>{hourtemps[,<span class="st">&quot;Warm_Hour&quot;</span>] <span class="ot">&lt;-</span> hourtemps<span class="sc">$</span>Temp <span class="sc">&gt;</span> <span class="dv">25</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>startYear <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(startYEARMODAHO, <span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>startMonth <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(startYEARMODAHO, <span class="dv">5</span>, <span class="dv">6</span>))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>startDay <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(startYEARMODAHO, <span class="dv">7</span>, <span class="dv">8</span>))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>startHour <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(startYEARMODAHO, <span class="dv">9</span>, <span class="dv">10</span>))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>endYear <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(endYEARMODAHO, <span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>endMonth <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(endYEARMODAHO, <span class="dv">5</span>, <span class="dv">6</span>))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>endDay <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(endYEARMODAHO, <span class="dv">7</span>, <span class="dv">8</span>))</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>endHour <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(endYEARMODAHO, <span class="dv">9</span>, <span class="dv">10</span>))</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>Start_Date <span class="ot">&lt;-</span> <span class="fu">which</span>(hourtemps<span class="sc">$</span>Year <span class="sc">==</span> startYear <span class="sc">&amp;</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>                    hourtemps<span class="sc">$</span>Month <span class="sc">==</span> startMonth <span class="sc">&amp;</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>                    hourtemps<span class="sc">$</span>Day <span class="sc">==</span> startDay <span class="sc">&amp;</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>                    hourtemps<span class="sc">$</span>Hour <span class="sc">==</span> startHour)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>End_Date <span class="ot">&lt;-</span> <span class="fu">which</span>(hourtemps<span class="sc">$</span>Year <span class="sc">==</span> endYear <span class="sc">&amp;</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>                  hourtemps<span class="sc">$</span>Month <span class="sc">==</span> endMonth <span class="sc">&amp;</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                  hourtemps<span class="sc">$</span>Day <span class="sc">==</span> endDay <span class="sc">&amp;</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>                  hourtemps<span class="sc">$</span>Hour <span class="sc">==</span> endHour)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>WHs <span class="ot">&lt;-</span> <span class="fu">sum</span>(hourtemps<span class="sc">$</span>Warm_Hour[Start_Date<span class="sc">:</span>End_Date])</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(WHs)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
<p>#Example</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb17"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum_WH</span>(Winters_hours_gaps, <span class="at">startYEARMODAHO =</span> <span class="dv">2008070100</span>, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">endYEARMODAHO =</span> <span class="dv">2008073123</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 306</code></pre>
</div>
</div>
<hr />
</section>
</section>
<section id="chapter-7-winter-chill-projections" class="level1">
<h1>Chapter 7: Winter Chill Projections</h1>
<section id="exercises-chill-models" class="level2">
<h2><strong><em>Exercises Chill Models</em></strong></h2>
<ol type="1">
<li>Run the chilling() function on the Winters_hours_gap dataset #chilling function</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb19"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>july <span class="ot">&lt;-</span> <span class="fu">chilling</span>(<span class="fu">make_JDay</span>(Winters_hours_gaps),</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Start_JDay =</span> <span class="dv">183</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">End_JDay =</span> <span class="dv">213</span>)</span></code></pre></div>
</details>
</div>
<ol type="1">
<li>Create your own temperature-weighting chill model using the step_model() function #step model</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb20"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1000</span>, <span class="dv">0</span>,  <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>,   <span class="dv">10</span>),  </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">c</span>(    <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">1000</span>), </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">c</span>(   <span class="dv">0</span>, <span class="dv">1</span>,  <span class="dv">2</span>,  <span class="dv">3</span>,  <span class="dv">2</span>,  <span class="dv">1</span>,    <span class="dv">0</span>))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df) <span class="sc">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="st">&quot;striped&quot;</span>, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>, <span class="at">font_size =</span> <span class="dv">12</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped caption-top" data-quarto-postprocess="true" style="font-size: 12px; ">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">lower</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">upper</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-1000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>


</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb21"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>custom <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">step_model</span>(x, df)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">custom</span>(Winters_hours_gaps<span class="sc">$</span>Temp)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]  0  0  0  0  0  0  0  0  0  0  0 NA NA NA NA NA NA NA NA NA NA NA NA NA NA
 [26] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
 [51] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
 [76] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</code></pre>
</div>
</div>
<ol type="1">
<li>Run this model on the Winters_hours_gaps dataset using the tempResponse() function.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb23"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">tempResponse</span>(<span class="fu">make_JDay</span>(Winters_hours_gaps),</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Start_JDay =</span> <span class="dv">183</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">End_JDay =</span> <span class="dv">213</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">models =</span> <span class="fu">list</span>(<span class="at">Chill_Portions =</span> Dynamic_Model, </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">GDH =</span> GDH))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(output) <span class="sc">%&gt;%</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="st">&quot;striped&quot;</span>, </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">font_size =</span> <span class="dv">12</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped caption-top" data-quarto-postprocess="true" style="font-size: 12px; ">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_Portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GDH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">9771.642</td>
</tr>
</tbody>
</table>


</div>
</div>
<hr />
</section>
</section>
<section id="chapter-8-making-hourly-temperatures" class="level1">
<h1>Chapter 8: Making Hourly Temperatures</h1>
<section id="exercises-on-hourly" class="level2">
<h2><strong><em>Exercises on hourly</em></strong></h2>
<ol type="1">
<li>Choose a location of interest, find out its latitude and produce plots of daily sunrise, sunset and daylength</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb24"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(chillR)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="sunset-time-and-daylength-at-rochester-latitude-43.15n-over-the" class="level1">
<h1>sunset time and daylength at Rochester (Latitude: 43.15Â°N) over the</h1>
<p>course of the year.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb25"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>Days <span class="ot">&lt;-</span> <span class="fu">daylength</span>(<span class="at">latitude =</span> <span class="dv">43</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">JDay =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>Days_df <span class="ot">&lt;-</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">JDay =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sunrise =</span> Days<span class="sc">$</span>Sunrise,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sunset =</span> Days<span class="sc">$</span>Sunset,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Daylength =</span> Days<span class="sc">$</span>Daylength</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>Days_df <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(Days_df, <span class="at">cols=</span><span class="fu">c</span>(Sunrise<span class="sc">:</span>Daylength))</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Days_df, <span class="fu">aes</span>(JDay, value)) <span class="sc">+</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(name)) <span class="sc">+</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Time of Day / Daylength (Hours)&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<ol type="1">
<li>Produce an hourly dataset, based on idealized daily curves, for the KA_weather dataset (included in chillR)</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb26"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stack_hourly_temps</span>(KA_weather, <span class="at">latitude =</span> <span class="dv">43</span>) [[<span class="dv">1</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      Year Month Day Tmax Tmin JDay Hour     Temp
1     1998     1   1  8.2  5.1    1    0 5.100000
4535  1998     1   1  8.2  5.1    1    1 5.100000
9069  1998     1   1  8.2  5.1    1    2 5.100000
13603 1998     1   1  8.2  5.1    1    3 5.100000
18137 1998     1   1  8.2  5.1    1    4 5.100000
22671 1998     1   1  8.2  5.1    1    5 5.100000
27205 1998     1   1  8.2  5.1    1    6 5.100000
31739 1998     1   1  8.2  5.1    1    7 5.100000
36273 1998     1   1  8.2  5.1    1    8 5.494357
40807 1998     1   1  8.2  5.1    1    9 6.215506
45341 1998     1   1  8.2  5.1    1   10 6.872424
49875 1998     1   1  8.2  5.1    1   11 7.427284
54409 1998     1   1  8.2  5.1    1   12 7.848137
58943 1998     1   1  8.2  5.1    1   13 8.110750
63477 1998     1   1  8.2  5.1    1   14 8.200000
68011 1998     1   1  8.2  5.1    1   15 8.110750
72545 1998     1   1  8.2  5.1    1   16 7.848137
77079 1998     1   1  8.2  5.1    1   17 7.275663
81613 1998     1   1  8.2  5.1    1   18 6.780076
86147 1998     1   1  8.2  5.1    1   19 6.455465</code></pre>
</div>
</div>
<ol type="1">
<li>Produce empirical temperature curve parameters for the Winters_hours_gaps dataset, and use them to predict hourly values from daily temperatures (this is very similar to the example above,but please make sure you understand whatâs going on).</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb28"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>empi_curve <span class="ot">&lt;-</span> <span class="fu">Empirical_daily_temperature_curve</span>(Winters_hours_gaps)</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb29"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Winters_daily <span class="ot">&lt;-</span> <span class="fu">make_all_day_table</span>(Winters_hours_gaps, <span class="at">input_timestep =</span> <span class="st">&quot;hour&quot;</span>)</span></code></pre></div>
</details>
</div>
<hr />
</section>
<section id="chapter-9-some-useful-tools-in-r" class="level1">
<h1>Chapter 9: Some Useful tools in R</h1>
<section id="exercises-on-useful-r-tools" class="level2">
<h2><strong><em>Exercises on useful R tools</em></strong></h2>
<ol type="1">
<li>Based on the Winters_hours_gaps dataset, use magrittr pipes and functions of the tidyverse to accomplish the following:</li>
</ol>
<ul>
<li>Convert the dataset into a tibble</li>
<li>Select only the top 10 rows of the dataset</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb30"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(chillR)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>ââ Attaching core tidyverse packages ââââââââââââââââââââââââ tidyverse 2.0.0 ââ
â forcats   1.0.0     â readr     2.1.5
â lubridate 1.9.3     â stringr   1.5.1
â purrr     1.0.2     â tibble    3.2.1
ââ Conflicts ââââââââââââââââââââââââââââââââââââââââââ tidyverse_conflicts() ââ
â dplyr::filter()          masks stats::filter()
â kableExtra::group_rows() masks dplyr::group_rows()
â dplyr::lag()             masks stats::lag()
â lubridate::leap_year()   masks chillR::leap_year()
â¹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb32"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>WHG <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Winters_hours_gaps[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ])</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>WHG</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã 6
    Year Month   Day  Hour Temp_gaps  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  2008     3     3    10      15.1  15.1
 2  2008     3     3    11      17.2  17.2
 3  2008     3     3    12      18.7  18.7
 4  2008     3     3    13      18.7  18.7
 5  2008     3     3    14      18.8  18.8
 6  2008     3     3    15      19.5  19.5
 7  2008     3     3    16      19.3  19.3
 8  2008     3     3    17      17.7  17.7
 9  2008     3     3    18      15.4  15.4
10  2008     3     3    19      12.7  12.7</code></pre>
</div>
</div>
<ul>
<li>Convert the tibble to a long format, with separate rows for Temp_gaps and Temp</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb34"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>WHGlong <span class="ot">&lt;-</span> WHG <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> Temp_gaps<span class="sc">:</span>Temp)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>WHGlong</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 Ã 6
    Year Month   Day  Hour name      value
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;
 1  2008     3     3    10 Temp_gaps  15.1
 2  2008     3     3    10 Temp       15.1
 3  2008     3     3    11 Temp_gaps  17.2
 4  2008     3     3    11 Temp       17.2
 5  2008     3     3    12 Temp_gaps  18.7
 6  2008     3     3    12 Temp       18.7
 7  2008     3     3    13 Temp_gaps  18.7
 8  2008     3     3    13 Temp       18.7
 9  2008     3     3    14 Temp_gaps  18.8
10  2008     3     3    14 Temp       18.8
11  2008     3     3    15 Temp_gaps  19.5
12  2008     3     3    15 Temp       19.5
13  2008     3     3    16 Temp_gaps  19.3
14  2008     3     3    16 Temp       19.3
15  2008     3     3    17 Temp_gaps  17.7
16  2008     3     3    17 Temp       17.7
17  2008     3     3    18 Temp_gaps  15.4
18  2008     3     3    18 Temp       15.4
19  2008     3     3    19 Temp_gaps  12.7
20  2008     3     3    19 Temp       12.7</code></pre>
</div>
</div>
<ul>
<li>Use ggplot2 to plot Temp_gaps and Temp as facets (point or line plot)</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb36"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(WHGlong, <span class="fu">aes</span>(Hour, value)) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour=</span><span class="fl">0.2</span>), <span class="at">size=</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">12</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Temperature (Â°C)&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Convert the dataset back to the wide format</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb37"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>WHGwide <span class="ot">&lt;-</span> WHGlong <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>WHGwide</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã 6
    Year Month   Day  Hour Temp_gaps  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  2008     3     3    10      15.1  15.1
 2  2008     3     3    11      17.2  17.2
 3  2008     3     3    12      18.7  18.7
 4  2008     3     3    13      18.7  18.7
 5  2008     3     3    14      18.8  18.8
 6  2008     3     3    15      19.5  19.5
 7  2008     3     3    16      19.3  19.3
 8  2008     3     3    17      17.7  17.7
 9  2008     3     3    18      15.4  15.4
10  2008     3     3    19      12.7  12.7</code></pre>
</div>
</div>
<ul>
<li>Select only the following columns: Year, Month, Day and Temp</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb39"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>WHG <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(Year, Month, Day, Temp))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã 4
    Year Month   Day  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
 1  2008     3     3  15.1
 2  2008     3     3  17.2
 3  2008     3     3  18.7
 4  2008     3     3  18.7
 5  2008     3     3  18.8
 6  2008     3     3  19.5
 7  2008     3     3  19.3
 8  2008     3     3  17.7
 9  2008     3     3  15.4
10  2008     3     3  12.7</code></pre>
</div>
</div>
<ul>
<li>Sort the dataset by the Temp column, in descending order</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb41"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>WHG <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Temp))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã 6
    Year Month   Day  Hour Temp_gaps  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  2008     3     3    15      19.5  19.5
 2  2008     3     3    16      19.3  19.3
 3  2008     3     3    14      18.8  18.8
 4  2008     3     3    12      18.7  18.7
 5  2008     3     3    13      18.7  18.7
 6  2008     3     3    17      17.7  17.7
 7  2008     3     3    11      17.2  17.2
 8  2008     3     3    18      15.4  15.4
 9  2008     3     3    10      15.1  15.1
10  2008     3     3    19      12.7  12.7</code></pre>
</div>
</div>
<ol type="1">
<li>For the Winter_hours_gaps dataset, write a for loop to convert all temperatures (Temp column) to degrees Fahrenheit</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb43"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>Temp <span class="ot">&lt;-</span> Winters_hours_gaps<span class="sc">$</span>Temp[<span class="dv">183</span><span class="sc">:</span><span class="dv">213</span>] <span class="co"># JDay for July</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> Temp)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  Fahrenheit <span class="ot">&lt;-</span> i <span class="sc">*</span> <span class="fl">1.8</span> <span class="sc">+</span> <span class="dv">32</span> </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(Fahrenheit) </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 57.9362
[1] 56.3828
[1] 56.0354
[1] 54.8654
[1] 46.481
[1] 44.7188
[1] 44.2184
[1] 45.3074
[1] 53.078
[1] 59.7884
[1] 64.0328
[1] 68.1422
[1] 68.5274
[1] 70.2014
[1] 68.7848
[1] 69.4706
[1] 70.5434
[1] 68.3132
[1] 62.6612
[1] 57.5924
[1] 54.9518
[1] 52.5092
[1] 51.1484
[1] 52.6406
[1] 57.074
[1] 56.9876
[1] 49.2044
[1] 47.2442
[1] 46.571
[1] 46.346
[1] 44.8556</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Execute the same operation with a function from the apply family</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb45"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> Winters_hours_gaps<span class="sc">$</span>Temp[<span class="dv">183</span><span class="sc">:</span><span class="dv">213</span>]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>fahrenheit <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">*</span> <span class="fl">1.8</span> <span class="sc">+</span> <span class="dv">32</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(x, fahrenheit)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 57.9362 56.3828 56.0354 54.8654 46.4810 44.7188 44.2184 45.3074 53.0780
[10] 59.7884 64.0328 68.1422 68.5274 70.2014 68.7848 69.4706 70.5434 68.3132
[19] 62.6612 57.5924 54.9518 52.5092 51.1484 52.6406 57.0740 56.9876 49.2044
[28] 47.2442 46.5710 46.3460 44.8556</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Now use the tidyverse function mutate to achieve the same outcome</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb47"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>WHG_F <span class="ot">&lt;-</span> WHG <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Temp_F =</span> Temp <span class="sc">*</span> <span class="fl">1.8</span> <span class="sc">+</span> <span class="dv">32</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>WHG_F</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã 7
    Year Month   Day  Hour Temp_gaps  Temp Temp_F
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1  2008     3     3    10      15.1  15.1   59.2
 2  2008     3     3    11      17.2  17.2   62.9
 3  2008     3     3    12      18.7  18.7   65.7
 4  2008     3     3    13      18.7  18.7   65.7
 5  2008     3     3    14      18.8  18.8   65.9
 6  2008     3     3    15      19.5  19.5   67.1
 7  2008     3     3    16      19.3  19.3   66.8
 8  2008     3     3    17      17.7  17.7   63.9
 9  2008     3     3    18      15.4  15.4   59.7
10  2008     3     3    19      12.7  12.7   54.9</code></pre>
</div>
</div>
<hr />
</section>
</section>
<section id="chapter-10-getting-temperature-data" class="level1">
<h1>Chapter 10: Getting temperature data</h1>
<section id="exercises-on-getting-temperature-data" class="level2">
<h2><strong><em>Exercises on getting temperature data</em></strong></h2>
<ol type="1">
<li>Choose a location of interest and find the 25 closest weather stations using the handle_gsod function</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb49"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>station_list_Rochester <span class="ot">&lt;-</span><span class="fu">handle_gsod</span>(<span class="at">action=</span><span class="st">&quot;list_stations&quot;</span>,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">location=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">77.60</span>, <span class="fl">43.15</span>),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">time_interval=</span><span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2020</span>))</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: &#39;magrittr&#39;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from &#39;package:purrr&#39;:

    set_names</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from &#39;package:tidyr&#39;:

    extract</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb53"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(kableExtra)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(station_list_Rochester) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="st">&quot;striped&quot;</span>, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>, <span class="at">font_size =</span> <span class="dv">8</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped caption-top" data-quarto-postprocess="true" style="font-size: 8px; ">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">chillR_code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">STATION.NAME</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CTRY</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Lat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Long</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BEGIN</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">END</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Distance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Overlap_years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_interval_covered</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">72529014768</td>
<td style="text-align: left;">GREATER ROCHESTER INTERNATIONAL AP</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">43.117</td>
<td style="text-align: right;">-77.675</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20241103</td>
<td style="text-align: right;">7.11</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">99999914768</td>
<td style="text-align: left;">ROCHESTER MONROE CO ARPT</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">43.117</td>
<td style="text-align: right;">-77.677</td>
<td style="text-align: right;">19480101</td>
<td style="text-align: right;">19721231</td>
<td style="text-align: right;">7.25</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">72529599999</td>
<td style="text-align: left;">ROCHESTER COAST GUARD LIGHT STAT</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">43.250</td>
<td style="text-align: right;">-77.600</td>
<td style="text-align: right;">19760926</td>
<td style="text-align: right;">19960701</td>
<td style="text-align: right;">11.13</td>
<td style="text-align: right;">6.50</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="even">
<td style="text-align: left;">99800999999</td>
<td style="text-align: left;">ROCHESTER</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">43.250</td>
<td style="text-align: right;">-77.583</td>
<td style="text-align: right;">20080101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">11.22</td>
<td style="text-align: right;">13.00</td>
<td style="text-align: right;">42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">99826799999</td>
<td style="text-align: left;">ROCHESTER</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">43.269</td>
<td style="text-align: right;">-77.626</td>
<td style="text-align: right;">20100101</td>
<td style="text-align: right;">20210114</td>
<td style="text-align: right;">13.41</td>
<td style="text-align: right;">11.00</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: left;">99719099999</td>
<td style="text-align: left;">LAKE ONTARIO BUOY - 20NM NORTH NORTHEAST</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">43.620</td>
<td style="text-align: right;">-77.410</td>
<td style="text-align: right;">20080517</td>
<td style="text-align: right;">20081125</td>
<td style="text-align: right;">54.53</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">72498899999</td>
<td style="text-align: left;">DANSVILLE MUNI</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">42.571</td>
<td style="text-align: right;">-77.713</td>
<td style="text-align: right;">20010811</td>
<td style="text-align: right;">20031231</td>
<td style="text-align: right;">65.11</td>
<td style="text-align: right;">2.39</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">72523094704</td>
<td style="text-align: left;">DANSVILLE/MUNICIPAL</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">42.571</td>
<td style="text-align: right;">-77.713</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">19850131</td>
<td style="text-align: right;">65.11</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">99999994704</td>
<td style="text-align: left;">DANSVILLE MUNI AP</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">42.571</td>
<td style="text-align: right;">-77.713</td>
<td style="text-align: right;">19490101</td>
<td style="text-align: right;">20001101</td>
<td style="text-align: right;">65.11</td>
<td style="text-align: right;">10.84</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: left;">72498894704</td>
<td style="text-align: left;">DANSVILLE MUNICIPAL ARPT</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">42.570</td>
<td style="text-align: right;">-77.714</td>
<td style="text-align: right;">20010102</td>
<td style="text-align: right;">20241030</td>
<td style="text-align: right;">65.23</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">65</td>
</tr>
<tr class="odd">
<td style="text-align: left;">72523099999</td>
<td style="text-align: left;">DANSVILLE MUNICIPAL</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">42.567</td>
<td style="text-align: right;">-77.717</td>
<td style="text-align: right;">20020418</td>
<td style="text-align: right;">20041014</td>
<td style="text-align: right;">65.60</td>
<td style="text-align: right;">2.49</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">72519454778</td>
<td style="text-align: left;">PENN YAN AIRPORT</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">42.644</td>
<td style="text-align: right;">-77.053</td>
<td style="text-align: right;">20060101</td>
<td style="text-align: right;">20241103</td>
<td style="text-align: right;">71.85</td>
<td style="text-align: right;">15.00</td>
<td style="text-align: right;">48</td>
</tr>
<tr class="odd">
<td style="text-align: left;">9999994727</td>
<td style="text-align: left;">GENEVA SAMPSON AFB</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">42.750</td>
<td style="text-align: right;">-76.900</td>
<td style="text-align: right;">19520102</td>
<td style="text-align: right;">19560624</td>
<td style="text-align: right;">72.36</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">72519499999</td>
<td style="text-align: left;">PENN YAN</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">42.633</td>
<td style="text-align: right;">-77.050</td>
<td style="text-align: right;">19990114</td>
<td style="text-align: right;">20051231</td>
<td style="text-align: right;">72.97</td>
<td style="text-align: right;">6.97</td>
<td style="text-align: right;">22</td>
</tr>
<tr class="odd">
<td style="text-align: left;">71430099999</td>
<td style="text-align: left;">POINT PETRE (AUT) ONT</td>
<td style="text-align: left;">CA</td>
<td style="text-align: right;">43.833</td>
<td style="text-align: right;">-77.150</td>
<td style="text-align: right;">19770611</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">84.27</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">71626899999</td>
<td style="text-align: left;">PT PETRE</td>
<td style="text-align: left;">CA</td>
<td style="text-align: right;">43.833</td>
<td style="text-align: right;">-77.150</td>
<td style="text-align: right;">19770701</td>
<td style="text-align: right;">19800625</td>
<td style="text-align: right;">84.27</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">72626899999</td>
<td style="text-align: left;">POINT PETRE (MARS)</td>
<td style="text-align: left;">CA</td>
<td style="text-align: right;">43.833</td>
<td style="text-align: right;">-77.150</td>
<td style="text-align: right;">19750905</td>
<td style="text-align: right;">19770630</td>
<td style="text-align: right;">84.27</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">99596099999</td>
<td style="text-align: left;">PRINCE EDWARD PT</td>
<td style="text-align: left;">CA</td>
<td style="text-align: right;">43.790</td>
<td style="text-align: right;">-76.870</td>
<td style="text-align: right;">19911018</td>
<td style="text-align: right;">20081123</td>
<td style="text-align: right;">92.49</td>
<td style="text-align: right;">17.10</td>
<td style="text-align: right;">55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">99798999999</td>
<td style="text-align: left;">OLCOTT HARBOR</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">43.333</td>
<td style="text-align: right;">-78.717</td>
<td style="text-align: right;">20080101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">92.85</td>
<td style="text-align: right;">13.00</td>
<td style="text-align: right;">42</td>
</tr>
<tr class="even">
<td style="text-align: left;">72519599999</td>
<td style="text-align: left;">OSWEGO COAST GUARD STATION</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">43.470</td>
<td style="text-align: right;">-76.520</td>
<td style="text-align: right;">19760926</td>
<td style="text-align: right;">19960701</td>
<td style="text-align: right;">94.46</td>
<td style="text-align: right;">6.50</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">99726499999</td>
<td style="text-align: left;">9052030 - OSWEGO NY</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">43.460</td>
<td style="text-align: right;">-76.510</td>
<td style="text-align: right;">20041122</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">94.81</td>
<td style="text-align: right;">16.11</td>
<td style="text-align: right;">52</td>
</tr>
<tr class="even">
<td style="text-align: left;">99999914733</td>
<td style="text-align: left;">BUFFALO BUFFALO ARPT</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">42.941</td>
<td style="text-align: right;">-78.736</td>
<td style="text-align: right;">19720101</td>
<td style="text-align: right;">19721231</td>
<td style="text-align: right;">95.30</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">72528014733</td>
<td style="text-align: left;">BUFFALO NIAGARA INTERNATIONAL AIRPOR</td>
<td style="text-align: left;">US</td>
<td style="text-align: right;">42.940</td>
<td style="text-align: right;">-78.736</td>
<td style="text-align: right;">19420201</td>
<td style="text-align: right;">20241103</td>
<td style="text-align: right;">95.33</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">71431099999</td>
<td style="text-align: left;">COBOURG (AUT) ONT</td>
<td style="text-align: left;">CA</td>
<td style="text-align: right;">43.950</td>
<td style="text-align: right;">-78.167</td>
<td style="text-align: right;">19770611</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">100.12</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">71626699999</td>
<td style="text-align: left;">COBOURG</td>
<td style="text-align: left;">CA</td>
<td style="text-align: right;">43.950</td>
<td style="text-align: right;">-78.167</td>
<td style="text-align: right;">19770701</td>
<td style="text-align: right;">19800809</td>
<td style="text-align: right;">100.12</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>


</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb54"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>station_list_Rochester</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 Ã 10
   chillR_code STATION.NAME             CTRY    Lat  Long  BEGIN    END Distance
   &lt;chr&gt;       &lt;chr&gt;                    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
 1 72529014768 GREATER ROCHESTER INTERâ¦ US     43.1 -77.7 1.97e7 2.02e7     7.11
 2 99999914768 ROCHESTER MONROE CO ARPT US     43.1 -77.7 1.95e7 1.97e7     7.25
 3 72529599999 ROCHESTER COAST GUARD Lâ¦ US     43.2 -77.6 1.98e7 2.00e7    11.1 
 4 99800999999 ROCHESTER                US     43.2 -77.6 2.01e7 2.02e7    11.2 
 5 99826799999 ROCHESTER                US     43.3 -77.6 2.01e7 2.02e7    13.4 
 6 99719099999 LAKE ONTARIO BUOY - 20Nâ¦ US     43.6 -77.4 2.01e7 2.01e7    54.5 
 7 72498899999 DANSVILLE MUNI           US     42.6 -77.7 2.00e7 2.00e7    65.1 
 8 72523094704 DANSVILLE/MUNICIPAL      US     42.6 -77.7 1.97e7 1.99e7    65.1 
 9 99999994704 DANSVILLE MUNI AP        US     42.6 -77.7 1.95e7 2.00e7    65.1 
10 72498894704 DANSVILLE MUNICIPAL ARPT US     42.6 -77.7 2.00e7 2.02e7    65.2 
# â¹ 15 more rows
# â¹ 2 more variables: Overlap_years &lt;dbl&gt;, Perc_interval_covered &lt;dbl&gt;</code></pre>
</div>
</div>
<ol type="1">
<li>Download weather data for the most promising station on the list</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb56"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">handle_gsod</span>(<span class="at">action =</span> <span class="st">&quot;download_weather&quot;</span>,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">location =</span> station_list_Rochester<span class="sc">$</span>chillR_code[<span class="dv">1</span>],</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">time_interval =</span> <span class="fu">c</span>(<span class="dv">1990</span>, <span class="dv">2020</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading data for 31 years from station &#39;GREATER ROCHESTER INTERNATIONAL AP&#39;
================================================================================</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb58"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>weather[[<span class="dv">1</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       STATION       DATE LATITUDE LONGITUDE ELEVATION
1  72529014768 1990-01-01 43.11723 -77.67539     164.5
2  72529014768 1990-01-02 43.11723 -77.67539     164.5
3  72529014768 1990-01-03 43.11723 -77.67539     164.5
4  72529014768 1990-01-04 43.11723 -77.67539     164.5
5  72529014768 1990-01-05 43.11723 -77.67539     164.5
6  72529014768 1990-01-06 43.11723 -77.67539     164.5
7  72529014768 1990-01-07 43.11723 -77.67539     164.5
8  72529014768 1990-01-08 43.11723 -77.67539     164.5
9  72529014768 1990-01-09 43.11723 -77.67539     164.5
10 72529014768 1990-01-10 43.11723 -77.67539     164.5
11 72529014768 1990-01-11 43.11723 -77.67539     164.5
12 72529014768 1990-01-12 43.11723 -77.67539     164.5
13 72529014768 1990-01-13 43.11723 -77.67539     164.5
14 72529014768 1990-01-14 43.11723 -77.67539     164.5
15 72529014768 1990-01-15 43.11723 -77.67539     164.5
16 72529014768 1990-01-16 43.11723 -77.67539     164.5
17 72529014768 1990-01-17 43.11723 -77.67539     164.5
18 72529014768 1990-01-18 43.11723 -77.67539     164.5
19 72529014768 1990-01-19 43.11723 -77.67539     164.5
20 72529014768 1990-01-20 43.11723 -77.67539     164.5
                                                                NAME TEMP
1  FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 31.1
2  FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 30.1
3  FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 33.8
4  FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 43.7
5  FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 33.0
6  FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 26.2
7  FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 29.0
8  FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 37.3
9  FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 36.7
10 FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 36.5
11 FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 34.3
12 FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 28.7
13 FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 16.3
14 FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 23.5
15 FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 35.7
16 FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 41.5
17 FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 45.4
18 FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 46.8
19 FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 29.2
20 FREDERICK DOUGLASS GREATER ROCHESTER INTERNATIONAL AIRPORT, NY US 28.3
   TEMP_ATTRIBUTES DEWP DEWP_ATTRIBUTES    SLP SLP_ATTRIBUTES   STP
1               24 25.0              24 1006.2             24 985.6
2               24 20.1              24 1022.9             24   1.8
3               24 22.0              24 1023.5             24   2.5
4               24 34.3              24 1012.1             24 991.5
5               24 26.3              24 1018.9             24 998.1
6               24 22.2              24 1018.1             24 997.0
7               24 20.6              24 1017.0             24 996.0
8               24 27.7              24 1012.2             24 991.5
9               24 27.4              24 1008.0             24 987.4
10              24 31.8              24 1002.7             24 982.3
11              24 29.2              24 1002.0             24 981.4
12              24 23.5              24  995.5             24 975.0
13              24 10.5              24 1015.8             24 994.6
14              24 15.0              24 1026.1             24   4.7
15              24 25.0              24 1020.2             24 999.2
16              24 37.0              24 1023.3             24   2.5
17              24 42.6              24 1020.9             24   0.2
18              24 42.4              24 1013.1             24 992.7
19              24 19.7              24 1027.7             24   6.6
20              24 21.1              24 1022.3             24   1.2
   STP_ATTRIBUTES VISIB VISIB_ATTRIBUTES WDSP WDSP_ATTRIBUTES MXSPD  GUST  MAX
1              24   9.6               24 15.2              24  21.0  27.0 44.1
2              24  14.8               24 13.7              24  19.0  28.9 36.0
3              24  16.4               24  6.5              24  11.1 999.9 44.1
4              24  15.2               24  9.2              24  17.1  27.0 46.9
5              24  15.6               24 10.0              24  15.0 999.9 48.0
6              24  11.7               24  8.5              24  18.1  25.1 35.1
7              24  16.9               24  9.1              24  20.0  25.1 43.0
8              24  14.0               24  7.9              24  15.9 999.9 44.1
9              24  12.6               24  8.2              24  12.0 999.9 45.0
10             24   7.0               24  7.8              24  15.9 999.9 41.0
11             24   8.9               24 11.9              24  25.1  34.0 39.9
12             24   5.9               24 17.3              24  22.9  34.0 39.9
13             24   8.3               24 14.5              24  21.0  25.1 34.0
14             24  11.2               24 10.3              24  18.1  25.1 25.0
15             24  12.1               24  8.2              24  15.9  22.9 43.0
16             24   6.4               24  8.0              24  14.0  20.0 50.0
17             24   4.1               24  6.5              24  12.0 999.9 55.0
18             24   9.8               24 12.9              24  17.1  22.0 55.9
19             24  15.8               24 10.6              24  17.1  25.1 36.0
20             24  13.8               24  4.0              24   6.0 999.9 35.1
   MAX_ATTRIBUTES  MIN MIN_ATTRIBUTES PRCP PRCP_ATTRIBUTES  SNDP FRSHTT
1                 25.0                0.20               G   2.8  11000
2               * 26.1                0.04               G   2.8      0
3               * 27.0                0.00               G   2.0      0
4               * 37.9                0.02               D   0.8  10000
5                 28.0                0.08               G 999.9  10000
6                 19.0                0.00               G 999.9 101000
7               * 15.1                0.02               C 999.9      0
8               * 28.9                0.00               D 999.9      0
9                 34.0                0.00               C 999.9  10000
10                33.1              * 0.08               G 999.9 111000
11                32.0                0.08               G 999.9 111000
12                21.0              * 0.08               G 999.9   1000
13                10.0                0.12               G   2.0   1000
14              * 18.0                0.00               G   0.8   1000
15              * 25.0                0.01               G   0.8  10000
16              * 37.0                0.00               G 999.9 110000
17              * 36.0                0.04               G 999.9 110000
18                36.0              * 0.35               G 999.9  10000
19              * 24.1                0.04               G 999.9   1000
20              * 23.0                0.00               G 999.9      0</code></pre>
</div>
</div>
<ol type="1">
<li>Convert the weather data into chillR format</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb60"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>cleaned_weather <span class="ot">&lt;-</span> <span class="fu">handle_gsod</span>(weather)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>cleaned_weather[[<span class="dv">1</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         Date Year Month Day    Tmin   Tmax  Tmean  Prec
1  1990-01-01 1990     1   1  -3.889  6.722 -0.500 5.080
2  1990-01-02 1990     1   2  -3.278  2.222 -1.056 1.016
3  1990-01-03 1990     1   3  -2.778  6.722  1.000 0.000
4  1990-01-04 1990     1   4   3.278  8.278  6.500 0.508
5  1990-01-05 1990     1   5  -2.222  8.889  0.556 2.032
6  1990-01-06 1990     1   6  -7.222  1.722 -3.222 0.000
7  1990-01-07 1990     1   7  -9.389  6.111 -1.667 0.508
8  1990-01-08 1990     1   8  -1.722  6.722  2.944 0.000
9  1990-01-09 1990     1   9   1.111  7.222  2.611 0.000
10 1990-01-10 1990     1  10   0.611  5.000  2.500 2.032
11 1990-01-11 1990     1  11   0.000  4.389  1.278 2.032
12 1990-01-12 1990     1  12  -6.111  4.389 -1.833 2.032
13 1990-01-13 1990     1  13 -12.222  1.111 -8.722 3.048
14 1990-01-14 1990     1  14  -7.778 -3.889 -4.722 0.000
15 1990-01-15 1990     1  15  -3.889  6.111  2.056 0.254
16 1990-01-16 1990     1  16   2.778 10.000  5.278 0.000
17 1990-01-17 1990     1  17   2.222 12.778  7.444 1.016
18 1990-01-18 1990     1  18   2.222 13.278  8.222 8.890
19 1990-01-19 1990     1  19  -4.389  2.222 -1.556 1.016
20 1990-01-20 1990     1  20  -5.000  1.722 -2.056 0.000</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb62"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;data_New_York&quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dir.create(&quot;data_New_York&quot;): &#39;data_New_York&#39; already exists</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb64"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(station_list_Rochester,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;data_New_York/station_list_Rochester.csv&quot;</span>,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(weather[[<span class="dv">1</span>]],</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;data_New_York/Rochester_weather.csv&quot;</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(cleaned_weather[[<span class="dv">1</span>]],</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;data_New_York/Rochester_chillR_weather.csv&quot;</span>,</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</details>
</div>
<hr />
</section>
</section>
<section id="chapter-11-getting-temperature-data" class="level1">
<h1>Chapter 11: Getting temperature data</h1>
<section id="exercises-on-getting-temperature-data-1" class="level2">
<h2><strong><em>Exercises on getting temperature data</em></strong></h2>
<ol type="1">
<li>Use chillR functions to find out how many gaps you have in this dataset (even if you have none, please still follow all further steps)</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb65"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>Rochester <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data_New_York/Rochester_chillR_weather.csv&quot;</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>Rochester_QC <span class="ot">&lt;-</span> <span class="fu">fix_weather</span>(Rochester)<span class="sc">$</span>QC</span></code></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Create a list of the 25 closest weather stations using the handle_gsod function</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb66"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>station_list <span class="ot">&lt;-</span> <span class="fu">handle_gsod</span>(<span class="at">action=</span><span class="st">&quot;list_stations&quot;</span>,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">location=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">77.60</span>, <span class="fl">43.15</span>),</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">time_interval=</span><span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2020</span>))</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>station_list</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 Ã 10
   chillR_code STATION.NAME             CTRY    Lat  Long  BEGIN    END Distance
   &lt;chr&gt;       &lt;chr&gt;                    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
 1 72529014768 GREATER ROCHESTER INTERâ¦ US     43.1 -77.7 1.97e7 2.02e7     7.11
 2 99999914768 ROCHESTER MONROE CO ARPT US     43.1 -77.7 1.95e7 1.97e7     7.25
 3 72529599999 ROCHESTER COAST GUARD Lâ¦ US     43.2 -77.6 1.98e7 2.00e7    11.1 
 4 99800999999 ROCHESTER                US     43.2 -77.6 2.01e7 2.02e7    11.2 
 5 99826799999 ROCHESTER                US     43.3 -77.6 2.01e7 2.02e7    13.4 
 6 99719099999 LAKE ONTARIO BUOY - 20Nâ¦ US     43.6 -77.4 2.01e7 2.01e7    54.5 
 7 72498899999 DANSVILLE MUNI           US     42.6 -77.7 2.00e7 2.00e7    65.1 
 8 72523094704 DANSVILLE/MUNICIPAL      US     42.6 -77.7 1.97e7 1.99e7    65.1 
 9 99999994704 DANSVILLE MUNI AP        US     42.6 -77.7 1.95e7 2.00e7    65.1 
10 72498894704 DANSVILLE MUNICIPAL ARPT US     42.6 -77.7 2.00e7 2.02e7    65.2 
# â¹ 15 more rows
# â¹ 2 more variables: Overlap_years &lt;dbl&gt;, Perc_interval_covered &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb68"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(station_list, <span class="at">n =</span> <span class="dv">26</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 Ã 10
   chillR_code STATION.NAME             CTRY    Lat  Long  BEGIN    END Distance
   &lt;chr&gt;       &lt;chr&gt;                    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
 1 72529014768 GREATER ROCHESTER INTERâ¦ US     43.1 -77.7 1.97e7 2.02e7     7.11
 2 99999914768 ROCHESTER MONROE CO ARPT US     43.1 -77.7 1.95e7 1.97e7     7.25
 3 72529599999 ROCHESTER COAST GUARD Lâ¦ US     43.2 -77.6 1.98e7 2.00e7    11.1 
 4 99800999999 ROCHESTER                US     43.2 -77.6 2.01e7 2.02e7    11.2 
 5 99826799999 ROCHESTER                US     43.3 -77.6 2.01e7 2.02e7    13.4 
 6 99719099999 LAKE ONTARIO BUOY - 20Nâ¦ US     43.6 -77.4 2.01e7 2.01e7    54.5 
 7 72498899999 DANSVILLE MUNI           US     42.6 -77.7 2.00e7 2.00e7    65.1 
 8 72523094704 DANSVILLE/MUNICIPAL      US     42.6 -77.7 1.97e7 1.99e7    65.1 
 9 99999994704 DANSVILLE MUNI AP        US     42.6 -77.7 1.95e7 2.00e7    65.1 
10 72498894704 DANSVILLE MUNICIPAL ARPT US     42.6 -77.7 2.00e7 2.02e7    65.2 
11 72523099999 DANSVILLE MUNICIPAL      US     42.6 -77.7 2.00e7 2.00e7    65.6 
12 72519454778 PENN YAN AIRPORT         US     42.6 -77.1 2.01e7 2.02e7    71.8 
13 9999994727  GENEVA SAMPSON AFB       US     42.8 -76.9 1.95e7 1.96e7    72.4 
14 72519499999 PENN YAN                 US     42.6 -77.0 2.00e7 2.01e7    73.0 
15 71430099999 POINT PETRE (AUT)  ONT   CA     43.8 -77.2 1.98e7 2.02e7    84.3 
16 71626899999 PT PETRE                 CA     43.8 -77.2 1.98e7 1.98e7    84.3 
17 72626899999 POINT PETRE (MARS)       CA     43.8 -77.2 1.98e7 1.98e7    84.3 
18 99596099999 PRINCE EDWARD PT         CA     43.8 -76.9 1.99e7 2.01e7    92.5 
19 99798999999 OLCOTT HARBOR            US     43.3 -78.7 2.01e7 2.02e7    92.8 
20 72519599999 OSWEGO COAST GUARD STATâ¦ US     43.5 -76.5 1.98e7 2.00e7    94.5 
21 99726499999 9052030 - OSWEGO  NY     US     43.5 -76.5 2.00e7 2.02e7    94.8 
22 99999914733 BUFFALO BUFFALO ARPT     US     42.9 -78.7 1.97e7 1.97e7    95.3 
23 72528014733 BUFFALO NIAGARA INTERNAâ¦ US     42.9 -78.7 1.94e7 2.02e7    95.3 
24 71431099999 COBOURG (AUT)  ONT       CA     44.0 -78.2 1.98e7 2.02e7   100.  
25 71626699999 COBOURG                  CA     44.0 -78.2 1.98e7 1.98e7   100.  
# â¹ 2 more variables: Overlap_years &lt;dbl&gt;, Perc_interval_covered &lt;dbl&gt;</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Identify suitable weather stations for patching gaps</li>
</ol>
<p>#download stations number 4, 5, and 10 these will be used to patch the gaps</p>
<ol start="4" type="1">
<li>Download weather data for promising stations, convert them to chillR format and compile them in a list</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb70"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>patch_weather<span class="ot">&lt;-</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handle_gsod</span>(<span class="at">action =</span> <span class="st">&quot;download_weather&quot;</span>,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">location =</span> <span class="fu">as.character</span>(station_list<span class="sc">$</span>chillR_code[<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">10</span>)]),</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">time_interval =</span> <span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2020</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handle_gsod</span>()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading data for 31 years from station &#39;DANSVILLE MUNICIPAL ARPT&#39;
================================================================================

Loading data for 31 years from station &#39;ROCHESTER&#39;
================================================================================

Loading data for 31 years from station &#39;ROCHESTER&#39;
================================================================================</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>Use the patch_daily_temperatures function to fill gaps</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb72"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>patched <span class="ot">&lt;-</span> <span class="fu">patch_daily_temperatures</span>(<span class="at">weather =</span> Rochester,</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">patch_weather =</span> patch_weather)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">1</span>]]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     mean_bias stdev_bias filled gaps_remain
Tmin    -0.213      2.319      0           0
Tmax    -0.521      2.143      0           1</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb74"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">2</span>]]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     mean_bias stdev_bias filled gaps_remain
Tmin    -2.944      2.520      0           0
Tmax     2.408      2.624      0           1</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb76"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">3</span>]]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     mean_bias stdev_bias filled gaps_remain
Tmin    -2.238      2.316      0           0
Tmax     2.325      2.761      0           1</code></pre>
</div>
</div>
<p>#set minimum quality criteria</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb78"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>patched <span class="ot">&lt;-</span> <span class="fu">patch_daily_temperatures</span>(<span class="at">weather =</span> Rochester,</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">patch_weather =</span> patch_weather,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">max_mean_bias =</span> <span class="dv">1</span>,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">max_stdev_bias =</span> <span class="dv">2</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">1</span>]]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     mean_bias stdev_bias filled gaps_remain
Tmin    -0.213      2.319      0           0
Tmax    -0.521      2.143      0           1</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb80"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">2</span>]]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     mean_bias stdev_bias filled gaps_remain
Tmin    -2.944      2.520      0           0
Tmax     2.408      2.624      0           1</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb82"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">3</span>]]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     mean_bias stdev_bias filled gaps_remain
Tmin    -2.238      2.316      0           0
Tmax     2.325      2.761      0           1</code></pre>
</div>
</div>
<ol start="6" type="1">
<li>Investigate the results - have all gaps been filled?</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb84"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>post_patch_stats <span class="ot">&lt;-</span> <span class="fu">fix_weather</span>(patched)<span class="sc">$</span>QC</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>post_patch_stats</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      Season End_year Season_days Data_days Missing_Tmin Missing_Tmax
1  1989/1990     1990         365       365            0            0
2  1990/1991     1991         365       365            0            0
3  1991/1992     1992         366       366            0            0
4  1992/1993     1993         365       365            0            0
5  1993/1994     1994         365       365            0            0
6  1994/1995     1995         365       365            0            0
7  1995/1996     1996         366       366            0            0
8  1996/1997     1997         365       365            0            0
9  1997/1998     1998         365       365            0            0
10 1998/1999     1999         365       365            0            0
11 1999/2000     2000         366       366            0            0
12 2000/2001     2001         365       365            0            0
13 2001/2002     2002         365       365            0            1
14 2002/2003     2003         365       365            0            0
15 2003/2004     2004         366       366            0            0
16 2004/2005     2005         365       365            0            0
17 2005/2006     2006         365       365            0            0
18 2006/2007     2007         365       365            0            0
19 2007/2008     2008         366       366            0            0
20 2008/2009     2009         365       365            0            0
21 2009/2010     2010         365       365            0            0
22 2010/2011     2011         365       365            0            0
23 2011/2012     2012         366       366            0            0
24 2012/2013     2013         365       365            0            0
25 2013/2014     2014         365       365            0            0
26 2014/2015     2015         365       365            0            0
27 2015/2016     2016         366       366            0            0
28 2016/2017     2017         365       365            0            0
29 2017/2018     2018         365       365            0            0
30 2018/2019     2019         365       365            0            0
31 2019/2020     2020         366       366            0            0
   Incomplete_days Perc_complete
1                0         100.0
2                0         100.0
3                0         100.0
4                0         100.0
5                0         100.0
6                0         100.0
7                0         100.0
8                0         100.0
9                0         100.0
10               0         100.0
11               0         100.0
12               0         100.0
13               1          99.7
14               0         100.0
15               0         100.0
16               0         100.0
17               0         100.0
18               0         100.0
19               0         100.0
20               0         100.0
21               0         100.0
22               0         100.0
23               0         100.0
24               0         100.0
25               0         100.0
26               0         100.0
27               0         100.0
28               0         100.0
29               0         100.0
30               0         100.0
31               0         100.0</code></pre>
</div>
</div>
<ol start="7" type="1">
<li>If necessary, repeat until you have a dataset you can work with in further analyses</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb86"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>Rochester_weather<span class="ot">&lt;-</span><span class="fu">fix_weather</span>(patched)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>patched_monthly <span class="ot">&lt;-</span> <span class="fu">patch_daily_temps</span>(<span class="at">weather =</span> Rochester,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">patch_weather =</span> patch_weather,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">max_mean_bias =</span> <span class="dv">1</span>,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">max_stdev_bias =</span> <span class="dv">2</span>,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">time_interval =</span> <span class="st">&quot;month&quot;</span>)</span></code></pre></div>
</details>
</div>
<p>#saving the data for later</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb87"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>monthly_bias_fixed <span class="ot">&lt;-</span> <span class="fu">fix_weather</span>(patched_monthly)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(monthly_bias_fixed<span class="sc">$</span>weather,</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;data_New_York/Rochester_weather.csv&quot;</span>)</span></code></pre></div>
</details>
</div>
<hr />
</section>
</section>
<section id="chapter-12-generating-temperature-scenarios" class="level1">
<h1>Chapter 12: Generating temperature scenarios</h1>
<section id="exercises-on-getting-temperature-data-2" class="level2">
<h2><strong><em>Exercises on getting temperature data</em></strong></h2>
<ol type="1">
<li>For the location you chose for your earlier analyses, use chillRâs weather generator to produce 100 years of synthetic temperature data.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb88"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>Rochester <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;data_New_York/Rochester_weather.csv&#39;</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>Temp <span class="ot">&lt;-</span> Rochester <span class="sc">%&gt;%</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">temperature_generation</span>(<span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1998</span>,<span class="dv">2009</span>),</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sim_years =</span> <span class="fu">c</span>(<span class="dv">2001</span>,<span class="dv">2100</span>))</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>Temperatures <span class="ot">&lt;-</span> Rochester <span class="sc">%&gt;%</span> </span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, Month, Day, Tmin, Tmax) <span class="sc">%&gt;%</span> </span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="dv">1998</span><span class="sc">:</span><span class="dv">2009</span>) <span class="sc">%&gt;%</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">Data_source =</span> <span class="st">&quot;observed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>    Temp[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(Year,</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>                           Month,</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>                           Day,</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>                           Tmin,</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>                           Tmax)) <span class="sc">%&gt;%</span></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(<span class="at">Data_source =</span> <span class="st">&quot;simulated&quot;</span>)</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(<span class="fu">ISOdate</span>(<span class="dv">2000</span>,</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>                                Month,</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>                                Day)))</span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Temperatures,</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(Date,</span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>           Tmin)) <span class="sc">+</span></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">colour =</span> <span class="fu">factor</span>(Year))) <span class="sc">+</span></span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Data_source)) <span class="sc">+</span></span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">&quot;%b&quot;</span>)</span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Temperatures,</span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(Date,</span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a>           Tmax)) <span class="sc">+</span></span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">colour =</span> <span class="fu">factor</span>(Year))) <span class="sc">+</span></span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Data_source)) <span class="sc">+</span></span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">&quot;%b&quot;</span>)</span></code></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Calculate winter chill (in Chill Portions) for your synthetic weather, and illustrate your results as histograms and cumulative distributions.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb89"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>Rochester <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;data_New_York/Rochester_weather.csv&#39;</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>Temp <span class="ot">&lt;-</span> Rochester <span class="sc">%&gt;%</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">temperature_generation</span>(<span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1998</span>,<span class="dv">2009</span>),</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sim_years =</span> <span class="fu">c</span>(<span class="dv">2001</span>,<span class="dv">2100</span>))</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>Temperatures <span class="ot">&lt;-</span> Rochester <span class="sc">%&gt;%</span> </span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, Month, Day, Tmin, Tmax) <span class="sc">%&gt;%</span> </span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="dv">1998</span><span class="sc">:</span><span class="dv">2009</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">Data_source =</span> <span class="st">&quot;observed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>    Temp[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(Year,</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>                           Month,</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>                           Day,</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>                           Tmin,</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>                           Tmax)) <span class="sc">%&gt;%</span></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(<span class="at">Data_source =</span> <span class="st">&quot;simulated&quot;</span>)</span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(<span class="fu">ISOdate</span>(<span class="dv">2000</span>,</span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>                                Month,</span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>                                Day)))</span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>chill_observed <span class="ot">&lt;-</span> Temperatures <span class="sc">%&gt;%</span></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Data_source <span class="sc">==</span> <span class="st">&quot;observed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack_hourly_temps</span>(<span class="at">latitude =</span> <span class="fl">43.15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">chilling</span>(<span class="at">Start_JDay =</span> <span class="dv">305</span>,</span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">End_JDay =</span> <span class="dv">59</span>)</span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>chill_simulated <span class="ot">&lt;-</span> Temperatures <span class="sc">%&gt;%</span></span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Data_source <span class="sc">==</span> <span class="st">&quot;simulated&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack_hourly_temps</span>(<span class="at">latitude =</span> <span class="fl">43.15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">chilling</span>(<span class="at">Start_JDay =</span> <span class="dv">305</span>,</span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">End_JDay =</span> <span class="dv">59</span>)</span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a>chill_comparison <span class="ot">&lt;-</span></span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(chill_observed,</span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">Data_source =</span> <span class="st">&quot;observed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">cbind</span>(chill_simulated,</span>
<span id="cb89-45"><a href="#cb89-45" aria-hidden="true" tabindex="-1"></a>              <span class="at">Data_source =</span> <span class="st">&quot;simulated&quot;</span>))</span>
<span id="cb89-46"><a href="#cb89-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-47"><a href="#cb89-47" aria-hidden="true" tabindex="-1"></a>chill_comparison_full_seasons <span class="ot">&lt;-</span> </span>
<span id="cb89-48"><a href="#cb89-48" aria-hidden="true" tabindex="-1"></a>  chill_comparison <span class="sc">%&gt;%</span></span>
<span id="cb89-49"><a href="#cb89-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Perc_complete <span class="sc">==</span> <span class="dv">100</span>)</span>
<span id="cb89-50"><a href="#cb89-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-51"><a href="#cb89-51" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chill_comparison_full_seasons,</span>
<span id="cb89-52"><a href="#cb89-52" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Chill_portions)) <span class="sc">+</span> </span>
<span id="cb89-53"><a href="#cb89-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>,</span>
<span id="cb89-54"><a href="#cb89-54" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(Data_source))) <span class="sc">+</span></span>
<span id="cb89-55"><a href="#cb89-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb89-56"><a href="#cb89-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Data source&quot;</span>) <span class="sc">+</span></span>
<span id="cb89-57"><a href="#cb89-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Chill accumulation (Chill Portions)&quot;</span>) <span class="sc">+</span></span>
<span id="cb89-58"><a href="#cb89-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Frequency&quot;</span>)</span>
<span id="cb89-59"><a href="#cb89-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-60"><a href="#cb89-60" aria-hidden="true" tabindex="-1"></a>chill_simulations <span class="ot">&lt;-</span></span>
<span id="cb89-61"><a href="#cb89-61" aria-hidden="true" tabindex="-1"></a>  chill_comparison_full_seasons <span class="sc">%&gt;%</span></span>
<span id="cb89-62"><a href="#cb89-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Data_source <span class="sc">==</span> <span class="st">&quot;simulated&quot;</span>)</span>
<span id="cb89-63"><a href="#cb89-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-64"><a href="#cb89-64" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chill_simulations,</span>
<span id="cb89-65"><a href="#cb89-65" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Chill_portions)) <span class="sc">+</span></span>
<span id="cb89-66"><a href="#cb89-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ecdf</span>(<span class="at">geom =</span> <span class="st">&quot;step&quot;</span>,</span>
<span id="cb89-67"><a href="#cb89-67" aria-hidden="true" tabindex="-1"></a>            <span class="at">lwd =</span> <span class="fl">1.5</span>,</span>
<span id="cb89-68"><a href="#cb89-68" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb89-69"><a href="#cb89-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Cumulative probability&quot;</span>) <span class="sc">+</span></span>
<span id="cb89-70"><a href="#cb89-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Chill accumulation (in Chill Portions)&quot;</span>) <span class="sc">+</span></span>
<span id="cb89-71"><a href="#cb89-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Produce similar plots for the number of freezing hours (&lt;0Â°C) in April (or October, if your site is in the Southern Hemisphere) for your location of interest.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb90"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>Rochester <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;data_New_York/Rochester_weather.csv&#39;</span>)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>Temp <span class="ot">&lt;-</span> Rochester <span class="sc">%&gt;%</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">temperature_generation</span>(<span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1998</span>,<span class="dv">2009</span>),</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sim_years =</span> <span class="fu">c</span>(<span class="dv">2001</span>,<span class="dv">2100</span>))</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>Temperatures <span class="ot">&lt;-</span> Rochester <span class="sc">%&gt;%</span> </span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, Month, Day, Tmin, Tmax) <span class="sc">%&gt;%</span> </span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="dv">1998</span><span class="sc">:</span><span class="dv">2009</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">Data_source =</span> <span class="st">&quot;observed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>    Temp[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(Year,</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>                           Month,</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>                           Day,</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>                           Tmin,</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>                           Tmax)) <span class="sc">%&gt;%</span></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(<span class="at">Data_source =</span> <span class="st">&quot;simulated&quot;</span>)</span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(<span class="fu">ISOdate</span>(<span class="dv">2000</span>,</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>                                Month,</span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>                                Day)))</span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span>  <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1000</span>,    <span class="dv">0</span>),</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span>  <span class="fu">c</span>(    <span class="dv">0</span>, <span class="dv">1000</span>),</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">c</span>(    <span class="dv">1</span>,    <span class="dv">0</span>))</span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>freezing_hours <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">step_model</span>(x,df)</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>chill_observed <span class="ot">&lt;-</span> Temperatures <span class="sc">%&gt;%</span></span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Data_source <span class="sc">==</span> <span class="st">&quot;observed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack_hourly_temps</span>(<span class="at">latitude =</span> <span class="fl">43.15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tempResponse</span>(<span class="at">Start_JDay =</span> <span class="dv">91</span>,</span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">End_JDay =</span> <span class="dv">120</span>,</span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>               <span class="at">models =</span> <span class="fu">list</span>(<span class="at">Frost =</span> freezing_hours,</span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Chill_portions =</span> Dynamic_Model,</span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>                             <span class="at">GDH =</span> GDH))</span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>chill_simulated <span class="ot">&lt;-</span> Temperatures <span class="sc">%&gt;%</span></span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Data_source <span class="sc">==</span> <span class="st">&quot;simulated&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack_hourly_temps</span>(<span class="at">latitude =</span> <span class="fl">43.15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tempResponse</span>(<span class="at">Start_JDay =</span> <span class="dv">91</span>,</span>
<span id="cb90-48"><a href="#cb90-48" aria-hidden="true" tabindex="-1"></a>               <span class="at">End_JDay =</span> <span class="dv">120</span>,</span>
<span id="cb90-49"><a href="#cb90-49" aria-hidden="true" tabindex="-1"></a>               <span class="at">models=</span><span class="fu">list</span>(<span class="at">Frost =</span> freezing_hours,</span>
<span id="cb90-50"><a href="#cb90-50" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Chill_portions =</span> Dynamic_Model,</span>
<span id="cb90-51"><a href="#cb90-51" aria-hidden="true" tabindex="-1"></a>                           <span class="at">GDH =</span> GDH))</span>
<span id="cb90-52"><a href="#cb90-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-53"><a href="#cb90-53" aria-hidden="true" tabindex="-1"></a>chill_comparison <span class="ot">&lt;-</span></span>
<span id="cb90-54"><a href="#cb90-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(chill_observed,</span>
<span id="cb90-55"><a href="#cb90-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">Data_source =</span> <span class="st">&quot;observed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-56"><a href="#cb90-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">cbind</span>(chill_simulated,</span>
<span id="cb90-57"><a href="#cb90-57" aria-hidden="true" tabindex="-1"></a>              <span class="at">Data_source =</span> <span class="st">&quot;simulated&quot;</span>))</span>
<span id="cb90-58"><a href="#cb90-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-59"><a href="#cb90-59" aria-hidden="true" tabindex="-1"></a>chill_comparison_full_seasons <span class="ot">&lt;-</span></span>
<span id="cb90-60"><a href="#cb90-60" aria-hidden="true" tabindex="-1"></a>  chill_comparison <span class="sc">%&gt;%</span></span>
<span id="cb90-61"><a href="#cb90-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Perc_complete <span class="sc">==</span> <span class="dv">100</span>)</span>
<span id="cb90-62"><a href="#cb90-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-63"><a href="#cb90-63" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chill_comparison_full_seasons,</span>
<span id="cb90-64"><a href="#cb90-64" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Frost)) <span class="sc">+</span> </span>
<span id="cb90-65"><a href="#cb90-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">25</span>,</span>
<span id="cb90-66"><a href="#cb90-66" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(Data_source))) <span class="sc">+</span></span>
<span id="cb90-67"><a href="#cb90-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb90-68"><a href="#cb90-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Data source&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-69"><a href="#cb90-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Frost incidence during April (hours)&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-70"><a href="#cb90-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Frequency&quot;</span>)</span>
<span id="cb90-71"><a href="#cb90-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-72"><a href="#cb90-72" aria-hidden="true" tabindex="-1"></a>chill_simulations <span class="ot">&lt;-</span></span>
<span id="cb90-73"><a href="#cb90-73" aria-hidden="true" tabindex="-1"></a>  chill_comparison_full_seasons <span class="sc">%&gt;%</span></span>
<span id="cb90-74"><a href="#cb90-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Data_source <span class="sc">==</span> <span class="st">&quot;simulated&quot;</span>)</span>
<span id="cb90-75"><a href="#cb90-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-76"><a href="#cb90-76" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chill_simulations,</span>
<span id="cb90-77"><a href="#cb90-77" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Frost)) <span class="sc">+</span></span>
<span id="cb90-78"><a href="#cb90-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ecdf</span>(<span class="at">geom =</span> <span class="st">&quot;step&quot;</span>,</span>
<span id="cb90-79"><a href="#cb90-79" aria-hidden="true" tabindex="-1"></a>            <span class="at">lwd =</span> <span class="fl">1.5</span>,</span>
<span id="cb90-80"><a href="#cb90-80" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-81"><a href="#cb90-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Cumulative probability&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-82"><a href="#cb90-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Frost incidence during April (hours)&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-83"><a href="#cb90-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code></pre></div>
</details>
</div>
<hr />
</section>
</section>
<section id="chapter-14-generating-historic-temperature-scenarios" class="level1">
<h1>Chapter 14: Generating historic temperature scenarios</h1>
<section id="exercises-on-historic-temperature-scenarios" class="level2">
<h2><strong><em>Exercises on historic temperature scenarios</em></strong></h2>
<ol type="1">
<li>For the location you chose for previous exercises, produce historic temperature scenarios representing several years of the historic record (your choice).</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb91"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(kableExtra)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># downloading weather station list for the vicinity of Rochester</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>station_list <span class="ot">&lt;-</span> <span class="fu">handle_gsod</span>(<span class="at">action =</span> <span class="st">&quot;list_stations&quot;</span>,</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">location=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">77.60</span>, <span class="fl">43.15</span>))</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="co"># downloading weather data for Greater Rochester International AP and convert it to chillR format</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>Rochester_weather <span class="ot">&lt;-</span> <span class="fu">handle_gsod</span>(<span class="at">action =</span> <span class="st">&quot;download_weather&quot;</span>,</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">location =</span> station_list<span class="sc">$</span>chillR_code[<span class="dv">1</span>],</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">time_interval =</span> <span class="fu">c</span>(<span class="dv">1973</span>,<span class="dv">2019</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handle_gsod</span>()</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="co"># check record for missing data</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a><span class="fu">fix_weather</span>(Rochester_weather<span class="sc">$</span><span class="st">&#39;GREATER ROCHESTER INTERNATIONAL AP&#39;</span>)<span class="sc">$</span>QC</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>Rochester_patched <span class="ot">&lt;-</span> <span class="fu">patch_daily_temperatures</span>(</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">weather =</span> Rochester_weather<span class="sc">$</span><span class="st">&#39;GREATER ROCHESTER INTERNATIONAL AP&#39;</span>,</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">patch_weather =</span> <span class="fu">list</span>(KA_weather))</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a><span class="fu">fix_weather</span>(Rochester_patched)<span class="sc">$</span>QC</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a><span class="co"># interpolating these gaps now</span></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>Rochester<span class="ot">&lt;-</span><span class="fu">fix_weather</span>(Rochester_patched)</span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>Rochester_temps<span class="ot">&lt;-</span>Rochester<span class="sc">$</span>weather</span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>scenario_1980 <span class="ot">&lt;-</span> <span class="fu">temperature_scenario_from_records</span>(<span class="at">weather =</span> Rochester_temps,</span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">year =</span> <span class="dv">1980</span>)</span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>scenario_1980<span class="sc">$</span><span class="st">&#39;1980&#39;</span><span class="sc">$</span>data</span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a><span class="co">#what could have happened in 1980 not what happpened</span></span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a>temps_1980 <span class="ot">&lt;-</span> <span class="fu">temperature_generation</span>(<span class="at">weather =</span> Rochester_temps,</span>
<span id="cb91-38"><a href="#cb91-38" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1973</span>, <span class="dv">2019</span>),</span>
<span id="cb91-39"><a href="#cb91-39" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">sim_years =</span> <span class="fu">c</span>(<span class="dv">2001</span>, <span class="dv">2100</span>),</span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">temperature_scenario =</span> scenario_1980)</span>
<span id="cb91-41"><a href="#cb91-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-42"><a href="#cb91-42" aria-hidden="true" tabindex="-1"></a>scenario_1996 <span class="ot">&lt;-</span> <span class="fu">temperature_scenario_from_records</span>(<span class="at">weather =</span> Rochester_temps,</span>
<span id="cb91-43"><a href="#cb91-43" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">year =</span> <span class="dv">1996</span>)</span>
<span id="cb91-44"><a href="#cb91-44" aria-hidden="true" tabindex="-1"></a>scenario_1996<span class="sc">$</span><span class="st">&#39;1996&#39;</span><span class="sc">$</span>data</span>
<span id="cb91-45"><a href="#cb91-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-46"><a href="#cb91-46" aria-hidden="true" tabindex="-1"></a>relative_scenario <span class="ot">&lt;-</span> <span class="fu">temperature_scenario_baseline_adjustment</span>(</span>
<span id="cb91-47"><a href="#cb91-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline =</span> scenario_1996,</span>
<span id="cb91-48"><a href="#cb91-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">temperature_scenario =</span> scenario_1980)</span>
<span id="cb91-49"><a href="#cb91-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-50"><a href="#cb91-50" aria-hidden="true" tabindex="-1"></a><span class="co"># error message here</span></span>
<span id="cb91-51"><a href="#cb91-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-52"><a href="#cb91-52" aria-hidden="true" tabindex="-1"></a>temps_1980 <span class="ot">&lt;-</span> <span class="fu">temperature_generation</span>(<span class="at">weather =</span> Rochester_temps,</span>
<span id="cb91-53"><a href="#cb91-53" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1973</span>, <span class="dv">2019</span>),</span>
<span id="cb91-54"><a href="#cb91-54" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">sim_years =</span> <span class="fu">c</span>(<span class="dv">2001</span>, <span class="dv">2100</span>),</span>
<span id="cb91-55"><a href="#cb91-55" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">temperature_scenario =</span> relative_scenario)</span>
<span id="cb91-56"><a href="#cb91-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-57"><a href="#cb91-57" aria-hidden="true" tabindex="-1"></a>all_past_scenarios <span class="ot">&lt;-</span> <span class="fu">temperature_scenario_from_records</span>(</span>
<span id="cb91-58"><a href="#cb91-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">weather =</span> Rochester_temps,</span>
<span id="cb91-59"><a href="#cb91-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">1980</span>,</span>
<span id="cb91-60"><a href="#cb91-60" aria-hidden="true" tabindex="-1"></a>           <span class="dv">1990</span>,</span>
<span id="cb91-61"><a href="#cb91-61" aria-hidden="true" tabindex="-1"></a>           <span class="dv">2000</span>,</span>
<span id="cb91-62"><a href="#cb91-62" aria-hidden="true" tabindex="-1"></a>           <span class="dv">2010</span>))</span>
<span id="cb91-63"><a href="#cb91-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-64"><a href="#cb91-64" aria-hidden="true" tabindex="-1"></a>adjusted_scenarios <span class="ot">&lt;-</span> <span class="fu">temperature_scenario_baseline_adjustment</span>(</span>
<span id="cb91-65"><a href="#cb91-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline =</span> scenario_1996,</span>
<span id="cb91-66"><a href="#cb91-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">temperature_scenario =</span> all_past_scenarios)</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb92"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>all_past_scenario_temps <span class="ot">&lt;-</span> <span class="fu">temperature_generation</span>(</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">weather =</span> Rochester_temps,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1973</span>,<span class="dv">2019</span>),</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sim_years =</span> <span class="fu">c</span>(<span class="dv">2001</span>,<span class="dv">2100</span>),</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">temperature_scenario =</span> adjusted_scenarios)</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb93"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>frost_model <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_model</span>(x,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">data.frame</span>(</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">lower=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1000</span>, <span class="dv">0</span>),</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">upper=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>),</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">weight=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>)))</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Chill_Portions =</span> Dynamic_Model,</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">GDH =</span> GDH,</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">Frost_H =</span> frost_model)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>chill_hist_scenario_list <span class="ot">&lt;-</span> <span class="fu">tempResponse_daily_list</span>(all_past_scenario_temps,</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">latitude =</span> <span class="fl">43.15</span>,</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">Start_JDay =</span> <span class="dv">305</span>,</span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">End_JDay =</span> <span class="dv">59</span>,</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">models =</span> models)</span></code></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Produce chill distributions for these scenarios and plot them.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb94"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>scenarios <span class="ot">&lt;-</span> <span class="fu">names</span>(chill_hist_scenario_list)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>all_scenarios <span class="ot">&lt;-</span> chill_hist_scenario_list[[scenarios[<span class="dv">1</span>]]] <span class="sc">%&gt;%</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">scenario =</span> <span class="fu">as.numeric</span>(scenarios[<span class="dv">1</span>]))</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (sc <span class="cf">in</span> scenarios[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a> all_scenarios <span class="ot">&lt;-</span> all_scenarios <span class="sc">%&gt;%</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(chill_hist_scenario_list[[sc]] <span class="sc">%&gt;%</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cbind</span>(</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">scenario=</span><span class="fu">as.numeric</span>(sc))</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Perc_complete <span class="sc">==</span> <span class="dv">100</span>)</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s compute the actual &#39;observed&#39; chill for comparison</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>actual_chill <span class="ot">&lt;-</span> <span class="fu">tempResponse_daily_list</span>(Rochester_temps,</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">latitude =</span> <span class="fl">43.15</span>,</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">Start_JDay =</span> <span class="dv">305</span>,</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">End_JDay =</span> <span class="dv">59</span>,</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>                                        models)[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Perc_complete <span class="sc">==</span> <span class="dv">100</span>)</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> all_scenarios,</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(scenario,</span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>           Chill_Portions,</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">factor</span>(scenario))) <span class="sc">+</span></span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">draw_quantiles =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)) <span class="sc">+</span></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Chill accumulation (Chill Portions)&quot;</span>) <span class="sc">+</span></span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Scenario year&quot;</span>) <span class="sc">+</span></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> actual_chill,</span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(End_year,</span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a>                 Chill_Portions,</span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Scenario&quot;</span>,</span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a>                      <span class="at">breaks =</span> <span class="fu">unique</span>(all_scenarios<span class="sc">$</span>scenario)) </span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a>temperature_means <span class="ot">&lt;-</span> </span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">Year =</span> <span class="fu">min</span>(Rochester_temps<span class="sc">$</span>Year)<span class="sc">:</span><span class="fu">max</span>(Rochester_temps<span class="sc">$</span>Year),</span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">Tmin =</span> <span class="fu">aggregate</span>(Rochester_temps<span class="sc">$</span>Tmin,</span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a>                              <span class="at">FUN =</span> <span class="st">&quot;mean&quot;</span>,</span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a>                              <span class="at">by =</span> <span class="fu">list</span>(Rochester_temps<span class="sc">$</span>Year))[,<span class="dv">2</span>],</span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a>             <span class="at">Tmax=</span><span class="fu">aggregate</span>(Rochester_temps<span class="sc">$</span>Tmax,</span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a>                            <span class="at">FUN =</span> <span class="st">&quot;mean&quot;</span>,</span>
<span id="cb94-50"><a href="#cb94-50" aria-hidden="true" tabindex="-1"></a>                            <span class="at">by =</span> <span class="fu">list</span>(Rochester_temps<span class="sc">$</span>Year))[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb94-51"><a href="#cb94-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">runn_mean_Tmin =</span> <span class="fu">runn_mean</span>(Tmin,<span class="dv">15</span>),</span>
<span id="cb94-52"><a href="#cb94-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">runn_mean_Tmax =</span> <span class="fu">runn_mean</span>(Tmax,<span class="dv">15</span>))</span>
<span id="cb94-53"><a href="#cb94-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-54"><a href="#cb94-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-55"><a href="#cb94-55" aria-hidden="true" tabindex="-1"></a>Tmin_regression <span class="ot">&lt;-</span> <span class="fu">lm</span>(Tmin <span class="sc">~</span> Year,</span>
<span id="cb94-56"><a href="#cb94-56" aria-hidden="true" tabindex="-1"></a>                      temperature_means)</span>
<span id="cb94-57"><a href="#cb94-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-58"><a href="#cb94-58" aria-hidden="true" tabindex="-1"></a>Tmax_regression <span class="ot">&lt;-</span> <span class="fu">lm</span>(Tmax <span class="sc">~</span> Year,</span>
<span id="cb94-59"><a href="#cb94-59" aria-hidden="true" tabindex="-1"></a>                      temperature_means)</span>
<span id="cb94-60"><a href="#cb94-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-61"><a href="#cb94-61" aria-hidden="true" tabindex="-1"></a>temperature_means <span class="ot">&lt;-</span> temperature_means <span class="sc">%&gt;%</span></span>
<span id="cb94-62"><a href="#cb94-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">regression_Tmin =</span> Tmin_regression<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span></span>
<span id="cb94-63"><a href="#cb94-63" aria-hidden="true" tabindex="-1"></a>           Tmin_regression<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>temperature_means<span class="sc">$</span>Year,</span>
<span id="cb94-64"><a href="#cb94-64" aria-hidden="true" tabindex="-1"></a>         <span class="at">regression_Tmax =</span> Tmax_regression<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span></span>
<span id="cb94-65"><a href="#cb94-65" aria-hidden="true" tabindex="-1"></a>           Tmax_regression<span class="sc">$</span>coefficients[<span class="dv">2</span>]<span class="sc">*</span>temperature_means<span class="sc">$</span>Year</span>
<span id="cb94-66"><a href="#cb94-66" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-67"><a href="#cb94-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-68"><a href="#cb94-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-69"><a href="#cb94-69" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temperature_means,</span>
<span id="cb94-70"><a href="#cb94-70" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(Year,</span>
<span id="cb94-71"><a href="#cb94-71" aria-hidden="true" tabindex="-1"></a>           Tmin)) <span class="sc">+</span> </span>
<span id="cb94-72"><a href="#cb94-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb94-73"><a href="#cb94-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> temperature_means,</span>
<span id="cb94-74"><a href="#cb94-74" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(Year,</span>
<span id="cb94-75"><a href="#cb94-75" aria-hidden="true" tabindex="-1"></a>                runn_mean_Tmin),</span>
<span id="cb94-76"><a href="#cb94-76" aria-hidden="true" tabindex="-1"></a>            <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb94-77"><a href="#cb94-77" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb94-78"><a href="#cb94-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> temperature_means,</span>
<span id="cb94-79"><a href="#cb94-79" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(Year,</span>
<span id="cb94-80"><a href="#cb94-80" aria-hidden="true" tabindex="-1"></a>                regression_Tmin),</span>
<span id="cb94-81"><a href="#cb94-81" aria-hidden="true" tabindex="-1"></a>            <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb94-82"><a href="#cb94-82" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb94-83"><a href="#cb94-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb94-84"><a href="#cb94-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Mean monthly minimum temperature (Â°C)&quot;</span>)</span>
<span id="cb94-85"><a href="#cb94-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-86"><a href="#cb94-86" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temperature_means,</span>
<span id="cb94-87"><a href="#cb94-87" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(Year,</span>
<span id="cb94-88"><a href="#cb94-88" aria-hidden="true" tabindex="-1"></a>           Tmax)) <span class="sc">+</span> </span>
<span id="cb94-89"><a href="#cb94-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb94-90"><a href="#cb94-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> temperature_means,</span>
<span id="cb94-91"><a href="#cb94-91" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(Year,</span>
<span id="cb94-92"><a href="#cb94-92" aria-hidden="true" tabindex="-1"></a>                runn_mean_Tmax),</span>
<span id="cb94-93"><a href="#cb94-93" aria-hidden="true" tabindex="-1"></a>            <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb94-94"><a href="#cb94-94" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb94-95"><a href="#cb94-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> temperature_means,</span>
<span id="cb94-96"><a href="#cb94-96" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(Year, </span>
<span id="cb94-97"><a href="#cb94-97" aria-hidden="true" tabindex="-1"></a>                regression_Tmax),</span>
<span id="cb94-98"><a href="#cb94-98" aria-hidden="true" tabindex="-1"></a>            <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb94-99"><a href="#cb94-99" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb94-100"><a href="#cb94-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb94-101"><a href="#cb94-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Mean monthly maximum temperature (Â°C)&quot;</span>)</span></code></pre></div>
</details>
</div>
<hr />
</section>
</section>
<section id="chapter-15-future-temperature-scenarios" class="level1">
<h1>Chapter 15: Future temperature scenarios</h1>
<section id="exercises-on-future-temperature-scenarios" class="level2">
<h2>*<strong>Exercises on future temperature scenarios</strong></h2>
<ol type="1">
<li>Briefly describe the differences between the RCPs and the SSPs.</li>
</ol>
<p>Representative Concentration Pathways (RCPs) are climate change scenarios to project future greenhouse gas concentrations.These pathways (or trajectories) describe future greenhouse gas concentrations (not emissions) and have been formally adopted by the IPCC. The pathways describe different climate change scenarios, all of which were considered possible depending on the amount of greenhouse gases (GHG) emitted in the years to come.</p>
<p>Shared Socioeconomic Pathways (SSPs) are climate change scenarios of projected socioeconomic global changes up to 2100 as defined in the IPCC Sixth Assessment Report on climate change in 2021.The SRES scenarios are âbaselineâ (or âreferenceâ) scenarios, which means that they do not take into account any current or future measures to limit greenhouse gas (GHG) emissions.</p>
<p>A major difference between both models is that RCPs focus on Emissions and Radiative Forcing while SSPs emphasize Socioeconomic Pathways.In phenology SSPs integrate societal drivers, allowing phenologists to link temperature scenarios with land use changes, habitat fragmentation, or conservation efforts.</p>
</section>
</section>
<section id="chapter-16-generating-cmip6-temperature-scenarios" class="level1">
<h1>Chapter 16: Generating CMIP6 temperature scenarios</h1>
<section id="exercises-on-generating-cmip6-temperature-scenarios" class="level2">
<h2><strong><em>Exercises on generating CMIP6 temperature scenarios</em></strong></h2>
<ol type="1">
<li>Analyze the historic and future impact of climate change on two agroclimatic metrics of your choice, for the location youâve chosen for your earlier analyses.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb95"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(chillR)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ecmwfr)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(tidyverse)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="co">#read Rochester_temps</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>Rochester_temps <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_temps.csv&quot;</span>)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>location<span class="ot">=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">77.60</span>, <span class="fl">43.15</span>) <span class="co">#Rochester</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>area <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="sc">-</span><span class="dv">79</span>, <span class="dv">40</span>, <span class="sc">-</span><span class="dv">71</span>)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a><span class="fu">download_cmip6_ecmwfr</span>(</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">scenarios =</span> <span class="fu">c</span>(<span class="st">&quot;ssp126&quot;</span>, <span class="st">&quot;ssp245&quot;</span>, <span class="st">&quot;ssp370&quot;</span>, <span class="st">&quot;ssp585&quot;</span>),</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">area =</span> area,</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">key =</span> <span class="st">&#39;e1bd6995-c569-4df1-bbe8-3549cb586e4a&#39;</span>,</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">&#39;default&#39;</span>,</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency =</span> <span class="st">&#39;monthly&#39;</span>,</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">&#39;Tmin&#39;</span>,  <span class="st">&#39;Tmax&#39;</span>),</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_start =</span> <span class="dv">2015</span>,</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_end =</span> <span class="dv">2100</span>)</span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a><span class="fu">download_baseline_cmip6_ecmwfr</span>(</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">area =</span> area,</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">key =</span> <span class="st">&#39;e1bd6995-c569-4df1-bbe8-3549cb586e4a&#39;</span>,</span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">&#39;match_downloaded&#39;</span>,</span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency =</span> <span class="st">&#39;monthly&#39;</span>,</span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">&#39;Tmin&#39;</span>, <span class="st">&#39;Tmax&#39;</span>),</span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_start =</span> <span class="dv">1986</span>, </span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_end =</span> <span class="dv">2014</span>, </span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">month =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a><span class="fu">download_baseline_cmip6_ecmwfr</span>(</span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">area =</span> area,</span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">key =</span> <span class="st">&#39;e1bd6995-c569-4df1-bbe8-3549cb586e4a&#39;</span>,</span>
<span id="cb95-38"><a href="#cb95-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">&#39;match_downloaded&#39;</span>,</span>
<span id="cb95-39"><a href="#cb95-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">frequency =</span> <span class="st">&#39;monthly&#39;</span>,</span>
<span id="cb95-40"><a href="#cb95-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">&#39;Tmin&#39;</span>, <span class="st">&#39;Tmax&#39;</span>),</span>
<span id="cb95-41"><a href="#cb95-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_start =</span> <span class="dv">1986</span>,</span>
<span id="cb95-42"><a href="#cb95-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_end =</span> <span class="dv">2014</span>,</span>
<span id="cb95-43"><a href="#cb95-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">month =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span>
<span id="cb95-44"><a href="#cb95-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-45"><a href="#cb95-45" aria-hidden="true" tabindex="-1"></a>station <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb95-46"><a href="#cb95-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">station_name =</span> <span class="fu">c</span>(<span class="st">&quot;Rochester&quot;</span>),</span>
<span id="cb95-47"><a href="#cb95-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">longitude =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">77.60</span>),</span>
<span id="cb95-48"><a href="#cb95-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">latitude =</span> <span class="fu">c</span>(<span class="fl">43.15</span>))</span>
<span id="cb95-49"><a href="#cb95-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-50"><a href="#cb95-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ncdf4)</span>
<span id="cb95-51"><a href="#cb95-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PCICt)</span>
<span id="cb95-52"><a href="#cb95-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-53"><a href="#cb95-53" aria-hidden="true" tabindex="-1"></a>extracted <span class="ot">&lt;-</span> <span class="fu">extract_cmip6_data</span>(<span class="at">stations =</span> station)</span>
<span id="cb95-54"><a href="#cb95-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-55"><a href="#cb95-55" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(extracted<span class="sc">$</span><span class="st">`</span><span class="at">ssp126_AWI-CM-1-1-MR</span><span class="st">`</span>)</span>
<span id="cb95-56"><a href="#cb95-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-57"><a href="#cb95-57" aria-hidden="true" tabindex="-1"></a>change_scenarios <span class="ot">&lt;-</span> </span>
<span id="cb95-58"><a href="#cb95-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gen_rel_change_scenario</span>(extracted,</span>
<span id="cb95-59"><a href="#cb95-59" aria-hidden="true" tabindex="-1"></a>                          <span class="at">scenarios =</span> <span class="fu">c</span>(<span class="dv">2050</span>, <span class="dv">2085</span>),</span>
<span id="cb95-60"><a href="#cb95-60" aria-hidden="true" tabindex="-1"></a>                          <span class="at">reference_period =</span> <span class="fu">c</span>(<span class="dv">1986</span><span class="sc">:</span><span class="dv">2014</span>),</span>
<span id="cb95-61"><a href="#cb95-61" aria-hidden="true" tabindex="-1"></a>                          <span class="at">future_window_width =</span> <span class="dv">30</span>)</span>
<span id="cb95-62"><a href="#cb95-62" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(change_scenarios)</span>
<span id="cb95-63"><a href="#cb95-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-64"><a href="#cb95-64" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(change_scenarios, <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/all_change_scenarios.csv&quot;</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb95-65"><a href="#cb95-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-66"><a href="#cb95-66" aria-hidden="true" tabindex="-1"></a>change_scenarios <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/all_change_scenarios.csv&quot;</span>)</span>
<span id="cb95-67"><a href="#cb95-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-68"><a href="#cb95-68" aria-hidden="true" tabindex="-1"></a>scen_list <span class="ot">&lt;-</span> <span class="fu">convert_scen_information</span>(change_scenarios)</span>
<span id="cb95-69"><a href="#cb95-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-70"><a href="#cb95-70" aria-hidden="true" tabindex="-1"></a>scen_frame <span class="ot">&lt;-</span> <span class="fu">convert_scen_information</span>(scen_list)</span>
<span id="cb95-71"><a href="#cb95-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-72"><a href="#cb95-72" aria-hidden="true" tabindex="-1"></a>scen_list<span class="sc">$</span>Rochester<span class="sc">$</span>ssp126<span class="sc">$</span><span class="st">`</span><span class="at">ACCESS-CM2</span><span class="st">`</span><span class="sc">$</span><span class="st">&#39;2050&#39;</span></span>
<span id="cb95-73"><a href="#cb95-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-74"><a href="#cb95-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-75"><a href="#cb95-75" aria-hidden="true" tabindex="-1"></a>temps_1996 <span class="ot">&lt;-</span> <span class="fu">temperature_scenario_from_records</span>(Rochester_temps,</span>
<span id="cb95-76"><a href="#cb95-76" aria-hidden="true" tabindex="-1"></a>                                                <span class="dv">1996</span>)</span>
<span id="cb95-77"><a href="#cb95-77" aria-hidden="true" tabindex="-1"></a>temps_2000 <span class="ot">&lt;-</span> <span class="fu">temperature_scenario_from_records</span>(Rochester_temps,</span>
<span id="cb95-78"><a href="#cb95-78" aria-hidden="true" tabindex="-1"></a>                                                <span class="dv">2000</span>)</span>
<span id="cb95-79"><a href="#cb95-79" aria-hidden="true" tabindex="-1"></a>temps_1996</span>
<span id="cb95-80"><a href="#cb95-80" aria-hidden="true" tabindex="-1"></a>temps_2000</span>
<span id="cb95-81"><a href="#cb95-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-82"><a href="#cb95-82" aria-hidden="true" tabindex="-1"></a>base <span class="ot">&lt;-</span> <span class="fu">temperature_scenario_baseline_adjustment</span>(temps_1996,</span>
<span id="cb95-83"><a href="#cb95-83" aria-hidden="true" tabindex="-1"></a>                                                 temps_2000)</span>
<span id="cb95-84"><a href="#cb95-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-85"><a href="#cb95-85" aria-hidden="true" tabindex="-1"></a>base</span>
<span id="cb95-86"><a href="#cb95-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-87"><a href="#cb95-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-88"><a href="#cb95-88" aria-hidden="true" tabindex="-1"></a>scen_list <span class="ot">&lt;-</span> <span class="fu">convert_scen_information</span>(change_scenarios,</span>
<span id="cb95-89"><a href="#cb95-89" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">give_structure =</span> <span class="cn">FALSE</span>)</span>
<span id="cb95-90"><a href="#cb95-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-91"><a href="#cb95-91" aria-hidden="true" tabindex="-1"></a>adjusted_list <span class="ot">&lt;-</span> <span class="fu">temperature_scenario_baseline_adjustment</span>(base,</span>
<span id="cb95-92"><a href="#cb95-92" aria-hidden="true" tabindex="-1"></a>                                                          scen_list,</span>
<span id="cb95-93"><a href="#cb95-93" aria-hidden="true" tabindex="-1"></a>                   <span class="at">temperature_check_args =</span> </span>
<span id="cb95-94"><a href="#cb95-94" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">list</span>(<span class="at">scenario_check_thresholds =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>)))</span>
<span id="cb95-95"><a href="#cb95-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-96"><a href="#cb95-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-97"><a href="#cb95-97" aria-hidden="true" tabindex="-1"></a><span class="co"># temps &lt;- temperature_generation(Rochester_temps,</span></span>
<span id="cb95-98"><a href="#cb95-98" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 years = c(1973, 2019),</span></span>
<span id="cb95-99"><a href="#cb95-99" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 sim_years = c(2001, 2100),</span></span>
<span id="cb95-100"><a href="#cb95-100" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 adjusted_list,  </span></span>
<span id="cb95-101"><a href="#cb95-101" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 temperature_check_args = </span></span>
<span id="cb95-102"><a href="#cb95-102" aria-hidden="true" tabindex="-1"></a><span class="co">#                                   list( scenario_check_thresholds = c(-5, 15)))</span></span>
<span id="cb95-103"><a href="#cb95-103" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb95-104"><a href="#cb95-104" aria-hidden="true" tabindex="-1"></a><span class="co"># save_temperature_scenarios(temps,</span></span>
<span id="cb95-105"><a href="#cb95-105" aria-hidden="true" tabindex="-1"></a><span class="co">#                            &quot;data_New_York/future_climate&quot;,&quot;Rochester_future&quot;)</span></span>
<span id="cb95-106"><a href="#cb95-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-107"><a href="#cb95-107" aria-hidden="true" tabindex="-1"></a><span class="co"># temps &lt;- load_temperature_scenarios(&quot;data_New_Year/future_climate&quot;,&quot;Rochester_future_&quot;)</span></span>
<span id="cb95-108"><a href="#cb95-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-109"><a href="#cb95-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-110"><a href="#cb95-110" aria-hidden="true" tabindex="-1"></a><span class="co"># now we have temperature scenarios</span></span>
<span id="cb95-111"><a href="#cb95-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-112"><a href="#cb95-112" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(scen <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(adjusted_list))</span>
<span id="cb95-113"><a href="#cb95-113" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb95-114"><a href="#cb95-114" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate/Rochester_future_&quot;</span>,</span>
<span id="cb95-115"><a href="#cb95-115" aria-hidden="true" tabindex="-1"></a>                       scen,<span class="st">&quot;_&quot;</span>,</span>
<span id="cb95-116"><a href="#cb95-116" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">names</span>(adjusted_list)[scen],<span class="st">&quot;.csv&quot;</span>)) )</span>
<span id="cb95-117"><a href="#cb95-117" aria-hidden="true" tabindex="-1"></a>  {temp_temp <span class="ot">&lt;-</span> <span class="fu">temperature_generation</span>(Rochester_temps,</span>
<span id="cb95-118"><a href="#cb95-118" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1973</span>, <span class="dv">2019</span>),</span>
<span id="cb95-119"><a href="#cb95-119" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">sim_years =</span> <span class="fu">c</span>(<span class="dv">2001</span>, <span class="dv">2100</span>),</span>
<span id="cb95-120"><a href="#cb95-120" aria-hidden="true" tabindex="-1"></a>                                   adjusted_list[scen],  </span>
<span id="cb95-121"><a href="#cb95-121" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">temperature_check_args =</span> </span>
<span id="cb95-122"><a href="#cb95-122" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">list</span>( <span class="at">scenario_check_thresholds =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>)))</span>
<span id="cb95-123"><a href="#cb95-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(temp_temp[[<span class="dv">1</span>]],<span class="fu">paste0</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate/Rochester_future_&quot;</span>,scen,<span class="st">&quot;_&quot;</span>,<span class="fu">names</span>(adjusted_list)[scen],<span class="st">&quot;.csv&quot;</span>),</span>
<span id="cb95-124"><a href="#cb95-124" aria-hidden="true" tabindex="-1"></a>                             <span class="at">row.names=</span><span class="cn">FALSE</span>)</span>
<span id="cb95-125"><a href="#cb95-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Processed object&quot;</span>,scen,<span class="st">&quot;of&quot;</span>, <span class="fu">length</span>(adjusted_list)))</span>
<span id="cb95-126"><a href="#cb95-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-127"><a href="#cb95-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-128"><a href="#cb95-128" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb95-129"><a href="#cb95-129" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-130"><a href="#cb95-130" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-131"><a href="#cb95-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-132"><a href="#cb95-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-133"><a href="#cb95-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-134"><a href="#cb95-134" aria-hidden="true" tabindex="-1"></a>temps <span class="ot">&lt;-</span> <span class="fu">load_temperature_scenarios</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;</span>,<span class="st">&quot;Rochester_future_&quot;</span>)</span>
<span id="cb95-135"><a href="#cb95-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-136"><a href="#cb95-136" aria-hidden="true" tabindex="-1"></a>frost_model <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb95-137"><a href="#cb95-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_model</span>(x,</span>
<span id="cb95-138"><a href="#cb95-138" aria-hidden="true" tabindex="-1"></a>             <span class="fu">data.frame</span>(</span>
<span id="cb95-139"><a href="#cb95-139" aria-hidden="true" tabindex="-1"></a>               <span class="at">lower =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1000</span>, <span class="dv">0</span>),</span>
<span id="cb95-140"><a href="#cb95-140" aria-hidden="true" tabindex="-1"></a>               <span class="at">upper =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>),</span>
<span id="cb95-141"><a href="#cb95-141" aria-hidden="true" tabindex="-1"></a>               <span class="at">weight =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>)))</span>
<span id="cb95-142"><a href="#cb95-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-143"><a href="#cb95-143" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Chill_Portions =</span> Dynamic_Model,</span>
<span id="cb95-144"><a href="#cb95-144" aria-hidden="true" tabindex="-1"></a>               <span class="at">GDH =</span> GDH,</span>
<span id="cb95-145"><a href="#cb95-145" aria-hidden="true" tabindex="-1"></a>               <span class="at">Frost_H =</span> frost_model)</span>
<span id="cb95-146"><a href="#cb95-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-147"><a href="#cb95-147" aria-hidden="true" tabindex="-1"></a>chill_future_scenario_list <span class="ot">&lt;-</span> </span>
<span id="cb95-148"><a href="#cb95-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tempResponse_daily_list</span>(temps,</span>
<span id="cb95-149"><a href="#cb95-149" aria-hidden="true" tabindex="-1"></a>                          <span class="at">latitude =</span> <span class="fl">43.15</span>,</span>
<span id="cb95-150"><a href="#cb95-150" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Start_JDay =</span> <span class="dv">305</span>,</span>
<span id="cb95-151"><a href="#cb95-151" aria-hidden="true" tabindex="-1"></a>                          <span class="at">End_JDay =</span> <span class="dv">59</span>,</span>
<span id="cb95-152"><a href="#cb95-152" aria-hidden="true" tabindex="-1"></a>                          <span class="at">models =</span> models)</span>
<span id="cb95-153"><a href="#cb95-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-154"><a href="#cb95-154" aria-hidden="true" tabindex="-1"></a>chill_future_scenario_list <span class="ot">&lt;-</span> </span>
<span id="cb95-155"><a href="#cb95-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(chill_future_scenario_list,</span>
<span id="cb95-156"><a href="#cb95-156" aria-hidden="true" tabindex="-1"></a>         <span class="cf">function</span>(x) x <span class="sc">%&gt;%</span></span>
<span id="cb95-157"><a href="#cb95-157" aria-hidden="true" tabindex="-1"></a>           <span class="fu">filter</span>(Perc_complete <span class="sc">==</span> <span class="dv">100</span>))</span>
<span id="cb95-158"><a href="#cb95-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-159"><a href="#cb95-159" aria-hidden="true" tabindex="-1"></a><span class="fu">save_temperature_scenarios</span>(chill_future_scenario_list,</span>
<span id="cb95-160"><a href="#cb95-160" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;</span>,</span>
<span id="cb95-161"><a href="#cb95-161" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Rochester_futurechill&quot;</span>)</span>
<span id="cb95-162"><a href="#cb95-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-163"><a href="#cb95-163" aria-hidden="true" tabindex="-1"></a><span class="co"># this would be for spring frost, but we&#39;re not running this</span></span>
<span id="cb95-164"><a href="#cb95-164" aria-hidden="true" tabindex="-1"></a>chill_future_scenario_list_frost <span class="ot">&lt;-</span> </span>
<span id="cb95-165"><a href="#cb95-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tempResponse_daily_list</span>(temps,</span>
<span id="cb95-166"><a href="#cb95-166" aria-hidden="true" tabindex="-1"></a>                          <span class="at">latitude =</span> <span class="fl">43.15</span>,</span>
<span id="cb95-167"><a href="#cb95-167" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Start_JDay =</span> <span class="dv">75</span>,</span>
<span id="cb95-168"><a href="#cb95-168" aria-hidden="true" tabindex="-1"></a>                          <span class="at">End_JDay =</span> <span class="dv">120</span>,</span>
<span id="cb95-169"><a href="#cb95-169" aria-hidden="true" tabindex="-1"></a>                          <span class="at">models =</span> <span class="fu">list</span>(<span class="at">GDH =</span> GDH,</span>
<span id="cb95-170"><a href="#cb95-170" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">Frost_H =</span> frost_model))</span>
<span id="cb95-171"><a href="#cb95-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-172"><a href="#cb95-172" aria-hidden="true" tabindex="-1"></a>chill_future_scenario_list_frost <span class="ot">&lt;-</span> </span>
<span id="cb95-173"><a href="#cb95-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(chill_future_scenario_list_frost,</span>
<span id="cb95-174"><a href="#cb95-174" aria-hidden="true" tabindex="-1"></a>         <span class="cf">function</span>(x) x <span class="sc">%&gt;%</span></span>
<span id="cb95-175"><a href="#cb95-175" aria-hidden="true" tabindex="-1"></a>           <span class="fu">filter</span>(Perc_complete <span class="sc">==</span> <span class="dv">100</span>))</span>
<span id="cb95-176"><a href="#cb95-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-177"><a href="#cb95-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-178"><a href="#cb95-178" aria-hidden="true" tabindex="-1"></a><span class="fu">save_temperature_scenarios</span>(chill_future_scenario_list_frost,</span>
<span id="cb95-179"><a href="#cb95-179" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;</span>,</span>
<span id="cb95-180"><a href="#cb95-180" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Rochester_futurefrost&quot;</span>)</span>
<span id="cb95-181"><a href="#cb95-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-182"><a href="#cb95-182" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate for the observed record</span></span>
<span id="cb95-183"><a href="#cb95-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-184"><a href="#cb95-184" aria-hidden="true" tabindex="-1"></a>Rochester_temps <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_temps.csv&quot;</span>)</span>
<span id="cb95-185"><a href="#cb95-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-186"><a href="#cb95-186" aria-hidden="true" tabindex="-1"></a>observed_chill <span class="ot">&lt;-</span> <span class="fu">tempResponse_daily_list</span>(Rochester_temps,</span>
<span id="cb95-187"><a href="#cb95-187" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">latitude =</span> <span class="fl">43.15</span>,</span>
<span id="cb95-188"><a href="#cb95-188" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">Start_JDay =</span> <span class="dv">305</span>,</span>
<span id="cb95-189"><a href="#cb95-189" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">End_JDay =</span> <span class="dv">59</span>,</span>
<span id="cb95-190"><a href="#cb95-190" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">models =</span> models)</span>
<span id="cb95-191"><a href="#cb95-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-192"><a href="#cb95-192" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(observed_chill, <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_observed_chill_305_59.csv&quot;</span>)</span>
<span id="cb95-193"><a href="#cb95-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-194"><a href="#cb95-194" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate chill for historic scenarios</span></span>
<span id="cb95-195"><a href="#cb95-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-196"><a href="#cb95-196" aria-hidden="true" tabindex="-1"></a>hist_temps <span class="ot">&lt;-</span> <span class="fu">load_temperature_scenarios</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York&quot;</span>,<span class="st">&quot;all_past_temps&quot;</span>)</span>
<span id="cb95-197"><a href="#cb95-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-198"><a href="#cb95-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-199"><a href="#cb95-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-200"><a href="#cb95-200" aria-hidden="true" tabindex="-1"></a>chill_hist_scenario_list <span class="ot">&lt;-</span> <span class="fu">tempResponse_daily_list</span>(hist_temps,</span>
<span id="cb95-201"><a href="#cb95-201" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">latitude =</span> <span class="fl">43.15</span>,</span>
<span id="cb95-202"><a href="#cb95-202" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">Start_JDay =</span> <span class="dv">305</span>,</span>
<span id="cb95-203"><a href="#cb95-203" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">End_JDay =</span> <span class="dv">59</span>,</span>
<span id="cb95-204"><a href="#cb95-204" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">models =</span> models)</span>
<span id="cb95-205"><a href="#cb95-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-206"><a href="#cb95-206" aria-hidden="true" tabindex="-1"></a>chill_hist_scenario_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(chill_hist_scenario_list,</span>
<span id="cb95-207"><a href="#cb95-207" aria-hidden="true" tabindex="-1"></a>                                   <span class="cf">function</span>(x) x <span class="sc">%&gt;%</span></span>
<span id="cb95-208"><a href="#cb95-208" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">filter</span>(Perc_complete <span class="sc">==</span> <span class="dv">100</span>))</span>
<span id="cb95-209"><a href="#cb95-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-210"><a href="#cb95-210" aria-hidden="true" tabindex="-1"></a><span class="fu">save_temperature_scenarios</span>(chill_hist_scenario_list,</span>
<span id="cb95-211"><a href="#cb95-211" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;</span>,</span>
<span id="cb95-212"><a href="#cb95-212" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Rochester_hist_chill_305_59&quot;</span>)</span>
<span id="cb95-213"><a href="#cb95-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-214"><a href="#cb95-214" aria-hidden="true" tabindex="-1"></a>chill_future_scenario_list <span class="ot">&lt;-</span> <span class="fu">load_temperature_scenarios</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;</span>,<span class="st">&quot;Rochester_futurechill&quot;</span>)</span>
<span id="cb95-215"><a href="#cb95-215" aria-hidden="true" tabindex="-1"></a>chill_hist_scenario_list<span class="ot">&lt;-</span><span class="fu">load_temperature_scenarios</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York&quot;</span>,<span class="st">&quot;Rochester_hist_chill_305_59&quot;</span>)</span>
<span id="cb95-216"><a href="#cb95-216" aria-hidden="true" tabindex="-1"></a>observed_chill <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_observed_chill_305_59.csv&quot;</span>)</span>
<span id="cb95-217"><a href="#cb95-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-218"><a href="#cb95-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-219"><a href="#cb95-219" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare for plotting</span></span>
<span id="cb95-220"><a href="#cb95-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-221"><a href="#cb95-221" aria-hidden="true" tabindex="-1"></a>chills <span class="ot">&lt;-</span> <span class="fu">make_climate_scenario</span>(</span>
<span id="cb95-222"><a href="#cb95-222" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric_summary =</span> chill_hist_scenario_list,</span>
<span id="cb95-223"><a href="#cb95-223" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">&quot;Historical&quot;</span>,</span>
<span id="cb95-224"><a href="#cb95-224" aria-hidden="true" tabindex="-1"></a>  <span class="at">historic_data =</span> observed_chill,</span>
<span id="cb95-225"><a href="#cb95-225" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_series =</span> <span class="cn">TRUE</span>)</span>
<span id="cb95-226"><a href="#cb95-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-227"><a href="#cb95-227" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_climate_scenarios</span>(</span>
<span id="cb95-228"><a href="#cb95-228" aria-hidden="true" tabindex="-1"></a>  <span class="at">climate_scenario_list =</span> chills,</span>
<span id="cb95-229"><a href="#cb95-229" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb95-230"><a href="#cb95-230" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric_label =</span> <span class="st">&quot;Chill (Chill Portions)&quot;</span>)</span>
<span id="cb95-231"><a href="#cb95-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-232"><a href="#cb95-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-233"><a href="#cb95-233" aria-hidden="true" tabindex="-1"></a>list_ssp <span class="ot">&lt;-</span> </span>
<span id="cb95-234"><a href="#cb95-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="fu">names</span>(chill_future_scenario_list),</span>
<span id="cb95-235"><a href="#cb95-235" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-236"><a href="#cb95-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-237"><a href="#cb95-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb95-238"><a href="#cb95-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-239"><a href="#cb95-239" aria-hidden="true" tabindex="-1"></a>list_gcm <span class="ot">&lt;-</span></span>
<span id="cb95-240"><a href="#cb95-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="fu">names</span>(chill_future_scenario_list), <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-241"><a href="#cb95-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-242"><a href="#cb95-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb95-243"><a href="#cb95-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-244"><a href="#cb95-244" aria-hidden="true" tabindex="-1"></a>list_time <span class="ot">&lt;-</span></span>
<span id="cb95-245"><a href="#cb95-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="fu">names</span>(chill_future_scenario_list), <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-246"><a href="#cb95-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-247"><a href="#cb95-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb95-248"><a href="#cb95-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-249"><a href="#cb95-249" aria-hidden="true" tabindex="-1"></a>SSPs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssp126&quot;</span>, <span class="st">&quot;ssp245&quot;</span>, <span class="st">&quot;ssp370&quot;</span>, <span class="st">&quot;ssp585&quot;</span>)</span>
<span id="cb95-250"><a href="#cb95-250" aria-hidden="true" tabindex="-1"></a>Times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2050</span>, <span class="dv">2085</span>)</span>
<span id="cb95-251"><a href="#cb95-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-252"><a href="#cb95-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-253"><a href="#cb95-253" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(SSP <span class="cf">in</span> SSPs)</span>
<span id="cb95-254"><a href="#cb95-254" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(Time <span class="cf">in</span> Times)</span>
<span id="cb95-255"><a href="#cb95-255" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb95-256"><a href="#cb95-256" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-257"><a href="#cb95-257" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find all scenarios for the ssp and time</span></span>
<span id="cb95-258"><a href="#cb95-258" aria-hidden="true" tabindex="-1"></a>    chill <span class="ot">&lt;-</span> chill_future_scenario_list[list_ssp <span class="sc">==</span> SSP <span class="sc">&amp;</span></span>
<span id="cb95-259"><a href="#cb95-259" aria-hidden="true" tabindex="-1"></a>                                          list_time <span class="sc">==</span> Time]</span>
<span id="cb95-260"><a href="#cb95-260" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(chill) <span class="ot">&lt;-</span> list_gcm[list_ssp <span class="sc">==</span> SSP <span class="sc">&amp;</span></span>
<span id="cb95-261"><a href="#cb95-261" aria-hidden="true" tabindex="-1"></a>                               list_time <span class="sc">==</span> Time]</span>
<span id="cb95-262"><a href="#cb95-262" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(SSP <span class="sc">==</span> <span class="st">&quot;ssp126&quot;</span>) SSPcaption <span class="ot">&lt;-</span> <span class="st">&quot;SSP1&quot;</span></span>
<span id="cb95-263"><a href="#cb95-263" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(SSP <span class="sc">==</span> <span class="st">&quot;ssp245&quot;</span>) SSPcaption <span class="ot">&lt;-</span> <span class="st">&quot;SSP2&quot;</span></span>
<span id="cb95-264"><a href="#cb95-264" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(SSP <span class="sc">==</span> <span class="st">&quot;ssp370&quot;</span>) SSPcaption <span class="ot">&lt;-</span> <span class="st">&quot;SSP3&quot;</span></span>
<span id="cb95-265"><a href="#cb95-265" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(SSP <span class="sc">==</span> <span class="st">&quot;ssp585&quot;</span>) SSPcaption <span class="ot">&lt;-</span> <span class="st">&quot;SSP5&quot;</span>    </span>
<span id="cb95-266"><a href="#cb95-266" aria-hidden="true" tabindex="-1"></a>    chills <span class="ot">&lt;-</span> chill <span class="sc">%&gt;%</span> </span>
<span id="cb95-267"><a href="#cb95-267" aria-hidden="true" tabindex="-1"></a>      <span class="fu">make_climate_scenario</span>(</span>
<span id="cb95-268"><a href="#cb95-268" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="fu">c</span>(SSPcaption,</span>
<span id="cb95-269"><a href="#cb95-269" aria-hidden="true" tabindex="-1"></a>                    Time),</span>
<span id="cb95-270"><a href="#cb95-270" aria-hidden="true" tabindex="-1"></a>        <span class="at">add_to =</span> chills)</span>
<span id="cb95-271"><a href="#cb95-271" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb95-272"><a href="#cb95-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-273"><a href="#cb95-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-274"><a href="#cb95-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-275"><a href="#cb95-275" aria-hidden="true" tabindex="-1"></a>info_chill <span class="ot">&lt;-</span></span>
<span id="cb95-276"><a href="#cb95-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_climate_scenarios</span>(</span>
<span id="cb95-277"><a href="#cb95-277" aria-hidden="true" tabindex="-1"></a>    <span class="at">climate_scenario_list =</span> chills,</span>
<span id="cb95-278"><a href="#cb95-278" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb95-279"><a href="#cb95-279" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric_label =</span> <span class="st">&quot;Chill (Chill Portions)&quot;</span>,</span>
<span id="cb95-280"><a href="#cb95-280" aria-hidden="true" tabindex="-1"></a>    <span class="at">texcex =</span> <span class="dv">1</span>)</span>
<span id="cb95-281"><a href="#cb95-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-282"><a href="#cb95-282" aria-hidden="true" tabindex="-1"></a>info_heat <span class="ot">&lt;-</span></span>
<span id="cb95-283"><a href="#cb95-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_climate_scenarios</span>(</span>
<span id="cb95-284"><a href="#cb95-284" aria-hidden="true" tabindex="-1"></a>    <span class="at">climate_scenario_list =</span> chills,</span>
<span id="cb95-285"><a href="#cb95-285" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb95-286"><a href="#cb95-286" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric_label =</span> <span class="st">&quot;Heat (Growing Degree Hours)&quot;</span>,</span>
<span id="cb95-287"><a href="#cb95-287" aria-hidden="true" tabindex="-1"></a>    <span class="at">texcex =</span> <span class="dv">1</span>)</span>
<span id="cb95-288"><a href="#cb95-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-289"><a href="#cb95-289" aria-hidden="true" tabindex="-1"></a>info_frost <span class="ot">&lt;-</span> </span>
<span id="cb95-290"><a href="#cb95-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_climate_scenarios</span>(  </span>
<span id="cb95-291"><a href="#cb95-291" aria-hidden="true" tabindex="-1"></a>    <span class="at">climate_scenario_list=</span>chills,</span>
<span id="cb95-292"><a href="#cb95-292" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric=</span><span class="st">&quot;Frost_H&quot;</span>,</span>
<span id="cb95-293"><a href="#cb95-293" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric_label=</span><span class="st">&quot;Frost incidence (hours)&quot;</span>,</span>
<span id="cb95-294"><a href="#cb95-294" aria-hidden="true" tabindex="-1"></a>    <span class="at">texcex=</span><span class="dv">1</span>)</span>
<span id="cb95-295"><a href="#cb95-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-296"><a href="#cb95-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-297"><a href="#cb95-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-298"><a href="#cb95-298" aria-hidden="true" tabindex="-1"></a>info_chill[[<span class="dv">2</span>]]</span></code></pre></div>
</details>
</div>
<hr />
</section>
</section>
<section id="chapter-18-plotting-climate-scenarios" class="level1">
<h1>Chapter 18: Plotting Climate Scenarios</h1>
<section id="exercises-on-plotting-future-projections" class="level2">
<h2><strong><em>Exercises on plotting future projections</em></strong></h2>
<p>1.Produce similar plots for the weather station you selected for earlier exercises.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb96"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co">#library(ggpmisc)</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co">#library(patchwork)</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>chill_hist_scenario_list <span class="ot">&lt;-</span> <span class="fu">load_temperature_scenarios</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York&quot;</span>,</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">&quot;Rochester_hist_chill_305_59&quot;</span>)</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>actual_chill <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_observed_chill_305_59.csv&quot;</span>)</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>chill_future_scenario_list <span class="ot">&lt;-</span> <span class="fu">load_temperature_scenarios</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;</span>,</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>                                                         <span class="st">&quot;Rochester_futurechill&quot;</span>)</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>chills <span class="ot">&lt;-</span> <span class="fu">make_climate_scenario</span>(</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  chill_hist_scenario_list,</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">&quot;Historic&quot;</span>,</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">historic_data =</span> actual_chill,</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_series =</span> <span class="cn">TRUE</span>)</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>SSPs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssp126&quot;</span>, <span class="st">&quot;ssp245&quot;</span>, <span class="st">&quot;ssp370&quot;</span>, <span class="st">&quot;ssp585&quot;</span>)</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>Times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2050</span>, <span class="dv">2085</span>)</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>list_ssp <span class="ot">&lt;-</span> </span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="fu">names</span>(chill_future_scenario_list), <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>list_gcm <span class="ot">&lt;-</span></span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="fu">names</span>(chill_future_scenario_list), <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>list_time <span class="ot">&lt;-</span></span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="fu">names</span>(chill_future_scenario_list), <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(SSP <span class="cf">in</span> SSPs)</span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(Time <span class="cf">in</span> Times)</span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-42"><a href="#cb96-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find all scenarios for the ssp and time</span></span>
<span id="cb96-43"><a href="#cb96-43" aria-hidden="true" tabindex="-1"></a>    chill <span class="ot">&lt;-</span> chill_future_scenario_list[list_ssp <span class="sc">==</span> SSP <span class="sc">&amp;</span> list_time <span class="sc">==</span> Time]</span>
<span id="cb96-44"><a href="#cb96-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(chill) <span class="ot">&lt;-</span> list_gcm[list_ssp <span class="sc">==</span> SSP <span class="sc">&amp;</span> list_time <span class="sc">==</span> Time]</span>
<span id="cb96-45"><a href="#cb96-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(SSP <span class="sc">==</span> <span class="st">&quot;ssp126&quot;</span>) SSPcaption <span class="ot">&lt;-</span> <span class="st">&quot;SSP1&quot;</span></span>
<span id="cb96-46"><a href="#cb96-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(SSP <span class="sc">==</span> <span class="st">&quot;ssp245&quot;</span>) SSPcaption <span class="ot">&lt;-</span> <span class="st">&quot;SSP2&quot;</span></span>
<span id="cb96-47"><a href="#cb96-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(SSP <span class="sc">==</span> <span class="st">&quot;ssp370&quot;</span>) SSPcaption <span class="ot">&lt;-</span> <span class="st">&quot;SSP3&quot;</span></span>
<span id="cb96-48"><a href="#cb96-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(SSP <span class="sc">==</span> <span class="st">&quot;ssp585&quot;</span>) SSPcaption <span class="ot">&lt;-</span> <span class="st">&quot;SSP5&quot;</span>    </span>
<span id="cb96-49"><a href="#cb96-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(Time <span class="sc">==</span> <span class="st">&quot;2050&quot;</span>) Time_caption <span class="ot">&lt;-</span> <span class="st">&quot;2050&quot;</span></span>
<span id="cb96-50"><a href="#cb96-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(Time <span class="sc">==</span> <span class="st">&quot;2085&quot;</span>) Time_caption <span class="ot">&lt;-</span> <span class="st">&quot;2085&quot;</span></span>
<span id="cb96-51"><a href="#cb96-51" aria-hidden="true" tabindex="-1"></a>    chills <span class="ot">&lt;-</span> chill <span class="sc">%&gt;%</span> </span>
<span id="cb96-52"><a href="#cb96-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">make_climate_scenario</span>(</span>
<span id="cb96-53"><a href="#cb96-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="fu">c</span>(SSPcaption,</span>
<span id="cb96-54"><a href="#cb96-54" aria-hidden="true" tabindex="-1"></a>                    Time_caption),</span>
<span id="cb96-55"><a href="#cb96-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">add_to =</span> chills)</span>
<span id="cb96-56"><a href="#cb96-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb96-57"><a href="#cb96-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-58"><a href="#cb96-58" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_climate_scenarios</span>(</span>
<span id="cb96-59"><a href="#cb96-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">climate_scenario_list =</span> chills,</span>
<span id="cb96-60"><a href="#cb96-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb96-61"><a href="#cb96-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric_label =</span> <span class="st">&quot;Chill (Chill Portions)&quot;</span>,</span>
<span id="cb96-62"><a href="#cb96-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">texcex =</span> <span class="dv">1</span>)</span>
<span id="cb96-63"><a href="#cb96-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-64"><a href="#cb96-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-65"><a href="#cb96-65" aria-hidden="true" tabindex="-1"></a><span class="co"># We&#39;ll first process the past scenarios (element 1 of the chills list).</span></span>
<span id="cb96-66"><a href="#cb96-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Within the data element, we have a list of multiple data.frames for</span></span>
<span id="cb96-67"><a href="#cb96-67" aria-hidden="true" tabindex="-1"></a><span class="co"># the various past scenarios.</span></span>
<span id="cb96-68"><a href="#cb96-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Using a &#39;for&#39; loop, we cycle through all these data.frames.</span></span>
<span id="cb96-69"><a href="#cb96-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-70"><a href="#cb96-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(nam <span class="cf">in</span> <span class="fu">names</span>(chills[[<span class="dv">1</span>]]<span class="sc">$</span>data))</span>
<span id="cb96-71"><a href="#cb96-71" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb96-72"><a href="#cb96-72" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Extract the data frame.</span></span>
<span id="cb96-73"><a href="#cb96-73" aria-hidden="true" tabindex="-1"></a>   ch <span class="ot">&lt;-</span> chills[[<span class="dv">1</span>]]<span class="sc">$</span>data[[nam]]</span>
<span id="cb96-74"><a href="#cb96-74" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Add columns for the new information we have to add and fill them.</span></span>
<span id="cb96-75"><a href="#cb96-75" aria-hidden="true" tabindex="-1"></a>   ch[,<span class="st">&quot;GCM&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb96-76"><a href="#cb96-76" aria-hidden="true" tabindex="-1"></a>   ch[,<span class="st">&quot;SSP&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb96-77"><a href="#cb96-77" aria-hidden="true" tabindex="-1"></a>   ch[,<span class="st">&quot;Year&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(nam)</span>
<span id="cb96-78"><a href="#cb96-78" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb96-79"><a href="#cb96-79" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Now check if this is the first time we&#39;ve gone through this loop.</span></span>
<span id="cb96-80"><a href="#cb96-80" aria-hidden="true" tabindex="-1"></a>   <span class="co"># If this is the first time, the ch data.frame becomes the output</span></span>
<span id="cb96-81"><a href="#cb96-81" aria-hidden="true" tabindex="-1"></a>   <span class="co"># object (past_simulated).</span></span>
<span id="cb96-82"><a href="#cb96-82" aria-hidden="true" tabindex="-1"></a>   <span class="co"># If it is not the first time (&#39;else&#39;), we add the current data.frame</span></span>
<span id="cb96-83"><a href="#cb96-83" aria-hidden="true" tabindex="-1"></a>   <span class="co"># to the &#39;past_simulated&#39; object</span></span>
<span id="cb96-84"><a href="#cb96-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(nam <span class="sc">==</span> <span class="fu">names</span>(chills[[<span class="dv">1</span>]]<span class="sc">$</span>data)[<span class="dv">1</span>])</span>
<span id="cb96-85"><a href="#cb96-85" aria-hidden="true" tabindex="-1"></a>    past_simulated <span class="ot">&lt;-</span> ch <span class="cf">else</span></span>
<span id="cb96-86"><a href="#cb96-86" aria-hidden="true" tabindex="-1"></a>      past_simulated <span class="ot">&lt;-</span> <span class="fu">rbind</span>(past_simulated,</span>
<span id="cb96-87"><a href="#cb96-87" aria-hidden="true" tabindex="-1"></a>                              ch)</span>
<span id="cb96-88"><a href="#cb96-88" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb96-89"><a href="#cb96-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-90"><a href="#cb96-90" aria-hidden="true" tabindex="-1"></a><span class="co"># We add another column called &#39;Scenario&#39; and label all rows as &#39;Historical&#39; </span></span>
<span id="cb96-91"><a href="#cb96-91" aria-hidden="true" tabindex="-1"></a>past_simulated[<span class="st">&quot;Scenario&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Historical&quot;</span></span>
<span id="cb96-92"><a href="#cb96-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-93"><a href="#cb96-93" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(past_simulated)</span>
<span id="cb96-94"><a href="#cb96-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-95"><a href="#cb96-95" aria-hidden="true" tabindex="-1"></a>past_simulated <span class="ot">&lt;-</span> past_simulated <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Perc_complete <span class="sc">==</span> <span class="dv">100</span>)</span>
<span id="cb96-96"><a href="#cb96-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-97"><a href="#cb96-97" aria-hidden="true" tabindex="-1"></a><span class="co"># We&#39;ll want to add the historic observation too, so let&#39;s simplify the</span></span>
<span id="cb96-98"><a href="#cb96-98" aria-hidden="true" tabindex="-1"></a><span class="co"># pointer to this information for easier use later</span></span>
<span id="cb96-99"><a href="#cb96-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-100"><a href="#cb96-100" aria-hidden="true" tabindex="-1"></a>past_observed <span class="ot">&lt;-</span> chills[[<span class="dv">1</span>]][[<span class="st">&quot;historic_data&quot;</span>]]</span>
<span id="cb96-101"><a href="#cb96-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-102"><a href="#cb96-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-103"><a href="#cb96-103" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(past_observed)</span>
<span id="cb96-104"><a href="#cb96-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-105"><a href="#cb96-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-106"><a href="#cb96-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract future data</span></span>
<span id="cb96-107"><a href="#cb96-107" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(chills))</span>
<span id="cb96-108"><a href="#cb96-108" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(nam <span class="cf">in</span> <span class="fu">names</span>(chills[[i]]<span class="sc">$</span>data))</span>
<span id="cb96-109"><a href="#cb96-109" aria-hidden="true" tabindex="-1"></a>    {ch <span class="ot">&lt;-</span> chills[[i]]<span class="sc">$</span>data[[nam]]</span>
<span id="cb96-110"><a href="#cb96-110" aria-hidden="true" tabindex="-1"></a>     ch[,<span class="st">&quot;GCM&quot;</span>] <span class="ot">&lt;-</span> nam</span>
<span id="cb96-111"><a href="#cb96-111" aria-hidden="true" tabindex="-1"></a>     ch[,<span class="st">&quot;SSP&quot;</span>] <span class="ot">&lt;-</span> chills[[i]]<span class="sc">$</span>caption[<span class="dv">1</span>]</span>
<span id="cb96-112"><a href="#cb96-112" aria-hidden="true" tabindex="-1"></a>     ch[,<span class="st">&quot;Year&quot;</span>] <span class="ot">&lt;-</span> chills[[i]]<span class="sc">$</span>caption[<span class="dv">2</span>]</span>
<span id="cb96-113"><a href="#cb96-113" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> nam <span class="sc">==</span> <span class="fu">names</span>(chills[[i]]<span class="sc">$</span>data)[<span class="dv">1</span>])</span>
<span id="cb96-114"><a href="#cb96-114" aria-hidden="true" tabindex="-1"></a>       future_data <span class="ot">&lt;-</span> ch <span class="cf">else</span></span>
<span id="cb96-115"><a href="#cb96-115" aria-hidden="true" tabindex="-1"></a>         future_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(future_data,ch)</span>
<span id="cb96-116"><a href="#cb96-116" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb96-117"><a href="#cb96-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-118"><a href="#cb96-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-119"><a href="#cb96-119" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(future_data)</span>
<span id="cb96-120"><a href="#cb96-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-121"><a href="#cb96-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-122"><a href="#cb96-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-123"><a href="#cb96-123" aria-hidden="true" tabindex="-1"></a>metric <span class="ot">&lt;-</span> <span class="st">&quot;GDH&quot;</span></span>
<span id="cb96-124"><a href="#cb96-124" aria-hidden="true" tabindex="-1"></a>axis_label <span class="ot">&lt;-</span> <span class="st">&quot;Heat (in GDH)&quot;</span></span>
<span id="cb96-125"><a href="#cb96-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-126"><a href="#cb96-126" aria-hidden="true" tabindex="-1"></a><span class="co"># get extreme values for the axis scale</span></span>
<span id="cb96-127"><a href="#cb96-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-128"><a href="#cb96-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-129"><a href="#cb96-129" aria-hidden="true" tabindex="-1"></a>rng <span class="ot">&lt;-</span> <span class="fu">range</span>(past_observed[[metric]],</span>
<span id="cb96-130"><a href="#cb96-130" aria-hidden="true" tabindex="-1"></a>             past_simulated[[metric]],</span>
<span id="cb96-131"><a href="#cb96-131" aria-hidden="true" tabindex="-1"></a>             future_data[[metric]])  </span>
<span id="cb96-132"><a href="#cb96-132" aria-hidden="true" tabindex="-1"></a>rng</span>
<span id="cb96-133"><a href="#cb96-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-134"><a href="#cb96-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-135"><a href="#cb96-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-136"><a href="#cb96-136" aria-hidden="true" tabindex="-1"></a>past_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb96-137"><a href="#cb96-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">data =</span> past_simulated,</span>
<span id="cb96-138"><a href="#cb96-138" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes_string</span>(<span class="st">&quot;as.numeric(Year)&quot;</span>,</span>
<span id="cb96-139"><a href="#cb96-139" aria-hidden="true" tabindex="-1"></a>                          metric,</span>
<span id="cb96-140"><a href="#cb96-140" aria-hidden="true" tabindex="-1"></a>                          <span class="at">group =</span> <span class="st">&quot;Year&quot;</span>),</span>
<span id="cb96-141"><a href="#cb96-141" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">&quot;skyblue&quot;</span>)</span>
<span id="cb96-142"><a href="#cb96-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-143"><a href="#cb96-143" aria-hidden="true" tabindex="-1"></a>past_plot</span>
<span id="cb96-144"><a href="#cb96-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-145"><a href="#cb96-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-146"><a href="#cb96-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-147"><a href="#cb96-147" aria-hidden="true" tabindex="-1"></a>past_plot <span class="ot">&lt;-</span> past_plot <span class="sc">+</span></span>
<span id="cb96-148"><a href="#cb96-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb96-149"><a href="#cb96-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb96-150"><a href="#cb96-150" aria-hidden="true" tabindex="-1"></a>               <span class="fu">round</span>(rng[<span class="dv">2</span>] <span class="sc">+</span> rng[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">10</span>))) <span class="sc">+</span></span>
<span id="cb96-151"><a href="#cb96-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, </span>
<span id="cb96-152"><a href="#cb96-152" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> axis_label)</span>
<span id="cb96-153"><a href="#cb96-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-154"><a href="#cb96-154" aria-hidden="true" tabindex="-1"></a>past_plot</span>
<span id="cb96-155"><a href="#cb96-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-156"><a href="#cb96-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-157"><a href="#cb96-157" aria-hidden="true" tabindex="-1"></a>past_plot <span class="ot">&lt;-</span> past_plot <span class="sc">+</span></span>
<span id="cb96-158"><a href="#cb96-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> Scenario) <span class="sc">+</span></span>
<span id="cb96-159"><a href="#cb96-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) </span>
<span id="cb96-160"><a href="#cb96-160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-161"><a href="#cb96-161" aria-hidden="true" tabindex="-1"></a>past_plot</span>
<span id="cb96-162"><a href="#cb96-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-163"><a href="#cb96-163" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-164"><a href="#cb96-164" aria-hidden="true" tabindex="-1"></a>past_plot <span class="ot">&lt;-</span> past_plot <span class="sc">+</span>  </span>
<span id="cb96-165"><a href="#cb96-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-166"><a href="#cb96-166" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb96-167"><a href="#cb96-167" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,</span>
<span id="cb96-168"><a href="#cb96-168" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">hjust =</span> <span class="dv">1</span>)) </span>
<span id="cb96-169"><a href="#cb96-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-170"><a href="#cb96-170" aria-hidden="true" tabindex="-1"></a>past_plot</span>
<span id="cb96-171"><a href="#cb96-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-172"><a href="#cb96-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-173"><a href="#cb96-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-174"><a href="#cb96-174" aria-hidden="true" tabindex="-1"></a><span class="co"># add historic data</span></span>
<span id="cb96-175"><a href="#cb96-175" aria-hidden="true" tabindex="-1"></a>past_plot <span class="ot">&lt;-</span> past_plot <span class="sc">+</span></span>
<span id="cb96-176"><a href="#cb96-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> past_observed,</span>
<span id="cb96-177"><a href="#cb96-177" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes_string</span>(<span class="st">&quot;End_year&quot;</span>,</span>
<span id="cb96-178"><a href="#cb96-178" aria-hidden="true" tabindex="-1"></a>                        metric),</span>
<span id="cb96-179"><a href="#cb96-179" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb96-180"><a href="#cb96-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-181"><a href="#cb96-181" aria-hidden="true" tabindex="-1"></a>past_plot</span>
<span id="cb96-182"><a href="#cb96-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-183"><a href="#cb96-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-184"><a href="#cb96-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-185"><a href="#cb96-185" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2050</span></span>
<span id="cb96-186"><a href="#cb96-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-187"><a href="#cb96-187" aria-hidden="true" tabindex="-1"></a>future_2050 <span class="ot">&lt;-</span></span>
<span id="cb96-188"><a href="#cb96-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> future_data[future_data<span class="sc">$</span>Year <span class="sc">==</span> y,]) <span class="sc">+</span></span>
<span id="cb96-189"><a href="#cb96-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes_string</span>(<span class="st">&quot;GCM&quot;</span>, </span>
<span id="cb96-190"><a href="#cb96-190" aria-hidden="true" tabindex="-1"></a>                          metric, </span>
<span id="cb96-191"><a href="#cb96-191" aria-hidden="true" tabindex="-1"></a>                          <span class="at">fill =</span> <span class="st">&quot;GCM&quot;</span>))</span>
<span id="cb96-192"><a href="#cb96-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-193"><a href="#cb96-193" aria-hidden="true" tabindex="-1"></a>future_2050</span>
<span id="cb96-194"><a href="#cb96-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-195"><a href="#cb96-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-196"><a href="#cb96-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-197"><a href="#cb96-197" aria-hidden="true" tabindex="-1"></a>future_2050 <span class="ot">&lt;-</span> future_2050 <span class="sc">+</span></span>
<span id="cb96-198"><a href="#cb96-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(SSP), <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb96-199"><a href="#cb96-199" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cn">NULL</span>,</span>
<span id="cb96-200"><a href="#cb96-200" aria-hidden="true" tabindex="-1"></a>                    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="dv">1</span>)) </span>
<span id="cb96-201"><a href="#cb96-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-202"><a href="#cb96-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-203"><a href="#cb96-203" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpmisc)</span>
<span id="cb96-204"><a href="#cb96-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-205"><a href="#cb96-205" aria-hidden="true" tabindex="-1"></a>future_2050 <span class="ot">&lt;-</span> future_2050 <span class="sc">+</span></span>
<span id="cb96-206"><a href="#cb96-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb96-207"><a href="#cb96-207" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">round</span>(<span class="fu">round</span>(<span class="fl">1.1</span><span class="sc">*</span>rng[<span class="dv">2</span>])))) <span class="sc">+</span></span>
<span id="cb96-208"><a href="#cb96-208" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_npc</span>(<span class="fu">aes</span>(<span class="at">npcx =</span> <span class="st">&quot;center&quot;</span>, </span>
<span id="cb96-209"><a href="#cb96-209" aria-hidden="true" tabindex="-1"></a>                      <span class="at">npcy =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb96-210"><a href="#cb96-210" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label =</span> Year),</span>
<span id="cb96-211"><a href="#cb96-211" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">5</span>)</span>
<span id="cb96-212"><a href="#cb96-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-213"><a href="#cb96-213" aria-hidden="true" tabindex="-1"></a>future_2050</span>
<span id="cb96-214"><a href="#cb96-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-215"><a href="#cb96-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-216"><a href="#cb96-216" aria-hidden="true" tabindex="-1"></a>future_2050 <span class="ot">&lt;-</span> future_2050 <span class="sc">+</span></span>
<span id="cb96-217"><a href="#cb96-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb96-218"><a href="#cb96-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-219"><a href="#cb96-219" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-220"><a href="#cb96-220" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-221"><a href="#cb96-221" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb96-222"><a href="#cb96-222" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>,</span>
<span id="cb96-223"><a href="#cb96-223" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">0</span>,</span>
<span id="cb96-224"><a href="#cb96-224" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">0</span>,</span>
<span id="cb96-225"><a href="#cb96-225" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">0</span>,</span>
<span id="cb96-226"><a href="#cb96-226" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb96-227"><a href="#cb96-227" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(),</span>
<span id="cb96-228"><a href="#cb96-228" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-229"><a href="#cb96-229" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb96-230"><a href="#cb96-230" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb96-231"><a href="#cb96-231" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb96-232"><a href="#cb96-232" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb96-233"><a href="#cb96-233" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">size =</span> <span class="dv">15</span> <span class="sc">*</span> <span class="fl">1.05</span>,</span>
<span id="cb96-234"><a href="#cb96-234" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) </span>
<span id="cb96-235"><a href="#cb96-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-236"><a href="#cb96-236" aria-hidden="true" tabindex="-1"></a>future_2050</span>
<span id="cb96-237"><a href="#cb96-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-238"><a href="#cb96-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-239"><a href="#cb96-239" aria-hidden="true" tabindex="-1"></a>future_plot_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb96-240"><a href="#cb96-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-241"><a href="#cb96-241" aria-hidden="true" tabindex="-1"></a>time_points <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2050</span>, <span class="dv">2085</span>)</span>
<span id="cb96-242"><a href="#cb96-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-243"><a href="#cb96-243" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(y <span class="cf">in</span> time_points)</span>
<span id="cb96-244"><a href="#cb96-244" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb96-245"><a href="#cb96-245" aria-hidden="true" tabindex="-1"></a>  future_plot_list[[<span class="fu">which</span>(y <span class="sc">==</span> time_points)]] <span class="ot">&lt;-</span></span>
<span id="cb96-246"><a href="#cb96-246" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> future_data[<span class="fu">which</span>(future_data<span class="sc">$</span>Year<span class="sc">==</span>y),]) <span class="sc">+</span></span>
<span id="cb96-247"><a href="#cb96-247" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="fu">aes_string</span>(<span class="st">&quot;GCM&quot;</span>,</span>
<span id="cb96-248"><a href="#cb96-248" aria-hidden="true" tabindex="-1"></a>                            metric,</span>
<span id="cb96-249"><a href="#cb96-249" aria-hidden="true" tabindex="-1"></a>                            <span class="at">fill=</span><span class="st">&quot;GCM&quot;</span>)) <span class="sc">+</span></span>
<span id="cb96-250"><a href="#cb96-250" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(SSP), <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb96-251"><a href="#cb96-251" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cn">NULL</span>,</span>
<span id="cb96-252"><a href="#cb96-252" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb96-253"><a href="#cb96-253" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb96-254"><a href="#cb96-254" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">round</span>(<span class="fu">round</span>(<span class="fl">1.1</span><span class="sc">*</span>rng[<span class="dv">2</span>])))) <span class="sc">+</span></span>
<span id="cb96-255"><a href="#cb96-255" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_npc</span>(<span class="fu">aes</span>(<span class="at">npcx =</span> <span class="st">&quot;center&quot;</span>,</span>
<span id="cb96-256"><a href="#cb96-256" aria-hidden="true" tabindex="-1"></a>                      <span class="at">npcy =</span> <span class="st">&quot;top&quot;</span>, </span>
<span id="cb96-257"><a href="#cb96-257" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label =</span> Year),</span>
<span id="cb96-258"><a href="#cb96-258" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb96-259"><a href="#cb96-259" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb96-260"><a href="#cb96-260" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-261"><a href="#cb96-261" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-262"><a href="#cb96-262" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-263"><a href="#cb96-263" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb96-264"><a href="#cb96-264" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, </span>
<span id="cb96-265"><a href="#cb96-265" aria-hidden="true" tabindex="-1"></a>                                 <span class="dv">0</span>, </span>
<span id="cb96-266"><a href="#cb96-266" aria-hidden="true" tabindex="-1"></a>                                 <span class="dv">0</span>, </span>
<span id="cb96-267"><a href="#cb96-267" aria-hidden="true" tabindex="-1"></a>                                 <span class="dv">0</span>, </span>
<span id="cb96-268"><a href="#cb96-268" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb96-269"><a href="#cb96-269" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.background =</span> <span class="fu">element_rect</span>(),</span>
<span id="cb96-270"><a href="#cb96-270" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-271"><a href="#cb96-271" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb96-272"><a href="#cb96-272" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb96-273"><a href="#cb96-273" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(</span>
<span id="cb96-274"><a href="#cb96-274" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb96-275"><a href="#cb96-275" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb96-276"><a href="#cb96-276" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">15</span> <span class="sc">*</span> <span class="fl">1.05</span>,</span>
<span id="cb96-277"><a href="#cb96-277" aria-hidden="true" tabindex="-1"></a>            <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) </span>
<span id="cb96-278"><a href="#cb96-278" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb96-279"><a href="#cb96-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-280"><a href="#cb96-280" aria-hidden="true" tabindex="-1"></a>future_plot_list</span>
<span id="cb96-281"><a href="#cb96-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-282"><a href="#cb96-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-283"><a href="#cb96-283" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb96-284"><a href="#cb96-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-285"><a href="#cb96-285" aria-hidden="true" tabindex="-1"></a>both_plots <span class="ot">&lt;-</span> past_plot <span class="sc">+</span> future_plot_list</span>
<span id="cb96-286"><a href="#cb96-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-287"><a href="#cb96-287" aria-hidden="true" tabindex="-1"></a>both_plots</span>
<span id="cb96-288"><a href="#cb96-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-289"><a href="#cb96-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-290"><a href="#cb96-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-291"><a href="#cb96-291" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> both_plots <span class="sc">+</span></span>
<span id="cb96-292"><a href="#cb96-292" aria-hidden="true" tabindex="-1"></a>           <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>,</span>
<span id="cb96-293"><a href="#cb96-293" aria-hidden="true" tabindex="-1"></a>                       <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>,</span>
<span id="cb96-294"><a href="#cb96-294" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="fl">1.8</span>,</span>
<span id="cb96-295"><a href="#cb96-295" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">length</span>(future_plot_list))))</span>
<span id="cb96-296"><a href="#cb96-296" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb96-297"><a href="#cb96-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-298"><a href="#cb96-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-299"><a href="#cb96-299" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> plot <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb96-300"><a href="#cb96-300" aria-hidden="true" tabindex="-1"></a>                     <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb96-301"><a href="#cb96-301" aria-hidden="true" tabindex="-1"></a>                     <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb96-302"><a href="#cb96-302" aria-hidden="true" tabindex="-1"></a>                     <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb96-303"><a href="#cb96-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-304"><a href="#cb96-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-305"><a href="#cb96-305" aria-hidden="true" tabindex="-1"></a>plot</span>
<span id="cb96-306"><a href="#cb96-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-307"><a href="#cb96-307" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb96-308"><a href="#cb96-308" aria-hidden="true" tabindex="-1"></a>metric <span class="ot">&lt;-</span> <span class="st">&quot;Chill_Portions&quot;</span></span>
<span id="cb96-309"><a href="#cb96-309" aria-hidden="true" tabindex="-1"></a>axis_label <span class="ot">&lt;-</span> <span class="st">&quot;Chill (in CP)&quot;</span></span>
<span id="cb96-310"><a href="#cb96-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-311"><a href="#cb96-311" aria-hidden="true" tabindex="-1"></a><span class="co"># get extreme values for the axis scale</span></span>
<span id="cb96-312"><a href="#cb96-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-313"><a href="#cb96-313" aria-hidden="true" tabindex="-1"></a>rng <span class="ot">&lt;-</span> <span class="fu">range</span>(past_observed[[metric]],</span>
<span id="cb96-314"><a href="#cb96-314" aria-hidden="true" tabindex="-1"></a>             past_simulated[[metric]],</span>
<span id="cb96-315"><a href="#cb96-315" aria-hidden="true" tabindex="-1"></a>             future_data[[metric]])  </span>
<span id="cb96-316"><a href="#cb96-316" aria-hidden="true" tabindex="-1"></a>past_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb96-317"><a href="#cb96-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">data =</span> past_simulated,</span>
<span id="cb96-318"><a href="#cb96-318" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes_string</span>(<span class="st">&quot;as.numeric(Year)&quot;</span>,</span>
<span id="cb96-319"><a href="#cb96-319" aria-hidden="true" tabindex="-1"></a>                          metric,<span class="at">group=</span><span class="st">&quot;Year&quot;</span>),</span>
<span id="cb96-320"><a href="#cb96-320" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span><span class="st">&quot;skyblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb96-321"><a href="#cb96-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb96-322"><a href="#cb96-322" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">round</span>(<span class="fu">round</span>(<span class="fl">1.1</span><span class="sc">*</span>rng[<span class="dv">2</span>])))) <span class="sc">+</span></span>
<span id="cb96-323"><a href="#cb96-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> axis_label) <span class="sc">+</span></span>
<span id="cb96-324"><a href="#cb96-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> Scenario) <span class="sc">+</span></span>
<span id="cb96-325"><a href="#cb96-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span>  </span>
<span id="cb96-326"><a href="#cb96-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-327"><a href="#cb96-327" aria-hidden="true" tabindex="-1"></a>           <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb96-328"><a href="#cb96-328" aria-hidden="true" tabindex="-1"></a>           <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb96-329"><a href="#cb96-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> past_observed,</span>
<span id="cb96-330"><a href="#cb96-330" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes_string</span>(<span class="st">&quot;End_year&quot;</span>,</span>
<span id="cb96-331"><a href="#cb96-331" aria-hidden="true" tabindex="-1"></a>                        metric),</span>
<span id="cb96-332"><a href="#cb96-332" aria-hidden="true" tabindex="-1"></a>             <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb96-333"><a href="#cb96-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-334"><a href="#cb96-334" aria-hidden="true" tabindex="-1"></a>future_plot_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb96-335"><a href="#cb96-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-336"><a href="#cb96-336" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(y <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">2050</span>,</span>
<span id="cb96-337"><a href="#cb96-337" aria-hidden="true" tabindex="-1"></a>           <span class="dv">2085</span>))</span>
<span id="cb96-338"><a href="#cb96-338" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb96-339"><a href="#cb96-339" aria-hidden="true" tabindex="-1"></a>  future_plot_list[[<span class="fu">which</span>(y <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">2050</span>,<span class="dv">2085</span>))]] <span class="ot">&lt;-</span></span>
<span id="cb96-340"><a href="#cb96-340" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> future_data[<span class="fu">which</span>(future_data<span class="sc">$</span>Year<span class="sc">==</span>y),]) <span class="sc">+</span></span>
<span id="cb96-341"><a href="#cb96-341" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="fu">aes_string</span>(<span class="st">&quot;GCM&quot;</span>, </span>
<span id="cb96-342"><a href="#cb96-342" aria-hidden="true" tabindex="-1"></a>                            metric, </span>
<span id="cb96-343"><a href="#cb96-343" aria-hidden="true" tabindex="-1"></a>                            <span class="at">fill=</span><span class="st">&quot;GCM&quot;</span>)) <span class="sc">+</span></span>
<span id="cb96-344"><a href="#cb96-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(SSP), <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb96-345"><a href="#cb96-345" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cn">NULL</span>,</span>
<span id="cb96-346"><a href="#cb96-346" aria-hidden="true" tabindex="-1"></a>                    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb96-347"><a href="#cb96-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,</span>
<span id="cb96-348"><a href="#cb96-348" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">round</span>(<span class="fu">round</span>(<span class="fl">1.1</span><span class="sc">*</span>rng[<span class="dv">2</span>])))) <span class="sc">+</span></span>
<span id="cb96-349"><a href="#cb96-349" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_npc</span>(<span class="fu">aes</span>(<span class="at">npcx =</span> <span class="st">&quot;center&quot;</span>, </span>
<span id="cb96-350"><a href="#cb96-350" aria-hidden="true" tabindex="-1"></a>                      <span class="at">npcy =</span> <span class="st">&quot;top&quot;</span>, </span>
<span id="cb96-351"><a href="#cb96-351" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label =</span> Year),</span>
<span id="cb96-352"><a href="#cb96-352" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb96-353"><a href="#cb96-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb96-354"><a href="#cb96-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-355"><a href="#cb96-355" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-356"><a href="#cb96-356" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-357"><a href="#cb96-357" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb96-358"><a href="#cb96-358" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>,</span>
<span id="cb96-359"><a href="#cb96-359" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">0</span>, </span>
<span id="cb96-360"><a href="#cb96-360" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">0</span>,</span>
<span id="cb96-361"><a href="#cb96-361" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">0</span>, </span>
<span id="cb96-362"><a href="#cb96-362" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb96-363"><a href="#cb96-363" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(),</span>
<span id="cb96-364"><a href="#cb96-364" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-365"><a href="#cb96-365" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb96-366"><a href="#cb96-366" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb96-367"><a href="#cb96-367" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, </span>
<span id="cb96-368"><a href="#cb96-368" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb96-369"><a href="#cb96-369" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">size =</span> <span class="dv">15</span> <span class="sc">*</span> <span class="fl">1.05</span>,</span>
<span id="cb96-370"><a href="#cb96-370" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) </span>
<span id="cb96-371"><a href="#cb96-371" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb96-372"><a href="#cb96-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-373"><a href="#cb96-373" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> (past_plot <span class="sc">+</span></span>
<span id="cb96-374"><a href="#cb96-374" aria-hidden="true" tabindex="-1"></a>           future_plot_list <span class="sc">+</span></span>
<span id="cb96-375"><a href="#cb96-375" aria-hidden="true" tabindex="-1"></a>           <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>,</span>
<span id="cb96-376"><a href="#cb96-376" aria-hidden="true" tabindex="-1"></a>                       <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">rep</span>(<span class="fl">1.8</span>,<span class="fu">length</span>(future_plot_list))))</span>
<span id="cb96-377"><a href="#cb96-377" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb96-378"><a href="#cb96-378" aria-hidden="true" tabindex="-1"></a>                   <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb96-379"><a href="#cb96-379" aria-hidden="true" tabindex="-1"></a>                   <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb96-380"><a href="#cb96-380" aria-hidden="true" tabindex="-1"></a>                   <span class="at">axis.title.x=</span><span class="fu">element_blank</span>())</span>
<span id="cb96-381"><a href="#cb96-381" aria-hidden="true" tabindex="-1"></a>plot</span>
<span id="cb96-382"><a href="#cb96-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-383"><a href="#cb96-383" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb96-384"><a href="#cb96-384" aria-hidden="true" tabindex="-1"></a>metric <span class="ot">&lt;-</span> <span class="st">&quot;Frost_H&quot;</span></span>
<span id="cb96-385"><a href="#cb96-385" aria-hidden="true" tabindex="-1"></a>axis_label <span class="ot">&lt;-</span> <span class="st">&quot;Frost duration (in hours)&quot;</span></span>
<span id="cb96-386"><a href="#cb96-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-387"><a href="#cb96-387" aria-hidden="true" tabindex="-1"></a><span class="co"># get extreme values for the axis scale</span></span>
<span id="cb96-388"><a href="#cb96-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-389"><a href="#cb96-389" aria-hidden="true" tabindex="-1"></a>rng <span class="ot">&lt;-</span> <span class="fu">range</span>(past_observed[[metric]],</span>
<span id="cb96-390"><a href="#cb96-390" aria-hidden="true" tabindex="-1"></a>             past_simulated[[metric]],</span>
<span id="cb96-391"><a href="#cb96-391" aria-hidden="true" tabindex="-1"></a>             future_data[[metric]])  </span>
<span id="cb96-392"><a href="#cb96-392" aria-hidden="true" tabindex="-1"></a>past_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb96-393"><a href="#cb96-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">data =</span> past_simulated,</span>
<span id="cb96-394"><a href="#cb96-394" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes_string</span>(<span class="st">&quot;as.numeric(Year)&quot;</span>,</span>
<span id="cb96-395"><a href="#cb96-395" aria-hidden="true" tabindex="-1"></a>                          metric,<span class="at">group=</span><span class="st">&quot;Year&quot;</span>),</span>
<span id="cb96-396"><a href="#cb96-396" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span><span class="st">&quot;skyblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb96-397"><a href="#cb96-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb96-398"><a href="#cb96-398" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">round</span>(<span class="fu">round</span>(<span class="fl">1.1</span><span class="sc">*</span>rng[<span class="dv">2</span>])))) <span class="sc">+</span></span>
<span id="cb96-399"><a href="#cb96-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> axis_label) <span class="sc">+</span></span>
<span id="cb96-400"><a href="#cb96-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> Scenario) <span class="sc">+</span></span>
<span id="cb96-401"><a href="#cb96-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span>  </span>
<span id="cb96-402"><a href="#cb96-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-403"><a href="#cb96-403" aria-hidden="true" tabindex="-1"></a>           <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb96-404"><a href="#cb96-404" aria-hidden="true" tabindex="-1"></a>           <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb96-405"><a href="#cb96-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> past_observed,</span>
<span id="cb96-406"><a href="#cb96-406" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes_string</span>(<span class="st">&quot;End_year&quot;</span>,</span>
<span id="cb96-407"><a href="#cb96-407" aria-hidden="true" tabindex="-1"></a>                        metric),</span>
<span id="cb96-408"><a href="#cb96-408" aria-hidden="true" tabindex="-1"></a>             <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb96-409"><a href="#cb96-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-410"><a href="#cb96-410" aria-hidden="true" tabindex="-1"></a>future_plot_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb96-411"><a href="#cb96-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-412"><a href="#cb96-412" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(y <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">2050</span>,</span>
<span id="cb96-413"><a href="#cb96-413" aria-hidden="true" tabindex="-1"></a>           <span class="dv">2085</span>))</span>
<span id="cb96-414"><a href="#cb96-414" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb96-415"><a href="#cb96-415" aria-hidden="true" tabindex="-1"></a>  future_plot_list[[<span class="fu">which</span>(y <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">2050</span>,<span class="dv">2085</span>))]] <span class="ot">&lt;-</span></span>
<span id="cb96-416"><a href="#cb96-416" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> future_data[<span class="fu">which</span>(future_data<span class="sc">$</span>Year<span class="sc">==</span>y),]) <span class="sc">+</span></span>
<span id="cb96-417"><a href="#cb96-417" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="fu">aes_string</span>(<span class="st">&quot;GCM&quot;</span>, </span>
<span id="cb96-418"><a href="#cb96-418" aria-hidden="true" tabindex="-1"></a>                            metric, </span>
<span id="cb96-419"><a href="#cb96-419" aria-hidden="true" tabindex="-1"></a>                            <span class="at">fill=</span><span class="st">&quot;GCM&quot;</span>)) <span class="sc">+</span></span>
<span id="cb96-420"><a href="#cb96-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(SSP), <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb96-421"><a href="#cb96-421" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cn">NULL</span>,</span>
<span id="cb96-422"><a href="#cb96-422" aria-hidden="true" tabindex="-1"></a>                    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb96-423"><a href="#cb96-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,</span>
<span id="cb96-424"><a href="#cb96-424" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">round</span>(<span class="fu">round</span>(<span class="fl">1.1</span><span class="sc">*</span>rng[<span class="dv">2</span>])))) <span class="sc">+</span></span>
<span id="cb96-425"><a href="#cb96-425" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_npc</span>(<span class="fu">aes</span>(<span class="at">npcx =</span> <span class="st">&quot;center&quot;</span>, </span>
<span id="cb96-426"><a href="#cb96-426" aria-hidden="true" tabindex="-1"></a>                      <span class="at">npcy =</span> <span class="st">&quot;top&quot;</span>, </span>
<span id="cb96-427"><a href="#cb96-427" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label =</span> Year),</span>
<span id="cb96-428"><a href="#cb96-428" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb96-429"><a href="#cb96-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb96-430"><a href="#cb96-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-431"><a href="#cb96-431" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-432"><a href="#cb96-432" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-433"><a href="#cb96-433" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb96-434"><a href="#cb96-434" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>,</span>
<span id="cb96-435"><a href="#cb96-435" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">0</span>, </span>
<span id="cb96-436"><a href="#cb96-436" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">0</span>,</span>
<span id="cb96-437"><a href="#cb96-437" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">0</span>, </span>
<span id="cb96-438"><a href="#cb96-438" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb96-439"><a href="#cb96-439" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(),</span>
<span id="cb96-440"><a href="#cb96-440" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-441"><a href="#cb96-441" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb96-442"><a href="#cb96-442" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb96-443"><a href="#cb96-443" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, </span>
<span id="cb96-444"><a href="#cb96-444" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb96-445"><a href="#cb96-445" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">size =</span> <span class="dv">15</span> <span class="sc">*</span> <span class="fl">1.05</span>,</span>
<span id="cb96-446"><a href="#cb96-446" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) </span>
<span id="cb96-447"><a href="#cb96-447" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb96-448"><a href="#cb96-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-449"><a href="#cb96-449" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> (past_plot <span class="sc">+</span></span>
<span id="cb96-450"><a href="#cb96-450" aria-hidden="true" tabindex="-1"></a>           future_plot_list <span class="sc">+</span></span>
<span id="cb96-451"><a href="#cb96-451" aria-hidden="true" tabindex="-1"></a>           <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>,</span>
<span id="cb96-452"><a href="#cb96-452" aria-hidden="true" tabindex="-1"></a>                       <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">rep</span>(<span class="fl">1.8</span>,<span class="fu">length</span>(future_plot_list))))</span>
<span id="cb96-453"><a href="#cb96-453" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb96-454"><a href="#cb96-454" aria-hidden="true" tabindex="-1"></a>                   <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb96-455"><a href="#cb96-455" aria-hidden="true" tabindex="-1"></a>                   <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb96-456"><a href="#cb96-456" aria-hidden="true" tabindex="-1"></a>                   <span class="at">axis.title.x=</span><span class="fu">element_blank</span>())</span>
<span id="cb96-457"><a href="#cb96-457" aria-hidden="true" tabindex="-1"></a>plot</span>
<span id="cb96-458"><a href="#cb96-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-459"><a href="#cb96-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-460"><a href="#cb96-460" aria-hidden="true" tabindex="-1"></a>plot_scenarios_gg <span class="ot">&lt;-</span> <span class="cf">function</span>(past_observed,</span>
<span id="cb96-461"><a href="#cb96-461" aria-hidden="true" tabindex="-1"></a>                              past_simulated,</span>
<span id="cb96-462"><a href="#cb96-462" aria-hidden="true" tabindex="-1"></a>                              future_data,</span>
<span id="cb96-463"><a href="#cb96-463" aria-hidden="true" tabindex="-1"></a>                              metric,</span>
<span id="cb96-464"><a href="#cb96-464" aria-hidden="true" tabindex="-1"></a>                              axis_label,</span>
<span id="cb96-465"><a href="#cb96-465" aria-hidden="true" tabindex="-1"></a>                              time_points)</span>
<span id="cb96-466"><a href="#cb96-466" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb96-467"><a href="#cb96-467" aria-hidden="true" tabindex="-1"></a>  rng <span class="ot">&lt;-</span> <span class="fu">range</span>(past_observed[[metric]],</span>
<span id="cb96-468"><a href="#cb96-468" aria-hidden="true" tabindex="-1"></a>               past_simulated[[metric]],</span>
<span id="cb96-469"><a href="#cb96-469" aria-hidden="true" tabindex="-1"></a>               future_data[[metric]])  </span>
<span id="cb96-470"><a href="#cb96-470" aria-hidden="true" tabindex="-1"></a>  past_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb96-471"><a href="#cb96-471" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">data =</span> past_simulated,</span>
<span id="cb96-472"><a href="#cb96-472" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes_string</span>(<span class="st">&quot;as.numeric(Year)&quot;</span>,</span>
<span id="cb96-473"><a href="#cb96-473" aria-hidden="true" tabindex="-1"></a>                            metric,</span>
<span id="cb96-474"><a href="#cb96-474" aria-hidden="true" tabindex="-1"></a>                            <span class="at">group=</span><span class="st">&quot;Year&quot;</span>),</span>
<span id="cb96-475"><a href="#cb96-475" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill=</span><span class="st">&quot;skyblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb96-476"><a href="#cb96-476" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb96-477"><a href="#cb96-477" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">round</span>(<span class="fu">round</span>(<span class="fl">1.1</span><span class="sc">*</span>rng[<span class="dv">2</span>])))) <span class="sc">+</span></span>
<span id="cb96-478"><a href="#cb96-478" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> axis_label) <span class="sc">+</span></span>
<span id="cb96-479"><a href="#cb96-479" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="sc">~</span> Scenario) <span class="sc">+</span></span>
<span id="cb96-480"><a href="#cb96-480" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span>  </span>
<span id="cb96-481"><a href="#cb96-481" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-482"><a href="#cb96-482" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb96-483"><a href="#cb96-483" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, </span>
<span id="cb96-484"><a href="#cb96-484" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">hjust=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb96-485"><a href="#cb96-485" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> past_observed,</span>
<span id="cb96-486"><a href="#cb96-486" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes_string</span>(<span class="st">&quot;End_year&quot;</span>,</span>
<span id="cb96-487"><a href="#cb96-487" aria-hidden="true" tabindex="-1"></a>                          metric),</span>
<span id="cb96-488"><a href="#cb96-488" aria-hidden="true" tabindex="-1"></a>               <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb96-489"><a href="#cb96-489" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-490"><a href="#cb96-490" aria-hidden="true" tabindex="-1"></a>  future_plot_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb96-491"><a href="#cb96-491" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-492"><a href="#cb96-492" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y <span class="cf">in</span> time_points)</span>
<span id="cb96-493"><a href="#cb96-493" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb96-494"><a href="#cb96-494" aria-hidden="true" tabindex="-1"></a>    future_plot_list[[<span class="fu">which</span>(y <span class="sc">==</span> time_points)]] <span class="ot">&lt;-</span></span>
<span id="cb96-495"><a href="#cb96-495" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="at">data =</span> future_data[<span class="fu">which</span>(future_data<span class="sc">$</span>Year<span class="sc">==</span>y),]) <span class="sc">+</span></span>
<span id="cb96-496"><a href="#cb96-496" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="fu">aes_string</span>(<span class="st">&quot;GCM&quot;</span>, </span>
<span id="cb96-497"><a href="#cb96-497" aria-hidden="true" tabindex="-1"></a>                              metric, </span>
<span id="cb96-498"><a href="#cb96-498" aria-hidden="true" tabindex="-1"></a>                              <span class="at">fill=</span><span class="st">&quot;GCM&quot;</span>)) <span class="sc">+</span></span>
<span id="cb96-499"><a href="#cb96-499" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(SSP), <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb96-500"><a href="#cb96-500" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cn">NULL</span>,</span>
<span id="cb96-501"><a href="#cb96-501" aria-hidden="true" tabindex="-1"></a>                       <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb96-502"><a href="#cb96-502" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb96-503"><a href="#cb96-503" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">round</span>(<span class="fu">round</span>(<span class="fl">1.1</span><span class="sc">*</span>rng[<span class="dv">2</span>])))) <span class="sc">+</span></span>
<span id="cb96-504"><a href="#cb96-504" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text_npc</span>(<span class="fu">aes</span>(<span class="at">npcx =</span> <span class="st">&quot;center&quot;</span>,</span>
<span id="cb96-505"><a href="#cb96-505" aria-hidden="true" tabindex="-1"></a>                        <span class="at">npcy =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb96-506"><a href="#cb96-506" aria-hidden="true" tabindex="-1"></a>                        <span class="at">label =</span> Year),</span>
<span id="cb96-507"><a href="#cb96-507" aria-hidden="true" tabindex="-1"></a>                    <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb96-508"><a href="#cb96-508" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb96-509"><a href="#cb96-509" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-510"><a href="#cb96-510" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-511"><a href="#cb96-511" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-512"><a href="#cb96-512" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb96-513"><a href="#cb96-513" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>,</span>
<span id="cb96-514"><a href="#cb96-514" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">0</span>, </span>
<span id="cb96-515"><a href="#cb96-515" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">0</span>, </span>
<span id="cb96-516"><a href="#cb96-516" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">0</span>, </span>
<span id="cb96-517"><a href="#cb96-517" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb96-518"><a href="#cb96-518" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.background =</span> <span class="fu">element_rect</span>(),</span>
<span id="cb96-519"><a href="#cb96-519" aria-hidden="true" tabindex="-1"></a>            <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb96-520"><a href="#cb96-520" aria-hidden="true" tabindex="-1"></a>            <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb96-521"><a href="#cb96-521" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb96-522"><a href="#cb96-522" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb96-523"><a href="#cb96-523" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb96-524"><a href="#cb96-524" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">size =</span> <span class="dv">15</span> <span class="sc">*</span> <span class="fl">1.05</span>,</span>
<span id="cb96-525"><a href="#cb96-525" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) </span>
<span id="cb96-526"><a href="#cb96-526" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb96-527"><a href="#cb96-527" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-528"><a href="#cb96-528" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> (past_plot <span class="sc">+</span></span>
<span id="cb96-529"><a href="#cb96-529" aria-hidden="true" tabindex="-1"></a>             future_plot_list <span class="sc">+</span></span>
<span id="cb96-530"><a href="#cb96-530" aria-hidden="true" tabindex="-1"></a>             <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>,</span>
<span id="cb96-531"><a href="#cb96-531" aria-hidden="true" tabindex="-1"></a>                         <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">rep</span>(<span class="fl">1.8</span>,<span class="fu">length</span>(future_plot_list))))</span>
<span id="cb96-532"><a href="#cb96-532" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb96-533"><a href="#cb96-533" aria-hidden="true" tabindex="-1"></a>                     <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb96-534"><a href="#cb96-534" aria-hidden="true" tabindex="-1"></a>                     <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb96-535"><a href="#cb96-535" aria-hidden="true" tabindex="-1"></a>                     <span class="at">axis.title.x=</span><span class="fu">element_blank</span>())</span>
<span id="cb96-536"><a href="#cb96-536" aria-hidden="true" tabindex="-1"></a>  plot</span>
<span id="cb96-537"><a href="#cb96-537" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-538"><a href="#cb96-538" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb96-539"><a href="#cb96-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-540"><a href="#cb96-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-541"><a href="#cb96-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-542"><a href="#cb96-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-543"><a href="#cb96-543" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_scenarios_gg</span>(<span class="at">past_observed =</span> past_observed,</span>
<span id="cb96-544"><a href="#cb96-544" aria-hidden="true" tabindex="-1"></a>                  <span class="at">past_simulated =</span> past_simulated,</span>
<span id="cb96-545"><a href="#cb96-545" aria-hidden="true" tabindex="-1"></a>                  <span class="at">future_data =</span> future_data,</span>
<span id="cb96-546"><a href="#cb96-546" aria-hidden="true" tabindex="-1"></a>                  <span class="at">metric =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb96-547"><a href="#cb96-547" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis_label =</span> <span class="st">&quot;Heat (in Growing Degree Hours)&quot;</span>,</span>
<span id="cb96-548"><a href="#cb96-548" aria-hidden="true" tabindex="-1"></a>                  <span class="at">time_points =</span> <span class="fu">c</span>(<span class="dv">2050</span>, <span class="dv">2085</span>))</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb97"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_scenarios_gg</span>(<span class="at">past_observed =</span> past_observed,</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">past_simulated =</span> past_simulated,</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">future_data =</span> future_data,</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">metric =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis_label =</span> <span class="st">&quot;Chill (in Chill Portions)&quot;</span>,</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">time_points =</span> <span class="fu">c</span>(<span class="dv">2050</span>, <span class="dv">2085</span>))</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb98"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_scenarios_gg</span>(<span class="at">past_observed =</span> past_observed,</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">past_simulated =</span> past_simulated,</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">future_data =</span> future_data,</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">metric =</span> <span class="st">&quot;Frost_H&quot;</span>,</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis_label =</span> <span class="st">&quot;Frost duration (in hours)&quot;</span>,</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">time_points =</span> <span class="fu">c</span>(<span class="dv">2050</span>, <span class="dv">2085</span>))</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_frost_plot.png&quot;</span>, </span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">600</span>)</span></code></pre></div>
</details>
</div>
<hr />
</section>
</section>
<section id="chapter-19-chill-model-comparison" class="level1">
<h1>Chapter 19: Chill model comparison</h1>
<section id="exercises-on-chill-model-comparison" class="level2">
<h2><strong><em>Exercises on chill model comparison</em></strong></h2>
<p>1.Produce similar plots for the weather station you selected for earlier exercises.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb99"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(chillR)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(tidyverse)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(colorRamps)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(patchwork)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(gganimate)</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a> SSPs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssp126&quot;</span>, <span class="st">&quot;ssp245&quot;</span>, <span class="st">&quot;ssp370&quot;</span>, <span class="st">&quot;ssp585&quot;</span>)</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a> Times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2050</span>, <span class="dv">2085</span>)</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(chillR)</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(devtools)</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">install_github</span>(<span class="st">&quot;EduardoFernandezC/dormancyR&quot;</span>)</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(dormancyR)</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a> hourly_models <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">Chilling_units =</span> chilling_units,</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">Low_chill =</span> low_chill_model,</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">Modified_Utah =</span> modified_utah_model,</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">North_Carolina =</span> north_carolina_model,</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">Positive_Utah =</span> positive_utah_model,</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">Chilling_Hours =</span> Chilling_Hours,</span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">Utah_Chill_Units =</span> Utah_Model,</span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">Chill_Portions =</span> Dynamic_Model)</span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>  daily_models <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Rate_of_Chill =</span> rate_of_chill,</span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Chill_Days =</span> chill_days,</span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Exponential_Chill =</span> exponential_chill,</span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Triangular_Chill_Haninnen =</span> triangular_chill_1,</span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Triangular_Chill_Legave =</span> triangular_chill_2)</span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">names</span>(daily_models),</span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a>             <span class="fu">names</span>(hourly_models))</span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a>model_labels <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Rate of Chill&quot;</span>,</span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Chill Days&quot;</span>,</span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Exponential Chill&quot;</span>,</span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Triangular Chill (HÃ¤ninnen)&quot;</span>,</span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Triangular Chill (Legave)&quot;</span>,</span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Chilling Units&quot;</span>,</span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Low-Chill Chill Units&quot;</span>,</span>
<span id="cb99-40"><a href="#cb99-40" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Modified Utah Chill Units&quot;</span>,</span>
<span id="cb99-41"><a href="#cb99-41" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;North Carolina Chill Units&quot;</span>,</span>
<span id="cb99-42"><a href="#cb99-42" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Positive Utah Chill Units&quot;</span>,</span>
<span id="cb99-43"><a href="#cb99-43" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Chilling Hours&quot;</span>,</span>
<span id="cb99-44"><a href="#cb99-44" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Utah Chill Units&quot;</span>,</span>
<span id="cb99-45"><a href="#cb99-45" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Chill Portions&quot;</span>)</span>
<span id="cb99-46"><a href="#cb99-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-47"><a href="#cb99-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-48"><a href="#cb99-48" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Metric=</span>model_labels,<span class="st">&#39;Function name&#39;</span><span class="ot">=</span>metrics)</span>
<span id="cb99-49"><a href="#cb99-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-50"><a href="#cb99-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-51"><a href="#cb99-51" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Metric=</span>model_labels,<span class="st">&#39;Function name&#39;</span><span class="ot">=</span>metrics)</span>
<span id="cb99-52"><a href="#cb99-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-53"><a href="#cb99-53" aria-hidden="true" tabindex="-1"></a>Rochester_temps <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_temps.csv&quot;</span>)</span>
<span id="cb99-54"><a href="#cb99-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-55"><a href="#cb99-55" aria-hidden="true" tabindex="-1"></a>Temps <span class="ot">&lt;-</span> <span class="fu">load_temperature_scenarios</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York&quot;</span>,</span>
<span id="cb99-56"><a href="#cb99-56" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;all_past_temps&quot;</span>)</span>
<span id="cb99-57"><a href="#cb99-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-58"><a href="#cb99-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-59"><a href="#cb99-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-60"><a href="#cb99-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-61"><a href="#cb99-61" aria-hidden="true" tabindex="-1"></a>Start_JDay <span class="ot">&lt;-</span> <span class="dv">305</span></span>
<span id="cb99-62"><a href="#cb99-62" aria-hidden="true" tabindex="-1"></a>End_JDay <span class="ot">&lt;-</span> <span class="dv">59</span></span>
<span id="cb99-63"><a href="#cb99-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-64"><a href="#cb99-64" aria-hidden="true" tabindex="-1"></a>daily_models_past_scenarios <span class="ot">&lt;-</span></span>
<span id="cb99-65"><a href="#cb99-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tempResponse_list_daily</span>(Temps,</span>
<span id="cb99-66"><a href="#cb99-66" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Start_JDay =</span> Start_JDay,</span>
<span id="cb99-67"><a href="#cb99-67" aria-hidden="true" tabindex="-1"></a>                          <span class="at">End_JDay =</span> End_JDay,</span>
<span id="cb99-68"><a href="#cb99-68" aria-hidden="true" tabindex="-1"></a>                          <span class="at">models =</span> daily_models) <span class="co"># list of daily temperatures function for min and max temps</span></span>
<span id="cb99-69"><a href="#cb99-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-70"><a href="#cb99-70" aria-hidden="true" tabindex="-1"></a>daily_models_past_scenarios <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb99-71"><a href="#cb99-71" aria-hidden="true" tabindex="-1"></a>  daily_models_past_scenarios,</span>
<span id="cb99-72"><a href="#cb99-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) x[<span class="fu">which</span>(x<span class="sc">$</span>Perc_complete<span class="sc">&gt;</span><span class="dv">90</span>),]) <span class="co"># allows us to apply models</span></span>
<span id="cb99-73"><a href="#cb99-73" aria-hidden="true" tabindex="-1"></a><span class="co"># total of 99 seasons</span></span>
<span id="cb99-74"><a href="#cb99-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-75"><a href="#cb99-75" aria-hidden="true" tabindex="-1"></a>hourly_models_past_scenarios <span class="ot">&lt;-</span></span>
<span id="cb99-76"><a href="#cb99-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tempResponse_daily_list</span>(Temps,</span>
<span id="cb99-77"><a href="#cb99-77" aria-hidden="true" tabindex="-1"></a>                          <span class="at">latitude =</span> <span class="fl">43.156</span>,</span>
<span id="cb99-78"><a href="#cb99-78" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Start_JDay =</span> Start_JDay,</span>
<span id="cb99-79"><a href="#cb99-79" aria-hidden="true" tabindex="-1"></a>                          <span class="at">End_JDay =</span> End_JDay,</span>
<span id="cb99-80"><a href="#cb99-80" aria-hidden="true" tabindex="-1"></a>                          <span class="at">models =</span> hourly_models,</span>
<span id="cb99-81"><a href="#cb99-81" aria-hidden="true" tabindex="-1"></a>                          <span class="at">misstolerance =</span> <span class="dv">10</span>)</span>
<span id="cb99-82"><a href="#cb99-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-83"><a href="#cb99-83" aria-hidden="true" tabindex="-1"></a>past_scenarios <span class="ot">&lt;-</span> daily_models_past_scenarios <span class="co"># combine the two models</span></span>
<span id="cb99-84"><a href="#cb99-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-85"><a href="#cb99-85" aria-hidden="true" tabindex="-1"></a>past_scenarios <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb99-86"><a href="#cb99-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(past_scenarios),</span>
<span id="cb99-87"><a href="#cb99-87" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x)</span>
<span id="cb99-88"><a href="#cb99-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(past_scenarios[[x]],</span>
<span id="cb99-89"><a href="#cb99-89" aria-hidden="true" tabindex="-1"></a>          hourly_models_past_scenarios[[x]][,<span class="fu">names</span>(hourly_models)]))</span>
<span id="cb99-90"><a href="#cb99-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-91"><a href="#cb99-91" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(past_scenarios) <span class="ot">&lt;-</span> <span class="fu">names</span>(daily_models_past_scenarios)</span>
<span id="cb99-92"><a href="#cb99-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-93"><a href="#cb99-93" aria-hidden="true" tabindex="-1"></a>daily_models_observed <span class="ot">&lt;-</span></span>
<span id="cb99-94"><a href="#cb99-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tempResponse_daily</span>(Rochester_temps,</span>
<span id="cb99-95"><a href="#cb99-95" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Start_JDay =</span> Start_JDay,</span>
<span id="cb99-96"><a href="#cb99-96" aria-hidden="true" tabindex="-1"></a>                     <span class="at">End_JDay =</span> End_JDay,</span>
<span id="cb99-97"><a href="#cb99-97" aria-hidden="true" tabindex="-1"></a>                     <span class="at">models =</span> daily_models)</span>
<span id="cb99-98"><a href="#cb99-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-99"><a href="#cb99-99" aria-hidden="true" tabindex="-1"></a>daily_models_observed <span class="ot">&lt;-</span></span>
<span id="cb99-100"><a href="#cb99-100" aria-hidden="true" tabindex="-1"></a>  daily_models_observed[<span class="fu">which</span>(daily_models_observed<span class="sc">$</span>Perc_complete<span class="sc">&gt;</span><span class="dv">90</span>),]</span>
<span id="cb99-101"><a href="#cb99-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-102"><a href="#cb99-102" aria-hidden="true" tabindex="-1"></a>hourly_models_observed <span class="ot">&lt;-</span></span>
<span id="cb99-103"><a href="#cb99-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tempResponse_daily_list</span>(Rochester_temps,</span>
<span id="cb99-104"><a href="#cb99-104" aria-hidden="true" tabindex="-1"></a>                          <span class="at">latitude=</span> <span class="fl">43.156</span>,</span>
<span id="cb99-105"><a href="#cb99-105" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Start_JDay =</span> Start_JDay,</span>
<span id="cb99-106"><a href="#cb99-106" aria-hidden="true" tabindex="-1"></a>                          <span class="at">End_JDay =</span> End_JDay,</span>
<span id="cb99-107"><a href="#cb99-107" aria-hidden="true" tabindex="-1"></a>                          <span class="at">models =</span> hourly_models,</span>
<span id="cb99-108"><a href="#cb99-108" aria-hidden="true" tabindex="-1"></a>                          <span class="at">misstolerance =</span> <span class="dv">10</span>)</span>
<span id="cb99-109"><a href="#cb99-109" aria-hidden="true" tabindex="-1"></a><span class="co"># run from here later</span></span>
<span id="cb99-110"><a href="#cb99-110" aria-hidden="true" tabindex="-1"></a>past_observed <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb99-111"><a href="#cb99-111" aria-hidden="true" tabindex="-1"></a>  daily_models_observed,</span>
<span id="cb99-112"><a href="#cb99-112" aria-hidden="true" tabindex="-1"></a>  hourly_models_observed[[<span class="dv">1</span>]][,<span class="fu">names</span>(hourly_models)])</span>
<span id="cb99-113"><a href="#cb99-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-114"><a href="#cb99-114" aria-hidden="true" tabindex="-1"></a><span class="fu">save_temperature_scenarios</span>(past_scenarios,</span>
<span id="cb99-115"><a href="#cb99-115" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;</span>,</span>
<span id="cb99-116"><a href="#cb99-116" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Rochester_multichill_305_59_historic&quot;</span>)</span>
<span id="cb99-117"><a href="#cb99-117" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(past_observed,</span>
<span id="cb99-118"><a href="#cb99-118" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate/Rochester_multichill_305_59_observed.csv&quot;</span>,</span>
<span id="cb99-119"><a href="#cb99-119" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names=</span><span class="cn">FALSE</span>)</span>
<span id="cb99-120"><a href="#cb99-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-121"><a href="#cb99-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-122"><a href="#cb99-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-123"><a href="#cb99-123" aria-hidden="true" tabindex="-1"></a>future_temps <span class="ot">&lt;-</span> <span class="fu">load_temperature_scenarios</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;</span>,<span class="st">&quot;Rochester_future_&quot;</span>)</span>
<span id="cb99-124"><a href="#cb99-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-125"><a href="#cb99-125" aria-hidden="true" tabindex="-1"></a>SSPs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssp126&quot;</span>, <span class="st">&quot;ssp245&quot;</span>, <span class="st">&quot;ssp370&quot;</span>, <span class="st">&quot;ssp585&quot;</span>)</span>
<span id="cb99-126"><a href="#cb99-126" aria-hidden="true" tabindex="-1"></a>Times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2050</span>, <span class="dv">2085</span>)</span>
<span id="cb99-127"><a href="#cb99-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-128"><a href="#cb99-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-129"><a href="#cb99-129" aria-hidden="true" tabindex="-1"></a>list_ssp <span class="ot">&lt;-</span></span>
<span id="cb99-130"><a href="#cb99-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="fu">names</span>(future_temps), <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-131"><a href="#cb99-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-132"><a href="#cb99-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb99-133"><a href="#cb99-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-134"><a href="#cb99-134" aria-hidden="true" tabindex="-1"></a>list_gcm <span class="ot">&lt;-</span></span>
<span id="cb99-135"><a href="#cb99-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="fu">names</span>(future_temps), <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-136"><a href="#cb99-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-137"><a href="#cb99-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb99-138"><a href="#cb99-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-139"><a href="#cb99-139" aria-hidden="true" tabindex="-1"></a>list_time <span class="ot">&lt;-</span></span>
<span id="cb99-140"><a href="#cb99-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="fu">names</span>(future_temps), <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-141"><a href="#cb99-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-142"><a href="#cb99-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb99-143"><a href="#cb99-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-144"><a href="#cb99-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-145"><a href="#cb99-145" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(SSP <span class="cf">in</span> SSPs)</span>
<span id="cb99-146"><a href="#cb99-146" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(Time <span class="cf">in</span> Times)</span>
<span id="cb99-147"><a href="#cb99-147" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb99-148"><a href="#cb99-148" aria-hidden="true" tabindex="-1"></a>    Temps <span class="ot">&lt;-</span> future_temps[list_ssp <span class="sc">==</span> SSP <span class="sc">&amp;</span> list_time <span class="sc">==</span> Time]</span>
<span id="cb99-149"><a href="#cb99-149" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(Temps) <span class="ot">&lt;-</span> list_gcm[list_ssp <span class="sc">==</span> SSP <span class="sc">&amp;</span> list_time <span class="sc">==</span> Time]</span>
<span id="cb99-150"><a href="#cb99-150" aria-hidden="true" tabindex="-1"></a>    daily_models_future_scenarios <span class="ot">&lt;-</span> <span class="fu">tempResponse_list_daily</span>(</span>
<span id="cb99-151"><a href="#cb99-151" aria-hidden="true" tabindex="-1"></a>      Temps,</span>
<span id="cb99-152"><a href="#cb99-152" aria-hidden="true" tabindex="-1"></a>      <span class="at">Start_JDay =</span> Start_JDay,</span>
<span id="cb99-153"><a href="#cb99-153" aria-hidden="true" tabindex="-1"></a>      <span class="at">End_JDay =</span> End_JDay,</span>
<span id="cb99-154"><a href="#cb99-154" aria-hidden="true" tabindex="-1"></a>      <span class="at">models =</span> daily_models)</span>
<span id="cb99-155"><a href="#cb99-155" aria-hidden="true" tabindex="-1"></a>    daily_models_future_scenarios<span class="ot">&lt;-</span><span class="fu">lapply</span>(</span>
<span id="cb99-156"><a href="#cb99-156" aria-hidden="true" tabindex="-1"></a>      daily_models_future_scenarios,</span>
<span id="cb99-157"><a href="#cb99-157" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(x) x[<span class="fu">which</span>(x<span class="sc">$</span>Perc_complete<span class="sc">&gt;</span><span class="dv">90</span>),])</span>
<span id="cb99-158"><a href="#cb99-158" aria-hidden="true" tabindex="-1"></a>    hourly_models_future_scenarios<span class="ot">&lt;-</span></span>
<span id="cb99-159"><a href="#cb99-159" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tempResponse_daily_list</span>(</span>
<span id="cb99-160"><a href="#cb99-160" aria-hidden="true" tabindex="-1"></a>        Temps,</span>
<span id="cb99-161"><a href="#cb99-161" aria-hidden="true" tabindex="-1"></a>        <span class="at">latitude =</span> <span class="fl">43.156</span>,</span>
<span id="cb99-162"><a href="#cb99-162" aria-hidden="true" tabindex="-1"></a>        <span class="at">Start_JDay =</span> Start_JDay,</span>
<span id="cb99-163"><a href="#cb99-163" aria-hidden="true" tabindex="-1"></a>        <span class="at">End_JDay =</span> End_JDay,</span>
<span id="cb99-164"><a href="#cb99-164" aria-hidden="true" tabindex="-1"></a>        <span class="at">models=</span>hourly_models,</span>
<span id="cb99-165"><a href="#cb99-165" aria-hidden="true" tabindex="-1"></a>        <span class="at">misstolerance =</span> <span class="dv">10</span>)</span>
<span id="cb99-166"><a href="#cb99-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-167"><a href="#cb99-167" aria-hidden="true" tabindex="-1"></a>    future_scenarios <span class="ot">&lt;-</span> daily_models_future_scenarios</span>
<span id="cb99-168"><a href="#cb99-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-169"><a href="#cb99-169" aria-hidden="true" tabindex="-1"></a>    future_scenarios <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb99-170"><a href="#cb99-170" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(future_scenarios),</span>
<span id="cb99-171"><a href="#cb99-171" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(x)</span>
<span id="cb99-172"><a href="#cb99-172" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cbind</span>(future_scenarios[[x]],</span>
<span id="cb99-173"><a href="#cb99-173" aria-hidden="true" tabindex="-1"></a>              hourly_models_future_scenarios[[x]][,<span class="fu">names</span>(hourly_models)]))</span>
<span id="cb99-174"><a href="#cb99-174" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(future_scenarios)<span class="ot">&lt;-</span><span class="fu">names</span>(daily_models_future_scenarios)</span>
<span id="cb99-175"><a href="#cb99-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-176"><a href="#cb99-176" aria-hidden="true" tabindex="-1"></a>    chill<span class="ot">&lt;-</span>future_scenarios</span>
<span id="cb99-177"><a href="#cb99-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-178"><a href="#cb99-178" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save_temperature_scenarios</span>(</span>
<span id="cb99-179"><a href="#cb99-179" aria-hidden="true" tabindex="-1"></a>      chill,</span>
<span id="cb99-180"><a href="#cb99-180" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;data_New_York/future_climate&quot;</span>,</span>
<span id="cb99-181"><a href="#cb99-181" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;Rochester_multichill_305_59_&quot;</span>,Time,<span class="st">&quot;_&quot;</span>,SSP))</span>
<span id="cb99-182"><a href="#cb99-182" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb99-183"><a href="#cb99-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-184"><a href="#cb99-184" aria-hidden="true" tabindex="-1"></a>chill_past_scenarios <span class="ot">&lt;-</span> <span class="fu">load_temperature_scenarios</span>(</span>
<span id="cb99-185"><a href="#cb99-185" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;</span>,</span>
<span id="cb99-186"><a href="#cb99-186" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Rochester_multichill_305_59_historic&quot;</span>)</span>
<span id="cb99-187"><a href="#cb99-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-188"><a href="#cb99-188" aria-hidden="true" tabindex="-1"></a>chill_observed <span class="ot">&lt;-</span></span>
<span id="cb99-189"><a href="#cb99-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate/Rochester_multichill_305_59_observed.csv&quot;</span>)</span>
<span id="cb99-190"><a href="#cb99-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-191"><a href="#cb99-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-192"><a href="#cb99-192" aria-hidden="true" tabindex="-1"></a>chills <span class="ot">&lt;-</span> <span class="fu">make_climate_scenario</span>(chill_past_scenarios,</span>
<span id="cb99-193"><a href="#cb99-193" aria-hidden="true" tabindex="-1"></a>                                <span class="at">caption =</span> <span class="st">&quot;Historic&quot;</span>,</span>
<span id="cb99-194"><a href="#cb99-194" aria-hidden="true" tabindex="-1"></a>                                <span class="at">historic_data =</span> chill_observed,</span>
<span id="cb99-195"><a href="#cb99-195" aria-hidden="true" tabindex="-1"></a>                                <span class="at">time_series =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-196"><a href="#cb99-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-197"><a href="#cb99-197" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(SSP <span class="cf">in</span> SSPs)</span>
<span id="cb99-198"><a href="#cb99-198" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(Time <span class="cf">in</span> Times)</span>
<span id="cb99-199"><a href="#cb99-199" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb99-200"><a href="#cb99-200" aria-hidden="true" tabindex="-1"></a>    chill <span class="ot">&lt;-</span> <span class="fu">load_temperature_scenarios</span>(</span>
<span id="cb99-201"><a href="#cb99-201" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;</span>,</span>
<span id="cb99-202"><a href="#cb99-202" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;Rochester_multichill_305_59_&quot;</span>,Time,<span class="st">&quot;_&quot;</span>,SSP))</span>
<span id="cb99-203"><a href="#cb99-203" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(SSP <span class="sc">==</span> <span class="st">&quot;ssp126&quot;</span>) SSPcaption <span class="ot">&lt;-</span> <span class="st">&quot;SSP1&quot;</span></span>
<span id="cb99-204"><a href="#cb99-204" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(SSP <span class="sc">==</span> <span class="st">&quot;ssp245&quot;</span>) SSPcaption <span class="ot">&lt;-</span> <span class="st">&quot;SSP2&quot;</span></span>
<span id="cb99-205"><a href="#cb99-205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(SSP <span class="sc">==</span> <span class="st">&quot;ssp370&quot;</span>) SSPcaption <span class="ot">&lt;-</span> <span class="st">&quot;SSP3&quot;</span></span>
<span id="cb99-206"><a href="#cb99-206" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(SSP <span class="sc">==</span> <span class="st">&quot;ssp585&quot;</span>) SSPcaption <span class="ot">&lt;-</span> <span class="st">&quot;SSP5&quot;</span></span>
<span id="cb99-207"><a href="#cb99-207" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(Time <span class="sc">==</span> <span class="st">&quot;2050&quot;</span>) Time_caption <span class="ot">&lt;-</span> <span class="st">&quot;2050&quot;</span></span>
<span id="cb99-208"><a href="#cb99-208" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(Time <span class="sc">==</span> <span class="st">&quot;2085&quot;</span>) Time_caption <span class="ot">&lt;-</span> <span class="st">&quot;2085&quot;</span></span>
<span id="cb99-209"><a href="#cb99-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-210"><a href="#cb99-210" aria-hidden="true" tabindex="-1"></a>    chills <span class="ot">&lt;-</span> <span class="fu">make_climate_scenario</span>(chill,</span>
<span id="cb99-211"><a href="#cb99-211" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">caption =</span> <span class="fu">c</span>(SSPcaption,</span>
<span id="cb99-212"><a href="#cb99-212" aria-hidden="true" tabindex="-1"></a>                                                Time_caption),</span>
<span id="cb99-213"><a href="#cb99-213" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">add_to =</span> chills)</span>
<span id="cb99-214"><a href="#cb99-214" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb99-215"><a href="#cb99-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-216"><a href="#cb99-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-217"><a href="#cb99-217" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_climate_scenarios</span>(chills,</span>
<span id="cb99-218"><a href="#cb99-218" aria-hidden="true" tabindex="-1"></a>                       <span class="at">metric=</span><span class="st">&quot;Rate_of_Chill&quot;</span>,</span>
<span id="cb99-219"><a href="#cb99-219" aria-hidden="true" tabindex="-1"></a>                       <span class="at">metric_label=</span><span class="st">&quot;Rate of Chill&quot;</span>,</span>
<span id="cb99-220"><a href="#cb99-220" aria-hidden="true" tabindex="-1"></a>                       <span class="at">year_name=</span><span class="st">&quot;End_Year&quot;</span>)</span>
<span id="cb99-221"><a href="#cb99-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-222"><a href="#cb99-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-223"><a href="#cb99-223" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(chills))</span>
<span id="cb99-224"><a href="#cb99-224" aria-hidden="true" tabindex="-1"></a>   {ch <span class="ot">&lt;-</span> chills[[i]]</span>
<span id="cb99-225"><a href="#cb99-225" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(ch<span class="sc">$</span>caption[<span class="dv">1</span>] <span class="sc">==</span> <span class="st">&quot;Historic&quot;</span>)</span>
<span id="cb99-226"><a href="#cb99-226" aria-hidden="true" tabindex="-1"></a>     {GCMs <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;none&quot;</span>,<span class="fu">length</span>(<span class="fu">names</span>(ch<span class="sc">$</span>data)))</span>
<span id="cb99-227"><a href="#cb99-227" aria-hidden="true" tabindex="-1"></a>      SSPs <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;none&quot;</span>,<span class="fu">length</span>(<span class="fu">names</span>(ch<span class="sc">$</span>data)))</span>
<span id="cb99-228"><a href="#cb99-228" aria-hidden="true" tabindex="-1"></a>      Years <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ch<span class="sc">$</span>labels)</span>
<span id="cb99-229"><a href="#cb99-229" aria-hidden="true" tabindex="-1"></a>      Scenario <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;Historic&quot;</span>,</span>
<span id="cb99-230"><a href="#cb99-230" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">length</span>(<span class="fu">names</span>(ch<span class="sc">$</span>data)))} <span class="cf">else</span></span>
<span id="cb99-231"><a href="#cb99-231" aria-hidden="true" tabindex="-1"></a>                        {GCMs <span class="ot">&lt;-</span> <span class="fu">names</span>(ch<span class="sc">$</span>data)</span>
<span id="cb99-232"><a href="#cb99-232" aria-hidden="true" tabindex="-1"></a>                        SSPs <span class="ot">&lt;-</span> <span class="fu">rep</span>(ch<span class="sc">$</span>caption[<span class="dv">1</span>],</span>
<span id="cb99-233"><a href="#cb99-233" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">length</span>(<span class="fu">names</span>(ch<span class="sc">$</span>data)))</span>
<span id="cb99-234"><a href="#cb99-234" aria-hidden="true" tabindex="-1"></a>                        Years <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(ch<span class="sc">$</span>caption[<span class="dv">2</span>]),</span>
<span id="cb99-235"><a href="#cb99-235" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">length</span>(<span class="fu">names</span>(ch<span class="sc">$</span>data)))</span>
<span id="cb99-236"><a href="#cb99-236" aria-hidden="true" tabindex="-1"></a>                        Scenario <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;Future&quot;</span>,</span>
<span id="cb99-237"><a href="#cb99-237" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">length</span>(<span class="fu">names</span>(ch<span class="sc">$</span>data)))}</span>
<span id="cb99-238"><a href="#cb99-238" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span>(nam <span class="cf">in</span> <span class="fu">names</span>(ch<span class="sc">$</span>data))</span>
<span id="cb99-239"><a href="#cb99-239" aria-hidden="true" tabindex="-1"></a>     {<span class="cf">for</span>(met <span class="cf">in</span> metrics)</span>
<span id="cb99-240"><a href="#cb99-240" aria-hidden="true" tabindex="-1"></a>       {temp_res <span class="ot">&lt;-</span></span>
<span id="cb99-241"><a href="#cb99-241" aria-hidden="true" tabindex="-1"></a>         <span class="fu">data.frame</span>(<span class="at">Metric =</span> met,</span>
<span id="cb99-242"><a href="#cb99-242" aria-hidden="true" tabindex="-1"></a>                    <span class="at">GCM =</span> GCMs[<span class="fu">which</span>(nam <span class="sc">==</span> <span class="fu">names</span>(ch<span class="sc">$</span>data))],</span>
<span id="cb99-243"><a href="#cb99-243" aria-hidden="true" tabindex="-1"></a>                    <span class="at">SSP =</span> SSPs[<span class="fu">which</span>(nam <span class="sc">==</span> <span class="fu">names</span>(ch<span class="sc">$</span>data))],</span>
<span id="cb99-244"><a href="#cb99-244" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Year =</span> Years[<span class="fu">which</span>(nam <span class="sc">==</span> <span class="fu">names</span>(ch<span class="sc">$</span>data))],</span>
<span id="cb99-245"><a href="#cb99-245" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Result =</span> <span class="fu">quantile</span>(ch<span class="sc">$</span>data[[nam]][,met],<span class="fl">0.1</span>), <span class="co"># 10% quantile</span></span>
<span id="cb99-246"><a href="#cb99-246" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Scenario =</span> Scenario[<span class="fu">which</span>(nam <span class="sc">==</span> <span class="fu">names</span>(ch<span class="sc">$</span>data))])</span>
<span id="cb99-247"><a href="#cb99-247" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> nam <span class="sc">==</span> <span class="fu">names</span>(ch<span class="sc">$</span>data)[<span class="dv">1</span>] <span class="sc">&amp;</span> met <span class="sc">==</span> metrics[<span class="dv">1</span>])</span>
<span id="cb99-248"><a href="#cb99-248" aria-hidden="true" tabindex="-1"></a>         results <span class="ot">&lt;-</span> temp_res <span class="cf">else</span></span>
<span id="cb99-249"><a href="#cb99-249" aria-hidden="true" tabindex="-1"></a>           results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results,</span>
<span id="cb99-250"><a href="#cb99-250" aria-hidden="true" tabindex="-1"></a>                            temp_res)</span>
<span id="cb99-251"><a href="#cb99-251" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb99-252"><a href="#cb99-252" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb99-253"><a href="#cb99-253" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb99-254"><a href="#cb99-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-255"><a href="#cb99-255" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(met <span class="cf">in</span> metrics)</span>
<span id="cb99-256"><a href="#cb99-256" aria-hidden="true" tabindex="-1"></a>  results[<span class="fu">which</span>(results<span class="sc">$</span>Metric <span class="sc">==</span> met),<span class="st">&quot;SWC&quot;</span>] <span class="ot">&lt;-</span></span>
<span id="cb99-257"><a href="#cb99-257" aria-hidden="true" tabindex="-1"></a>    results[<span class="fu">which</span>(results<span class="sc">$</span>Metric <span class="sc">==</span> met),<span class="st">&quot;Result&quot;</span>]<span class="sc">/</span></span>
<span id="cb99-258"><a href="#cb99-258" aria-hidden="true" tabindex="-1"></a>      results[<span class="fu">which</span>(results<span class="sc">$</span>Metric <span class="sc">==</span> met <span class="sc">&amp;</span> results<span class="sc">$</span>Year <span class="sc">==</span> <span class="dv">1980</span>),</span>
<span id="cb99-259"><a href="#cb99-259" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;Result&quot;</span>]<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb99-260"><a href="#cb99-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-261"><a href="#cb99-261" aria-hidden="true" tabindex="-1"></a>rng <span class="ot">=</span> <span class="fu">range</span>(results<span class="sc">$</span>SWC)</span>
<span id="cb99-262"><a href="#cb99-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-263"><a href="#cb99-263" aria-hidden="true" tabindex="-1"></a>p_future <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(results[<span class="fu">which</span>(<span class="sc">!</span>results<span class="sc">$</span>GCM <span class="sc">==</span> <span class="st">&quot;none&quot;</span>),],</span>
<span id="cb99-264"><a href="#cb99-264" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(GCM,</span>
<span id="cb99-265"><a href="#cb99-265" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> <span class="fu">factor</span>(Metric,</span>
<span id="cb99-266"><a href="#cb99-266" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">levels =</span> metrics),</span>
<span id="cb99-267"><a href="#cb99-267" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fill =</span> SWC)) <span class="sc">+</span></span>
<span id="cb99-268"><a href="#cb99-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>()</span>
<span id="cb99-269"><a href="#cb99-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-270"><a href="#cb99-270" aria-hidden="true" tabindex="-1"></a>p_future</span>
<span id="cb99-271"><a href="#cb99-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-272"><a href="#cb99-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-273"><a href="#cb99-273" aria-hidden="true" tabindex="-1"></a>p_future <span class="ot">&lt;-</span></span>
<span id="cb99-274"><a href="#cb99-274" aria-hidden="true" tabindex="-1"></a>  p_future <span class="sc">+</span></span>
<span id="cb99-275"><a href="#cb99-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(SSP <span class="sc">~</span> Year)</span>
<span id="cb99-276"><a href="#cb99-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-277"><a href="#cb99-277" aria-hidden="true" tabindex="-1"></a>p_future</span>
<span id="cb99-278"><a href="#cb99-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-279"><a href="#cb99-279" aria-hidden="true" tabindex="-1"></a>p_future <span class="ot">&lt;-</span></span>
<span id="cb99-280"><a href="#cb99-280" aria-hidden="true" tabindex="-1"></a>  p_future <span class="sc">+</span></span>
<span id="cb99-281"><a href="#cb99-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb99-282"><a href="#cb99-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))</span>
<span id="cb99-283"><a href="#cb99-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-284"><a href="#cb99-284" aria-hidden="true" tabindex="-1"></a>p_future</span>
<span id="cb99-285"><a href="#cb99-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-286"><a href="#cb99-286" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorRamps)</span>
<span id="cb99-287"><a href="#cb99-287" aria-hidden="true" tabindex="-1"></a>p_future <span class="ot">&lt;-</span></span>
<span id="cb99-288"><a href="#cb99-288" aria-hidden="true" tabindex="-1"></a>  p_future <span class="sc">+</span></span>
<span id="cb99-289"><a href="#cb99-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">rev</span>(<span class="fu">matlab.like</span>(<span class="dv">15</span>)),</span>
<span id="cb99-290"><a href="#cb99-290" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> scales<span class="sc">::</span>percent,</span>
<span id="cb99-291"><a href="#cb99-291" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> rng)</span>
<span id="cb99-292"><a href="#cb99-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-293"><a href="#cb99-293" aria-hidden="true" tabindex="-1"></a>p_future</span>
<span id="cb99-294"><a href="#cb99-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-295"><a href="#cb99-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-296"><a href="#cb99-296" aria-hidden="true" tabindex="-1"></a>p_future <span class="ot">&lt;-</span></span>
<span id="cb99-297"><a href="#cb99-297" aria-hidden="true" tabindex="-1"></a>  p_future  <span class="sc">+</span></span>
<span id="cb99-298"><a href="#cb99-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">75</span>,</span>
<span id="cb99-299"><a href="#cb99-299" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb99-300"><a href="#cb99-300" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">vjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb99-301"><a href="#cb99-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Change in</span><span class="sc">\n</span><span class="st">Safe Winter Chill</span><span class="sc">\n</span><span class="st">since 1975&quot;</span>) <span class="sc">+</span></span>
<span id="cb99-302"><a href="#cb99-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> model_labels) <span class="sc">+</span></span>
<span id="cb99-303"><a href="#cb99-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Chill metric&quot;</span>)</span>
<span id="cb99-304"><a href="#cb99-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-305"><a href="#cb99-305" aria-hidden="true" tabindex="-1"></a>p_future</span>
<span id="cb99-306"><a href="#cb99-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-307"><a href="#cb99-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-308"><a href="#cb99-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-309"><a href="#cb99-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-310"><a href="#cb99-310" aria-hidden="true" tabindex="-1"></a>p_past<span class="ot">&lt;-</span></span>
<span id="cb99-311"><a href="#cb99-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(results[<span class="fu">which</span>(results<span class="sc">$</span>GCM <span class="sc">==</span> <span class="st">&quot;none&quot;</span>),],</span>
<span id="cb99-312"><a href="#cb99-312" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(Year,</span>
<span id="cb99-313"><a href="#cb99-313" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">factor</span>(Metric,</span>
<span id="cb99-314"><a href="#cb99-314" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels=</span>metrics),</span>
<span id="cb99-315"><a href="#cb99-315" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> SWC)) <span class="sc">+</span></span>
<span id="cb99-316"><a href="#cb99-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>()</span>
<span id="cb99-317"><a href="#cb99-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-318"><a href="#cb99-318" aria-hidden="true" tabindex="-1"></a>p_past<span class="ot">&lt;-</span></span>
<span id="cb99-319"><a href="#cb99-319" aria-hidden="true" tabindex="-1"></a>  p_past <span class="sc">+</span></span>
<span id="cb99-320"><a href="#cb99-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb99-321"><a href="#cb99-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))</span>
<span id="cb99-322"><a href="#cb99-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-323"><a href="#cb99-323" aria-hidden="true" tabindex="-1"></a>p_past<span class="ot">&lt;-</span></span>
<span id="cb99-324"><a href="#cb99-324" aria-hidden="true" tabindex="-1"></a>  p_past <span class="sc">+</span></span>
<span id="cb99-325"><a href="#cb99-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">rev</span>(<span class="fu">matlab.like</span>(<span class="dv">15</span>)),</span>
<span id="cb99-326"><a href="#cb99-326" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> scales<span class="sc">::</span>percent,</span>
<span id="cb99-327"><a href="#cb99-327" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> rng)</span>
<span id="cb99-328"><a href="#cb99-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-329"><a href="#cb99-329" aria-hidden="true" tabindex="-1"></a>p_past<span class="ot">&lt;-</span></span>
<span id="cb99-330"><a href="#cb99-330" aria-hidden="true" tabindex="-1"></a>  p_past <span class="sc">+</span></span>
<span id="cb99-331"><a href="#cb99-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb99-332"><a href="#cb99-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-333"><a href="#cb99-333" aria-hidden="true" tabindex="-1"></a>p_past<span class="ot">&lt;-</span></span>
<span id="cb99-334"><a href="#cb99-334" aria-hidden="true" tabindex="-1"></a>  p_past <span class="sc">+</span></span>
<span id="cb99-335"><a href="#cb99-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Change in</span><span class="sc">\n</span><span class="st">Safe Winter Chill</span><span class="sc">\n</span><span class="st">since 1975&quot;</span>) <span class="sc">+</span></span>
<span id="cb99-336"><a href="#cb99-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> model_labels) <span class="sc">+</span></span>
<span id="cb99-337"><a href="#cb99-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Chill metric&quot;</span>)</span>
<span id="cb99-338"><a href="#cb99-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-339"><a href="#cb99-339" aria-hidden="true" tabindex="-1"></a>p_past</span>
<span id="cb99-340"><a href="#cb99-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-341"><a href="#cb99-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-342"><a href="#cb99-342" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb99-343"><a href="#cb99-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-344"><a href="#cb99-344" aria-hidden="true" tabindex="-1"></a>chill_comp_plot<span class="ot">&lt;-</span></span>
<span id="cb99-345"><a href="#cb99-345" aria-hidden="true" tabindex="-1"></a>  (p_past <span class="sc">+</span></span>
<span id="cb99-346"><a href="#cb99-346" aria-hidden="true" tabindex="-1"></a>     p_future <span class="sc">+</span></span>
<span id="cb99-347"><a href="#cb99-347" aria-hidden="true" tabindex="-1"></a>     <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>,</span>
<span id="cb99-348"><a href="#cb99-348" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb99-349"><a href="#cb99-349" aria-hidden="true" tabindex="-1"></a>                 <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))) <span class="sc">&amp;</span></span>
<span id="cb99-350"><a href="#cb99-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb99-351"><a href="#cb99-351" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb99-352"><a href="#cb99-352" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span>
<span id="cb99-353"><a href="#cb99-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-354"><a href="#cb99-354" aria-hidden="true" tabindex="-1"></a>chill_comp_plot</span>
<span id="cb99-355"><a href="#cb99-355" aria-hidden="true" tabindex="-1"></a>hist_results <span class="ot">&lt;-</span> results[<span class="fu">which</span>(results<span class="sc">$</span>GCM <span class="sc">==</span> <span class="st">&quot;none&quot;</span>),]</span>
<span id="cb99-356"><a href="#cb99-356" aria-hidden="true" tabindex="-1"></a>hist_results<span class="sc">$</span>SSP <span class="ot">&lt;-</span> <span class="st">&quot;SSP1&quot;</span></span>
<span id="cb99-357"><a href="#cb99-357" aria-hidden="true" tabindex="-1"></a>hist_results_2 <span class="ot">&lt;-</span> hist_results</span>
<span id="cb99-358"><a href="#cb99-358" aria-hidden="true" tabindex="-1"></a>hist_results_2<span class="sc">$</span>SSP <span class="ot">&lt;-</span> <span class="st">&quot;SSP2&quot;</span></span>
<span id="cb99-359"><a href="#cb99-359" aria-hidden="true" tabindex="-1"></a>hist_results_3 <span class="ot">&lt;-</span> hist_results</span>
<span id="cb99-360"><a href="#cb99-360" aria-hidden="true" tabindex="-1"></a>hist_results_3<span class="sc">$</span>SSP <span class="ot">&lt;-</span> <span class="st">&quot;SSP3&quot;</span></span>
<span id="cb99-361"><a href="#cb99-361" aria-hidden="true" tabindex="-1"></a>hist_results_4 <span class="ot">&lt;-</span> hist_results</span>
<span id="cb99-362"><a href="#cb99-362" aria-hidden="true" tabindex="-1"></a>hist_results_4<span class="sc">$</span>SSP <span class="ot">&lt;-</span> <span class="st">&quot;SSP5&quot;</span></span>
<span id="cb99-363"><a href="#cb99-363" aria-hidden="true" tabindex="-1"></a>hist_results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(hist_results,</span>
<span id="cb99-364"><a href="#cb99-364" aria-hidden="true" tabindex="-1"></a>                      hist_results_2,</span>
<span id="cb99-365"><a href="#cb99-365" aria-hidden="true" tabindex="-1"></a>                      hist_results_3,</span>
<span id="cb99-366"><a href="#cb99-366" aria-hidden="true" tabindex="-1"></a>                      hist_results_4)</span>
<span id="cb99-367"><a href="#cb99-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-368"><a href="#cb99-368" aria-hidden="true" tabindex="-1"></a>future_results <span class="ot">&lt;-</span> results[<span class="fu">which</span>(<span class="sc">!</span>results<span class="sc">$</span>GCM <span class="sc">==</span> <span class="st">&quot;none&quot;</span>),]</span>
<span id="cb99-369"><a href="#cb99-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-370"><a href="#cb99-370" aria-hidden="true" tabindex="-1"></a>GCM_aggregate <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(</span>
<span id="cb99-371"><a href="#cb99-371" aria-hidden="true" tabindex="-1"></a>  future_results<span class="sc">$</span>SWC,</span>
<span id="cb99-372"><a href="#cb99-372" aria-hidden="true" tabindex="-1"></a>  <span class="at">by=</span><span class="fu">list</span>(future_results<span class="sc">$</span>Metric,</span>
<span id="cb99-373"><a href="#cb99-373" aria-hidden="true" tabindex="-1"></a>          future_results<span class="sc">$</span>SSP,</span>
<span id="cb99-374"><a href="#cb99-374" aria-hidden="true" tabindex="-1"></a>          future_results<span class="sc">$</span>Year),</span>
<span id="cb99-375"><a href="#cb99-375" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN=</span>mean)</span>
<span id="cb99-376"><a href="#cb99-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-377"><a href="#cb99-377" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(GCM_aggregate) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Metric&quot;</span>,</span>
<span id="cb99-378"><a href="#cb99-378" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;SSP&quot;</span>,</span>
<span id="cb99-379"><a href="#cb99-379" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb99-380"><a href="#cb99-380" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;SWC&quot;</span>)</span>
<span id="cb99-381"><a href="#cb99-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-382"><a href="#cb99-382" aria-hidden="true" tabindex="-1"></a>SSP_Time_series<span class="ot">&lt;-</span><span class="fu">rbind</span>(hist_results[,<span class="fu">c</span>(<span class="st">&quot;Metric&quot;</span>,</span>
<span id="cb99-383"><a href="#cb99-383" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">&quot;SSP&quot;</span>,</span>
<span id="cb99-384"><a href="#cb99-384" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb99-385"><a href="#cb99-385" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">&quot;SWC&quot;</span>)],</span>
<span id="cb99-386"><a href="#cb99-386" aria-hidden="true" tabindex="-1"></a>                       GCM_aggregate)</span>
<span id="cb99-387"><a href="#cb99-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-388"><a href="#cb99-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-389"><a href="#cb99-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-390"><a href="#cb99-390" aria-hidden="true" tabindex="-1"></a>SSP_Time_series<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(SSP_Time_series<span class="sc">$</span>Year)</span>
<span id="cb99-391"><a href="#cb99-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-392"><a href="#cb99-392" aria-hidden="true" tabindex="-1"></a>chill_change_plot<span class="ot">&lt;-</span></span>
<span id="cb99-393"><a href="#cb99-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> SSP_Time_series,</span>
<span id="cb99-394"><a href="#cb99-394" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> Year,</span>
<span id="cb99-395"><a href="#cb99-395" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> SWC,</span>
<span id="cb99-396"><a href="#cb99-396" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="fu">factor</span>(Metric,</span>
<span id="cb99-397"><a href="#cb99-397" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> metrics))) <span class="sc">+</span></span>
<span id="cb99-398"><a href="#cb99-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb99-399"><a href="#cb99-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>SSP,</span>
<span id="cb99-400"><a href="#cb99-400" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb99-401"><a href="#cb99-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb99-402"><a href="#cb99-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="st">&quot;Change in</span><span class="sc">\n</span><span class="st">Safe Winter Chill</span><span class="sc">\n</span><span class="st">since 1980&quot;</span>) <span class="sc">+</span></span>
<span id="cb99-403"><a href="#cb99-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">labels =</span> model_labels) <span class="sc">+</span></span>
<span id="cb99-404"><a href="#cb99-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb99-405"><a href="#cb99-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb99-406"><a href="#cb99-406" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) <span class="sc">+</span></span>
<span id="cb99-407"><a href="#cb99-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Safe Winter Chill&quot;</span>)</span>
<span id="cb99-408"><a href="#cb99-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-409"><a href="#cb99-409" aria-hidden="true" tabindex="-1"></a>chill_change_plot</span>
<span id="cb99-410"><a href="#cb99-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-411"><a href="#cb99-411" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb99-412"><a href="#cb99-412" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gifski)</span>
<span id="cb99-413"><a href="#cb99-413" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(png)</span>
<span id="cb99-414"><a href="#cb99-414" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(transformr)</span>
<span id="cb99-415"><a href="#cb99-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-416"><a href="#cb99-416" aria-hidden="true" tabindex="-1"></a>ccp<span class="ot">&lt;-</span>chill_change_plot <span class="sc">+</span></span>
<span id="cb99-417"><a href="#cb99-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_reveal</span>(Year)</span>
<span id="cb99-418"><a href="#cb99-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-419"><a href="#cb99-419" aria-hidden="true" tabindex="-1"></a><span class="co"># trying out different numbers of frames per second</span></span>
<span id="cb99-420"><a href="#cb99-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-421"><a href="#cb99-421" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(ccp, <span class="at">fps=</span><span class="dv">1</span>)</span>
<span id="cb99-422"><a href="#cb99-422" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/chill_comparison_animation_1.gif&quot;</span>,</span>
<span id="cb99-423"><a href="#cb99-423" aria-hidden="true" tabindex="-1"></a>          <span class="at">animation =</span> <span class="fu">last_animation</span>())</span>
<span id="cb99-424"><a href="#cb99-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-425"><a href="#cb99-425" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(ccp, <span class="at">fps=</span><span class="dv">100</span>)</span>
<span id="cb99-426"><a href="#cb99-426" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/chill_comparison_animation_100.gif&quot;</span>,</span>
<span id="cb99-427"><a href="#cb99-427" aria-hidden="true" tabindex="-1"></a>          <span class="at">animation =</span> <span class="fu">last_animation</span>())</span></code></pre></div>
</details>
</div>
<hr />
</section>
</section>
<section id="chapter-20-simple-phenology-analysis" class="level1">
<h1>Chapter 20: Simple Phenology Analysis</h1>
<section id="exercises-on-simple-phenology-analysis" class="level2">
<h2><strong><em>Exercises on simple phenology analysis</em></strong></h2>
<ol type="1">
<li>Provide a brief narrative describing what p-hacking is, and why this is a problematic approach to data analysis.</li>
</ol>
<p>P-hacking, (data fishing), is the manipulation of data analysis to obtain statistically significant results, often by repeatedly testing different hypotheses, adjusting variables, or selectively reporting findings until a desired p-value (typically &lt; 0.05) is achieved.</p>
<p>This is problematic because it increases the likelihood of false positivesâresults that appear significant but are actually due to chance and it causes over-fitting during data analysis.</p>
<ol start="2" type="1">
<li>Provide a sketch of your causal understanding of the relationship between temperature and bloom dates.</li>
</ol>
<p>Temperature - Time Climate change has caused: - Warmer winter = delay in bloom dates - Rising spring temperature = advanced bloom dates</p>
<p>Temperatures have been rising over time and phenology has advanced over time so later years generally feature earlier bloom dates.</p>
<ol start="3" type="1">
<li>What do we need to know to build a process-based model from this?</li>
</ol>
<p>Regression equation isnât very useful for this process.</p>
<hr />
</section>
</section>
<section id="chapter-21-delineating-temperature-response-phases-with-pls-regression" class="level1">
<h1>Chapter 21: Delineating temperature response phases with PLS regression</h1>
<section id="exercises-on-chill-model-comparison-1" class="level2">
<h2><strong><em>Exercises on chill model comparison</em></strong></h2>
<ol type="1">
<li>Briefly explain why you shouldnât take the results of a PLS regression analysis between temperature and phenology at face value.</li>
</ol>
<p>PLS should not be used as a data mining tool but in conjuction with a theory on how the system works to detect meaningful pattterns.</p>
<ol start="2" type="1">
<li>What do you need in addition in order to make sense of such outputs? Replicate the PLS analysis for the Roter Boskoop dataset that you used in a previous lesson.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb100"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>Roter_first <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Roter_Boskoop_bloom_1958_2019.csv.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, First_bloom) <span class="sc">%&gt;%</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">1</span>, <span class="dv">4</span>)),</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">5</span>, <span class="dv">6</span>)),</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">7</span>, <span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_JDay</span>() <span class="sc">%&gt;%</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, JDay) <span class="sc">%&gt;%</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Year =</span> Pheno_year,</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">pheno =</span> JDay)</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Roter_first)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Year pheno
1 1958   129
2 1959   104
3 1960   115
4 1961    99
5 1962   134
6 1963   127</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb102"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>KA_temps <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/TMaxTMin1958-2019_patched.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_JDay</span>()</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(KA_temps)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      DATE YEARMODA Year Month Day Tmin Tmax Tmin_source Tmax_source no_Tmin
1 01-01-58 19580101 1958     1   1  5.0 7.50        &lt;NA&gt;        &lt;NA&gt;   FALSE
2 02-01-58 19580102 1958     1   2  1.5 9.00        &lt;NA&gt;        &lt;NA&gt;   FALSE
3 03-01-58 19580103 1958     1   3 -5.5 1.10        &lt;NA&gt;        &lt;NA&gt;   FALSE
4 04-01-58 19580104 1958     1   4 -5.5 0.50        &lt;NA&gt;        &lt;NA&gt;   FALSE
5 05-01-58 19580105 1958     1   5  3.5 2.75        &lt;NA&gt;        &lt;NA&gt;   FALSE
6 06-01-58 19580106 1958     1   6  3.0 5.00        &lt;NA&gt;        &lt;NA&gt;   FALSE
  no_Tmax JDay
1   FALSE    1
2   FALSE    2
3   FALSE    3
4   FALSE    4
5    TRUE    5
6   FALSE    6</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb104"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>PLS_results <span class="ot">&lt;-</span> <span class="fu">PLS_pheno</span>(KA_temps,</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>                         Roter_first)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(PLS_results<span class="sc">$</span>PLS_summary)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Date JDay          Coef       VIP    Tmean   Tstdev
1  801 -152 -0.0550839319 0.4813947 18.32970 1.914004
2  802 -151 -0.0280285625 0.4583224 18.30846 1.884389
3  803 -150  0.0034427515 0.4856287 18.27148 1.844368
4  804 -149  0.0267715221 0.4904789 18.23742 1.886276
5  805 -148  0.0250187439 0.4832248 18.19609 1.884567
6  806 -147 -0.0003849407 0.5708911 18.17148 1.855337</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb106"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS</span>(PLS_results,</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">PLS_results_path =</span> <span class="st">&quot;PLS_out&quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dir.create(PLS_results_path): &#39;PLS_out&#39; already exists</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb108"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>PLS_gg <span class="ot">&lt;-</span> PLS_results<span class="sc">$</span>PLS_summary <span class="sc">%&gt;%</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">trunc</span>(Date <span class="sc">/</span> <span class="dv">100</span>),</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> Date <span class="sc">-</span> Month <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Date =</span> <span class="cn">NULL</span>) </span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>PLS_gg<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2002</span>, </span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>                       PLS_gg<span class="sc">$</span>Month, </span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>                       PLS_gg<span class="sc">$</span>Day)</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>PLS_gg<span class="sc">$</span>Date[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ISOdate</span>(<span class="dv">2001</span>, </span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>          PLS_gg<span class="sc">$</span>Month[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>], </span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>          PLS_gg<span class="sc">$</span>Day[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>])</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>PLS_gg <span class="ot">&lt;-</span> PLS_gg <span class="sc">%&gt;%</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VIP_importance =</span> VIP <span class="sc">&gt;=</span> <span class="fl">0.8</span>,</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">VIP_Coeff =</span> <span class="fu">factor</span>(<span class="fu">sign</span>(Coef) <span class="sc">*</span> VIP_importance))</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>VIP_plot<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> VIP)) <span class="sc">+</span></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&#39;identity&#39;</span>,</span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">fill =</span> VIP_importance))</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>VIP_plot <span class="ot">&lt;-</span> VIP_plot <span class="sc">+</span></span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">&quot;VIP&quot;</span>, </span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;0.8&quot;</span>,</span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;&gt;0.8&quot;</span>), </span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;FALSE&quot;</span><span class="ot">=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;TRUE&quot;</span><span class="ot">=</span><span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>() )</span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a>VIP_plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb109"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>coeff_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> Coef)) <span class="sc">+</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span><span class="st">&#39;identity&#39;</span>,</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">fill =</span> VIP_Coeff)) <span class="sc">+</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Effect direction&quot;</span>, </span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Advancing&quot;</span>,</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Unimportant&quot;</span>,</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Delaying&quot;</span>), </span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;-1&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;dark green&quot;</span>)) <span class="sc">+</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;PLS coefficient&quot;</span>) <span class="sc">+</span></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>() )</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>coeff_plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-50-2.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb110"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>temp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg) <span class="sc">+</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Tmean <span class="sc">-</span> Tstdev,</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Tmean <span class="sc">+</span> Tstdev),</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Tmean <span class="sc">-</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Tmean <span class="sc">+</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Tmean <span class="sc">-</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Tmean <span class="sc">+</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>)),</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;dark green&quot;</span>) <span class="sc">+</span></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> Tmean)) <span class="sc">+</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(T[mean],<span class="st">&quot; (Â°C)&quot;</span>)))</span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>temp_plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-50-3.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb111"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>plot<span class="ot">&lt;-</span> (VIP_plot <span class="sc">+</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>          coeff_plot <span class="sc">+</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>          temp_plot <span class="sc">+</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>)</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-50-4.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb112"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>ggplot_PLS <span class="ot">&lt;-</span> <span class="cf">function</span>(PLS_results)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  PLS_gg <span class="ot">&lt;-</span> PLS_results<span class="sc">$</span>PLS_summary <span class="sc">%&gt;%</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">trunc</span>(Date <span class="sc">/</span> <span class="dv">100</span>),</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">Day =</span> Date <span class="sc">-</span> Month <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">Date =</span> <span class="cn">NULL</span>) </span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  PLS_gg<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2002</span>, </span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>                         PLS_gg<span class="sc">$</span>Month, </span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>                         PLS_gg<span class="sc">$</span>Day)</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>  PLS_gg<span class="sc">$</span>Date[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span></span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ISOdate</span>(<span class="dv">2001</span>, </span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>            PLS_gg<span class="sc">$</span>Month[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>], </span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>            PLS_gg<span class="sc">$</span>Day[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>])</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>  PLS_gg <span class="ot">&lt;-</span> PLS_gg <span class="sc">%&gt;%</span></span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">VIP_importance =</span> VIP <span class="sc">&gt;=</span> <span class="fl">0.8</span>,</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">VIP_Coeff =</span> <span class="fu">factor</span>(<span class="fu">sign</span>(Coef) <span class="sc">*</span> VIP_importance))</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>  VIP_plot<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,<span class="fu">aes</span>(<span class="at">x=</span>Date,<span class="at">y=</span>VIP)) <span class="sc">+</span></span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&#39;identity&#39;</span>,<span class="fu">aes</span>(<span class="at">fill=</span>VIP<span class="sc">&gt;</span><span class="fl">0.8</span>))</span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>  VIP_plot <span class="ot">&lt;-</span> VIP_plot <span class="sc">+</span></span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">&quot;VIP&quot;</span>, </span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;0.8&quot;</span>, <span class="st">&quot;&gt;0.8&quot;</span>), </span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;FALSE&quot;</span><span class="ot">=</span><span class="st">&quot;grey&quot;</span>, <span class="st">&quot;TRUE&quot;</span><span class="ot">=</span><span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb112-33"><a href="#cb112-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-34"><a href="#cb112-34" aria-hidden="true" tabindex="-1"></a>  coeff_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb112-35"><a href="#cb112-35" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb112-36"><a href="#cb112-36" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y =</span> Coef)) <span class="sc">+</span></span>
<span id="cb112-37"><a href="#cb112-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span><span class="st">&#39;identity&#39;</span>,</span>
<span id="cb112-38"><a href="#cb112-38" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> VIP_Coeff)) <span class="sc">+</span></span>
<span id="cb112-39"><a href="#cb112-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Effect direction&quot;</span>, </span>
<span id="cb112-40"><a href="#cb112-40" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Advancing&quot;</span>,</span>
<span id="cb112-41"><a href="#cb112-41" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Unimportant&quot;</span>,</span>
<span id="cb112-42"><a href="#cb112-42" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Delaying&quot;</span>), </span>
<span id="cb112-43"><a href="#cb112-43" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;-1&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb112-44"><a href="#cb112-44" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb112-45"><a href="#cb112-45" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;dark green&quot;</span>)) <span class="sc">+</span></span>
<span id="cb112-46"><a href="#cb112-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb112-47"><a href="#cb112-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;PLS coefficient&quot;</span>) <span class="sc">+</span></span>
<span id="cb112-48"><a href="#cb112-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb112-49"><a href="#cb112-49" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb112-50"><a href="#cb112-50" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb112-51"><a href="#cb112-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-52"><a href="#cb112-52" aria-hidden="true" tabindex="-1"></a>  temp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg) <span class="sc">+</span></span>
<span id="cb112-53"><a href="#cb112-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb112-54"><a href="#cb112-54" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> Tmean <span class="sc">-</span> Tstdev,</span>
<span id="cb112-55"><a href="#cb112-55" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> Tmean <span class="sc">+</span> Tstdev),</span>
<span id="cb112-56"><a href="#cb112-56" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb112-57"><a href="#cb112-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb112-58"><a href="#cb112-58" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> Tmean <span class="sc">-</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb112-59"><a href="#cb112-59" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> Tmean <span class="sc">+</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb112-60"><a href="#cb112-60" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb112-61"><a href="#cb112-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb112-62"><a href="#cb112-62" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> Tmean <span class="sc">-</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb112-63"><a href="#cb112-63" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> Tmean <span class="sc">+</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>)),</span>
<span id="cb112-64"><a href="#cb112-64" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;dark green&quot;</span>) <span class="sc">+</span></span>
<span id="cb112-65"><a href="#cb112-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb112-66"><a href="#cb112-66" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> Tmean)) <span class="sc">+</span></span>
<span id="cb112-67"><a href="#cb112-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb112-68"><a href="#cb112-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(T[mean],<span class="st">&quot; (Â°C)&quot;</span>)))</span>
<span id="cb112-69"><a href="#cb112-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-70"><a href="#cb112-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(patchwork)</span>
<span id="cb112-71"><a href="#cb112-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-72"><a href="#cb112-72" aria-hidden="true" tabindex="-1"></a>  plot<span class="ot">&lt;-</span> (VIP_plot <span class="sc">+</span></span>
<span id="cb112-73"><a href="#cb112-73" aria-hidden="true" tabindex="-1"></a>            coeff_plot <span class="sc">+</span></span>
<span id="cb112-74"><a href="#cb112-74" aria-hidden="true" tabindex="-1"></a>            temp_plot <span class="sc">+</span></span>
<span id="cb112-75"><a href="#cb112-75" aria-hidden="true" tabindex="-1"></a>            <span class="fu">plot_layout</span>(<span class="at">ncol=</span><span class="dv">1</span>,</span>
<span id="cb112-76"><a href="#cb112-76" aria-hidden="true" tabindex="-1"></a>                        <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>)</span>
<span id="cb112-77"><a href="#cb112-77" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb112-78"><a href="#cb112-78" aria-hidden="true" tabindex="-1"></a>                    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb112-79"><a href="#cb112-79" aria-hidden="true" tabindex="-1"></a>                    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb112-80"><a href="#cb112-80" aria-hidden="true" tabindex="-1"></a>                    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb112-81"><a href="#cb112-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-82"><a href="#cb112-82" aria-hidden="true" tabindex="-1"></a>  plot}</span>
<span id="cb112-83"><a href="#cb112-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-84"><a href="#cb112-84" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_PLS</span>(PLS_results)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-50-5.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Write down your thoughts on why weâre not seeing the temperature response pattern we may have expected. What happened to the chill response?</li>
</ol>
</section>
<section id="pls-responded-to-temperatures-indicating-greater-heat-accumulation-which-shows-early-bloom-however-this-is-absent-for-chill-accumulation-because-they-are-not-monotonically-related." class="level2">
<h2>PLS responded to temperatures indicating greater heat accumulation which shows early bloom however this is absent for chill accumulation because they are not monotonically related.</h2>
</section>
</section>
<section id="chapter-22-successes-and-limitations-of-pls-regression-analysis" class="level1">
<h1>Chapter 22: Successes and limitations of PLS regression analysis</h1>
<section id="exercises-on-chill-model-comparison-2" class="level2">
<h2><strong><em>Exercises on chill model comparison</em></strong></h2>
<ol type="1">
<li>Briefly explain in what climatic settings we can expect PLS regression to detect the chilling phase - and in what settings this probably wonât work.</li>
</ol>
<p>In locations such as Davis in California, warm temperatures in winter reduces chill accumulation. While in other locations such as Klein-Altendorf and Beijing, when relatively cold, warming may increase the chill.When temperatures are relatively high, chill accumulation would be reduced by warming. At these two locations, there is no monotonic relationship between temperature and chill accumulation. Therefore, PLS would not produce clear results.</p>
<ol start="2" type="1">
<li>How could we overcome this problem?</li>
</ol>
<p>PLS regression failed to pick up the chilling period in relatively cold locations is that there is no monotonic relationship between temperature and chill effectiveness.</p>
<p>To overcome this problem, we need to convert temperature into something that is monotonically related to chill accumulation. Maybe we can make use of the chill models we already learned about</p>
<hr />
</section>
</section>
<section id="chapter-23-pls-regression-with-agroclimatic-metrics" class="level1">
<h1>Chapter 23: PLS regression with agroclimatic metrics</h1>
<section id="exercises-on-chill-model-comparison-3" class="level2">
<h2><strong><em>Exercises on Chill model comparison</em></strong></h2>
<ol type="1">
<li>Repeat the PLS_chill_force procedure for the âRoter Boskoopâ dataset. Include plots of daily chill and heat accumulation.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb113"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>temps_hourly <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/TMaxTMin1958-2019_patched.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack_hourly_temps</span>(<span class="at">latitude =</span> <span class="fl">43.1</span>)</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temps_hourly<span class="sc">$</span>hourtemps)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           DATE YEARMODA Year Month Day Tmin Tmax Tmin_source Tmax_source
1      01-01-58 19580101 1958     1   1    5  7.5        &lt;NA&gt;        &lt;NA&gt;
22452  01-01-58 19580101 1958     1   1    5  7.5        &lt;NA&gt;        &lt;NA&gt;
44903  01-01-58 19580101 1958     1   1    5  7.5        &lt;NA&gt;        &lt;NA&gt;
67354  01-01-58 19580101 1958     1   1    5  7.5        &lt;NA&gt;        &lt;NA&gt;
89805  01-01-58 19580101 1958     1   1    5  7.5        &lt;NA&gt;        &lt;NA&gt;
112256 01-01-58 19580101 1958     1   1    5  7.5        &lt;NA&gt;        &lt;NA&gt;
       no_Tmin no_Tmax JDay Hour Temp
1        FALSE   FALSE    1    0    5
22452    FALSE   FALSE    1    1    5
44903    FALSE   FALSE    1    2    5
67354    FALSE   FALSE    1    3    5
89805    FALSE   FALSE    1    4    5
112256   FALSE   FALSE    1    5    5</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb115"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>daychill <span class="ot">&lt;-</span> <span class="fu">daily_chill</span>(<span class="at">hourtemps =</span> temps_hourly,</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">running_mean =</span> <span class="dv">1</span>,</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">models =</span> <span class="fu">list</span>(</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Chilling_Hours =</span> Chilling_Hours,</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Utah_Chill_Units =</span> Utah_Model,</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Chill_Portions =</span> Dynamic_Model,</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">GDH =</span> GDH)</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(daychill<span class="sc">$</span>daily_chill)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    YYMMDD Year Month Day Chilling_Hours Utah_Chill_Units Chill_Portions
1 19580101 1958     1   1             19             24.0    0.000000000
2 19580102 1958     1   2             16             16.5    1.125678495
3 19580103 1958     1   3              5              0.0    0.003207597
4 19580104 1958     1   4              9              2.0    0.208134160
5 19580105 1958     1   5             24             24.0    1.266485806
6 19580106 1958     1   6             24             21.5    0.738858345
         GDH     Tmean no_Tmin no_Tmax
1 10.5101397  5.474222   FALSE   FALSE
2 13.7707171  3.596476   FALSE   FALSE
3  0.0000000 -2.518361   FALSE   FALSE
4  0.0000000 -1.683636   FALSE   FALSE
5  0.0000000  3.012222   FALSE    TRUE
6  0.4997425  3.352441   FALSE   FALSE</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb117"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>dc <span class="ot">&lt;-</span> <span class="fu">make_daily_chill_plot2</span>(daychill,</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">metrics =</span> <span class="fu">c</span>(<span class="st">&quot;Chill_Portions&quot;</span>),</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">cumulative =</span> <span class="cn">FALSE</span>,</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">startdate =</span> <span class="dv">300</span>,</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">enddate =</span> <span class="dv">30</span>,</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">focusyears =</span> <span class="fu">c</span>(<span class="dv">2008</span>,<span class="dv">2018</span>), </span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">metriclabels =</span> <span class="st">&quot;Chill Portions&quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb118"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>dc <span class="ot">&lt;-</span> <span class="fu">make_daily_chill_plot2</span>(daychill,</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">metrics =</span> <span class="fu">c</span>(<span class="st">&quot;Chill_Portions&quot;</span>),</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">cumulative =</span> <span class="cn">TRUE</span>,</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">startdate =</span> <span class="dv">300</span>,</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">enddate =</span> <span class="dv">30</span>,</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">focusyears =</span> <span class="fu">c</span>(<span class="dv">2008</span>),</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">metriclabels =</span> <span class="st">&quot;Chill Portions&quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-51-2.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb119"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>Roter_Boskoop <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Roter_Boskoop_bloom_1958_2019.csv.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, First_bloom) <span class="sc">%&gt;%</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">1</span>, <span class="dv">4</span>)),</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">5</span>, <span class="dv">6</span>)),</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">7</span>, <span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_JDay</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, </span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>         JDay) <span class="sc">%&gt;%</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Year =</span> Pheno_year,</span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">pheno =</span> JDay) </span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>plscf <span class="ot">&lt;-</span> <span class="fu">PLS_chill_force</span>(<span class="at">daily_chill_obj =</span> daychill,</span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bio_data_frame =</span> Roter_Boskoop,</span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">split_month =</span> <span class="dv">6</span>,</span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">chill_models =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">heat_models =</span> <span class="st">&quot;GDH&quot;</span>)</span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(plscf<span class="sc">$</span>Chill_Portions<span class="sc">$</span>GDH<span class="sc">$</span>PLS_summary)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Date  Type JDay        Coef       VIP MetricMean MetricStdev
1  701 Chill -183  0.14696728 1.2458136 0.08337297   0.2788507
2  702 Chill -182 -0.01406667 0.2856791 0.05012075   0.2203154
3  703 Chill -181  0.00945019 0.5483639 0.06722064   0.2536409
4  704 Chill -180 -0.10797135 0.5973938 0.06712402   0.2532811
5  705 Chill -179  0.22044678 1.9679578 0.06603972   0.2492901
6  706 Chill -178 -0.02465086 0.1964161 0.01679378   0.1300841</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Run PLS_chill_force analyses for all three major chill models. Delineate your best estimates of chilling and forcing phases for all of them.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb121"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS</span>(plscf,</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">PLS_results_path =</span> <span class="st">&quot;data_New_York/plscf_outputs_NY&quot;</span>)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>plscf <span class="ot">&lt;-</span> <span class="fu">PLS_chill_force</span>(<span class="at">daily_chill_obj =</span> daychill,</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bio_data_frame =</span> Roter_Boskoop,</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">split_month =</span> <span class="dv">6</span>,</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">chill_models =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">heat_models =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">runn_means =</span> <span class="dv">11</span>)</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS</span>(plscf,</span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">PLS_results_path =</span> <span class="st">&quot;data_New_York/plscf_outputs_NY_11days&quot;</span>)</span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS</span>(plscf,</span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">PLS_results_path =</span> <span class="st">&quot;data_New_York/plscf_outputs_NY_11days_periods&quot;</span>,</span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">add_chill =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>,<span class="dv">62</span>),</span>
<span id="cb121-22"><a href="#cb121-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">add_heat =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="fl">105.5</span>))</span>
<span id="cb121-23"><a href="#cb121-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-24"><a href="#cb121-24" aria-hidden="true" tabindex="-1"></a>PLS_gg <span class="ot">&lt;-</span> plscf<span class="sc">$</span>Chill_Portions<span class="sc">$</span>GDH<span class="sc">$</span>PLS_summary <span class="sc">%&gt;%</span></span>
<span id="cb121-25"><a href="#cb121-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">trunc</span>(Date<span class="sc">/</span><span class="dv">100</span>),</span>
<span id="cb121-26"><a href="#cb121-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> Date <span class="sc">-</span> Month <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb121-27"><a href="#cb121-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">Date =</span> <span class="fu">ISOdate</span>(<span class="dv">2002</span>,</span>
<span id="cb121-28"><a href="#cb121-28" aria-hidden="true" tabindex="-1"></a>                        Month,</span>
<span id="cb121-29"><a href="#cb121-29" aria-hidden="true" tabindex="-1"></a>                        Day))</span>
<span id="cb121-30"><a href="#cb121-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-31"><a href="#cb121-31" aria-hidden="true" tabindex="-1"></a>PLS_gg[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>,<span class="st">&quot;Date&quot;</span>]<span class="ot">&lt;-</span></span>
<span id="cb121-32"><a href="#cb121-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb121-33"><a href="#cb121-33" aria-hidden="true" tabindex="-1"></a>          PLS_gg<span class="sc">$</span>Month[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>],</span>
<span id="cb121-34"><a href="#cb121-34" aria-hidden="true" tabindex="-1"></a>          PLS_gg<span class="sc">$</span>Day[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>])</span>
<span id="cb121-35"><a href="#cb121-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-36"><a href="#cb121-36" aria-hidden="true" tabindex="-1"></a>PLS_gg <span class="ot">&lt;-</span> PLS_gg <span class="sc">%&gt;%</span></span>
<span id="cb121-37"><a href="#cb121-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VIP_importance =</span> VIP <span class="sc">&gt;=</span> <span class="fl">0.8</span>,</span>
<span id="cb121-38"><a href="#cb121-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">VIP_Coeff =</span> <span class="fu">factor</span>(<span class="fu">sign</span>(Coef) <span class="sc">*</span> VIP_importance))</span>
<span id="cb121-39"><a href="#cb121-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-40"><a href="#cb121-40" aria-hidden="true" tabindex="-1"></a>chill_start_JDay <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">48</span></span>
<span id="cb121-41"><a href="#cb121-41" aria-hidden="true" tabindex="-1"></a>chill_end_JDay <span class="ot">&lt;-</span> <span class="dv">62</span></span>
<span id="cb121-42"><a href="#cb121-42" aria-hidden="true" tabindex="-1"></a>heat_start_JDay <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">5</span></span>
<span id="cb121-43"><a href="#cb121-43" aria-hidden="true" tabindex="-1"></a>heat_end_JDay <span class="ot">&lt;-</span> <span class="fl">105.5</span></span>
<span id="cb121-44"><a href="#cb121-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-45"><a href="#cb121-45" aria-hidden="true" tabindex="-1"></a>chill_start_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb121-46"><a href="#cb121-46" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb121-47"><a href="#cb121-47" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> chill_start_JDay <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb121-48"><a href="#cb121-48" aria-hidden="true" tabindex="-1"></a>chill_end_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb121-49"><a href="#cb121-49" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb121-50"><a href="#cb121-50" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span> chill_end_JDay <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb121-51"><a href="#cb121-51" aria-hidden="true" tabindex="-1"></a>heat_start_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb121-52"><a href="#cb121-52" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">12</span>,</span>
<span id="cb121-53"><a href="#cb121-53" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">31</span>) <span class="sc">+</span> heat_start_JDay <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb121-54"><a href="#cb121-54" aria-hidden="true" tabindex="-1"></a>heat_end_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb121-55"><a href="#cb121-55" aria-hidden="true" tabindex="-1"></a>                         <span class="dv">12</span>,</span>
<span id="cb121-56"><a href="#cb121-56" aria-hidden="true" tabindex="-1"></a>                         <span class="dv">31</span>) <span class="sc">+</span> heat_end_JDay <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb121-57"><a href="#cb121-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-58"><a href="#cb121-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb121-59"><a href="#cb121-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-60"><a href="#cb121-60" aria-hidden="true" tabindex="-1"></a>temp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb121-61"><a href="#cb121-61" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> Date) <span class="sc">+</span></span>
<span id="cb121-62"><a href="#cb121-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb121-63"><a href="#cb121-63" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb121-64"><a href="#cb121-64" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb121-65"><a href="#cb121-65" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb121-66"><a href="#cb121-66" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb121-67"><a href="#cb121-67" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb121-68"><a href="#cb121-68" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb121-69"><a href="#cb121-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb121-70"><a href="#cb121-70" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb121-71"><a href="#cb121-71" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb121-72"><a href="#cb121-72" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb121-73"><a href="#cb121-73" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb121-74"><a href="#cb121-74" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb121-75"><a href="#cb121-75" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb121-76"><a href="#cb121-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb121-77"><a href="#cb121-77" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb121-78"><a href="#cb121-78" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb121-79"><a href="#cb121-79" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb121-80"><a href="#cb121-80" aria-hidden="true" tabindex="-1"></a>             <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb121-81"><a href="#cb121-81" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb121-82"><a href="#cb121-82" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb121-83"><a href="#cb121-83" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb121-84"><a href="#cb121-84" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb121-85"><a href="#cb121-85" aria-hidden="true" tabindex="-1"></a>             <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb121-86"><a href="#cb121-86" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb121-87"><a href="#cb121-87" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb121-88"><a href="#cb121-88" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb121-89"><a href="#cb121-89" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb121-90"><a href="#cb121-90" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb121-91"><a href="#cb121-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb121-92"><a href="#cb121-92" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">12</span>,</span>
<span id="cb121-93"><a href="#cb121-93" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb121-94"><a href="#cb121-94" aria-hidden="true" tabindex="-1"></a>               <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb121-95"><a href="#cb121-95" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb121-96"><a href="#cb121-96" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb121-97"><a href="#cb121-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb121-98"><a href="#cb121-98" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev ,</span>
<span id="cb121-99"><a href="#cb121-99" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev),</span>
<span id="cb121-100"><a href="#cb121-100" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb121-101"><a href="#cb121-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb121-102"><a href="#cb121-102" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb121-103"><a href="#cb121-103" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb121-104"><a href="#cb121-104" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb121-105"><a href="#cb121-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb121-106"><a href="#cb121-106" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb121-107"><a href="#cb121-107" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>)),</span>
<span id="cb121-108"><a href="#cb121-108" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;dark green&quot;</span>) <span class="sc">+</span></span>
<span id="cb121-109"><a href="#cb121-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb121-110"><a href="#cb121-110" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> MetricMean ))</span>
<span id="cb121-111"><a href="#cb121-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-112"><a href="#cb121-112" aria-hidden="true" tabindex="-1"></a>temp_plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb122"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>temp_plot <span class="ot">&lt;-</span> temp_plot <span class="sc">+</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type),</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>,</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>               <span class="fu">labeller</span>(<span class="at">Type =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>               <span class="fu">c</span>(<span class="at">Chill =</span> <span class="st">&quot;Chill (CP)&quot;</span>,</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Heat =</span> <span class="st">&quot;Heat (GDH)&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Daily chill and heat accumulation rates&quot;</span>) <span class="sc">+</span></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span><span class="dv">12</span>),</span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a>temp_plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-52-2.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb123"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>VIP_plot<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> VIP)) <span class="sc">+</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a>             <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a>             <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb123-29"><a href="#cb123-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb123-30"><a href="#cb123-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb123-31"><a href="#cb123-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb123-32"><a href="#cb123-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-33"><a href="#cb123-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb123-34"><a href="#cb123-34" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">12</span>,</span>
<span id="cb123-35"><a href="#cb123-35" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb123-36"><a href="#cb123-36" aria-hidden="true" tabindex="-1"></a>               <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb123-37"><a href="#cb123-37" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb123-38"><a href="#cb123-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-39"><a href="#cb123-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb123-40"><a href="#cb123-40" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">fill =</span> VIP <span class="sc">&gt;</span> <span class="fl">0.8</span>))</span>
<span id="cb123-41"><a href="#cb123-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-42"><a href="#cb123-42" aria-hidden="true" tabindex="-1"></a>VIP_plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-52-3.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb124"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>VIP_plot <span class="ot">&lt;-</span> VIP_plot <span class="sc">+</span> </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type),</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> </span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>               <span class="fu">labeller</span>(<span class="at">Type =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(<span class="at">Chill =</span> <span class="st">&quot;VIP for chill&quot;</span>,</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Heat =</span> <span class="st">&quot;VIP for heat&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(plscf<span class="sc">$</span>Chill_Portions<span class="sc">$</span>GDH<span class="sc">$</span>PLS_summary<span class="sc">$</span>VIP))) <span class="sc">+</span></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Variable Importance in the Projection (VIP) scores&quot;</span>) <span class="sc">+</span></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb124-18"><a href="#cb124-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb124-19"><a href="#cb124-19" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb124-20"><a href="#cb124-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb124-21"><a href="#cb124-21" aria-hidden="true" tabindex="-1"></a>VIP_plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-52-4.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb125"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>VIP_plot <span class="ot">&lt;-</span> VIP_plot <span class="sc">+</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;VIP&quot;</span>, </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;0.8&quot;</span>, <span class="st">&quot;&gt;0.8&quot;</span>), </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;FALSE&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;TRUE&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>VIP_plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-52-5.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb126"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>coeff_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> Coef)) <span class="sc">+</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb126-20"><a href="#cb126-20" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb126-21"><a href="#cb126-21" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb126-22"><a href="#cb126-22" aria-hidden="true" tabindex="-1"></a>             <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb126-23"><a href="#cb126-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb126-24"><a href="#cb126-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb126-25"><a href="#cb126-25" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb126-26"><a href="#cb126-26" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb126-27"><a href="#cb126-27" aria-hidden="true" tabindex="-1"></a>             <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb126-28"><a href="#cb126-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb126-29"><a href="#cb126-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb126-30"><a href="#cb126-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb126-31"><a href="#cb126-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb126-32"><a href="#cb126-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb126-33"><a href="#cb126-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb126-34"><a href="#cb126-34" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">12</span>,</span>
<span id="cb126-35"><a href="#cb126-35" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb126-36"><a href="#cb126-36" aria-hidden="true" tabindex="-1"></a>               <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb126-37"><a href="#cb126-37" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb126-38"><a href="#cb126-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb126-39"><a href="#cb126-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb126-40"><a href="#cb126-40" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">fill =</span> VIP_Coeff))</span>
<span id="cb126-41"><a href="#cb126-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-42"><a href="#cb126-42" aria-hidden="true" tabindex="-1"></a>coeff_plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-52-6.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb127"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>coeff_plot <span class="ot">&lt;-</span> coeff_plot <span class="sc">+</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type),</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>               <span class="fu">labeller</span>(</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Type =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="at">Chill =</span> <span class="st">&quot;MC for chill&quot;</span>,</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Heat =</span> <span class="st">&quot;MC for heat&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">min</span>(plscf<span class="sc">$</span>Chill_Portions<span class="sc">$</span>GDH<span class="sc">$</span>PLS_summary<span class="sc">$</span>Coef),</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(plscf<span class="sc">$</span>Chill_Portions<span class="sc">$</span>GDH<span class="sc">$</span>PLS_summary<span class="sc">$</span>Coef))) <span class="sc">+</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Model coefficients (MC)&quot;</span>) <span class="sc">+</span></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>coeff_plot </span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-52-7.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb128"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>coeff_plot <span class="ot">&lt;-</span> coeff_plot <span class="sc">+</span>  </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">&quot;Effect direction&quot;</span>, </span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Advancing&quot;</span>,</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Unimportant&quot;</span>,</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Delaying&quot;</span>), </span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;-1&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;dark green&quot;</span>)) <span class="sc">+</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;PLS coefficient&quot;</span>) <span class="sc">+</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>coeff_plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-52-8.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb129"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>plot<span class="ot">&lt;-</span> (VIP_plot <span class="sc">+</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>          coeff_plot <span class="sc">+</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>          temp_plot <span class="sc">+</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>)</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-52-9.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb130"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>plot_PLS_chill_force <span class="ot">&lt;-</span> <span class="cf">function</span>(plscf,</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">chill_metric =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">heat_metric =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">chill_label =</span> <span class="st">&quot;CP&quot;</span>,</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">heat_label =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">chill_phase =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>, <span class="dv">62</span>),</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">heat_phase =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="fl">105.5</span>))</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>  PLS_gg <span class="ot">&lt;-</span> plscf[[chill_metric]][[heat_metric]]<span class="sc">$</span>PLS_summary <span class="sc">%&gt;%</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">trunc</span>(Date<span class="sc">/</span><span class="dv">100</span>),</span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">Day =</span> Date <span class="sc">-</span> Month <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">Date =</span> <span class="fu">ISOdate</span>(<span class="dv">2002</span>,</span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>                          Month,</span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a>                          Day))</span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>  PLS_gg[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>,<span class="st">&quot;Date&quot;</span>]<span class="ot">&lt;-</span></span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a>            PLS_gg<span class="sc">$</span>Month[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>],</span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a>            PLS_gg<span class="sc">$</span>Day[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>])</span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a>  PLS_gg <span class="ot">&lt;-</span> PLS_gg <span class="sc">%&gt;%</span></span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">VIP_importance =</span> VIP <span class="sc">&gt;=</span> <span class="fl">0.8</span>,</span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">VIP_Coeff =</span> <span class="fu">factor</span>(<span class="fu">sign</span>(Coef) <span class="sc">*</span> VIP_importance))</span>
<span id="cb130-24"><a href="#cb130-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb130-25"><a href="#cb130-25" aria-hidden="true" tabindex="-1"></a>  chill_start_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-26"><a href="#cb130-26" aria-hidden="true" tabindex="-1"></a>                              <span class="dv">12</span>,</span>
<span id="cb130-27"><a href="#cb130-27" aria-hidden="true" tabindex="-1"></a>                              <span class="dv">31</span>) <span class="sc">+</span> chill_phase[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb130-28"><a href="#cb130-28" aria-hidden="true" tabindex="-1"></a>  chill_end_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-29"><a href="#cb130-29" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb130-30"><a href="#cb130-30" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> chill_phase[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb130-31"><a href="#cb130-31" aria-hidden="true" tabindex="-1"></a>  heat_start_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-32"><a href="#cb130-32" aria-hidden="true" tabindex="-1"></a>                             <span class="dv">12</span>,</span>
<span id="cb130-33"><a href="#cb130-33" aria-hidden="true" tabindex="-1"></a>                             <span class="dv">31</span>) <span class="sc">+</span> heat_phase[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb130-34"><a href="#cb130-34" aria-hidden="true" tabindex="-1"></a>  heat_end_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-35"><a href="#cb130-35" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">12</span>,</span>
<span id="cb130-36"><a href="#cb130-36" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">31</span>) <span class="sc">+</span> heat_phase[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb130-37"><a href="#cb130-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-38"><a href="#cb130-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-39"><a href="#cb130-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-40"><a href="#cb130-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-41"><a href="#cb130-41" aria-hidden="true" tabindex="-1"></a>  temp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg) <span class="sc">+</span></span>
<span id="cb130-42"><a href="#cb130-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb130-43"><a href="#cb130-43" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb130-44"><a href="#cb130-44" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb130-45"><a href="#cb130-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb130-46"><a href="#cb130-46" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb130-47"><a href="#cb130-47" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb130-48"><a href="#cb130-48" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-49"><a href="#cb130-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb130-50"><a href="#cb130-50" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb130-51"><a href="#cb130-51" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb130-52"><a href="#cb130-52" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb130-53"><a href="#cb130-53" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb130-54"><a href="#cb130-54" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb130-55"><a href="#cb130-55" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-56"><a href="#cb130-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb130-57"><a href="#cb130-57" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-58"><a href="#cb130-58" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb130-59"><a href="#cb130-59" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb130-60"><a href="#cb130-60" aria-hidden="true" tabindex="-1"></a>               <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb130-61"><a href="#cb130-61" aria-hidden="true" tabindex="-1"></a>                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb130-62"><a href="#cb130-62" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-63"><a href="#cb130-63" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb130-64"><a href="#cb130-64" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb130-65"><a href="#cb130-65" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb130-66"><a href="#cb130-66" aria-hidden="true" tabindex="-1"></a>                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb130-67"><a href="#cb130-67" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb130-68"><a href="#cb130-68" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb130-69"><a href="#cb130-69" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb130-70"><a href="#cb130-70" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-71"><a href="#cb130-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-72"><a href="#cb130-72" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">12</span>,</span>
<span id="cb130-73"><a href="#cb130-73" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb130-74"><a href="#cb130-74" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb130-75"><a href="#cb130-75" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb130-76"><a href="#cb130-76" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-77"><a href="#cb130-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb130-78"><a href="#cb130-78" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev ,</span>
<span id="cb130-79"><a href="#cb130-79" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev ),</span>
<span id="cb130-80"><a href="#cb130-80" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-81"><a href="#cb130-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb130-82"><a href="#cb130-82" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb130-83"><a href="#cb130-83" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb130-84"><a href="#cb130-84" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-85"><a href="#cb130-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb130-86"><a href="#cb130-86" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb130-87"><a href="#cb130-87" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>)),</span>
<span id="cb130-88"><a href="#cb130-88" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;dark green&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-89"><a href="#cb130-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb130-90"><a href="#cb130-90" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> MetricMean)) <span class="sc">+</span></span>
<span id="cb130-91"><a href="#cb130-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type),</span>
<span id="cb130-92"><a href="#cb130-92" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>,</span>
<span id="cb130-93"><a href="#cb130-93" aria-hidden="true" tabindex="-1"></a>               <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb130-94"><a href="#cb130-94" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> </span>
<span id="cb130-95"><a href="#cb130-95" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">labeller</span>(</span>
<span id="cb130-96"><a href="#cb130-96" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Type =</span></span>
<span id="cb130-97"><a href="#cb130-97" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="at">Chill =</span> <span class="fu">paste0</span>(<span class="st">&quot;Chill (&quot;</span>,</span>
<span id="cb130-98"><a href="#cb130-98" aria-hidden="true" tabindex="-1"></a>                                                  chill_label,</span>
<span id="cb130-99"><a href="#cb130-99" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">&quot;)&quot;</span>),</span>
<span id="cb130-100"><a href="#cb130-100" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Heat =</span> <span class="fu">paste0</span>(<span class="st">&quot;Heat (&quot;</span>,</span>
<span id="cb130-101"><a href="#cb130-101" aria-hidden="true" tabindex="-1"></a>                                                 heat_label,</span>
<span id="cb130-102"><a href="#cb130-102" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">&quot;)&quot;</span>))))) <span class="sc">+</span></span>
<span id="cb130-103"><a href="#cb130-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Daily chill and heat accumulation rates&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-104"><a href="#cb130-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb130-105"><a href="#cb130-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb130-106"><a href="#cb130-106" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb130-107"><a href="#cb130-107" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb130-108"><a href="#cb130-108" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb130-109"><a href="#cb130-109" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb130-110"><a href="#cb130-110" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb130-111"><a href="#cb130-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb130-112"><a href="#cb130-112" aria-hidden="true" tabindex="-1"></a>  VIP_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb130-113"><a href="#cb130-113" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb130-114"><a href="#cb130-114" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> VIP)) <span class="sc">+</span></span>
<span id="cb130-115"><a href="#cb130-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb130-116"><a href="#cb130-116" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb130-117"><a href="#cb130-117" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb130-118"><a href="#cb130-118" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb130-119"><a href="#cb130-119" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb130-120"><a href="#cb130-120" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb130-121"><a href="#cb130-121" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-122"><a href="#cb130-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb130-123"><a href="#cb130-123" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb130-124"><a href="#cb130-124" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb130-125"><a href="#cb130-125" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb130-126"><a href="#cb130-126" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb130-127"><a href="#cb130-127" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb130-128"><a href="#cb130-128" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-129"><a href="#cb130-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb130-130"><a href="#cb130-130" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-131"><a href="#cb130-131" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb130-132"><a href="#cb130-132" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb130-133"><a href="#cb130-133" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb130-134"><a href="#cb130-134" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-135"><a href="#cb130-135" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb130-136"><a href="#cb130-136" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb130-137"><a href="#cb130-137" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb130-138"><a href="#cb130-138" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb130-139"><a href="#cb130-139" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb130-140"><a href="#cb130-140" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb130-141"><a href="#cb130-141" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-142"><a href="#cb130-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-143"><a href="#cb130-143" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">12</span>,</span>
<span id="cb130-144"><a href="#cb130-144" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb130-145"><a href="#cb130-145" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb130-146"><a href="#cb130-146" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-147"><a href="#cb130-147" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb130-148"><a href="#cb130-148" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> VIP<span class="sc">&gt;</span><span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb130-149"><a href="#cb130-149" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type), </span>
<span id="cb130-150"><a href="#cb130-150" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb130-151"><a href="#cb130-151" aria-hidden="true" tabindex="-1"></a>               <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb130-152"><a href="#cb130-152" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> </span>
<span id="cb130-153"><a href="#cb130-153" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">labeller</span>(</span>
<span id="cb130-154"><a href="#cb130-154" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Type =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="at">Chill=</span><span class="st">&quot;VIP for chill&quot;</span>,</span>
<span id="cb130-155"><a href="#cb130-155" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">Heat=</span><span class="st">&quot;VIP for heat&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb130-156"><a href="#cb130-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb130-157"><a href="#cb130-157" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,</span>
<span id="cb130-158"><a href="#cb130-158" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(plscf[[chill_metric]][[heat_metric]]<span class="sc">$</span>PLS_summary<span class="sc">$</span>VIP))) <span class="sc">+</span></span>
<span id="cb130-159"><a href="#cb130-159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Variable Importance in the Projection (VIP) scores&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-160"><a href="#cb130-160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb130-161"><a href="#cb130-161" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb130-162"><a href="#cb130-162" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb130-163"><a href="#cb130-163" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb130-164"><a href="#cb130-164" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb130-165"><a href="#cb130-165" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb130-166"><a href="#cb130-166" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb130-167"><a href="#cb130-167" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;VIP&quot;</span>, </span>
<span id="cb130-168"><a href="#cb130-168" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;0.8&quot;</span>, <span class="st">&quot;&gt;0.8&quot;</span>), </span>
<span id="cb130-169"><a href="#cb130-169" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;FALSE&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb130-170"><a href="#cb130-170" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;TRUE&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb130-171"><a href="#cb130-171" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb130-172"><a href="#cb130-172" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb130-173"><a href="#cb130-173" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb130-174"><a href="#cb130-174" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb130-175"><a href="#cb130-175" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb130-176"><a href="#cb130-176" aria-hidden="true" tabindex="-1"></a>  coeff_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb130-177"><a href="#cb130-177" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb130-178"><a href="#cb130-178" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y =</span> Coef)) <span class="sc">+</span></span>
<span id="cb130-179"><a href="#cb130-179" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb130-180"><a href="#cb130-180" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb130-181"><a href="#cb130-181" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb130-182"><a href="#cb130-182" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb130-183"><a href="#cb130-183" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb130-184"><a href="#cb130-184" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb130-185"><a href="#cb130-185" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-186"><a href="#cb130-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb130-187"><a href="#cb130-187" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb130-188"><a href="#cb130-188" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb130-189"><a href="#cb130-189" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb130-190"><a href="#cb130-190" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb130-191"><a href="#cb130-191" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb130-192"><a href="#cb130-192" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-193"><a href="#cb130-193" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb130-194"><a href="#cb130-194" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-195"><a href="#cb130-195" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb130-196"><a href="#cb130-196" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb130-197"><a href="#cb130-197" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb130-198"><a href="#cb130-198" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-199"><a href="#cb130-199" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb130-200"><a href="#cb130-200" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb130-201"><a href="#cb130-201" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb130-202"><a href="#cb130-202" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb130-203"><a href="#cb130-203" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb130-204"><a href="#cb130-204" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb130-205"><a href="#cb130-205" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-206"><a href="#cb130-206" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb130-207"><a href="#cb130-207" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">12</span>,</span>
<span id="cb130-208"><a href="#cb130-208" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb130-209"><a href="#cb130-209" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb130-210"><a href="#cb130-210" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-211"><a href="#cb130-211" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb130-212"><a href="#cb130-212" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> VIP_Coeff)) <span class="sc">+</span></span>
<span id="cb130-213"><a href="#cb130-213" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type),</span>
<span id="cb130-214"><a href="#cb130-214" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb130-215"><a href="#cb130-215" aria-hidden="true" tabindex="-1"></a>               <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb130-216"><a href="#cb130-216" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span></span>
<span id="cb130-217"><a href="#cb130-217" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">labeller</span>(</span>
<span id="cb130-218"><a href="#cb130-218" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Type =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="at">Chill =</span> <span class="st">&quot;MC for chill&quot;</span>,</span>
<span id="cb130-219"><a href="#cb130-219" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">Heat =</span> <span class="st">&quot;MC for heat&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb130-220"><a href="#cb130-220" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb130-221"><a href="#cb130-221" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">min</span>(plscf[[chill_metric]][[heat_metric]]<span class="sc">$</span>PLS_summary<span class="sc">$</span>Coef),</span>
<span id="cb130-222"><a href="#cb130-222" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">max</span>(plscf[[chill_metric]][[heat_metric]]<span class="sc">$</span>PLS_summary<span class="sc">$</span>Coef))) <span class="sc">+</span></span>
<span id="cb130-223"><a href="#cb130-223" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Model coefficients (MC)&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-224"><a href="#cb130-224" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb130-225"><a href="#cb130-225" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb130-226"><a href="#cb130-226" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb130-227"><a href="#cb130-227" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb130-228"><a href="#cb130-228" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb130-229"><a href="#cb130-229" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb130-230"><a href="#cb130-230" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb130-231"><a href="#cb130-231" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">&quot;Effect direction&quot;</span>, </span>
<span id="cb130-232"><a href="#cb130-232" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Advancing&quot;</span>,</span>
<span id="cb130-233"><a href="#cb130-233" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Unimportant&quot;</span>,</span>
<span id="cb130-234"><a href="#cb130-234" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Delaying&quot;</span>), </span>
<span id="cb130-235"><a href="#cb130-235" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;-1&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb130-236"><a href="#cb130-236" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb130-237"><a href="#cb130-237" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;dark green&quot;</span>)) <span class="sc">+</span></span>
<span id="cb130-238"><a href="#cb130-238" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;PLS coefficient&quot;</span>) <span class="sc">+</span></span>
<span id="cb130-239"><a href="#cb130-239" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb130-240"><a href="#cb130-240" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb130-241"><a href="#cb130-241" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb130-242"><a href="#cb130-242" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb130-243"><a href="#cb130-243" aria-hidden="true" tabindex="-1"></a>   <span class="fu">library</span>(patchwork)</span>
<span id="cb130-244"><a href="#cb130-244" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb130-245"><a href="#cb130-245" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> (VIP_plot <span class="sc">+</span></span>
<span id="cb130-246"><a href="#cb130-246" aria-hidden="true" tabindex="-1"></a>             coeff_plot <span class="sc">+</span></span>
<span id="cb130-247"><a href="#cb130-247" aria-hidden="true" tabindex="-1"></a>             temp_plot <span class="sc">+</span></span>
<span id="cb130-248"><a href="#cb130-248" aria-hidden="true" tabindex="-1"></a>             <span class="fu">plot_layout</span>(<span class="at">ncol=</span><span class="dv">1</span>,</span>
<span id="cb130-249"><a href="#cb130-249" aria-hidden="true" tabindex="-1"></a>                         <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>)</span>
<span id="cb130-250"><a href="#cb130-250" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb130-251"><a href="#cb130-251" aria-hidden="true" tabindex="-1"></a>                     <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb130-252"><a href="#cb130-252" aria-hidden="true" tabindex="-1"></a>                     <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb130-253"><a href="#cb130-253" aria-hidden="true" tabindex="-1"></a>                     <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb130-254"><a href="#cb130-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-255"><a href="#cb130-255" aria-hidden="true" tabindex="-1"></a>plot</span>
<span id="cb130-256"><a href="#cb130-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-257"><a href="#cb130-257" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb130-258"><a href="#cb130-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-259"><a href="#cb130-259" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS_chill_force</span>(plscf)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-52-10.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Plot results for all three analyses, including shaded plot areas for the chilling and forcing periods you estimated.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb131"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>daychill <span class="ot">&lt;-</span> <span class="fu">daily_chill</span>(<span class="at">hourtemps =</span> temps_hourly,</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">running_mean =</span> <span class="dv">11</span>,</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">models =</span> <span class="fu">list</span>(<span class="at">Chilling_Hours =</span> Chilling_Hours,</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">Utah_Chill_Units =</span> Utah_Model,</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">Chill_Portions =</span> Dynamic_Model,</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">GDH =</span> GDH)</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>plscf <span class="ot">&lt;-</span> <span class="fu">PLS_chill_force</span>(<span class="at">daily_chill_obj =</span> daychill,</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bio_data_frame =</span> Roter_Boskoop,</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">split_month =</span> <span class="dv">6</span>,</span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">chill_models =</span> <span class="fu">c</span>(<span class="st">&quot;Chilling_Hours&quot;</span>,</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;Utah_Chill_Units&quot;</span>,</span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;Chill_Portions&quot;</span>),</span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">heat_models =</span> <span class="fu">c</span>(<span class="st">&quot;GDH&quot;</span>))</span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS_chill_force</span>(plscf,</span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_metric =</span> <span class="st">&quot;Chilling_Hours&quot;</span>,</span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_metric =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_label =</span> <span class="st">&quot;CH&quot;</span>,</span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_label =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_phase =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_phase =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb132"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS_chill_force</span>(plscf,</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_metric =</span> <span class="st">&quot;Utah_Chill_Units&quot;</span>,</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_metric =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_label =</span> <span class="st">&quot;CU&quot;</span>,</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_label =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_phase =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_phase =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-53-2.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb133"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS_chill_force</span>(plscf,</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_metric =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_metric =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_label =</span> <span class="st">&quot;CP&quot;</span>,</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_label =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_phase =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_phase =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-53-3.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<hr />
</section>
</section>
<section id="chapter-24-pls-regression-with-agroclimatic-metrics" class="level1">
<h1>Chapter 24: PLS regression with agroclimatic metrics</h1>
<section id="exercises-on-examples-of-pls-regression-with-agroclimatic-metrics" class="level2">
<h2><strong><em>Exercises on examples of PLS regression with agroclimatic metrics</em></strong></h2>
<ol type="1">
<li>Look across all the PLS results presented above. Can you detect a pattern in where chilling and forcing periods could be delineated clearly, and where this attempt failed?</li>
</ol>
<p>PLS regression doesnât allow easy delineation of temperature response phases, especially when it comes to the chilling period. This problem didnât really go away after replacing temperatures with agroclimatic metrics in the analysis.</p>
<p>PLS looks responses of a variable to variation in the input variable. This response should be monotonic (bloom date should be positively or negatively correlated with the input variables). The sign of this relationship should not change halfway through the range of the input variables.</p>
<p>Another prerequisite for a successful PLS regression, is that there needs to be meaningful variation in the signal variables in the first place.</p>
<ol start="2" type="1">
<li>Think about possible reasons for the success or failure of PLS analysis based on agroclimatic metrics. Write down your thoughts.</li>
</ol>
<hr />
</section>
</section>
<section id="chapter-25-pls-regression-with-agroclimatic-metrics" class="level1">
<h1>Chapter 25: PLS regression with agroclimatic metrics</h1>
<section id="exercises-on-expected-pls-responsiveness" class="level2">
<h2><strong><em>Exercises on expected PLS responsiveness</em></strong></h2>
<p>Produce chill and heat model sensitivity plots for the location you focused on in previous exercises.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb134"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>mon <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Month</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>ndays <span class="ot">&lt;-</span> <span class="dv">31</span> <span class="co"># Number of days per month</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>tmin <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>tmax <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">&lt;-</span> <span class="dv">43</span> <span class="co">#Rochester</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">make_all_day_table</span>(</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">data.frame</span>(<span class="at">Year =</span> <span class="fu">c</span>(<span class="dv">2001</span>, <span class="dv">2001</span>),</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Month =</span> <span class="fu">c</span>(mon, mon),</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Day =</span> <span class="fu">c</span>(<span class="dv">1</span>, ndays),</span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Tmin =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Tmax =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Tmin =</span> tmin,</span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">Tmax =</span> tmax)</span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>hourly_temps <span class="ot">&lt;-</span> <span class="fu">stack_hourly_temps</span>(weather,</span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latitude =</span> latitude)</span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>CPs <span class="ot">&lt;-</span> <span class="fu">Dynamic_Model</span>(</span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>     hourly_temps<span class="sc">$</span>hourtemps<span class="sc">$</span>Temp)</span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>daily_CPs <span class="ot">&lt;-</span> <span class="fu">tail</span>(CPs, <span class="dv">1</span>) <span class="sc">/</span> <span class="fu">nrow</span>(weather)</span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>daily_CPs <span class="co">#chill portions</span></span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6857511</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb136"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">&lt;-</span> <span class="fl">43.1</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>month_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>Tmins <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">20</span>) <span class="co"># calculate sensitivity for expected temps in winter</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>Tmaxs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span><span class="sc">:</span><span class="dv">30</span>) <span class="co"># range</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>mins <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>maxs <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>CP <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>month <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>temp_model <span class="ot">&lt;-</span> Dynamic_Model <span class="co"># model for temp</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(mon <span class="cf">in</span> month_range)</span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>    {days_month <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>( <span class="co"># number of days in a month</span></span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">difftime</span>( <span class="fu">ISOdate</span>(<span class="dv">2002</span>, <span class="co"># time difference of 31 days</span></span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a>                        mon<span class="sc">+</span><span class="dv">1</span>,</span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">1</span>),</span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ISOdate</span>(<span class="dv">2002</span>,</span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a>                        mon,</span>
<span id="cb136-22"><a href="#cb136-22" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">1</span>)))</span>
<span id="cb136-23"><a href="#cb136-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-24"><a href="#cb136-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(mon <span class="sc">==</span> <span class="dv">12</span>) days_month <span class="ot">&lt;-</span> <span class="dv">31</span></span>
<span id="cb136-25"><a href="#cb136-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-26"><a href="#cb136-26" aria-hidden="true" tabindex="-1"></a>    weather <span class="ot">&lt;-</span> <span class="fu">make_all_day_table</span>(</span>
<span id="cb136-27"><a href="#cb136-27" aria-hidden="true" tabindex="-1"></a>                <span class="fu">data.frame</span>(<span class="at">Year =</span> <span class="fu">c</span>(<span class="dv">2001</span>, <span class="dv">2001</span>),</span>
<span id="cb136-28"><a href="#cb136-28" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Month =</span> <span class="fu">c</span>(mon, mon),</span>
<span id="cb136-29"><a href="#cb136-29" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Day =</span> <span class="fu">c</span>(<span class="dv">1</span>, days_month),</span>
<span id="cb136-30"><a href="#cb136-30" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Tmin =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb136-31"><a href="#cb136-31" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Tmax =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb136-32"><a href="#cb136-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-33"><a href="#cb136-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(tmin <span class="cf">in</span> Tmins)</span>
<span id="cb136-34"><a href="#cb136-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(tmax <span class="cf">in</span> Tmaxs)</span>
<span id="cb136-35"><a href="#cb136-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tmax <span class="sc">&gt;=</span> tmin)</span>
<span id="cb136-36"><a href="#cb136-36" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb136-37"><a href="#cb136-37" aria-hidden="true" tabindex="-1"></a>          hourtemps <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span></span>
<span id="cb136-38"><a href="#cb136-38" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">Tmin =</span> tmin,</span>
<span id="cb136-39"><a href="#cb136-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Tmax =</span> tmax) <span class="sc">%&gt;%</span></span>
<span id="cb136-40"><a href="#cb136-40" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stack_hourly_temps</span>(<span class="at">latitude =</span> latitude) <span class="sc">%&gt;%</span></span>
<span id="cb136-41"><a href="#cb136-41" aria-hidden="true" tabindex="-1"></a>            <span class="fu">pluck</span>(<span class="st">&quot;hourtemps&quot;</span>, <span class="st">&quot;Temp&quot;</span>)</span>
<span id="cb136-42"><a href="#cb136-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-43"><a href="#cb136-43" aria-hidden="true" tabindex="-1"></a>          CP <span class="ot">&lt;-</span> <span class="fu">c</span>(CP,</span>
<span id="cb136-44"><a href="#cb136-44" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">tail</span>(<span class="fu">do.call</span>(temp_model,</span>
<span id="cb136-45"><a href="#cb136-45" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">list</span>(hourtemps)), <span class="dv">1</span>) <span class="sc">/</span></span>
<span id="cb136-46"><a href="#cb136-46" aria-hidden="true" tabindex="-1"></a>                    days_month)</span>
<span id="cb136-47"><a href="#cb136-47" aria-hidden="true" tabindex="-1"></a>          mins <span class="ot">&lt;-</span> <span class="fu">c</span>(mins, tmin)</span>
<span id="cb136-48"><a href="#cb136-48" aria-hidden="true" tabindex="-1"></a>          maxs <span class="ot">&lt;-</span> <span class="fu">c</span>(maxs, tmax)</span>
<span id="cb136-49"><a href="#cb136-49" aria-hidden="true" tabindex="-1"></a>          month <span class="ot">&lt;-</span> <span class="fu">c</span>(month, mon)</span>
<span id="cb136-50"><a href="#cb136-50" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb136-51"><a href="#cb136-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb136-52"><a href="#cb136-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-53"><a href="#cb136-53" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Month =</span> month,</span>
<span id="cb136-54"><a href="#cb136-54" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Tmin =</span> mins,</span>
<span id="cb136-55"><a href="#cb136-55" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Tmax =</span> maxs,</span>
<span id="cb136-56"><a href="#cb136-56" aria-hidden="true" tabindex="-1"></a>                      CP)</span>
<span id="cb136-57"><a href="#cb136-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-58"><a href="#cb136-58" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> results[<span class="sc">!</span><span class="fu">is.na</span>(results<span class="sc">$</span>Month),</span>
<span id="cb136-59"><a href="#cb136-59" aria-hidden="true" tabindex="-1"></a>                   ]</span>
<span id="cb136-60"><a href="#cb136-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-61"><a href="#cb136-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-62"><a href="#cb136-62" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(results,</span>
<span id="cb136-63"><a href="#cb136-63" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/model_sensitivity_development.csv&quot;</span>,</span>
<span id="cb136-64"><a href="#cb136-64" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb136-65"><a href="#cb136-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-66"><a href="#cb136-66" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(results)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Month Tmin Tmax                    CP
2    10  -20  -15 0.0000000000001085391
3    10  -20  -14 0.0000000000006373370
4    10  -20  -13 0.0000000000037399058
5    10  -20  -12 0.0000000000218431572
6    10  -20  -11 0.0000000001266344358
7    10  -20  -10 0.0000000007273857353</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb138"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/model_sensitivity_development.csv&quot;</span>)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorRamps)</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>Month_names <span class="ot">&lt;-</span> <span class="fu">factor</span>(results<span class="sc">$</span>Month,</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> month_range,<span class="co"># october to march</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">labels =</span> month.name[month_range])  </span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>DM_sensitivity <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(results, <span class="co"># heat map</span></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">aes</span>(<span class="at">x =</span> Tmin,</span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y =</span> Tmax,</span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>                             <span class="at">fill =</span> CP)) <span class="sc">+</span></span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">alpha</span>(<span class="fu">matlab.like</span>(<span class="dv">15</span>),</span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">alpha =</span> .<span class="dv">5</span>),</span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">&quot;Chill/day (CP)&quot;</span>) <span class="sc">+</span></span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">min</span>(results<span class="sc">$</span>Tmax),</span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">max</span>(results<span class="sc">$</span>Tmax)) <span class="sc">+</span></span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">min</span>(results<span class="sc">$</span>Tmin),</span>
<span id="cb138-23"><a href="#cb138-23" aria-hidden="true" tabindex="-1"></a>       <span class="fu">max</span>(results<span class="sc">$</span>Tmin))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for y is already present.
Adding another scale for y, which will replace the existing scale.</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb140"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>DM_sensitivity</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2706 rows containing missing values or values outside the scale range
(`geom_tile()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb142"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>DM_sensitivity <span class="ot">&lt;-</span> DM_sensitivity <span class="sc">+</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Month_names)) <span class="sc">+</span> <span class="co"># facet_wraps separates them by months</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">min</span>(results<span class="sc">$</span>Tmax),</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">max</span>(results<span class="sc">$</span>Tmax)) <span class="sc">+</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">min</span>(results<span class="sc">$</span>Tmin),</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">max</span>(results<span class="sc">$</span>Tmin))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for y is already present.
Adding another scale for y, which will replace the existing scale.
Scale for y is already present.
Adding another scale for y, which will replace the existing scale.</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb144"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>DM_sensitivity <span class="co"># nothing happens at -20 temp, at temp below freezing -10, we see some reactions,  </span></span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2706 rows containing missing values or values outside the scale range
(`geom_tile()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-54-2.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb146"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>temperatures <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/TMaxTMin1958-2019_patched.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Month <span class="sc">%in%</span> month_range) <span class="sc">%&gt;%</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month_names =</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(Month,</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;October&quot;</span>, <span class="st">&quot;November&quot;</span>, <span class="st">&quot;December&quot;</span>,</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;January&quot;</span>, <span class="st">&quot;February&quot;</span>, <span class="st">&quot;March&quot;</span>))) <span class="co">#rename months</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>temperatures[<span class="fu">which</span>(temperatures<span class="sc">$</span>Tmax <span class="sc">&lt;</span> temperatures<span class="sc">$</span>Tmin),</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>             <span class="fu">c</span>(<span class="st">&quot;Tmax&quot;</span>, <span class="st">&quot;Tmin&quot;</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>DM_sensitivity <span class="sc">+</span></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> temperatures,</span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Tmin,</span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> Tmax,</span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="cn">NULL</span>,</span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;Temperature&quot;</span>),</span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Month_names)) <span class="sc">+</span></span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="st">&quot;Daily temperature </span><span class="sc">\n</span><span class="st">extremes (Â°C)&quot;</span>,</span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">&quot;Observed at site&quot;</span> ) <span class="sc">+</span></span>
<span id="cb146-23"><a href="#cb146-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">order =</span> <span class="dv">1</span>),</span>
<span id="cb146-24"><a href="#cb146-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb146-25"><a href="#cb146-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Tmax (Â°C)&quot;</span>) <span class="sc">+</span></span>
<span id="cb146-26"><a href="#cb146-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Tmin (Â°C)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb146-27"><a href="#cb146-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="co"># Model response in relationship to temps observed in Rochester</span></span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2706 rows containing missing values or values outside the scale range
(`geom_tile()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 250 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-54-3.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb149"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>Chill_model_sensitivity<span class="ot">&lt;-</span> <span class="co"># creating a function for other locations</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(latitude,</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">temp_models =</span> <span class="fu">list</span>(<span class="at">Dynamic_Model =</span> Dynamic_Model,</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">GDH =</span> GDH),</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">Tmins =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>),</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">Tmaxs =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">30</span>))</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>  mins <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>  maxs <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>  metrics <span class="ot">&lt;-</span> <span class="fu">as.list</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,</span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(temp_models)))</span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(metrics) <span class="ot">&lt;-</span> <span class="fu">names</span>(temp_models)</span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>  month <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(mon <span class="cf">in</span> month_range)</span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>    days_month <span class="ot">&lt;-</span></span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">difftime</span>( <span class="fu">ISOdate</span>(<span class="dv">2002</span>,</span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a>                                   mon<span class="sc">+</span><span class="dv">1</span>,</span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">1</span>),</span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ISOdate</span>(<span class="dv">2002</span>,</span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a>                                   mon,</span>
<span id="cb149-24"><a href="#cb149-24" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">1</span>) ))</span>
<span id="cb149-25"><a href="#cb149-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(mon <span class="sc">==</span> <span class="dv">12</span>) days_month <span class="ot">&lt;-</span> <span class="dv">31</span></span>
<span id="cb149-26"><a href="#cb149-26" aria-hidden="true" tabindex="-1"></a>    weather <span class="ot">&lt;-</span> </span>
<span id="cb149-27"><a href="#cb149-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">make_all_day_table</span>(<span class="fu">data.frame</span>(<span class="at">Year =</span> <span class="fu">c</span>(<span class="dv">2001</span>, <span class="dv">2001</span>),</span>
<span id="cb149-28"><a href="#cb149-28" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Month =</span> <span class="fu">c</span>(mon, mon),</span>
<span id="cb149-29"><a href="#cb149-29" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Day =</span> <span class="fu">c</span>(<span class="dv">1</span>, days_month),</span>
<span id="cb149-30"><a href="#cb149-30" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Tmin =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb149-31"><a href="#cb149-31" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Tmax =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb149-32"><a href="#cb149-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-33"><a href="#cb149-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb149-34"><a href="#cb149-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(tmin <span class="cf">in</span> Tmins)</span>
<span id="cb149-35"><a href="#cb149-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(tmax <span class="cf">in</span> Tmaxs)</span>
<span id="cb149-36"><a href="#cb149-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tmax <span class="sc">&gt;=</span> tmin)</span>
<span id="cb149-37"><a href="#cb149-37" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb149-38"><a href="#cb149-38" aria-hidden="true" tabindex="-1"></a>          hourtemps <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span></span>
<span id="cb149-39"><a href="#cb149-39" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">Tmin =</span> tmin,</span>
<span id="cb149-40"><a href="#cb149-40" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Tmax =</span> tmax) <span class="sc">%&gt;%</span></span>
<span id="cb149-41"><a href="#cb149-41" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stack_hourly_temps</span>(</span>
<span id="cb149-42"><a href="#cb149-42" aria-hidden="true" tabindex="-1"></a>              <span class="at">latitude =</span> latitude) <span class="sc">%&gt;%</span></span>
<span id="cb149-43"><a href="#cb149-43" aria-hidden="true" tabindex="-1"></a>            <span class="fu">pluck</span>(<span class="st">&quot;hourtemps&quot;</span>,</span>
<span id="cb149-44"><a href="#cb149-44" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Temp&quot;</span>)</span>
<span id="cb149-45"><a href="#cb149-45" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb149-46"><a href="#cb149-46" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(tm <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(temp_models))</span>
<span id="cb149-47"><a href="#cb149-47" aria-hidden="true" tabindex="-1"></a>            metrics[[tm]] <span class="ot">&lt;-</span> </span>
<span id="cb149-48"><a href="#cb149-48" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(metrics[[tm]],</span>
<span id="cb149-49"><a href="#cb149-49" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tail</span>(<span class="fu">do.call</span>(temp_models[[tm]],</span>
<span id="cb149-50"><a href="#cb149-50" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">list</span>(hourtemps)),<span class="dv">1</span>)<span class="sc">/</span></span>
<span id="cb149-51"><a href="#cb149-51" aria-hidden="true" tabindex="-1"></a>                  days_month)</span>
<span id="cb149-52"><a href="#cb149-52" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb149-53"><a href="#cb149-53" aria-hidden="true" tabindex="-1"></a>          mins <span class="ot">&lt;-</span> <span class="fu">c</span>(mins, tmin)</span>
<span id="cb149-54"><a href="#cb149-54" aria-hidden="true" tabindex="-1"></a>          maxs <span class="ot">&lt;-</span> <span class="fu">c</span>(maxs, tmax)</span>
<span id="cb149-55"><a href="#cb149-55" aria-hidden="true" tabindex="-1"></a>          month <span class="ot">&lt;-</span> <span class="fu">c</span>(month, mon)</span>
<span id="cb149-56"><a href="#cb149-56" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb149-57"><a href="#cb149-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb149-58"><a href="#cb149-58" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">data.frame</span>(<span class="at">Month =</span> month,</span>
<span id="cb149-59"><a href="#cb149-59" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Tmin =</span> mins,</span>
<span id="cb149-60"><a href="#cb149-60" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Tmax =</span> maxs),</span>
<span id="cb149-61"><a href="#cb149-61" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">as.data.frame</span>(metrics))</span>
<span id="cb149-62"><a href="#cb149-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-63"><a href="#cb149-63" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> results[<span class="sc">!</span><span class="fu">is.na</span>(results<span class="sc">$</span>Month),]</span>
<span id="cb149-64"><a href="#cb149-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-65"><a href="#cb149-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-66"><a href="#cb149-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-67"><a href="#cb149-67" aria-hidden="true" tabindex="-1"></a>Chill_sensitivity_temps <span class="ot">&lt;-</span></span>
<span id="cb149-68"><a href="#cb149-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(chill_model_sensitivity_table,</span>
<span id="cb149-69"><a href="#cb149-69" aria-hidden="true" tabindex="-1"></a>           temperatures,</span>
<span id="cb149-70"><a href="#cb149-70" aria-hidden="true" tabindex="-1"></a>           temp_model,</span>
<span id="cb149-71"><a href="#cb149-71" aria-hidden="true" tabindex="-1"></a>           <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb149-72"><a href="#cb149-72" aria-hidden="true" tabindex="-1"></a>           <span class="at">Tmins =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>),</span>
<span id="cb149-73"><a href="#cb149-73" aria-hidden="true" tabindex="-1"></a>           <span class="at">Tmaxs =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">30</span>),</span>
<span id="cb149-74"><a href="#cb149-74" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend_label =</span> <span class="st">&quot;Chill/day (CP)&quot;</span>)</span>
<span id="cb149-75"><a href="#cb149-75" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb149-76"><a href="#cb149-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb149-77"><a href="#cb149-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(colorRamps)</span>
<span id="cb149-78"><a href="#cb149-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-79"><a href="#cb149-79" aria-hidden="true" tabindex="-1"></a>  cmst <span class="ot">&lt;-</span> chill_model_sensitivity_table</span>
<span id="cb149-80"><a href="#cb149-80" aria-hidden="true" tabindex="-1"></a>  cmst <span class="ot">&lt;-</span> cmst[<span class="fu">which</span>(cmst<span class="sc">$</span>Month <span class="sc">%in%</span> month_range),]</span>
<span id="cb149-81"><a href="#cb149-81" aria-hidden="true" tabindex="-1"></a>  cmst<span class="sc">$</span>Month_names <span class="ot">&lt;-</span> <span class="fu">factor</span>(cmst<span class="sc">$</span>Month,</span>
<span id="cb149-82"><a href="#cb149-82" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> month_range,</span>
<span id="cb149-83"><a href="#cb149-83" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> month.name[month_range])  </span>
<span id="cb149-84"><a href="#cb149-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-85"><a href="#cb149-85" aria-hidden="true" tabindex="-1"></a>  DM_sensitivity<span class="ot">&lt;-</span></span>
<span id="cb149-86"><a href="#cb149-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(cmst,</span>
<span id="cb149-87"><a href="#cb149-87" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">&quot;Tmin&quot;</span>,</span>
<span id="cb149-88"><a href="#cb149-88" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="st">&quot;Tmax&quot;</span>,</span>
<span id="cb149-89"><a href="#cb149-89" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fill =</span> temp_model)) <span class="sc">+</span></span>
<span id="cb149-90"><a href="#cb149-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb149-91"><a href="#cb149-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">alpha</span>(<span class="fu">matlab.like</span>(<span class="dv">15</span>),</span>
<span id="cb149-92"><a href="#cb149-92" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">alpha =</span> .<span class="dv">5</span>),</span>
<span id="cb149-93"><a href="#cb149-93" aria-hidden="true" tabindex="-1"></a>                         <span class="at">name =</span> legend_label) <span class="sc">+</span></span>
<span id="cb149-94"><a href="#cb149-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(Tmins[<span class="dv">1</span>],</span>
<span id="cb149-95"><a href="#cb149-95" aria-hidden="true" tabindex="-1"></a>         Tmins[<span class="fu">length</span>(Tmins)]) <span class="sc">+</span></span>
<span id="cb149-96"><a href="#cb149-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(Tmaxs[<span class="dv">1</span>],</span>
<span id="cb149-97"><a href="#cb149-97" aria-hidden="true" tabindex="-1"></a>         Tmaxs[<span class="fu">length</span>(Tmaxs)])</span>
<span id="cb149-98"><a href="#cb149-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-99"><a href="#cb149-99" aria-hidden="true" tabindex="-1"></a>  temperatures<span class="ot">&lt;-</span></span>
<span id="cb149-100"><a href="#cb149-100" aria-hidden="true" tabindex="-1"></a>    temperatures[<span class="fu">which</span>(temperatures<span class="sc">$</span>Month <span class="sc">%in%</span> month_range),]</span>
<span id="cb149-101"><a href="#cb149-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-102"><a href="#cb149-102" aria-hidden="true" tabindex="-1"></a>  temperatures[<span class="fu">which</span>(temperatures<span class="sc">$</span>Tmax <span class="sc">&lt;</span> temperatures<span class="sc">$</span>Tmin),</span>
<span id="cb149-103"><a href="#cb149-103" aria-hidden="true" tabindex="-1"></a>               <span class="fu">c</span>(<span class="st">&quot;Tmax&quot;</span>, </span>
<span id="cb149-104"><a href="#cb149-104" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Tmin&quot;</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb149-105"><a href="#cb149-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-106"><a href="#cb149-106" aria-hidden="true" tabindex="-1"></a>  temperatures<span class="sc">$</span>Month_names <span class="ot">&lt;-</span></span>
<span id="cb149-107"><a href="#cb149-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">factor</span>(temperatures<span class="sc">$</span>Month,</span>
<span id="cb149-108"><a href="#cb149-108" aria-hidden="true" tabindex="-1"></a>           <span class="at">levels =</span> month_range,</span>
<span id="cb149-109"><a href="#cb149-109" aria-hidden="true" tabindex="-1"></a>           <span class="at">labels =</span> month.name[month_range])  </span>
<span id="cb149-110"><a href="#cb149-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-111"><a href="#cb149-111" aria-hidden="true" tabindex="-1"></a>  DM_sensitivity <span class="sc">+</span></span>
<span id="cb149-112"><a href="#cb149-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> temperatures,</span>
<span id="cb149-113"><a href="#cb149-113" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> Tmin,</span>
<span id="cb149-114"><a href="#cb149-114" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> Tmax,</span>
<span id="cb149-115"><a href="#cb149-115" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="cn">NULL</span>,</span>
<span id="cb149-116"><a href="#cb149-116" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">&quot;Temperature&quot;</span>),</span>
<span id="cb149-117"><a href="#cb149-117" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb149-118"><a href="#cb149-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Month_names)) <span class="sc">+</span></span>
<span id="cb149-119"><a href="#cb149-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb149-120"><a href="#cb149-120" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="st">&quot;Daily temperature </span><span class="sc">\n</span><span class="st">extremes (Â°C)&quot;</span>,</span>
<span id="cb149-121"><a href="#cb149-121" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">&quot;Observed at site&quot;</span> ) <span class="sc">+</span></span>
<span id="cb149-122"><a href="#cb149-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">order =</span> <span class="dv">1</span>),</span>
<span id="cb149-123"><a href="#cb149-123" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb149-124"><a href="#cb149-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Tmax (Â°C)&quot;</span>) <span class="sc">+</span></span>
<span id="cb149-125"><a href="#cb149-125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Tmin (Â°C)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb149-126"><a href="#cb149-126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span>
<span id="cb149-127"><a href="#cb149-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-128"><a href="#cb149-128" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-129"><a href="#cb149-129" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-130"><a href="#cb149-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-131"><a href="#cb149-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-132"><a href="#cb149-132" aria-hidden="true" tabindex="-1"></a>Model_sensitivities_CNY <span class="ot">&lt;-</span> <span class="co"># Rochester, New York</span></span>
<span id="cb149-133"><a href="#cb149-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Chill_model_sensitivity</span>(<span class="at">latitude =</span> <span class="dv">43</span>,</span>
<span id="cb149-134"><a href="#cb149-134" aria-hidden="true" tabindex="-1"></a>                          <span class="at">temp_models =</span> <span class="fu">list</span>(<span class="at">Dynamic_Model =</span> Dynamic_Model,</span>
<span id="cb149-135"><a href="#cb149-135" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">GDH =</span> GDH),</span>
<span id="cb149-136"><a href="#cb149-136" aria-hidden="true" tabindex="-1"></a>                          <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="cb149-137"><a href="#cb149-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-138"><a href="#cb149-138" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(Model_sensitivities_CNY,</span>
<span id="cb149-139"><a href="#cb149-139" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Model_sensitivities_CNY.csv&quot;</span>,</span>
<span id="cb149-140"><a href="#cb149-140" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb149-141"><a href="#cb149-141" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb149-142"><a href="#cb149-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-143"><a href="#cb149-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-144"><a href="#cb149-144" aria-hidden="true" tabindex="-1"></a>Model_sensitivities_CNY <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Model_sensitivities_CNY.csv&quot;</span>)</span>
<span id="cb149-145"><a href="#cb149-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-146"><a href="#cb149-146" aria-hidden="true" tabindex="-1"></a>Rochester_weather <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_weather.csv&quot;</span>)</span>
<span id="cb149-147"><a href="#cb149-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-148"><a href="#cb149-148" aria-hidden="true" tabindex="-1"></a><span class="fu">Chill_sensitivity_temps</span>(Model_sensitivities_CNY,</span>
<span id="cb149-149"><a href="#cb149-149" aria-hidden="true" tabindex="-1"></a>                        Rochester_weather,</span>
<span id="cb149-150"><a href="#cb149-150" aria-hidden="true" tabindex="-1"></a>                        <span class="at">temp_model =</span> <span class="st">&quot;Dynamic_Model&quot;</span>,</span>
<span id="cb149-151"><a href="#cb149-151" aria-hidden="true" tabindex="-1"></a>                        <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb149-152"><a href="#cb149-152" aria-hidden="true" tabindex="-1"></a>                        <span class="at">legend_label =</span> <span class="st">&quot;Chill per day </span><span class="sc">\n</span><span class="st">(Chill Portions)&quot;</span>) <span class="sc">+</span></span>
<span id="cb149-153"><a href="#cb149-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Chill model sensitivity at Rochester, New York&quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `aes_string()` was deprecated in ggplot2 3.0.0.
â¹ Please use tidy evaluation idioms with `aes()`.
â¹ See also `vignette(&quot;ggplot2-in-packages&quot;)` for more information.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 486 rows containing missing values or values outside the scale range
(`geom_tile()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 847 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-54-4.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb153"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Chill_sensitivity_temps</span>(Model_sensitivities_CNY,</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>                        Rochester_weather,</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">temp_model =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">legend_label =</span> <span class="st">&quot;Heat per day </span><span class="sc">\n</span><span class="st">(GDH)&quot;</span>) <span class="sc">+</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Heat model sensitivity at Rochester, New York&quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 486 rows containing missing values or values outside the scale range
(`geom_tile()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 897 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<hr />
</section>
</section>
<section id="chapter-26-evaluating-pls-outputs" class="level1">
<h1>Chapter 26: Evaluating PLS outputs</h1>
<section id="exercises-on-expected-pls-results" class="level2">
<h2><strong><em>Exercises on expected PLS results</em></strong></h2>
<ol type="1">
<li>Reproduce the analysis for the âRoter Boskoopâ dataset.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb156"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>Roter_first <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Roter_Boskoop_bloom_1958_2019.csv.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, First_bloom) <span class="sc">%&gt;%</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">1</span>, <span class="dv">4</span>)),</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">5</span>, <span class="dv">6</span>)),</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">7</span>, <span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_JDay</span>() <span class="sc">%&gt;%</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, </span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>         JDay) <span class="sc">%&gt;%</span></span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Year =</span> Pheno_year,</span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">pheno =</span> JDay)</span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>temps <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/TMaxTMin1958-2019_patched.csv&quot;</span>)</span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>temps_hourly <span class="ot">&lt;-</span> temps <span class="sc">%&gt;%</span></span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack_hourly_temps</span>(<span class="at">latitude =</span> <span class="fl">43.1</span>)</span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>daychill <span class="ot">&lt;-</span> <span class="fu">daily_chill</span>(<span class="at">hourtemps =</span> temps_hourly,</span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a>                        <span class="at">running_mean =</span> <span class="dv">1</span>,</span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a>                        <span class="at">models =</span> <span class="fu">list</span>(<span class="at">Chilling_Hours =</span> Chilling_Hours,</span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">Utah_Chill_Units =</span> Utah_Model,</span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">Chill_Portions =</span> Dynamic_Model,</span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">GDH =</span> GDH)</span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a>plscf <span class="ot">&lt;-</span> <span class="fu">PLS_chill_force</span>(<span class="at">daily_chill_obj =</span> daychill,</span>
<span id="cb156-31"><a href="#cb156-31" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bio_data_frame =</span> Roter_first,</span>
<span id="cb156-32"><a href="#cb156-32" aria-hidden="true" tabindex="-1"></a>                         <span class="at">split_month =</span> <span class="dv">6</span>,</span>
<span id="cb156-33"><a href="#cb156-33" aria-hidden="true" tabindex="-1"></a>                         <span class="at">chill_models =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb156-34"><a href="#cb156-34" aria-hidden="true" tabindex="-1"></a>                         <span class="at">heat_models =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb156-35"><a href="#cb156-35" aria-hidden="true" tabindex="-1"></a>                         <span class="at">runn_means =</span> <span class="dv">11</span>)</span>
<span id="cb156-36"><a href="#cb156-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-37"><a href="#cb156-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-38"><a href="#cb156-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb156-39"><a href="#cb156-39" aria-hidden="true" tabindex="-1"></a>plot_PLS_chill_force <span class="ot">&lt;-</span> <span class="cf">function</span>(plscf,</span>
<span id="cb156-40"><a href="#cb156-40" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">chill_metric =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb156-41"><a href="#cb156-41" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">heat_metric =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb156-42"><a href="#cb156-42" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">chill_label =</span> <span class="st">&quot;CP&quot;</span>,</span>
<span id="cb156-43"><a href="#cb156-43" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">heat_label =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb156-44"><a href="#cb156-44" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">chill_phase =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>, <span class="dv">62</span>),</span>
<span id="cb156-45"><a href="#cb156-45" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">heat_phase =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="fl">105.5</span>))</span>
<span id="cb156-46"><a href="#cb156-46" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb156-47"><a href="#cb156-47" aria-hidden="true" tabindex="-1"></a>  PLS_gg <span class="ot">&lt;-</span> plscf[[chill_metric]][[heat_metric]]<span class="sc">$</span>PLS_summary <span class="sc">%&gt;%</span></span>
<span id="cb156-48"><a href="#cb156-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">trunc</span>(Date<span class="sc">/</span><span class="dv">100</span>),</span>
<span id="cb156-49"><a href="#cb156-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">Day =</span> Date <span class="sc">-</span> Month <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb156-50"><a href="#cb156-50" aria-hidden="true" tabindex="-1"></a>           <span class="at">Date =</span> <span class="fu">ISOdate</span>(<span class="dv">2002</span>,</span>
<span id="cb156-51"><a href="#cb156-51" aria-hidden="true" tabindex="-1"></a>                          Month,</span>
<span id="cb156-52"><a href="#cb156-52" aria-hidden="true" tabindex="-1"></a>                          Day))</span>
<span id="cb156-53"><a href="#cb156-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-54"><a href="#cb156-54" aria-hidden="true" tabindex="-1"></a>  PLS_gg[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>,<span class="st">&quot;Date&quot;</span>]<span class="ot">&lt;-</span></span>
<span id="cb156-55"><a href="#cb156-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-56"><a href="#cb156-56" aria-hidden="true" tabindex="-1"></a>            PLS_gg<span class="sc">$</span>Month[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>],</span>
<span id="cb156-57"><a href="#cb156-57" aria-hidden="true" tabindex="-1"></a>            PLS_gg<span class="sc">$</span>Day[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>])</span>
<span id="cb156-58"><a href="#cb156-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-59"><a href="#cb156-59" aria-hidden="true" tabindex="-1"></a>  PLS_gg <span class="ot">&lt;-</span> PLS_gg <span class="sc">%&gt;%</span></span>
<span id="cb156-60"><a href="#cb156-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">VIP_importance =</span> VIP <span class="sc">&gt;=</span> <span class="fl">0.8</span>,</span>
<span id="cb156-61"><a href="#cb156-61" aria-hidden="true" tabindex="-1"></a>           <span class="at">VIP_Coeff =</span> <span class="fu">factor</span>(<span class="fu">sign</span>(Coef) <span class="sc">*</span> VIP_importance))</span>
<span id="cb156-62"><a href="#cb156-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-63"><a href="#cb156-63" aria-hidden="true" tabindex="-1"></a>  chill_start_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-64"><a href="#cb156-64" aria-hidden="true" tabindex="-1"></a>                              <span class="dv">12</span>,</span>
<span id="cb156-65"><a href="#cb156-65" aria-hidden="true" tabindex="-1"></a>                              <span class="dv">31</span>) <span class="sc">+</span> chill_phase[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb156-66"><a href="#cb156-66" aria-hidden="true" tabindex="-1"></a>  chill_end_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-67"><a href="#cb156-67" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb156-68"><a href="#cb156-68" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> chill_phase[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb156-69"><a href="#cb156-69" aria-hidden="true" tabindex="-1"></a>  heat_start_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-70"><a href="#cb156-70" aria-hidden="true" tabindex="-1"></a>                             <span class="dv">12</span>,</span>
<span id="cb156-71"><a href="#cb156-71" aria-hidden="true" tabindex="-1"></a>                             <span class="dv">31</span>) <span class="sc">+</span> heat_phase[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb156-72"><a href="#cb156-72" aria-hidden="true" tabindex="-1"></a>  heat_end_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-73"><a href="#cb156-73" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">12</span>,</span>
<span id="cb156-74"><a href="#cb156-74" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">31</span>) <span class="sc">+</span> heat_phase[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb156-75"><a href="#cb156-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-76"><a href="#cb156-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-77"><a href="#cb156-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-78"><a href="#cb156-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-79"><a href="#cb156-79" aria-hidden="true" tabindex="-1"></a>  temp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg) <span class="sc">+</span></span>
<span id="cb156-80"><a href="#cb156-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb156-81"><a href="#cb156-81" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb156-82"><a href="#cb156-82" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb156-83"><a href="#cb156-83" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb156-84"><a href="#cb156-84" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb156-85"><a href="#cb156-85" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb156-86"><a href="#cb156-86" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-87"><a href="#cb156-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb156-88"><a href="#cb156-88" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb156-89"><a href="#cb156-89" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb156-90"><a href="#cb156-90" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb156-91"><a href="#cb156-91" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb156-92"><a href="#cb156-92" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb156-93"><a href="#cb156-93" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-94"><a href="#cb156-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb156-95"><a href="#cb156-95" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-96"><a href="#cb156-96" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb156-97"><a href="#cb156-97" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb156-98"><a href="#cb156-98" aria-hidden="true" tabindex="-1"></a>               <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb156-99"><a href="#cb156-99" aria-hidden="true" tabindex="-1"></a>                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb156-100"><a href="#cb156-100" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-101"><a href="#cb156-101" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb156-102"><a href="#cb156-102" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb156-103"><a href="#cb156-103" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb156-104"><a href="#cb156-104" aria-hidden="true" tabindex="-1"></a>                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb156-105"><a href="#cb156-105" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb156-106"><a href="#cb156-106" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb156-107"><a href="#cb156-107" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb156-108"><a href="#cb156-108" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-109"><a href="#cb156-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-110"><a href="#cb156-110" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">12</span>,</span>
<span id="cb156-111"><a href="#cb156-111" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb156-112"><a href="#cb156-112" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb156-113"><a href="#cb156-113" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb156-114"><a href="#cb156-114" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-115"><a href="#cb156-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb156-116"><a href="#cb156-116" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev ,</span>
<span id="cb156-117"><a href="#cb156-117" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev ),</span>
<span id="cb156-118"><a href="#cb156-118" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-119"><a href="#cb156-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb156-120"><a href="#cb156-120" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb156-121"><a href="#cb156-121" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb156-122"><a href="#cb156-122" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-123"><a href="#cb156-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb156-124"><a href="#cb156-124" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb156-125"><a href="#cb156-125" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>)),</span>
<span id="cb156-126"><a href="#cb156-126" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;dark green&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-127"><a href="#cb156-127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb156-128"><a href="#cb156-128" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> MetricMean)) <span class="sc">+</span></span>
<span id="cb156-129"><a href="#cb156-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type),</span>
<span id="cb156-130"><a href="#cb156-130" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>,</span>
<span id="cb156-131"><a href="#cb156-131" aria-hidden="true" tabindex="-1"></a>               <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb156-132"><a href="#cb156-132" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> </span>
<span id="cb156-133"><a href="#cb156-133" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">labeller</span>(</span>
<span id="cb156-134"><a href="#cb156-134" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Type =</span></span>
<span id="cb156-135"><a href="#cb156-135" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="at">Chill =</span> <span class="fu">paste0</span>(<span class="st">&quot;Chill (&quot;</span>,</span>
<span id="cb156-136"><a href="#cb156-136" aria-hidden="true" tabindex="-1"></a>                                                  chill_label,</span>
<span id="cb156-137"><a href="#cb156-137" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">&quot;)&quot;</span>),</span>
<span id="cb156-138"><a href="#cb156-138" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Heat =</span> <span class="fu">paste0</span>(<span class="st">&quot;Heat (&quot;</span>,</span>
<span id="cb156-139"><a href="#cb156-139" aria-hidden="true" tabindex="-1"></a>                                                 heat_label,</span>
<span id="cb156-140"><a href="#cb156-140" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">&quot;)&quot;</span>))))) <span class="sc">+</span></span>
<span id="cb156-141"><a href="#cb156-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Daily chill and heat accumulation rates&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-142"><a href="#cb156-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb156-143"><a href="#cb156-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb156-144"><a href="#cb156-144" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb156-145"><a href="#cb156-145" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb156-146"><a href="#cb156-146" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb156-147"><a href="#cb156-147" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb156-148"><a href="#cb156-148" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb156-149"><a href="#cb156-149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-150"><a href="#cb156-150" aria-hidden="true" tabindex="-1"></a>  VIP_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb156-151"><a href="#cb156-151" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb156-152"><a href="#cb156-152" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> VIP)) <span class="sc">+</span></span>
<span id="cb156-153"><a href="#cb156-153" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb156-154"><a href="#cb156-154" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb156-155"><a href="#cb156-155" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb156-156"><a href="#cb156-156" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb156-157"><a href="#cb156-157" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb156-158"><a href="#cb156-158" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb156-159"><a href="#cb156-159" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-160"><a href="#cb156-160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb156-161"><a href="#cb156-161" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb156-162"><a href="#cb156-162" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb156-163"><a href="#cb156-163" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb156-164"><a href="#cb156-164" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb156-165"><a href="#cb156-165" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb156-166"><a href="#cb156-166" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-167"><a href="#cb156-167" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb156-168"><a href="#cb156-168" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-169"><a href="#cb156-169" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb156-170"><a href="#cb156-170" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb156-171"><a href="#cb156-171" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb156-172"><a href="#cb156-172" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-173"><a href="#cb156-173" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb156-174"><a href="#cb156-174" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb156-175"><a href="#cb156-175" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb156-176"><a href="#cb156-176" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb156-177"><a href="#cb156-177" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb156-178"><a href="#cb156-178" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb156-179"><a href="#cb156-179" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-180"><a href="#cb156-180" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-181"><a href="#cb156-181" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">12</span>,</span>
<span id="cb156-182"><a href="#cb156-182" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb156-183"><a href="#cb156-183" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb156-184"><a href="#cb156-184" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-185"><a href="#cb156-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb156-186"><a href="#cb156-186" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> VIP<span class="sc">&gt;</span><span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb156-187"><a href="#cb156-187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type), </span>
<span id="cb156-188"><a href="#cb156-188" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb156-189"><a href="#cb156-189" aria-hidden="true" tabindex="-1"></a>               <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb156-190"><a href="#cb156-190" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> </span>
<span id="cb156-191"><a href="#cb156-191" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">labeller</span>(</span>
<span id="cb156-192"><a href="#cb156-192" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Type =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="at">Chill=</span><span class="st">&quot;VIP for chill&quot;</span>,</span>
<span id="cb156-193"><a href="#cb156-193" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">Heat=</span><span class="st">&quot;VIP for heat&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb156-194"><a href="#cb156-194" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb156-195"><a href="#cb156-195" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,</span>
<span id="cb156-196"><a href="#cb156-196" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">max</span>(plscf[[chill_metric]][[heat_metric]]<span class="sc">$</span>PLS_summary<span class="sc">$</span>VIP))) <span class="sc">+</span></span>
<span id="cb156-197"><a href="#cb156-197" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Variable Importance in the Projection (VIP) scores&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-198"><a href="#cb156-198" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb156-199"><a href="#cb156-199" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb156-200"><a href="#cb156-200" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb156-201"><a href="#cb156-201" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb156-202"><a href="#cb156-202" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb156-203"><a href="#cb156-203" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb156-204"><a href="#cb156-204" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb156-205"><a href="#cb156-205" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;VIP&quot;</span>, </span>
<span id="cb156-206"><a href="#cb156-206" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;0.8&quot;</span>, <span class="st">&quot;&gt;0.8&quot;</span>), </span>
<span id="cb156-207"><a href="#cb156-207" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;FALSE&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb156-208"><a href="#cb156-208" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;TRUE&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb156-209"><a href="#cb156-209" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb156-210"><a href="#cb156-210" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb156-211"><a href="#cb156-211" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb156-212"><a href="#cb156-212" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb156-213"><a href="#cb156-213" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-214"><a href="#cb156-214" aria-hidden="true" tabindex="-1"></a>  coeff_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb156-215"><a href="#cb156-215" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb156-216"><a href="#cb156-216" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y =</span> Coef)) <span class="sc">+</span></span>
<span id="cb156-217"><a href="#cb156-217" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb156-218"><a href="#cb156-218" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb156-219"><a href="#cb156-219" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb156-220"><a href="#cb156-220" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb156-221"><a href="#cb156-221" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb156-222"><a href="#cb156-222" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb156-223"><a href="#cb156-223" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-224"><a href="#cb156-224" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb156-225"><a href="#cb156-225" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb156-226"><a href="#cb156-226" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb156-227"><a href="#cb156-227" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb156-228"><a href="#cb156-228" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb156-229"><a href="#cb156-229" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb156-230"><a href="#cb156-230" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-231"><a href="#cb156-231" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb156-232"><a href="#cb156-232" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-233"><a href="#cb156-233" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb156-234"><a href="#cb156-234" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb156-235"><a href="#cb156-235" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb156-236"><a href="#cb156-236" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-237"><a href="#cb156-237" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb156-238"><a href="#cb156-238" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb156-239"><a href="#cb156-239" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb156-240"><a href="#cb156-240" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb156-241"><a href="#cb156-241" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb156-242"><a href="#cb156-242" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb156-243"><a href="#cb156-243" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-244"><a href="#cb156-244" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb156-245"><a href="#cb156-245" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">12</span>,</span>
<span id="cb156-246"><a href="#cb156-246" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb156-247"><a href="#cb156-247" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb156-248"><a href="#cb156-248" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-249"><a href="#cb156-249" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb156-250"><a href="#cb156-250" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> VIP_Coeff)) <span class="sc">+</span></span>
<span id="cb156-251"><a href="#cb156-251" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type),</span>
<span id="cb156-252"><a href="#cb156-252" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb156-253"><a href="#cb156-253" aria-hidden="true" tabindex="-1"></a>               <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb156-254"><a href="#cb156-254" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span></span>
<span id="cb156-255"><a href="#cb156-255" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">labeller</span>(</span>
<span id="cb156-256"><a href="#cb156-256" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Type =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="at">Chill =</span> <span class="st">&quot;MC for chill&quot;</span>,</span>
<span id="cb156-257"><a href="#cb156-257" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">Heat =</span> <span class="st">&quot;MC for heat&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb156-258"><a href="#cb156-258" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb156-259"><a href="#cb156-259" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">min</span>(plscf[[chill_metric]][[heat_metric]]<span class="sc">$</span>PLS_summary<span class="sc">$</span>Coef),</span>
<span id="cb156-260"><a href="#cb156-260" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">max</span>(plscf[[chill_metric]][[heat_metric]]<span class="sc">$</span>PLS_summary<span class="sc">$</span>Coef))) <span class="sc">+</span></span>
<span id="cb156-261"><a href="#cb156-261" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Model coefficients (MC)&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-262"><a href="#cb156-262" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb156-263"><a href="#cb156-263" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb156-264"><a href="#cb156-264" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb156-265"><a href="#cb156-265" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb156-266"><a href="#cb156-266" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb156-267"><a href="#cb156-267" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb156-268"><a href="#cb156-268" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb156-269"><a href="#cb156-269" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Effect direction&quot;</span>, </span>
<span id="cb156-270"><a href="#cb156-270" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Advancing&quot;</span>,</span>
<span id="cb156-271"><a href="#cb156-271" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Unimportant&quot;</span>,</span>
<span id="cb156-272"><a href="#cb156-272" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Delaying&quot;</span>), </span>
<span id="cb156-273"><a href="#cb156-273" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;-1&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb156-274"><a href="#cb156-274" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb156-275"><a href="#cb156-275" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;dark green&quot;</span>)) <span class="sc">+</span></span>
<span id="cb156-276"><a href="#cb156-276" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;PLS coefficient&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-277"><a href="#cb156-277" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb156-278"><a href="#cb156-278" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb156-279"><a href="#cb156-279" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb156-280"><a href="#cb156-280" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb156-281"><a href="#cb156-281" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-282"><a href="#cb156-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(patchwork)</span>
<span id="cb156-283"><a href="#cb156-283" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-284"><a href="#cb156-284" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> (VIP_plot <span class="sc">+</span></span>
<span id="cb156-285"><a href="#cb156-285" aria-hidden="true" tabindex="-1"></a>             coeff_plot <span class="sc">+</span></span>
<span id="cb156-286"><a href="#cb156-286" aria-hidden="true" tabindex="-1"></a>             temp_plot <span class="sc">+</span></span>
<span id="cb156-287"><a href="#cb156-287" aria-hidden="true" tabindex="-1"></a>             <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb156-288"><a href="#cb156-288" aria-hidden="true" tabindex="-1"></a>                         <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>)</span>
<span id="cb156-289"><a href="#cb156-289" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb156-290"><a href="#cb156-290" aria-hidden="true" tabindex="-1"></a>                     <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb156-291"><a href="#cb156-291" aria-hidden="true" tabindex="-1"></a>                     <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb156-292"><a href="#cb156-292" aria-hidden="true" tabindex="-1"></a>                     <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb156-293"><a href="#cb156-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-294"><a href="#cb156-294" aria-hidden="true" tabindex="-1"></a>plot</span>
<span id="cb156-295"><a href="#cb156-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-296"><a href="#cb156-296" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb156-297"><a href="#cb156-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-298"><a href="#cb156-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-299"><a href="#cb156-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-300"><a href="#cb156-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-301"><a href="#cb156-301" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS_chill_force</span>(plscf,</span>
<span id="cb156-302"><a href="#cb156-302" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_metric =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb156-303"><a href="#cb156-303" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_metric =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb156-304"><a href="#cb156-304" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_label =</span> <span class="st">&quot;CP&quot;</span>,</span>
<span id="cb156-305"><a href="#cb156-305" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_label =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb156-306"><a href="#cb156-306" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_phase =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>, <span class="dv">62</span>),</span>
<span id="cb156-307"><a href="#cb156-307" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_phase =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="fl">105.5</span>))</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb157"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>chill_phase <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">317</span>, <span class="dv">62</span>)</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>heat_phase <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">360</span>, <span class="fl">105.5</span>)</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>chill <span class="ot">&lt;-</span> <span class="fu">tempResponse</span>(<span class="at">hourtemps =</span> temps_hourly,</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Start_JDay =</span> chill_phase[<span class="dv">1</span>],</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">End_JDay =</span> chill_phase[<span class="dv">2</span>],</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">models =</span> <span class="fu">list</span>(<span class="at">Chill_Portions =</span> Dynamic_Model),</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">misstolerance =</span> <span class="dv">10</span>)</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>heat <span class="ot">&lt;-</span> <span class="fu">tempResponse</span>(<span class="at">hourtemps =</span> temps_hourly,</span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Start_JDay =</span> heat_phase[<span class="dv">1</span>],</span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">End_JDay =</span> heat_phase[<span class="dv">2</span>],</span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">models =</span> <span class="fu">list</span>(<span class="at">GDH =</span> GDH))</span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> chill,</span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Chill_Portions)) <span class="sc">+</span></span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Chill accumulation during endodormancy (Chill Portions)&quot;</span>) <span class="sc">+</span></span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Chill accumulation (Chill Portions)&quot;</span>) <span class="sc">+</span></span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Frequency between 1958 and 2019&quot;</span>) <span class="sc">+</span></span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> heat,</span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> GDH)) <span class="sc">+</span></span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Heat accumulation during ecodormancy (GDH)&quot;</span>) <span class="sc">+</span></span>
<span id="cb157-28"><a href="#cb157-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Heat accumulation (Growing Degree Hours)&quot;</span>) <span class="sc">+</span></span>
<span id="cb157-29"><a href="#cb157-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Frequency between 1958 and 2019&quot;</span>) <span class="sc">+</span></span>
<span id="cb157-30"><a href="#cb157-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb157-31"><a href="#cb157-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-32"><a href="#cb157-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-33"><a href="#cb157-33" aria-hidden="true" tabindex="-1"></a>chill_requirement <span class="ot">&lt;-</span> <span class="fu">mean</span>(chill<span class="sc">$</span>Chill_Portions)</span>
<span id="cb157-34"><a href="#cb157-34" aria-hidden="true" tabindex="-1"></a>chill_req_error <span class="ot">&lt;-</span> <span class="fu">sd</span>(chill<span class="sc">$</span>Chill_Portions)</span>
<span id="cb157-35"><a href="#cb157-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-36"><a href="#cb157-36" aria-hidden="true" tabindex="-1"></a>chill_nonpara <span class="ot">&lt;-</span> <span class="fu">quantile</span>(chill<span class="sc">$</span>Chill_Portions,</span>
<span id="cb157-37"><a href="#cb157-37" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb157-38"><a href="#cb157-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-39"><a href="#cb157-39" aria-hidden="true" tabindex="-1"></a>heat_requirement <span class="ot">&lt;-</span> <span class="fu">mean</span>(heat<span class="sc">$</span>GDH)</span>
<span id="cb157-40"><a href="#cb157-40" aria-hidden="true" tabindex="-1"></a>heat_req_error <span class="ot">&lt;-</span> <span class="fu">sd</span>(heat<span class="sc">$</span>GDH)</span>
<span id="cb157-41"><a href="#cb157-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-42"><a href="#cb157-42" aria-hidden="true" tabindex="-1"></a>heat_nonpara <span class="ot">&lt;-</span> <span class="fu">quantile</span>(heat<span class="sc">$</span>GDH,</span>
<span id="cb157-43"><a href="#cb157-43" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb157-44"><a href="#cb157-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-45"><a href="#cb157-45" aria-hidden="true" tabindex="-1"></a>chill_phase <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">317</span>, <span class="dv">62</span>)</span>
<span id="cb157-46"><a href="#cb157-46" aria-hidden="true" tabindex="-1"></a>heat_phase <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">360</span>, <span class="dv">106</span>)</span>
<span id="cb157-47"><a href="#cb157-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-48"><a href="#cb157-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-49"><a href="#cb157-49" aria-hidden="true" tabindex="-1"></a>mpt <span class="ot">&lt;-</span> <span class="fu">make_pheno_trend_plot</span>(<span class="at">weather_data_frame =</span> temps,</span>
<span id="cb157-50"><a href="#cb157-50" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pheno =</span> Roter_first,</span>
<span id="cb157-51"><a href="#cb157-51" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Start_JDay_chill =</span> chill_phase[<span class="dv">1</span>],</span>
<span id="cb157-52"><a href="#cb157-52" aria-hidden="true" tabindex="-1"></a>                             <span class="at">End_JDay_chill =</span> chill_phase[<span class="dv">2</span>],</span>
<span id="cb157-53"><a href="#cb157-53" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Start_JDay_heat =</span> heat_phase[<span class="dv">1</span>],</span>
<span id="cb157-54"><a href="#cb157-54" aria-hidden="true" tabindex="-1"></a>                             <span class="at">End_JDay_heat =</span> heat_phase[<span class="dv">2</span>],</span>
<span id="cb157-55"><a href="#cb157-55" aria-hidden="true" tabindex="-1"></a>                             <span class="at">outpath =</span> <span class="st">&quot;data/&quot;</span>,</span>
<span id="cb157-56"><a href="#cb157-56" aria-hidden="true" tabindex="-1"></a>                             <span class="at">file_name =</span> <span class="st">&quot;pheno_trend_plot&quot;</span>,</span>
<span id="cb157-57"><a href="#cb157-57" aria-hidden="true" tabindex="-1"></a>                             <span class="at">plot_title =</span>  <span class="st">&quot;Impacts of chilling and forcing temperatures on pear phenology&quot;</span>,</span>
<span id="cb157-58"><a href="#cb157-58" aria-hidden="true" tabindex="-1"></a>                             <span class="at">image_type =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb157-59"><a href="#cb157-59" aria-hidden="true" tabindex="-1"></a>                             <span class="at">colorscheme =</span> <span class="st">&quot;normal&quot;</span>)</span>
<span id="cb157-60"><a href="#cb157-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-61"><a href="#cb157-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-62"><a href="#cb157-62" aria-hidden="true" tabindex="-1"></a>mean_temp_period <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb157-63"><a href="#cb157-63" aria-hidden="true" tabindex="-1"></a>    temps,</span>
<span id="cb157-64"><a href="#cb157-64" aria-hidden="true" tabindex="-1"></a>    start_JDay,</span>
<span id="cb157-65"><a href="#cb157-65" aria-hidden="true" tabindex="-1"></a>    end_JDay,</span>
<span id="cb157-66"><a href="#cb157-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_season =</span> end_JDay)</span>
<span id="cb157-67"><a href="#cb157-67" aria-hidden="true" tabindex="-1"></a>{ temps_JDay <span class="ot">&lt;-</span> <span class="fu">make_JDay</span>(temps) <span class="sc">%&gt;%</span></span>
<span id="cb157-68"><a href="#cb157-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Season =</span>Year)</span>
<span id="cb157-69"><a href="#cb157-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-70"><a href="#cb157-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(start_JDay <span class="sc">&gt;</span> end_season)</span>
<span id="cb157-71"><a href="#cb157-71" aria-hidden="true" tabindex="-1"></a>    temps_JDay<span class="sc">$</span>Season[<span class="fu">which</span>(temps_JDay<span class="sc">$</span>JDay <span class="sc">&gt;=</span> start_JDay)]<span class="ot">&lt;-</span></span>
<span id="cb157-72"><a href="#cb157-72" aria-hidden="true" tabindex="-1"></a>        temps_JDay<span class="sc">$</span>Year[<span class="fu">which</span>(temps_JDay<span class="sc">$</span>JDay <span class="sc">&gt;=</span> start_JDay)]<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb157-73"><a href="#cb157-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-74"><a href="#cb157-74" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(start_JDay <span class="sc">&gt;</span> end_season)</span>
<span id="cb157-75"><a href="#cb157-75" aria-hidden="true" tabindex="-1"></a>    sub_temps <span class="ot">&lt;-</span> <span class="fu">subset</span>(temps_JDay,</span>
<span id="cb157-76"><a href="#cb157-76" aria-hidden="true" tabindex="-1"></a>                        JDay <span class="sc">&lt;=</span> end_JDay <span class="sc">|</span> JDay <span class="sc">&gt;=</span> start_JDay)</span>
<span id="cb157-77"><a href="#cb157-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-78"><a href="#cb157-78" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(start_JDay <span class="sc">&lt;=</span> end_JDay)</span>
<span id="cb157-79"><a href="#cb157-79" aria-hidden="true" tabindex="-1"></a>    sub_temps <span class="ot">&lt;-</span> <span class="fu">subset</span>(temps_JDay,</span>
<span id="cb157-80"><a href="#cb157-80" aria-hidden="true" tabindex="-1"></a>                        JDay <span class="sc">&lt;=</span> end_JDay <span class="sc">&amp;</span> JDay <span class="sc">&gt;=</span> start_JDay)</span>
<span id="cb157-81"><a href="#cb157-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-82"><a href="#cb157-82" aria-hidden="true" tabindex="-1"></a>  mean_temps <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(sub_temps[, <span class="fu">c</span>(<span class="st">&quot;Tmin&quot;</span>, <span class="st">&quot;Tmax&quot;</span>)],</span>
<span id="cb157-83"><a href="#cb157-83" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by =</span> <span class="fu">list</span>(sub_temps<span class="sc">$</span>Season),</span>
<span id="cb157-84"><a href="#cb157-84" aria-hidden="true" tabindex="-1"></a>                          <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x,</span>
<span id="cb157-85"><a href="#cb157-85" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb157-86"><a href="#cb157-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-87"><a href="#cb157-87" aria-hidden="true" tabindex="-1"></a>  mean_temps[, <span class="st">&quot;n_days&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(sub_temps[, <span class="st">&quot;Tmin&quot;</span>],</span>
<span id="cb157-88"><a href="#cb157-88" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">by =</span> <span class="fu">list</span>(sub_temps<span class="sc">$</span>Season),</span>
<span id="cb157-89"><a href="#cb157-89" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">FUN =</span> length)[,<span class="dv">2</span>]</span>
<span id="cb157-90"><a href="#cb157-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-91"><a href="#cb157-91" aria-hidden="true" tabindex="-1"></a>  mean_temps[, <span class="st">&quot;Tmean&quot;</span>] <span class="ot">&lt;-</span> (mean_temps<span class="sc">$</span>Tmin <span class="sc">+</span> mean_temps<span class="sc">$</span>Tmax) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb157-92"><a href="#cb157-92" aria-hidden="true" tabindex="-1"></a>  mean_temps <span class="ot">&lt;-</span> mean_temps[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>)]</span>
<span id="cb157-93"><a href="#cb157-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(mean_temps)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;End_year&quot;</span></span>
<span id="cb157-94"><a href="#cb157-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-95"><a href="#cb157-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mean_temps)</span>
<span id="cb157-96"><a href="#cb157-96" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb157-97"><a href="#cb157-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-98"><a href="#cb157-98" aria-hidden="true" tabindex="-1"></a>mean_temp_chill <span class="ot">&lt;-</span> <span class="fu">mean_temp_period</span>(<span class="at">temps =</span> temps,</span>
<span id="cb157-99"><a href="#cb157-99" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">start_JDay =</span> chill_phase[<span class="dv">1</span>],</span>
<span id="cb157-100"><a href="#cb157-100" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">end_JDay =</span> chill_phase[<span class="dv">2</span>],</span>
<span id="cb157-101"><a href="#cb157-101" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">end_season =</span> <span class="dv">60</span>)</span>
<span id="cb157-102"><a href="#cb157-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-103"><a href="#cb157-103" aria-hidden="true" tabindex="-1"></a>mean_temp_heat <span class="ot">&lt;-</span> <span class="fu">mean_temp_period</span>(<span class="at">temps =</span> temps,</span>
<span id="cb157-104"><a href="#cb157-104" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">start_JDay =</span> heat_phase[<span class="dv">1</span>],</span>
<span id="cb157-105"><a href="#cb157-105" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">end_JDay =</span> heat_phase[<span class="dv">2</span>],</span>
<span id="cb157-106"><a href="#cb157-106" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">end_season =</span> <span class="dv">60</span>)</span>
<span id="cb157-107"><a href="#cb157-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-108"><a href="#cb157-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-109"><a href="#cb157-109" aria-hidden="true" tabindex="-1"></a>mean_temp_chill <span class="ot">&lt;-</span> </span>
<span id="cb157-110"><a href="#cb157-110" aria-hidden="true" tabindex="-1"></a>  mean_temp_chill[<span class="fu">which</span>(mean_temp_chill<span class="sc">$</span>n_days <span class="sc">&gt;=</span></span>
<span id="cb157-111"><a href="#cb157-111" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">max</span>(mean_temp_chill<span class="sc">$</span>n_days)<span class="sc">-</span><span class="dv">1</span>),]</span>
<span id="cb157-112"><a href="#cb157-112" aria-hidden="true" tabindex="-1"></a>mean_temp_heat <span class="ot">&lt;-</span></span>
<span id="cb157-113"><a href="#cb157-113" aria-hidden="true" tabindex="-1"></a>  mean_temp_heat[<span class="fu">which</span>(mean_temp_heat<span class="sc">$</span>n_days <span class="sc">&gt;=</span></span>
<span id="cb157-114"><a href="#cb157-114" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">max</span>(mean_temp_heat<span class="sc">$</span>n_days)<span class="sc">-</span><span class="dv">1</span>),]</span>
<span id="cb157-115"><a href="#cb157-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-116"><a href="#cb157-116" aria-hidden="true" tabindex="-1"></a>mean_chill <span class="ot">&lt;-</span> mean_temp_chill[, <span class="fu">c</span>(<span class="st">&quot;End_year&quot;</span>,</span>
<span id="cb157-117"><a href="#cb157-117" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;Tmean&quot;</span>)]</span>
<span id="cb157-118"><a href="#cb157-118" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mean_chill)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Tmean_chill&quot;</span></span>
<span id="cb157-119"><a href="#cb157-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-120"><a href="#cb157-120" aria-hidden="true" tabindex="-1"></a>mean_heat <span class="ot">&lt;-</span> mean_temp_heat[,<span class="fu">c</span>(<span class="st">&quot;End_year&quot;</span>,</span>
<span id="cb157-121"><a href="#cb157-121" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Tmean&quot;</span>)]</span>
<span id="cb157-122"><a href="#cb157-122" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mean_heat)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Tmean_heat&quot;</span></span>
<span id="cb157-123"><a href="#cb157-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-124"><a href="#cb157-124" aria-hidden="true" tabindex="-1"></a>phase_Tmeans <span class="ot">&lt;-</span> <span class="fu">merge</span>(mean_chill,</span>
<span id="cb157-125"><a href="#cb157-125" aria-hidden="true" tabindex="-1"></a>                      mean_heat, </span>
<span id="cb157-126"><a href="#cb157-126" aria-hidden="true" tabindex="-1"></a>                      <span class="at">by =</span> <span class="st">&quot;End_year&quot;</span>)</span>
<span id="cb157-127"><a href="#cb157-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-128"><a href="#cb157-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-129"><a href="#cb157-129" aria-hidden="true" tabindex="-1"></a>pheno <span class="ot">&lt;-</span> Roter_first</span>
<span id="cb157-130"><a href="#cb157-130" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pheno)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;End_year&quot;</span></span>
<span id="cb157-131"><a href="#cb157-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-132"><a href="#cb157-132" aria-hidden="true" tabindex="-1"></a>Tmeans_pheno <span class="ot">&lt;-</span> <span class="fu">merge</span>(phase_Tmeans,</span>
<span id="cb157-133"><a href="#cb157-133" aria-hidden="true" tabindex="-1"></a>                      pheno,</span>
<span id="cb157-134"><a href="#cb157-134" aria-hidden="true" tabindex="-1"></a>                      <span class="at">by =</span> <span class="st">&quot;End_year&quot;</span>)</span>
<span id="cb157-135"><a href="#cb157-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-136"><a href="#cb157-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-137"><a href="#cb157-137" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Tmeans_pheno)</span>
<span id="cb157-138"><a href="#cb157-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-139"><a href="#cb157-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-140"><a href="#cb157-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-141"><a href="#cb157-141" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fields)</span>
<span id="cb157-142"><a href="#cb157-142" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">Krig</span>(<span class="at">x =</span> <span class="fu">as.matrix</span>(</span>
<span id="cb157-143"><a href="#cb157-143" aria-hidden="true" tabindex="-1"></a>                Tmeans_pheno[,</span>
<span id="cb157-144"><a href="#cb157-144" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(<span class="st">&quot;Tmean_chill&quot;</span>,</span>
<span id="cb157-145"><a href="#cb157-145" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Tmean_heat&quot;</span>)]),</span>
<span id="cb157-146"><a href="#cb157-146" aria-hidden="true" tabindex="-1"></a>          <span class="at">Y =</span> Tmeans_pheno<span class="sc">$</span>pheno)</span>
<span id="cb157-147"><a href="#cb157-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-148"><a href="#cb157-148" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predictSurface</span>(k)</span>
<span id="cb157-149"><a href="#cb157-149" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pred<span class="sc">$</span>z) <span class="ot">&lt;-</span> pred<span class="sc">$</span>y</span>
<span id="cb157-150"><a href="#cb157-150" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(pred<span class="sc">$</span>z) <span class="ot">&lt;-</span> pred<span class="sc">$</span>x</span>
<span id="cb157-151"><a href="#cb157-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-152"><a href="#cb157-152" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb157-153"><a href="#cb157-153" aria-hidden="true" tabindex="-1"></a>melted <span class="ot">&lt;-</span> <span class="fu">melt</span>(pred<span class="sc">$</span>z)</span>
<span id="cb157-154"><a href="#cb157-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-155"><a href="#cb157-155" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(metR)</span>
<span id="cb157-156"><a href="#cb157-156" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorRamps)</span>
<span id="cb157-157"><a href="#cb157-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-158"><a href="#cb157-158" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(melted) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Tmean_chill&quot;</span>,</span>
<span id="cb157-159"><a href="#cb157-159" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Tmean_heat&quot;</span>,</span>
<span id="cb157-160"><a href="#cb157-160" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span>)</span>
<span id="cb157-161"><a href="#cb157-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-162"><a href="#cb157-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-163"><a href="#cb157-163" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(melted,</span>
<span id="cb157-164"><a href="#cb157-164" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Tmean_chill,</span>
<span id="cb157-165"><a href="#cb157-165" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Tmean_heat,</span>
<span id="cb157-166"><a href="#cb157-166" aria-hidden="true" tabindex="-1"></a>           <span class="at">z =</span> value)) <span class="sc">+</span></span>
<span id="cb157-167"><a href="#cb157-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour_fill</span>(<span class="at">bins =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb157-168"><a href="#cb157-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">alpha</span>(<span class="fu">matlab.like</span>(<span class="dv">15</span>)),</span>
<span id="cb157-169"><a href="#cb157-169" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">&quot;Bloom date </span><span class="sc">\n</span><span class="st">(day of the year)&quot;</span>) <span class="sc">+</span></span>
<span id="cb157-170"><a href="#cb157-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">col =</span> <span class="st">&quot;black&quot;</span>)  <span class="sc">+</span></span>
<span id="cb157-171"><a href="#cb157-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> Tmeans_pheno,</span>
<span id="cb157-172"><a href="#cb157-172" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Tmean_chill,</span>
<span id="cb157-173"><a href="#cb157-173" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> Tmean_heat,</span>
<span id="cb157-174"><a href="#cb157-174" aria-hidden="true" tabindex="-1"></a>                 <span class="at">z =</span> <span class="cn">NULL</span>),</span>
<span id="cb157-175"><a href="#cb157-175" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb157-176"><a href="#cb157-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_contour</span>(<span class="at">stroke =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb157-177"><a href="#cb157-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Forcing phase &quot;</span>, </span>
<span id="cb157-178"><a href="#cb157-178" aria-hidden="true" tabindex="-1"></a>                        T[mean],</span>
<span id="cb157-179"><a href="#cb157-179" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot; (&quot;</span>,</span>
<span id="cb157-180"><a href="#cb157-180" aria-hidden="true" tabindex="-1"></a>                        degree,</span>
<span id="cb157-181"><a href="#cb157-181" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;C)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb157-182"><a href="#cb157-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Chilling phase &quot;</span>,</span>
<span id="cb157-183"><a href="#cb157-183" aria-hidden="true" tabindex="-1"></a>                        T[mean],</span>
<span id="cb157-184"><a href="#cb157-184" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot; (&quot;</span>,</span>
<span id="cb157-185"><a href="#cb157-185" aria-hidden="true" tabindex="-1"></a>                        degree,</span>
<span id="cb157-186"><a href="#cb157-186" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;C)&quot;</span>)))  <span class="sc">+</span></span>
<span id="cb157-187"><a href="#cb157-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span>
<span id="cb157-188"><a href="#cb157-188" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-189"><a href="#cb157-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-190"><a href="#cb157-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-191"><a href="#cb157-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-192"><a href="#cb157-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-193"><a href="#cb157-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-194"><a href="#cb157-194" aria-hidden="true" tabindex="-1"></a>pheno_trend_ggplot <span class="ot">&lt;-</span> <span class="cf">function</span>(temps,</span>
<span id="cb157-195"><a href="#cb157-195" aria-hidden="true" tabindex="-1"></a>                               pheno,</span>
<span id="cb157-196"><a href="#cb157-196" aria-hidden="true" tabindex="-1"></a>                               chill_phase,</span>
<span id="cb157-197"><a href="#cb157-197" aria-hidden="true" tabindex="-1"></a>                               heat_phase,</span>
<span id="cb157-198"><a href="#cb157-198" aria-hidden="true" tabindex="-1"></a>                               <span class="at">phenology_stage =</span> <span class="st">&quot;Bloom&quot;</span>)</span>
<span id="cb157-199"><a href="#cb157-199" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb157-200"><a href="#cb157-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(fields)</span>
<span id="cb157-201"><a href="#cb157-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(reshape2)</span>
<span id="cb157-202"><a href="#cb157-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(metR)</span>
<span id="cb157-203"><a href="#cb157-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb157-204"><a href="#cb157-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(colorRamps)</span>
<span id="cb157-205"><a href="#cb157-205" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-206"><a href="#cb157-206" aria-hidden="true" tabindex="-1"></a>  mean_temp_period <span class="ot">&lt;-</span> <span class="cf">function</span>(temps,</span>
<span id="cb157-207"><a href="#cb157-207" aria-hidden="true" tabindex="-1"></a>                               start_JDay,</span>
<span id="cb157-208"><a href="#cb157-208" aria-hidden="true" tabindex="-1"></a>                               end_JDay, </span>
<span id="cb157-209"><a href="#cb157-209" aria-hidden="true" tabindex="-1"></a>                               <span class="at">end_season =</span> end_JDay)</span>
<span id="cb157-210"><a href="#cb157-210" aria-hidden="true" tabindex="-1"></a>    { temps_JDay <span class="ot">&lt;-</span> <span class="fu">make_JDay</span>(temps) <span class="sc">%&gt;%</span></span>
<span id="cb157-211"><a href="#cb157-211" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Season =</span> Year)</span>
<span id="cb157-212"><a href="#cb157-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-213"><a href="#cb157-213" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(start_JDay <span class="sc">&gt;</span> end_season)</span>
<span id="cb157-214"><a href="#cb157-214" aria-hidden="true" tabindex="-1"></a>      temps_JDay<span class="sc">$</span>Season[<span class="fu">which</span>(temps_JDay<span class="sc">$</span>JDay <span class="sc">&gt;=</span> start_JDay)] <span class="ot">&lt;-</span></span>
<span id="cb157-215"><a href="#cb157-215" aria-hidden="true" tabindex="-1"></a>        temps_JDay<span class="sc">$</span>Year[<span class="fu">which</span>(temps_JDay<span class="sc">$</span>JDay <span class="sc">&gt;=</span> start_JDay)]<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb157-216"><a href="#cb157-216" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-217"><a href="#cb157-217" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(start_JDay <span class="sc">&gt;</span> end_season)</span>
<span id="cb157-218"><a href="#cb157-218" aria-hidden="true" tabindex="-1"></a>      sub_temps <span class="ot">&lt;-</span> <span class="fu">subset</span>(temps_JDay,</span>
<span id="cb157-219"><a href="#cb157-219" aria-hidden="true" tabindex="-1"></a>                          JDay <span class="sc">&lt;=</span> end_JDay <span class="sc">|</span> JDay <span class="sc">&gt;=</span> start_JDay)</span>
<span id="cb157-220"><a href="#cb157-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-221"><a href="#cb157-221" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(start_JDay <span class="sc">&lt;=</span> end_JDay)</span>
<span id="cb157-222"><a href="#cb157-222" aria-hidden="true" tabindex="-1"></a>      sub_temps <span class="ot">&lt;-</span> <span class="fu">subset</span>(temps_JDay,</span>
<span id="cb157-223"><a href="#cb157-223" aria-hidden="true" tabindex="-1"></a>                          JDay <span class="sc">&lt;=</span> end_JDay <span class="sc">&amp;</span> JDay <span class="sc">&gt;=</span> start_JDay)</span>
<span id="cb157-224"><a href="#cb157-224" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-225"><a href="#cb157-225" aria-hidden="true" tabindex="-1"></a>    mean_temps <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(sub_temps[,</span>
<span id="cb157-226"><a href="#cb157-226" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">c</span>(<span class="st">&quot;Tmin&quot;</span>,</span>
<span id="cb157-227"><a href="#cb157-227" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;Tmax&quot;</span>)],</span>
<span id="cb157-228"><a href="#cb157-228" aria-hidden="true" tabindex="-1"></a>                            <span class="at">by =</span> <span class="fu">list</span>(sub_temps<span class="sc">$</span>Season),</span>
<span id="cb157-229"><a href="#cb157-229" aria-hidden="true" tabindex="-1"></a>                            <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x,</span>
<span id="cb157-230"><a href="#cb157-230" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb157-231"><a href="#cb157-231" aria-hidden="true" tabindex="-1"></a>    mean_temps[, <span class="st">&quot;n_days&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(sub_temps[,</span>
<span id="cb157-232"><a href="#cb157-232" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">&quot;Tmin&quot;</span>],</span>
<span id="cb157-233"><a href="#cb157-233" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">by =</span> <span class="fu">list</span>(sub_temps<span class="sc">$</span>Season),</span>
<span id="cb157-234"><a href="#cb157-234" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">FUN =</span> length)[,<span class="dv">2</span>]</span>
<span id="cb157-235"><a href="#cb157-235" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-236"><a href="#cb157-236" aria-hidden="true" tabindex="-1"></a>    mean_temps[,<span class="st">&quot;Tmean&quot;</span>] <span class="ot">&lt;-</span> (mean_temps<span class="sc">$</span>Tmin <span class="sc">+</span> mean_temps<span class="sc">$</span>Tmax) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb157-237"><a href="#cb157-237" aria-hidden="true" tabindex="-1"></a>    mean_temps <span class="ot">&lt;-</span> mean_temps[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>)]</span>
<span id="cb157-238"><a href="#cb157-238" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(mean_temps)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;End_year&quot;</span></span>
<span id="cb157-239"><a href="#cb157-239" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(mean_temps)</span>
<span id="cb157-240"><a href="#cb157-240" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb157-241"><a href="#cb157-241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-242"><a href="#cb157-242" aria-hidden="true" tabindex="-1"></a>  mean_temp_chill <span class="ot">&lt;-</span> <span class="fu">mean_temp_period</span>(<span class="at">temps =</span> temps,</span>
<span id="cb157-243"><a href="#cb157-243" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">start_JDay =</span> chill_phase[<span class="dv">1</span>],</span>
<span id="cb157-244"><a href="#cb157-244" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">end_JDay =</span> chill_phase[<span class="dv">2</span>],</span>
<span id="cb157-245"><a href="#cb157-245" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">end_season =</span> heat_phase[<span class="dv">2</span>])</span>
<span id="cb157-246"><a href="#cb157-246" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-247"><a href="#cb157-247" aria-hidden="true" tabindex="-1"></a>  mean_temp_heat <span class="ot">&lt;-</span> <span class="fu">mean_temp_period</span>(<span class="at">temps =</span> temps,</span>
<span id="cb157-248"><a href="#cb157-248" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">start_JDay =</span> heat_phase[<span class="dv">1</span>],</span>
<span id="cb157-249"><a href="#cb157-249" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">end_JDay =</span> heat_phase[<span class="dv">2</span>],</span>
<span id="cb157-250"><a href="#cb157-250" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">end_season =</span> heat_phase[<span class="dv">2</span>])</span>
<span id="cb157-251"><a href="#cb157-251" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-252"><a href="#cb157-252" aria-hidden="true" tabindex="-1"></a>  mean_temp_chill <span class="ot">&lt;-</span></span>
<span id="cb157-253"><a href="#cb157-253" aria-hidden="true" tabindex="-1"></a>    mean_temp_chill[<span class="fu">which</span>(mean_temp_chill<span class="sc">$</span>n_days <span class="sc">&gt;=</span> </span>
<span id="cb157-254"><a href="#cb157-254" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">max</span>(mean_temp_chill<span class="sc">$</span>n_days)<span class="sc">-</span><span class="dv">1</span>),]</span>
<span id="cb157-255"><a href="#cb157-255" aria-hidden="true" tabindex="-1"></a>  mean_temp_heat <span class="ot">&lt;-</span></span>
<span id="cb157-256"><a href="#cb157-256" aria-hidden="true" tabindex="-1"></a>    mean_temp_heat[<span class="fu">which</span>(mean_temp_heat<span class="sc">$</span>n_days <span class="sc">&gt;=</span> </span>
<span id="cb157-257"><a href="#cb157-257" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">max</span>(mean_temp_heat<span class="sc">$</span>n_days)<span class="sc">-</span><span class="dv">1</span>),]</span>
<span id="cb157-258"><a href="#cb157-258" aria-hidden="true" tabindex="-1"></a>  mean_chill <span class="ot">&lt;-</span> mean_temp_chill[, <span class="fu">c</span>(<span class="st">&quot;End_year&quot;</span>,</span>
<span id="cb157-259"><a href="#cb157-259" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Tmean&quot;</span>)]</span>
<span id="cb157-260"><a href="#cb157-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(mean_chill)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Tmean_chill&quot;</span></span>
<span id="cb157-261"><a href="#cb157-261" aria-hidden="true" tabindex="-1"></a>  mean_heat<span class="ot">&lt;-</span>mean_temp_heat[,<span class="fu">c</span>(<span class="st">&quot;End_year&quot;</span>,</span>
<span id="cb157-262"><a href="#cb157-262" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Tmean&quot;</span>)]</span>
<span id="cb157-263"><a href="#cb157-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(mean_heat)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Tmean_heat&quot;</span></span>
<span id="cb157-264"><a href="#cb157-264" aria-hidden="true" tabindex="-1"></a>  phase_Tmeans <span class="ot">&lt;-</span> <span class="fu">merge</span>(mean_chill,</span>
<span id="cb157-265"><a href="#cb157-265" aria-hidden="true" tabindex="-1"></a>                        mean_heat,</span>
<span id="cb157-266"><a href="#cb157-266" aria-hidden="true" tabindex="-1"></a>                        <span class="at">by =</span> <span class="st">&quot;End_year&quot;</span>)</span>
<span id="cb157-267"><a href="#cb157-267" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-268"><a href="#cb157-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(pheno) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;End_year&quot;</span>,</span>
<span id="cb157-269"><a href="#cb157-269" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;pheno&quot;</span>)</span>
<span id="cb157-270"><a href="#cb157-270" aria-hidden="true" tabindex="-1"></a>  Tmeans_pheno <span class="ot">&lt;-</span> <span class="fu">merge</span>(phase_Tmeans,</span>
<span id="cb157-271"><a href="#cb157-271" aria-hidden="true" tabindex="-1"></a>                        pheno, </span>
<span id="cb157-272"><a href="#cb157-272" aria-hidden="true" tabindex="-1"></a>                        <span class="at">by=</span><span class="st">&quot;End_year&quot;</span>)</span>
<span id="cb157-273"><a href="#cb157-273" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-274"><a href="#cb157-274" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Kriging interpolation</span></span>
<span id="cb157-275"><a href="#cb157-275" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">Krig</span>(<span class="at">x =</span> <span class="fu">as.matrix</span>(Tmeans_pheno[,<span class="fu">c</span>(<span class="st">&quot;Tmean_chill&quot;</span>,</span>
<span id="cb157-276"><a href="#cb157-276" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;Tmean_heat&quot;</span>)]),</span>
<span id="cb157-277"><a href="#cb157-277" aria-hidden="true" tabindex="-1"></a>            <span class="at">Y =</span> Tmeans_pheno<span class="sc">$</span>pheno)</span>
<span id="cb157-278"><a href="#cb157-278" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predictSurface</span>(k)</span>
<span id="cb157-279"><a href="#cb157-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(pred<span class="sc">$</span>z) <span class="ot">&lt;-</span> pred<span class="sc">$</span>y</span>
<span id="cb157-280"><a href="#cb157-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(pred<span class="sc">$</span>z) <span class="ot">&lt;-</span> pred<span class="sc">$</span>x</span>
<span id="cb157-281"><a href="#cb157-281" aria-hidden="true" tabindex="-1"></a>  melted <span class="ot">&lt;-</span> <span class="fu">melt</span>(pred<span class="sc">$</span>z)</span>
<span id="cb157-282"><a href="#cb157-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(melted) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Tmean_chill&quot;</span>,</span>
<span id="cb157-283"><a href="#cb157-283" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;Tmean_heat&quot;</span>,</span>
<span id="cb157-284"><a href="#cb157-284" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;value&quot;</span>)</span>
<span id="cb157-285"><a href="#cb157-285" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-286"><a href="#cb157-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(melted,</span>
<span id="cb157-287"><a href="#cb157-287" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> Tmean_chill,</span>
<span id="cb157-288"><a href="#cb157-288" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> Tmean_heat,</span>
<span id="cb157-289"><a href="#cb157-289" aria-hidden="true" tabindex="-1"></a>             <span class="at">z =</span> value)) <span class="sc">+</span></span>
<span id="cb157-290"><a href="#cb157-290" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_contour_fill</span>(<span class="at">bins =</span> <span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb157-291"><a href="#cb157-291" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">alpha</span>(<span class="fu">matlab.like</span>(<span class="dv">15</span>)),</span>
<span id="cb157-292"><a href="#cb157-292" aria-hidden="true" tabindex="-1"></a>                         <span class="at">name =</span> <span class="fu">paste</span>(phenology_stage,</span>
<span id="cb157-293"><a href="#cb157-293" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;date </span><span class="sc">\n</span><span class="st">(day of the year)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb157-294"><a href="#cb157-294" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_contour</span>(<span class="at">col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb157-295"><a href="#cb157-295" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text_contour</span>(<span class="at">stroke =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb157-296"><a href="#cb157-296" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> Tmeans_pheno,</span>
<span id="cb157-297"><a href="#cb157-297" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> Tmean_chill,</span>
<span id="cb157-298"><a href="#cb157-298" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> Tmean_heat,</span>
<span id="cb157-299"><a href="#cb157-299" aria-hidden="true" tabindex="-1"></a>                   <span class="at">z =</span> <span class="cn">NULL</span>),</span>
<span id="cb157-300"><a href="#cb157-300" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.7</span>)  <span class="sc">+</span></span>
<span id="cb157-301"><a href="#cb157-301" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Forcing phase &quot;</span>,</span>
<span id="cb157-302"><a href="#cb157-302" aria-hidden="true" tabindex="-1"></a>                          T[mean],</span>
<span id="cb157-303"><a href="#cb157-303" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot; (&quot;</span>,</span>
<span id="cb157-304"><a href="#cb157-304" aria-hidden="true" tabindex="-1"></a>                          degree,</span>
<span id="cb157-305"><a href="#cb157-305" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;C)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb157-306"><a href="#cb157-306" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Chilling phase &quot;</span>,</span>
<span id="cb157-307"><a href="#cb157-307" aria-hidden="true" tabindex="-1"></a>                          T[mean],</span>
<span id="cb157-308"><a href="#cb157-308" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot; (&quot;</span>,</span>
<span id="cb157-309"><a href="#cb157-309" aria-hidden="true" tabindex="-1"></a>                          degree,</span>
<span id="cb157-310"><a href="#cb157-310" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;C)&quot;</span>))) <span class="sc">+</span></span>
<span id="cb157-311"><a href="#cb157-311" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span>
<span id="cb157-312"><a href="#cb157-312" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb157-313"><a href="#cb157-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-314"><a href="#cb157-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-315"><a href="#cb157-315" aria-hidden="true" tabindex="-1"></a>chill_phase <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">317</span>, <span class="dv">62</span>)</span>
<span id="cb157-316"><a href="#cb157-316" aria-hidden="true" tabindex="-1"></a>heat_phase <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">360</span>, <span class="fl">105.5</span>)</span>
<span id="cb157-317"><a href="#cb157-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-318"><a href="#cb157-318" aria-hidden="true" tabindex="-1"></a><span class="fu">pheno_trend_ggplot</span>(<span class="at">temps =</span> temps,</span>
<span id="cb157-319"><a href="#cb157-319" aria-hidden="true" tabindex="-1"></a>                   <span class="at">pheno =</span> Roter_first,</span>
<span id="cb157-320"><a href="#cb157-320" aria-hidden="true" tabindex="-1"></a>                   <span class="at">chill_phase =</span> chill_phase,</span>
<span id="cb157-321"><a href="#cb157-321" aria-hidden="true" tabindex="-1"></a>                   <span class="at">heat_phase =</span> heat_phase,</span>
<span id="cb157-322"><a href="#cb157-322" aria-hidden="true" tabindex="-1"></a>                   <span class="at">phenology_stage =</span> <span class="st">&quot;Bloom&quot;</span>)</span>
<span id="cb157-323"><a href="#cb157-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-324"><a href="#cb157-324" aria-hidden="true" tabindex="-1"></a><span class="co"># Applying to california </span></span>
<span id="cb157-325"><a href="#cb157-325" aria-hidden="true" tabindex="-1"></a><span class="co"># Cali_temps &lt;- read_tab(&quot;data/Davis_weather.csv&quot;)</span></span>
<span id="cb157-326"><a href="#cb157-326" aria-hidden="true" tabindex="-1"></a><span class="co"># Walnut_pheno &lt;- read_tab(&quot;data/Davis_Payne_leaf_out.csv&quot;) %&gt;%</span></span>
<span id="cb157-327"><a href="#cb157-327" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(Year = as.numeric(substr(Leaf.date,7,8)),</span></span>
<span id="cb157-328"><a href="#cb157-328" aria-hidden="true" tabindex="-1"></a><span class="co">#          Year = Year+(19+(Year&lt;25))*100,</span></span>
<span id="cb157-329"><a href="#cb157-329" aria-hidden="true" tabindex="-1"></a><span class="co">#          Month = as.numeric(substr(Leaf.date,4,5)),</span></span>
<span id="cb157-330"><a href="#cb157-330" aria-hidden="true" tabindex="-1"></a><span class="co">#          Day = as.numeric(substr(Leaf.date,1,2))) %&gt;%</span></span>
<span id="cb157-331"><a href="#cb157-331" aria-hidden="true" tabindex="-1"></a><span class="co">#   make_JDay() %&gt;%</span></span>
<span id="cb157-332"><a href="#cb157-332" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(Year, JDay)</span></span>
<span id="cb157-333"><a href="#cb157-333" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb157-334"><a href="#cb157-334" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(Walnut_pheno) &lt;- c(&quot;Year&quot;,</span></span>
<span id="cb157-335"><a href="#cb157-335" aria-hidden="true" tabindex="-1"></a><span class="co">#                             &quot;pheno&quot;)</span></span>
<span id="cb157-336"><a href="#cb157-336" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb157-337"><a href="#cb157-337" aria-hidden="true" tabindex="-1"></a><span class="co"># Cali_temps_hourly &lt;- stack_hourly_temps(Cali_temps,</span></span>
<span id="cb157-338"><a href="#cb157-338" aria-hidden="true" tabindex="-1"></a><span class="co">#                                         latitude = 38.5)</span></span>
<span id="cb157-339"><a href="#cb157-339" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb157-340"><a href="#cb157-340" aria-hidden="true" tabindex="-1"></a><span class="co"># Cali_daychill &lt;- daily_chill(hourtemps = Cali_temps_hourly,</span></span>
<span id="cb157-341"><a href="#cb157-341" aria-hidden="true" tabindex="-1"></a><span class="co">#                              running_mean = 1,</span></span>
<span id="cb157-342"><a href="#cb157-342" aria-hidden="true" tabindex="-1"></a><span class="co">#                              models = list(Chilling_Hours = Chilling_Hours,</span></span>
<span id="cb157-343"><a href="#cb157-343" aria-hidden="true" tabindex="-1"></a><span class="co">#                                            Utah_Chill_Units = Utah_Model,</span></span>
<span id="cb157-344"><a href="#cb157-344" aria-hidden="true" tabindex="-1"></a><span class="co">#                                            Chill_Portions = Dynamic_Model,</span></span>
<span id="cb157-345"><a href="#cb157-345" aria-hidden="true" tabindex="-1"></a><span class="co">#                                            GDH = GDH)</span></span>
<span id="cb157-346"><a href="#cb157-346" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb157-347"><a href="#cb157-347" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb157-348"><a href="#cb157-348" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb157-349"><a href="#cb157-349" aria-hidden="true" tabindex="-1"></a><span class="co"># plscf &lt;- PLS_chill_force(daily_chill_obj = Cali_daychill,</span></span>
<span id="cb157-350"><a href="#cb157-350" aria-hidden="true" tabindex="-1"></a><span class="co">#                          bio_data_frame = Walnut_pheno,</span></span>
<span id="cb157-351"><a href="#cb157-351" aria-hidden="true" tabindex="-1"></a><span class="co">#                          split_month = 6,</span></span>
<span id="cb157-352"><a href="#cb157-352" aria-hidden="true" tabindex="-1"></a><span class="co">#                          chill_models = &quot;Chill_Portions&quot;,</span></span>
<span id="cb157-353"><a href="#cb157-353" aria-hidden="true" tabindex="-1"></a><span class="co">#                          heat_models = &quot;GDH&quot;,</span></span>
<span id="cb157-354"><a href="#cb157-354" aria-hidden="true" tabindex="-1"></a><span class="co">#                          runn_means = 11)</span></span>
<span id="cb157-355"><a href="#cb157-355" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb157-356"><a href="#cb157-356" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_PLS_chill_force(plscf,</span></span>
<span id="cb157-357"><a href="#cb157-357" aria-hidden="true" tabindex="-1"></a><span class="co">#                      chill_metric = &quot;Chill_Portions&quot;,</span></span>
<span id="cb157-358"><a href="#cb157-358" aria-hidden="true" tabindex="-1"></a><span class="co">#                      heat_metric = &quot;GDH&quot;,</span></span>
<span id="cb157-359"><a href="#cb157-359" aria-hidden="true" tabindex="-1"></a><span class="co">#                      chill_label = &quot;CP&quot;,</span></span>
<span id="cb157-360"><a href="#cb157-360" aria-hidden="true" tabindex="-1"></a><span class="co">#                      heat_label = &quot;GDH&quot;,</span></span>
<span id="cb157-361"><a href="#cb157-361" aria-hidden="true" tabindex="-1"></a><span class="co">#                      chill_phase = c(-56, 5),</span></span>
<span id="cb157-362"><a href="#cb157-362" aria-hidden="true" tabindex="-1"></a><span class="co">#                      heat_phase = c(19, 77))</span></span>
<span id="cb157-363"><a href="#cb157-363" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb157-364"><a href="#cb157-364" aria-hidden="true" tabindex="-1"></a><span class="co"># pheno_trend_ggplot(temps = Cali_temps,</span></span>
<span id="cb157-365"><a href="#cb157-365" aria-hidden="true" tabindex="-1"></a><span class="co">#                    pheno = Walnut_pheno,</span></span>
<span id="cb157-366"><a href="#cb157-366" aria-hidden="true" tabindex="-1"></a><span class="co">#                    chill_phase = c(309, 5),</span></span>
<span id="cb157-367"><a href="#cb157-367" aria-hidden="true" tabindex="-1"></a><span class="co">#                    heat_phase = c(19, 77),</span></span>
<span id="cb157-368"><a href="#cb157-368" aria-hidden="true" tabindex="-1"></a><span class="co">#                    phenology_stage = &quot;Leaf emergence&quot;)</span></span>
<span id="cb157-369"><a href="#cb157-369" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code></pre></div>
</details>
</div>
<p>2.Weâve looked at data from a number of locations so far. How would you expect this surface plot to look like in Beijing? And how should it look in Tunisia?</p>
<hr />
</section>
</section>
<section id="chapter-27-the-relative-importance-of-chill-and-heat" class="level1">
<h1>Chapter 27: The relative importance of chill and heat</h1>
<section id="exercises-on-the-relative-importance-of-chill-and-heat" class="level2">
<h2><strong><em>Exercises on the relative importance of chill and heat</em></strong></h2>
<p>Describe the temperature response hypothesis outlined in this chapter.</p>
<p>The temperature response hypothesis explains how the phenology of temperate trees in cold-winter climates responds to temperature variations during the chilling and forcing periods. During the ecodormancy phase, when buds are sensitive to heat, spring phenology is primarily influenced by forcing temperatures, as chill accumulation in such climates is usually high, and winter conditions are favorable for chilling. This stability makes it challenging to define the chilling period in these regions.</p>
<p>As endodormancy temperatures rise, temperature conditions during chill accumulation begin to influence phenology, introducing a delaying effect. This transition is marked by increasing interaction between chill and forcing temperatures, depicted as upward-bending contour lines in the hypothesis framework. With further warming, chilling temperatures dominate, eventually causing stagnation or delays in budbreak, instead of advancing phenology.</p>
<hr />
</section>
</section>
<section id="chapter-29-making-valid-tree-phenology-models" class="level1">
<h1>Chapter 29: Making valid tree phenology models</h1>
<section id="exercises-on-making-valid-tree-phenology-models" class="level2">
<h2><strong><em>Exercises on making valid tree phenology models</em></strong></h2>
<ol type="1">
<li>Explain the difference between output validation and process validation.</li>
</ol>
<p>Output validation assesses a modelâs predictive accuracy, while process validation ensures the modelâs internal logic is scientifically sound and reflective of real-world processes. For instance, output validation relies on performance metrics like Root Mean Square Error (RMSE) or Model Efficiency to quantify accuracy while requires domain knowledge about the processes to evaluate how well the model represents them. Both are important, but process validation provides deeper confidence in the modelâs applicability beyond specific datasets.</p>
<ol start="2" type="1">
<li>Explain what a validity domain is and why it is important to consider this whenever we want to use our model to forecast something.This is the range of conditions that the model is capable of making reliable predictions for.</li>
</ol>
<p>Validity domain ensures that models are applied within their appropriate scope, enhancing their reliability and relevance. In application, model performance to be validated under conditions that resemble those predicted.</p>
<ol start="3" type="1">
<li>What is validation for purpose?</li>
</ol>
<p>Validation for purpose is the process of assessing whether a model is capable of achieving its intended objective in a specific context. It involves reflecting on the modelâs goals and evaluating if it can realistically and reliably deliver the required predictions under the conditions of interest. This approach considers the modelâs assumptions, structure, and data inputs to determine its applicability for a given task.</p>
<ol start="4" type="1">
<li>How can we ensure that our model is suitable for the predictions we want to make?</li>
</ol>
<p>We must verify that the predictions we wish to make come inside the modelâs validity domain, meaning that the requirements for making those predictions closely match the set of requirements that the model is predicated on, in order to make sure our model is appropriate for those predictions. Additionally, there are instances in which model predictions may remain accurate even when they are outside the modelâs validity domain. The model can still be considered appropriate in certain situations, but it needs to be strongly justified.</p>
<hr />
</section>
</section>
<section id="chapter-30-the-phenoflex-model" class="level1">
<h1>Chapter 30: The Phenoflex Model</h1>
<section id="exercises-on-making-valid-tree-phenology-models-1" class="level2">
<h2><strong><em>Exercises on making valid tree phenology models</em></strong></h2>
<ol type="1">
<li>Parameterize the PhenoFlex model for `Roter Boskoopâ apples.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb158"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>CKA_weather <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/TMaxTMin1958-2019_patched.csv&quot;</span>)</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>hourtemps <span class="ot">&lt;-</span> <span class="fu">stack_hourly_temps</span>(CKA_weather, </span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>                                <span class="at">latitude =</span> <span class="fl">50.6</span>)</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>yc <span class="ot">&lt;-</span> <span class="dv">40</span> <span class="co"># chilling requirement</span></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>zc <span class="ot">&lt;-</span> <span class="dv">190</span> <span class="co"># heating requirement</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>iSeason <span class="ot">&lt;-</span> <span class="fu">genSeason</span>(hourtemps,</span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mrange =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">6</span>), <span class="co"># month range</span></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">years =</span> <span class="fu">c</span>(<span class="dv">2009</span>))</span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>season_data <span class="ot">&lt;-</span> hourtemps<span class="sc">$</span>hourtemps[iSeason[[<span class="dv">1</span>]],]</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">PhenoFlex</span>(<span class="at">temp =</span> season_data<span class="sc">$</span>Temp,</span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span> <span class="fu">length</span>(season_data<span class="sc">$</span>Temp)),</span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">zc =</span> zc,</span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stopatzc =</span> <span class="cn">TRUE</span>,</span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">yc =</span> yc,</span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">basic_output =</span> <span class="cn">FALSE</span>)</span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a>DBreakDay <span class="ot">&lt;-</span> res<span class="sc">$</span>bloomindex</span>
<span id="cb158-26"><a href="#cb158-26" aria-hidden="true" tabindex="-1"></a>seasontemps <span class="ot">&lt;-</span> hourtemps<span class="sc">$</span>hourtemps[iSeason[[<span class="dv">1</span>]],]</span>
<span id="cb158-27"><a href="#cb158-27" aria-hidden="true" tabindex="-1"></a>seasontemps[,<span class="st">&quot;x&quot;</span>] <span class="ot">&lt;-</span> res<span class="sc">$</span>x</span>
<span id="cb158-28"><a href="#cb158-28" aria-hidden="true" tabindex="-1"></a>seasontemps[,<span class="st">&quot;y&quot;</span>] <span class="ot">&lt;-</span> res<span class="sc">$</span>y</span>
<span id="cb158-29"><a href="#cb158-29" aria-hidden="true" tabindex="-1"></a>seasontemps[,<span class="st">&quot;z&quot;</span>] <span class="ot">&lt;-</span> res<span class="sc">$</span>z</span>
<span id="cb158-30"><a href="#cb158-30" aria-hidden="true" tabindex="-1"></a>seasontemps <span class="ot">&lt;-</span> <span class="fu">add_date</span>(seasontemps)</span>
<span id="cb158-31"><a href="#cb158-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-32"><a href="#cb158-32" aria-hidden="true" tabindex="-1"></a>CR_full <span class="ot">&lt;-</span> seasontemps<span class="sc">$</span>Date[<span class="fu">which</span>(seasontemps<span class="sc">$</span>y <span class="sc">&gt;=</span> yc)[<span class="dv">1</span>]] <span class="co"># the date where chilling requirement is broken</span></span>
<span id="cb158-33"><a href="#cb158-33" aria-hidden="true" tabindex="-1"></a>Bloom <span class="ot">&lt;-</span> seasontemps<span class="sc">$</span>Date[<span class="fu">which</span>(seasontemps<span class="sc">$</span>z <span class="sc">&gt;=</span> zc)[<span class="dv">1</span>]]</span>
<span id="cb158-34"><a href="#cb158-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-35"><a href="#cb158-35" aria-hidden="true" tabindex="-1"></a>chillplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> seasontemps[<span class="dv">1</span><span class="sc">:</span>DBreakDay,],</span>
<span id="cb158-36"><a href="#cb158-36" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb158-37"><a href="#cb158-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb158-38"><a href="#cb158-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb158-39"><a href="#cb158-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb158-40"><a href="#cb158-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb158-41"><a href="#cb158-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> yc,</span>
<span id="cb158-42"><a href="#cb158-42" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb158-43"><a href="#cb158-43" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb158-44"><a href="#cb158-44" aria-hidden="true" tabindex="-1"></a>             <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb158-45"><a href="#cb158-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> CR_full,</span>
<span id="cb158-46"><a href="#cb158-46" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">3</span>,</span>
<span id="cb158-47"><a href="#cb158-47" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb158-48"><a href="#cb158-48" aria-hidden="true" tabindex="-1"></a>             <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb158-49"><a href="#cb158-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Chill accumulation (y)&quot;</span>) <span class="sc">+</span></span>
<span id="cb158-50"><a href="#cb158-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Chilling&quot;</span>) <span class="sc">+</span></span>
<span id="cb158-51"><a href="#cb158-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>,</span>
<span id="cb158-52"><a href="#cb158-52" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;Chill req. (yc)&quot;</span>, </span>
<span id="cb158-53"><a href="#cb158-53" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">ISOdate</span>(<span class="dv">2008</span>,<span class="dv">10</span>,<span class="dv">01</span>),</span>
<span id="cb158-54"><a href="#cb158-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> yc<span class="sc">*</span><span class="fl">1.1</span>,</span>
<span id="cb158-55"><a href="#cb158-55" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb158-56"><a href="#cb158-56" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">5</span>)</span>
<span id="cb158-57"><a href="#cb158-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-58"><a href="#cb158-58" aria-hidden="true" tabindex="-1"></a>heatplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> seasontemps[<span class="dv">1</span><span class="sc">:</span>DBreakDay,],</span>
<span id="cb158-59"><a href="#cb158-59" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb158-60"><a href="#cb158-60" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> z)) <span class="sc">+</span></span>
<span id="cb158-61"><a href="#cb158-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb158-62"><a href="#cb158-62" aria-hidden="true" tabindex="-1"></a>            <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb158-63"><a href="#cb158-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb158-64"><a href="#cb158-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">position =</span> <span class="st">&quot;right&quot;</span>) <span class="sc">+</span></span>
<span id="cb158-65"><a href="#cb158-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> zc,</span>
<span id="cb158-66"><a href="#cb158-66" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb158-67"><a href="#cb158-67" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb158-68"><a href="#cb158-68" aria-hidden="true" tabindex="-1"></a>             <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb158-69"><a href="#cb158-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> CR_full,</span>
<span id="cb158-70"><a href="#cb158-70" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">3</span>,</span>
<span id="cb158-71"><a href="#cb158-71" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb158-72"><a href="#cb158-72" aria-hidden="true" tabindex="-1"></a>             <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb158-73"><a href="#cb158-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> Bloom,</span>
<span id="cb158-74"><a href="#cb158-74" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">3</span>,</span>
<span id="cb158-75"><a href="#cb158-75" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb158-76"><a href="#cb158-76" aria-hidden="true" tabindex="-1"></a>             <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb158-77"><a href="#cb158-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Heat accumulation (z)&quot;</span>) <span class="sc">+</span></span>
<span id="cb158-78"><a href="#cb158-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Forcing&quot;</span>) <span class="sc">+</span></span>
<span id="cb158-79"><a href="#cb158-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>,</span>
<span id="cb158-80"><a href="#cb158-80" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;Heat req. (zc)&quot;</span>, </span>
<span id="cb158-81"><a href="#cb158-81" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">ISOdate</span>(<span class="dv">2008</span>,<span class="dv">10</span>,<span class="dv">01</span>),</span>
<span id="cb158-82"><a href="#cb158-82" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> zc<span class="sc">*</span><span class="fl">0.95</span>,</span>
<span id="cb158-83"><a href="#cb158-83" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb158-84"><a href="#cb158-84" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">5</span>)</span>
<span id="cb158-85"><a href="#cb158-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-86"><a href="#cb158-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-87"><a href="#cb158-87" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb158-88"><a href="#cb158-88" aria-hidden="true" tabindex="-1"></a>chillplot <span class="sc">+</span> heatplot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb159"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>yc <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>zc <span class="ot">&lt;-</span> <span class="dv">190</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>seasons <span class="ot">&lt;-</span> <span class="dv">1959</span><span class="sc">:</span><span class="dv">2019</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>iSeason <span class="ot">&lt;-</span> <span class="fu">genSeason</span>(hourtemps,</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mrange =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">6</span>),</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">years =</span> seasons)</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (sea <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(seasons))</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>{season_data <span class="ot">&lt;-</span> hourtemps<span class="sc">$</span>hourtemps[iSeason[[sea]], ]</span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a> res <span class="ot">&lt;-</span> <span class="fu">PhenoFlex</span>(<span class="at">temp =</span> season_data<span class="sc">$</span>Temp,</span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span> <span class="fu">length</span>(season_data<span class="sc">$</span>Temp)),</span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">zc =</span> zc,</span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stopatzc =</span> <span class="cn">TRUE</span>,</span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">yc =</span> yc,</span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">basic_output =</span> <span class="cn">FALSE</span>)</span>
<span id="cb159-17"><a href="#cb159-17" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span>(sea <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb159-18"><a href="#cb159-18" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> season_data<span class="sc">$</span>DATE[res<span class="sc">$</span>bloomindex] <span class="cf">else</span></span>
<span id="cb159-19"><a href="#cb159-19" aria-hidden="true" tabindex="-1"></a>      results <span class="ot">&lt;-</span> <span class="fu">c</span>(results,</span>
<span id="cb159-20"><a href="#cb159-20" aria-hidden="true" tabindex="-1"></a>                   season_data<span class="sc">$</span>DATE[res<span class="sc">$</span>bloomindex])}</span>
<span id="cb159-21"><a href="#cb159-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-22"><a href="#cb159-22" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Season =</span> seasons,</span>
<span id="cb159-23"><a href="#cb159-23" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Prediction =</span> results)</span>
<span id="cb159-24"><a href="#cb159-24" aria-hidden="true" tabindex="-1"></a>predictions<span class="sc">$</span>Prediction <span class="ot">&lt;-</span></span>
<span id="cb159-25"><a href="#cb159-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb159-26"><a href="#cb159-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">substr</span>(predictions<span class="sc">$</span>Prediction, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb159-27"><a href="#cb159-27" aria-hidden="true" tabindex="-1"></a>          <span class="fu">substr</span>(predictions<span class="sc">$</span>Prediction, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb159-28"><a href="#cb159-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-29"><a href="#cb159-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> predictions,</span>
<span id="cb159-30"><a href="#cb159-30" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Season,</span>
<span id="cb159-31"><a href="#cb159-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Prediction)) <span class="sc">+</span></span>
<span id="cb159-32"><a href="#cb159-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb159-33"><a href="#cb159-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb159-34"><a href="#cb159-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Predicted bloom date&quot;</span>) <span class="sc">+</span></span>
<span id="cb159-35"><a href="#cb159-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-58-2.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb161"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>Roter_first <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Roter_Boskoop_bloom_1958_2019.csv.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, First_bloom) <span class="sc">%&gt;%</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">1</span>, <span class="dv">4</span>)),</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">5</span>, <span class="dv">6</span>)),</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">7</span>, <span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_JDay</span>() <span class="sc">%&gt;%</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, JDay) <span class="sc">%&gt;%</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Year =</span> Pheno_year,</span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">pheno =</span> JDay)</span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>hourtemps <span class="ot">&lt;-</span> </span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/TMaxTMin1958-2019_patched.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack_hourly_temps</span>(<span class="at">latitude =</span> <span class="fl">50.6</span>)</span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a><span class="co"># here&#39;s the order of the parameters (from the helpfile of the</span></span>
<span id="cb161-17"><a href="#cb161-17" aria-hidden="true" tabindex="-1"></a><span class="co"># PhenoFlex_GDHwrapper function)</span></span>
<span id="cb161-18"><a href="#cb161-18" aria-hidden="true" tabindex="-1"></a><span class="co">#          yc,  zc,  s1, Tu,    E0,      E1,     A0,         A1,   Tf, Tc, Tb,  slope</span></span>
<span id="cb161-19"><a href="#cb161-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-20"><a href="#cb161-20" aria-hidden="true" tabindex="-1"></a>par <span class="ot">&lt;-</span>   <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">190</span>, <span class="fl">0.5</span>, <span class="dv">25</span>, <span class="fl">3372.8</span>,  <span class="fl">9900.3</span>, <span class="fl">6319.5</span>,</span>
<span id="cb161-21"><a href="#cb161-21" aria-hidden="true" tabindex="-1"></a>           <span class="fl">5.939917e13</span>,  <span class="dv">4</span>, <span class="dv">36</span>,  <span class="dv">4</span>,  <span class="fl">1.60</span>)</span>
<span id="cb161-22"><a href="#cb161-22" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">41</span>, <span class="dv">200</span>, <span class="fl">1.0</span>, <span class="dv">30</span>, <span class="fl">4000.0</span>, <span class="fl">10000.0</span>, <span class="fl">7000.0</span>,  </span>
<span id="cb161-23"><a href="#cb161-23" aria-hidden="true" tabindex="-1"></a>           <span class="dv">6</span>.e13, <span class="dv">10</span>, <span class="dv">40</span>, <span class="dv">10</span>, <span class="fl">50.00</span>)</span>
<span id="cb161-24"><a href="#cb161-24" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">38</span>, <span class="dv">180</span>, <span class="fl">0.1</span>, <span class="dv">0</span> , <span class="fl">3000.0</span>,  <span class="fl">9000.0</span>, <span class="fl">6000.0</span>,   </span>
<span id="cb161-25"><a href="#cb161-25" aria-hidden="true" tabindex="-1"></a>           <span class="dv">5</span>.e13,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="fl">0.05</span>)</span>
<span id="cb161-26"><a href="#cb161-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-27"><a href="#cb161-27" aria-hidden="true" tabindex="-1"></a>SeasonList <span class="ot">&lt;-</span> <span class="fu">genSeasonList</span>(hourtemps<span class="sc">$</span>hourtemps,</span>
<span id="cb161-28"><a href="#cb161-28" aria-hidden="true" tabindex="-1"></a>                            <span class="at">mrange =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">6</span>),</span>
<span id="cb161-29"><a href="#cb161-29" aria-hidden="true" tabindex="-1"></a>                            <span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1959</span><span class="sc">:</span><span class="dv">2018</span>))</span>
<span id="cb161-30"><a href="#cb161-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-31"><a href="#cb161-31" aria-hidden="true" tabindex="-1"></a>Fit_res <span class="ot">&lt;-</span> </span>
<span id="cb161-32"><a href="#cb161-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">phenologyFitter</span>(<span class="at">par.guess =</span> par, </span>
<span id="cb161-33"><a href="#cb161-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">modelfn =</span> PhenoFlex_GDHwrapper,</span>
<span id="cb161-34"><a href="#cb161-34" aria-hidden="true" tabindex="-1"></a>                  <span class="at">bloomJDays =</span> Roter_first<span class="sc">$</span>pheno[<span class="fu">which</span>(Roter_first<span class="sc">$</span>Year <span class="sc">&gt;</span> <span class="dv">1958</span>)],</span>
<span id="cb161-35"><a href="#cb161-35" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SeasonList =</span> SeasonList,</span>
<span id="cb161-36"><a href="#cb161-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lower =</span> lower,</span>
<span id="cb161-37"><a href="#cb161-37" aria-hidden="true" tabindex="-1"></a>                           <span class="at">upper =</span> upper,</span>
<span id="cb161-38"><a href="#cb161-38" aria-hidden="true" tabindex="-1"></a>                           <span class="at">control =</span> <span class="fu">list</span>(<span class="at">smooth =</span> <span class="cn">FALSE</span>,</span>
<span id="cb161-39"><a href="#cb161-39" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">verbose =</span> <span class="cn">FALSE</span>, </span>
<span id="cb161-40"><a href="#cb161-40" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">maxit =</span> <span class="dv">1000</span>,</span>
<span id="cb161-41"><a href="#cb161-41" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">nb.stop.improvement =</span> <span class="dv">5</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: parallel</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb163"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>Roter_par <span class="ot">&lt;-</span> Fit_res<span class="sc">$</span>par</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(Roter_par,</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/PhenoFlex_parameters_Roter_Boskoop.csv&quot;</span>)</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Roter_par)) <span class="sc">%&gt;%</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="st">&quot;striped&quot;</span>, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>, <span class="at">font_size =</span> <span class="dv">10</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped caption-top" data-quarto-postprocess="true" style="font-size: 10px; ">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">39.4579019</td>
</tr>
<tr class="even">
<td style="text-align: right;">195.5517993</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.3217589</td>
</tr>
<tr class="even">
<td style="text-align: right;">25.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3372.8000000</td>
</tr>
<tr class="even">
<td style="text-align: right;">9900.3000000</td>
</tr>
</tbody>
</table>


</div>
</div>
<ol start="2" type="1">
<li>Produce plots of predicted vs.Â observed bloom dates and distribution of prediction errors.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb164"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>Roter_par <span class="ot">&lt;-</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/PhenoFlex_parameters_Roter_Boskoop.csv&quot;</span>)[,<span class="dv">2</span>]</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>SeasonList <span class="ot">&lt;-</span> <span class="fu">genSeasonList</span>(hourtemps<span class="sc">$</span>hourtemps,</span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">mrange =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">6</span>),</span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1959</span><span class="sc">:</span><span class="dv">2018</span>))</span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a>Roter_PhenoFlex_predictions <span class="ot">&lt;-</span> Roter_first[<span class="fu">which</span>(Roter_first<span class="sc">$</span>Year <span class="sc">&gt;</span> <span class="dv">1958</span>),]</span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>Year))</span>
<span id="cb164-15"><a href="#cb164-15" aria-hidden="true" tabindex="-1"></a>   Roter_PhenoFlex_predictions<span class="sc">$</span>predicted[y] <span class="ot">&lt;-</span></span>
<span id="cb164-16"><a href="#cb164-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">PhenoFlex_GDHwrapper</span>(SeasonList[[y]],</span>
<span id="cb164-17"><a href="#cb164-17" aria-hidden="true" tabindex="-1"></a>                         Roter_par)</span>
<span id="cb164-18"><a href="#cb164-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-19"><a href="#cb164-19" aria-hidden="true" tabindex="-1"></a>Roter_PhenoFlex_predictions<span class="sc">$</span>Error <span class="ot">&lt;-</span></span>
<span id="cb164-20"><a href="#cb164-20" aria-hidden="true" tabindex="-1"></a>  Roter_PhenoFlex_predictions<span class="sc">$</span>predicted <span class="sc">-</span></span>
<span id="cb164-21"><a href="#cb164-21" aria-hidden="true" tabindex="-1"></a>  Roter_PhenoFlex_predictions<span class="sc">$</span>pheno</span>
<span id="cb164-22"><a href="#cb164-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-23"><a href="#cb164-23" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSEP</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>predicted,</span>
<span id="cb164-24"><a href="#cb164-24" aria-hidden="true" tabindex="-1"></a>      Roter_PhenoFlex_predictions<span class="sc">$</span>pheno)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.690369</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb166"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>Error)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.915972</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb168"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">abs</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>Error))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.340972</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb170"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Roter_PhenoFlex_predictions,</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> pheno,</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> predicted)) <span class="sc">+</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Observed bloom date (Day of the year)&quot;</span>) <span class="sc">+</span></span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Predicted bloom date (Day of the year)&quot;</span>) <span class="sc">+</span></span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Predicted vs. observed bloom dates&quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb171"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Roter_PhenoFlex_predictions,</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(Error)) <span class="sc">+</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Distribution of prediction errors&quot;</span>) <span class="sc">+</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Compute the model performance metrics RMSEP, mean error and mean absolute error.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb173"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>RMSEP <span class="ot">&lt;-</span> chillR<span class="sc">::</span><span class="fu">RMSEP</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>predicted, Roter_PhenoFlex_predictions<span class="sc">$</span>pheno)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>Error)</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>abs_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>Error))</span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">RMSEP =</span> RMSEP, <span class="at">Mean =</span> mean, <span class="st">`</span><span class="at">Absolute Mean</span><span class="st">`</span> <span class="ot">=</span> abs_mean, <span class="at">check.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(result) <span class="sc">%&gt;%</span></span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="st">&quot;striped&quot;</span>, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>, <span class="at">font_size =</span> <span class="dv">10</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped caption-top" data-quarto-postprocess="true" style="font-size: 10px; ">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">RMSEP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Absolute Mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4.69037</td>
<td style="text-align: right;">-1.915972</td>
<td style="text-align: right;">3.340972</td>
</tr>
</tbody>
</table>


</div>
</div>
<hr />
</section>
</section>
<section id="chapter-31-the-phenoflex-model---a-second-look" class="level1">
<h1>Chapter 31: The PhenoFlex model - a second look</h1>
<section id="exercises-on-basic-phenoflex-diagnostics" class="level2">
<h2><strong><em>Exercises on basic PhenoFlex diagnostics</em></strong></h2>
<ol type="1">
<li>Make chill and heat response plots for the âRoter Boskoopâ PhenoFlex model for the location you did the earlier analyses for.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb174"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>Roter_par <span class="ot">&lt;-</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/PhenoFlex_parameters_Roter_Boskoop.csv&quot;</span>)[,<span class="dv">2</span>]</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>E0 <span class="ot">&lt;-</span> Roter_par[<span class="dv">5</span>]</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>E1 <span class="ot">&lt;-</span> Roter_par[<span class="dv">6</span>]</span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>A0 <span class="ot">&lt;-</span> Roter_par[<span class="dv">7</span>]</span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> Roter_par[<span class="dv">8</span>]</span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a>Tf <span class="ot">&lt;-</span> Roter_par[<span class="dv">9</span>]</span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> Roter_par[<span class="dv">12</span>]</span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a>apply_const_temp <span class="ot">&lt;-</span></span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(temp, </span>
<span id="cb174-16"><a href="#cb174-16" aria-hidden="true" tabindex="-1"></a>           A0, A1, E0, E1, Tf, </span>
<span id="cb174-17"><a href="#cb174-17" aria-hidden="true" tabindex="-1"></a>           slope, <span class="at">portions =</span> <span class="dv">1200</span>, <span class="at">deg_celsius =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb174-18"><a href="#cb174-18" aria-hidden="true" tabindex="-1"></a>    temp_vector <span class="ot">&lt;-</span> <span class="fu">rep</span>(temp,</span>
<span id="cb174-19"><a href="#cb174-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">times =</span> portions)</span>
<span id="cb174-20"><a href="#cb174-20" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> chillR<span class="sc">::</span><span class="fu">DynModel_driver</span>(<span class="at">temp =</span> temp_vector,</span>
<span id="cb174-21"><a href="#cb174-21" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">A0 =</span> A0,</span>
<span id="cb174-22"><a href="#cb174-22" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">A1 =</span> A1,</span>
<span id="cb174-23"><a href="#cb174-23" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">E0 =</span> E0,</span>
<span id="cb174-24"><a href="#cb174-24" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">E1 =</span> E1,</span>
<span id="cb174-25"><a href="#cb174-25" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Tf =</span> Tf,</span>
<span id="cb174-26"><a href="#cb174-26" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">slope =</span> slope,</span>
<span id="cb174-27"><a href="#cb174-27" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">deg_celsius =</span> deg_celsius)</span>
<span id="cb174-28"><a href="#cb174-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(res<span class="sc">$</span>y[<span class="fu">length</span>(res<span class="sc">$</span>y)])</span>
<span id="cb174-29"><a href="#cb174-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb174-30"><a href="#cb174-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-31"><a href="#cb174-31" aria-hidden="true" tabindex="-1"></a><span class="fu">apply_const_temp</span>(<span class="dv">4</span>, A0, A1, E0, E1, Tf, </span>
<span id="cb174-32"><a href="#cb174-32" aria-hidden="true" tabindex="-1"></a>                 slope)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16.82839</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb176"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>gen_bell <span class="ot">&lt;-</span> <span class="cf">function</span>(par,</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">temp_values =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">20</span>, <span class="fl">0.1</span>)) {</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  E0 <span class="ot">&lt;-</span> par[<span class="dv">5</span>]</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>  E1 <span class="ot">&lt;-</span> par[<span class="dv">6</span>]</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>  A0 <span class="ot">&lt;-</span> par[<span class="dv">7</span>]</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>  A1 <span class="ot">&lt;-</span> par[<span class="dv">8</span>]</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>  Tf <span class="ot">&lt;-</span> par[<span class="dv">9</span>]</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>  slope <span class="ot">&lt;-</span> par[<span class="dv">12</span>]</span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(temp_values)) {</span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a>    y[i] <span class="ot">&lt;-</span> <span class="fu">apply_const_temp</span>(<span class="at">temp =</span> temp_values[i],</span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a>                             <span class="at">A0 =</span> A0,</span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a>                             <span class="at">A1 =</span> A1,</span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a>                             <span class="at">E0 =</span> E0,</span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a>                             <span class="at">E1 =</span> E1,</span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Tf =</span> Tf,</span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">slope =</span> slope)</span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(y))</span>
<span id="cb176-21"><a href="#cb176-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb176-22"><a href="#cb176-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-23"><a href="#cb176-23" aria-hidden="true" tabindex="-1"></a>temp_values <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">30</span>, <span class="fl">0.1</span>)</span>
<span id="cb176-24"><a href="#cb176-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-25"><a href="#cb176-25" aria-hidden="true" tabindex="-1"></a>bell <span class="ot">&lt;-</span> <span class="fu">gen_bell</span>(Roter_par,</span>
<span id="cb176-26"><a href="#cb176-26" aria-hidden="true" tabindex="-1"></a>                 temp_values)</span>
<span id="cb176-27"><a href="#cb176-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-28"><a href="#cb176-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bell)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb177"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>GDH_response <span class="ot">&lt;-</span> <span class="cf">function</span>(T, par) {</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>  Tb <span class="ot">&lt;-</span> par[<span class="dv">11</span>]</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  Tu <span class="ot">&lt;-</span> par[<span class="dv">4</span>]</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>  Tc <span class="ot">&lt;-</span> par[<span class="dv">10</span>]</span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>  GDH_weight <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(T))</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>  GDH_weight[<span class="fu">which</span>(T <span class="sc">&gt;=</span> Tb <span class="sc">&amp;</span> T <span class="sc">&lt;=</span> Tu)] <span class="ot">&lt;-</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">cos</span>(pi <span class="sc">+</span> pi <span class="sc">*</span> (T[<span class="fu">which</span>(T <span class="sc">&gt;=</span> Tb <span class="sc">&amp;</span> T <span class="sc">&lt;=</span> Tu)] <span class="sc">-</span> Tb)<span class="sc">/</span>(Tu <span class="sc">-</span> Tb)))</span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>  GDH_weight[<span class="fu">which</span>(T <span class="sc">&gt;</span> Tu <span class="sc">&amp;</span> T <span class="sc">&lt;=</span> Tc)] <span class="ot">&lt;-</span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">cos</span>(pi<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> pi<span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> (T[<span class="fu">which</span>(T <span class="sc">&gt;</span>  Tu <span class="sc">&amp;</span> T <span class="sc">&lt;=</span> Tc)] <span class="sc">-</span>Tu)<span class="sc">/</span>(Tc <span class="sc">-</span> Tu)))</span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(GDH_weight)</span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-15"><a href="#cb177-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-16"><a href="#cb177-16" aria-hidden="true" tabindex="-1"></a>temp_values <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">30</span>, <span class="fl">0.1</span>)</span>
<span id="cb177-17"><a href="#cb177-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-18"><a href="#cb177-18" aria-hidden="true" tabindex="-1"></a>temp_response <span class="ot">&lt;-</span> </span>
<span id="cb177-19"><a href="#cb177-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">Temperature =</span> temp_values,</span>
<span id="cb177-20"><a href="#cb177-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">Chill_response =</span> <span class="fu">gen_bell</span>(Roter_par,</span>
<span id="cb177-21"><a href="#cb177-21" aria-hidden="true" tabindex="-1"></a>                                       temp_values),</span>
<span id="cb177-22"><a href="#cb177-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">Heat_response =</span> <span class="fu">GDH_response</span>(temp_values,</span>
<span id="cb177-23"><a href="#cb177-23" aria-hidden="true" tabindex="-1"></a>                                          Roter_par))</span>
<span id="cb177-24"><a href="#cb177-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-25"><a href="#cb177-25" aria-hidden="true" tabindex="-1"></a>pivoted_response <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(temp_response, </span>
<span id="cb177-26"><a href="#cb177-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">c</span>(Chill_response,</span>
<span id="cb177-27"><a href="#cb177-27" aria-hidden="true" tabindex="-1"></a>                                   Heat_response))</span>
<span id="cb177-28"><a href="#cb177-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-29"><a href="#cb177-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pivoted_response,</span>
<span id="cb177-30"><a href="#cb177-30" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Temperature,</span>
<span id="cb177-31"><a href="#cb177-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb177-32"><a href="#cb177-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">2</span>,</span>
<span id="cb177-33"><a href="#cb177-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">col =</span> name)) <span class="sc">+</span></span>
<span id="cb177-34"><a href="#cb177-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Temperature response (arbitrary units)&quot;</span>) <span class="sc">+</span></span>
<span id="cb177-35"><a href="#cb177-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Temperature (Â°C)&quot;</span>) <span class="sc">+</span></span>
<span id="cb177-36"><a href="#cb177-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(name),</span>
<span id="cb177-37"><a href="#cb177-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb177-38"><a href="#cb177-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> </span>
<span id="cb177-39"><a href="#cb177-39" aria-hidden="true" tabindex="-1"></a>               <span class="fu">labeller</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="at">Chill_response =</span> <span class="fu">c</span>(<span class="st">&quot;Chill response&quot;</span>),</span>
<span id="cb177-40"><a href="#cb177-40" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Heat_response =</span> <span class="fu">c</span>(<span class="st">&quot;Heat response&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb177-41"><a href="#cb177-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Chill_response&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb177-42"><a href="#cb177-42" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;Heat_response&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb177-43"><a href="#cb177-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb177-44"><a href="#cb177-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-62-2.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb178"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using Rochester as location</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">&lt;-</span> <span class="fl">43.1</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>month_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>Tmins <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>Tmaxs <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span><span class="sc">:</span><span class="dv">30</span>)</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>mins <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>maxs <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>chill_eff <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a>heat_eff <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a>month <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a>Roter_par <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/PhenoFlex_parameters_Roter_Boskoop.csv&quot;</span>)[, <span class="dv">2</span>]</span>
<span id="cb178-16"><a href="#cb178-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-17"><a href="#cb178-17" aria-hidden="true" tabindex="-1"></a>simulation_par <span class="ot">&lt;-</span> Roter_par</span>
<span id="cb178-18"><a href="#cb178-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-19"><a href="#cb178-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (mon <span class="cf">in</span> month_range) {</span>
<span id="cb178-20"><a href="#cb178-20" aria-hidden="true" tabindex="-1"></a>    days_month <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="fu">ISOdate</span>(<span class="dv">2002</span>, mon <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">1</span>), <span class="fu">ISOdate</span>(<span class="dv">2002</span>, mon,</span>
<span id="cb178-21"><a href="#cb178-21" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>)))</span>
<span id="cb178-22"><a href="#cb178-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (mon <span class="sc">==</span> <span class="dv">12</span>)</span>
<span id="cb178-23"><a href="#cb178-23" aria-hidden="true" tabindex="-1"></a>        days_month <span class="ot">&lt;-</span> <span class="dv">31</span></span>
<span id="cb178-24"><a href="#cb178-24" aria-hidden="true" tabindex="-1"></a>    weather <span class="ot">&lt;-</span> <span class="fu">make_all_day_table</span>(<span class="fu">data.frame</span>(<span class="at">Year =</span> <span class="fu">c</span>(<span class="dv">2002</span>, <span class="dv">2002</span>), <span class="at">Month =</span> <span class="fu">c</span>(mon,</span>
<span id="cb178-25"><a href="#cb178-25" aria-hidden="true" tabindex="-1"></a>        mon), <span class="at">Day =</span> <span class="fu">c</span>(<span class="dv">1</span>, days_month), <span class="at">Tmin =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">Tmax =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb178-26"><a href="#cb178-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-27"><a href="#cb178-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (tmin <span class="cf">in</span> Tmins) <span class="cf">for</span> (tmax <span class="cf">in</span> Tmaxs) <span class="cf">if</span> (tmax <span class="sc">&gt;=</span> tmin) {</span>
<span id="cb178-28"><a href="#cb178-28" aria-hidden="true" tabindex="-1"></a>        hourtemps <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span></span>
<span id="cb178-29"><a href="#cb178-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">Tmin =</span> tmin, <span class="at">Tmax =</span> tmax) <span class="sc">%&gt;%</span></span>
<span id="cb178-30"><a href="#cb178-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stack_hourly_temps</span>(<span class="at">latitude =</span> latitude) <span class="sc">%&gt;%</span></span>
<span id="cb178-31"><a href="#cb178-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">pluck</span>(<span class="st">&quot;hourtemps&quot;</span>, <span class="st">&quot;Temp&quot;</span>)</span>
<span id="cb178-32"><a href="#cb178-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-33"><a href="#cb178-33" aria-hidden="true" tabindex="-1"></a>        chill_eff <span class="ot">&lt;-</span> <span class="fu">c</span>(chill_eff, <span class="fu">PhenoFlex</span>(<span class="at">temp =</span> hourtemps, <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(hourtemps)),</span>
<span id="cb178-34"><a href="#cb178-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">A0 =</span> simulation_par[<span class="dv">7</span>], <span class="at">A1 =</span> simulation_par[<span class="dv">8</span>], <span class="at">E0 =</span> simulation_par[<span class="dv">5</span>],</span>
<span id="cb178-35"><a href="#cb178-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">E1 =</span> simulation_par[<span class="dv">6</span>], <span class="at">Tf =</span> simulation_par[<span class="dv">9</span>], <span class="at">slope =</span> simulation_par[<span class="dv">12</span>],</span>
<span id="cb178-36"><a href="#cb178-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">deg_celsius =</span> <span class="cn">TRUE</span>, <span class="at">basic_output =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>y[<span class="fu">length</span>(hourtemps)]<span class="sc">/</span>(<span class="fu">length</span>(hourtemps)<span class="sc">/</span><span class="dv">24</span>))</span>
<span id="cb178-37"><a href="#cb178-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-38"><a href="#cb178-38" aria-hidden="true" tabindex="-1"></a>        heat_eff <span class="ot">&lt;-</span> <span class="fu">c</span>(heat_eff, <span class="fu">cumsum</span>(<span class="fu">GDH_response</span>(hourtemps, simulation_par))[<span class="fu">length</span>(hourtemps)]<span class="sc">/</span>(<span class="fu">length</span>(hourtemps)<span class="sc">/</span><span class="dv">24</span>))</span>
<span id="cb178-39"><a href="#cb178-39" aria-hidden="true" tabindex="-1"></a>        mins <span class="ot">&lt;-</span> <span class="fu">c</span>(mins, tmin)</span>
<span id="cb178-40"><a href="#cb178-40" aria-hidden="true" tabindex="-1"></a>        maxs <span class="ot">&lt;-</span> <span class="fu">c</span>(maxs, tmax)</span>
<span id="cb178-41"><a href="#cb178-41" aria-hidden="true" tabindex="-1"></a>        month <span class="ot">&lt;-</span> <span class="fu">c</span>(month, mon)</span>
<span id="cb178-42"><a href="#cb178-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb178-43"><a href="#cb178-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb178-44"><a href="#cb178-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-45"><a href="#cb178-45" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Month =</span> month, <span class="at">Tmin =</span> mins, <span class="at">Tmax =</span> maxs, <span class="at">Chill_eff =</span> chill_eff,</span>
<span id="cb178-46"><a href="#cb178-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">Heat_eff =</span> heat_eff) <span class="sc">%&gt;%</span></span>
<span id="cb178-47"><a href="#cb178-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Month))</span>
<span id="cb178-48"><a href="#cb178-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-49"><a href="#cb178-49" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(results, <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/model_sensitivity_PhenoFlex_Roter.csv&quot;</span>)</span>
<span id="cb178-50"><a href="#cb178-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-51"><a href="#cb178-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Chill response plot</span></span>
<span id="cb178-52"><a href="#cb178-52" aria-hidden="true" tabindex="-1"></a>Model_sensitivities_PhenoFlex <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/model_sensitivity_PhenoFlex_Roter.csv&quot;</span>)</span>
<span id="cb178-53"><a href="#cb178-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-54"><a href="#cb178-54" aria-hidden="true" tabindex="-1"></a>Rochester_weather <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_weather.csv&quot;</span>)</span>
<span id="cb178-55"><a href="#cb178-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-56"><a href="#cb178-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-57"><a href="#cb178-57" aria-hidden="true" tabindex="-1"></a><span class="fu">Chill_sensitivity_temps</span>(Model_sensitivities_PhenoFlex, Rochester_weather, <span class="at">temp_model =</span> <span class="st">&quot;Chill_eff&quot;</span>,</span>
<span id="cb178-58"><a href="#cb178-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">Tmins =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">20</span>), <span class="at">Tmaxs =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span><span class="sc">:</span><span class="dv">30</span>), <span class="at">legend_label =</span> <span class="st">&quot;Chill per day </span><span class="sc">\n</span><span class="st">(arbitrary)&quot;</span>) <span class="sc">+</span></span>
<span id="cb178-59"><a href="#cb178-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;PhenoFlex chill efficiency (&#39;Roter Boskoop&#39;)&quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 606 rows containing missing values or values outside the scale range
(`geom_tile()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 50 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-62-3.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb181"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Heat response plot</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Chill_sensitivity_temps</span>(Model_sensitivities_PhenoFlex, Rochester_weather, <span class="at">temp_model =</span> <span class="st">&quot;Heat_eff&quot;</span>,</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">Tmins =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">20</span>), <span class="at">Tmaxs =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span><span class="sc">:</span><span class="dv">30</span>), <span class="at">legend_label =</span> <span class="st">&quot;Heat per day </span><span class="sc">\n</span><span class="st">(arbitrary)&quot;</span>) <span class="sc">+</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;PhenoFlex heat efficiency (&#39;Roter Boskoop&#39;)&quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 606 rows containing missing values or values outside the scale range
(`geom_tile()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 50 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<hr />
</section>
</section>
<section id="chapter-32-can-we-improve-the-performance-of-phenoflex" class="level1">
<h1>Chapter 32: Can we improve the performance of PhenoFlex</h1>
<section id="exercises-on-improving-the-performance-of-phenoflex" class="level2">
<h2><strong><em>Exercises on improving the performance of PhenoFlex</em></strong></h2>
<p>Describe (briefly) in your own words:</p>
<ol type="1">
<li><p>What was the objective of this work? The objective is to validate the PhenoFlex model under different conditions. Also, some results obtained in the original publication suggest temperature responses during chill accumulation that seem implausible.</p></li>
<li><p>What was the main conclusion? Discussions on the major potential limitations of the PhenoFlex and other models. It has been obbserved that under extreme conditions, the process of dormancy breaking is modulated by mechanisms that are not considered in the PhenoFlex framework.</p></li>
<li><p>What experiments could we conduct to test the hypothesis that emerged at the end of the conclusion? It has been concluded that additional systematic studies would have to be conducted.</p></li>
</ol>
<hr />
</section>
</section>
<section id="chapter-33-frost-risk-analysis" class="level1">
<h1>Chapter 33: Frost risk analysis</h1>
<section id="exercises-on-frost-risk-analysis" class="level2">
<h2><strong><em>Exercises on frost risk analysis</em></strong></h2>
<p>1.Download the phenology dataset for the apple cultivar Roter Boskoop from Klein-Altendorf.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb184"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>CKA_Roter_Boskoop <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Roter_Boskoop_bloom_1958_2019.csv.csv&quot;</span>)</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>Roter_Boskoop <span class="ot">&lt;-</span> CKA_Roter_Boskoop <span class="sc">%&gt;%</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">&quot;First_bloom&quot;</span><span class="sc">:</span><span class="st">&quot;Last_bloom&quot;</span>,</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to=</span><span class="st">&quot;YEARMODA&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(YEARMODA, <span class="dv">1</span>, <span class="dv">4</span>)),</span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(YEARMODA, <span class="dv">5</span>, <span class="dv">6</span>)),</span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(YEARMODA, <span class="dv">7</span>, <span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_JDay</span>() </span></code></pre></div>
</details>
</div>
<p>2.Illustrate the development of the bloom period over the duration of the weather record. Use multiple ways to show this - feel free to be creative.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb185"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Illustrating with a scatter plot</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Roter_Boskoop,<span class="fu">aes</span>(Pheno_year, JDay, <span class="at">col =</span> variable)) <span class="sc">+</span></span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm) <span class="sc">+</span></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(</span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Phenological event&quot;</span>,</span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;First bloom&quot;</span>, <span class="st">&quot;Full bloom&quot;</span>, <span class="st">&quot;Last bloom&quot;</span>)) <span class="sc">+</span></span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Phenological year&quot;</span>) <span class="sc">+</span></span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Julian date (day of the year)&quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Evaluate the occurrence of frost events at Klein-Altendorf since 1958. Illustrate this in a plot.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb187"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating model for frost hours (temperatures &lt; 0Â°C)</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>frost_df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1000</span>, <span class="dv">0</span>),</span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>),</span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a>frost_model <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">step_model</span>(x,</span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>                                      frost_df)</span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert temperature record to hourly values</span></span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a>hourly <span class="ot">&lt;-</span> <span class="fu">stack_hourly_temps</span>(CKA_weather,</span>
<span id="cb187-16"><a href="#cb187-16" aria-hidden="true" tabindex="-1"></a>                             <span class="at">latitude =</span> <span class="fl">50.625</span>)</span>
<span id="cb187-17"><a href="#cb187-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-18"><a href="#cb187-18" aria-hidden="true" tabindex="-1"></a>frost <span class="ot">&lt;-</span> <span class="fu">tempResponse</span>(hourly,</span>
<span id="cb187-19"><a href="#cb187-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">models =</span> <span class="fu">c</span>(<span class="at">frost =</span> frost_model))</span>
<span id="cb187-20"><a href="#cb187-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-21"><a href="#cb187-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot number of frost hours</span></span>
<span id="cb187-22"><a href="#cb187-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(frost,</span>
<span id="cb187-23"><a href="#cb187-23" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(End_year,</span>
<span id="cb187-24"><a href="#cb187-24" aria-hidden="true" tabindex="-1"></a>           frost)) <span class="sc">+</span></span>
<span id="cb187-25"><a href="#cb187-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb187-26"><a href="#cb187-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb187-27"><a href="#cb187-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb187-28"><a href="#cb187-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Frost hours per year&quot;</span>) <span class="sc">+</span></span>
<span id="cb187-29"><a href="#cb187-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Year&quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img src="tree_phenology_assignment_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>Produce an illustration of the relationship between spring frost events and the bloom period of âRoter Boskoopâ.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb189"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(chillR)</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(leaflet)</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyverse)</span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(kableExtra)</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(Kendall)</span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # Generating model for frost hours (temperatures &lt; 0Â°C)</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a><span class="co"># frost_df = data.frame(</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   lower = c(-1000, 0),</span></span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   upper = c(0, 1000),</span></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   weight = c(1, 0))</span></span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a><span class="co"># frost_model &lt;- function(x) step_model(x,</span></span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                                       frost_df)</span></span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert temperature record to hourly values</span></span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a><span class="co"># hourly &lt;- stack_hourly_temps(CKA_weather,</span></span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a><span class="co">#                              latitude = 50.625)</span></span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a><span class="co"># frost &lt;- tempResponse(hourly,</span></span>
<span id="cb189-21"><a href="#cb189-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                       models = c(frost = frost_model))</span></span>
<span id="cb189-22"><a href="#cb189-22" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-23"><a href="#cb189-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-24"><a href="#cb189-24" aria-hidden="true" tabindex="-1"></a><span class="co"># # Ribbon for total bloom duration</span></span>
<span id="cb189-25"><a href="#cb189-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Ribbon_Boskoop &lt;-</span></span>
<span id="cb189-26"><a href="#cb189-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   Roter_Boskoop %&gt;%</span></span>
<span id="cb189-27"><a href="#cb189-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(Pheno_year, variable, JDay) %&gt;%</span></span>
<span id="cb189-28"><a href="#cb189-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = &quot;variable&quot;, values_from = &quot;JDay&quot;)</span></span>
<span id="cb189-29"><a href="#cb189-29" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-30"><a href="#cb189-30" aria-hidden="true" tabindex="-1"></a><span class="co"># # Identify frost events that overlap with bloom </span></span>
<span id="cb189-31"><a href="#cb189-31" aria-hidden="true" tabindex="-1"></a><span class="co"># lookup_dates &lt;- Ribbon_Boskoop</span></span>
<span id="cb189-32"><a href="#cb189-32" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-33"><a href="#cb189-33" aria-hidden="true" tabindex="-1"></a><span class="co"># row.names(lookup_dates) &lt;- lookup_dates$Pheno_year</span></span>
<span id="cb189-34"><a href="#cb189-34" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-35"><a href="#cb189-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily_frost[, &quot;First_bloom&quot;]&lt;-</span></span>
<span id="cb189-36"><a href="#cb189-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   lookup_dates[as.character(Daily_frost$Year),</span></span>
<span id="cb189-37"><a href="#cb189-37" aria-hidden="true" tabindex="-1"></a><span class="co">#                &quot;First_bloom&quot;]</span></span>
<span id="cb189-38"><a href="#cb189-38" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-39"><a href="#cb189-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily_frost[, &quot;Last_bloom&quot;] &lt;-</span></span>
<span id="cb189-40"><a href="#cb189-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   lookup_dates[as.character(Daily_frost$Year),</span></span>
<span id="cb189-41"><a href="#cb189-41" aria-hidden="true" tabindex="-1"></a><span class="co">#                &quot;Last_bloom&quot;]</span></span>
<span id="cb189-42"><a href="#cb189-42" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-43"><a href="#cb189-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily_frost[which(!is.na(Daily_frost$Frost_hours)),</span></span>
<span id="cb189-44"><a href="#cb189-44" aria-hidden="true" tabindex="-1"></a><span class="co">#             &quot;Bloom_frost&quot;] &lt;-</span></span>
<span id="cb189-45"><a href="#cb189-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   &quot;Before bloom&quot;</span></span>
<span id="cb189-46"><a href="#cb189-46" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-47"><a href="#cb189-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily_frost[which(Daily_frost$JDay &gt;= Daily_frost$First_bloom),</span></span>
<span id="cb189-48"><a href="#cb189-48" aria-hidden="true" tabindex="-1"></a><span class="co">#             &quot;Bloom_frost&quot;] &lt;-</span></span>
<span id="cb189-49"><a href="#cb189-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   &quot;During bloom&quot;</span></span>
<span id="cb189-50"><a href="#cb189-50" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-51"><a href="#cb189-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily_frost[which(Daily_frost$JDay &gt; Daily_frost$Last_bloom),</span></span>
<span id="cb189-52"><a href="#cb189-52" aria-hidden="true" tabindex="-1"></a><span class="co">#             &quot;Bloom_frost&quot;] &lt;-</span></span>
<span id="cb189-53"><a href="#cb189-53" aria-hidden="true" tabindex="-1"></a><span class="co">#   &quot;After bloom&quot;</span></span>
<span id="cb189-54"><a href="#cb189-54" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb189-55"><a href="#cb189-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily_frost[which(Daily_frost$JDay &gt; 180),</span></span>
<span id="cb189-56"><a href="#cb189-56" aria-hidden="true" tabindex="-1"></a><span class="co">#             &quot;Bloom_frost&quot;] &lt;-</span></span>
<span id="cb189-57"><a href="#cb189-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   &quot;Before bloom&quot;</span></span>
<span id="cb189-58"><a href="#cb189-58" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot spring frost events that coincided with bloom</span></span>
<span id="cb189-59"><a href="#cb189-59" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(data = Ribbon_Boskoop,</span></span>
<span id="cb189-60"><a href="#cb189-60" aria-hidden="true" tabindex="-1"></a><span class="co">#        aes(Pheno_year)) +</span></span>
<span id="cb189-61"><a href="#cb189-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_ribbon(aes(ymin = First_bloom, </span></span>
<span id="cb189-62"><a href="#cb189-62" aria-hidden="true" tabindex="-1"></a><span class="co">#                   ymax = Last_bloom),</span></span>
<span id="cb189-63"><a href="#cb189-63" aria-hidden="true" tabindex="-1"></a><span class="co">#               fill = &quot;light gray&quot;) +</span></span>
<span id="cb189-64"><a href="#cb189-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(aes(y = Full_bloom)) +</span></span>
<span id="cb189-65"><a href="#cb189-65" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_bw(base_size = 15) +</span></span>
<span id="cb189-66"><a href="#cb189-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   xlab(&quot;Phenological year&quot;) +</span></span>
<span id="cb189-67"><a href="#cb189-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   ylab(&quot;Julian date (day of the year)&quot;) +</span></span>
<span id="cb189-68"><a href="#cb189-68" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(data = Daily_frost,</span></span>
<span id="cb189-69"><a href="#cb189-69" aria-hidden="true" tabindex="-1"></a><span class="co">#              aes(Year,</span></span>
<span id="cb189-70"><a href="#cb189-70" aria-hidden="true" tabindex="-1"></a><span class="co">#                  JDay,</span></span>
<span id="cb189-71"><a href="#cb189-71" aria-hidden="true" tabindex="-1"></a><span class="co">#                  size = Frost_hours,</span></span>
<span id="cb189-72"><a href="#cb189-72" aria-hidden="true" tabindex="-1"></a><span class="co">#                  col = Bloom_frost),</span></span>
<span id="cb189-73"><a href="#cb189-73" aria-hidden="true" tabindex="-1"></a><span class="co">#              alpha = 0.8) + </span></span>
<span id="cb189-74"><a href="#cb189-74" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_size(range = c(0, 5),</span></span>
<span id="cb189-75"><a href="#cb189-75" aria-hidden="true" tabindex="-1"></a><span class="co">#              breaks = c(1, 5, 10, 15, 20),</span></span>
<span id="cb189-76"><a href="#cb189-76" aria-hidden="true" tabindex="-1"></a><span class="co">#              labels = c(&quot;1&quot;, &quot;5&quot;, &quot;10&quot;, &quot;15&quot;, &quot;20&quot;),</span></span>
<span id="cb189-77"><a href="#cb189-77" aria-hidden="true" tabindex="-1"></a><span class="co">#              name = &quot;Frost hours&quot;) +</span></span>
<span id="cb189-78"><a href="#cb189-78" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(</span></span>
<span id="cb189-79"><a href="#cb189-79" aria-hidden="true" tabindex="-1"></a><span class="co">#     breaks = c(&quot;Before bloom&quot;,</span></span>
<span id="cb189-80"><a href="#cb189-80" aria-hidden="true" tabindex="-1"></a><span class="co">#                &quot;During bloom&quot;,</span></span>
<span id="cb189-81"><a href="#cb189-81" aria-hidden="true" tabindex="-1"></a><span class="co">#                &quot;After bloom&quot;),</span></span>
<span id="cb189-82"><a href="#cb189-82" aria-hidden="true" tabindex="-1"></a><span class="co">#     values = c(&quot;light green&quot;,</span></span>
<span id="cb189-83"><a href="#cb189-83" aria-hidden="true" tabindex="-1"></a><span class="co">#                &quot;red&quot;,</span></span>
<span id="cb189-84"><a href="#cb189-84" aria-hidden="true" tabindex="-1"></a><span class="co">#                &quot;light blue&quot;),</span></span>
<span id="cb189-85"><a href="#cb189-85" aria-hidden="true" tabindex="-1"></a><span class="co">#     name = &quot;Frost timing&quot;) +</span></span>
<span id="cb189-86"><a href="#cb189-86" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_bw(base_size = 15) +</span></span>
<span id="cb189-87"><a href="#cb189-87" aria-hidden="true" tabindex="-1"></a><span class="co">#   ylim(c(75, 140))</span></span></code></pre></div>
</details>
</div>
<ol start="5" type="1">
<li>Evaluate how the risk of spring frost for this cultivar has changed over time. Has there been a significant trend?</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode" id="cb190"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(chillR)</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(leaflet)</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyverse)</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(kableExtra)</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(Kendall)</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # Generating model for frost hours (temperatures &lt; 0Â°C)</span></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a><span class="co"># frost_df = data.frame(</span></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   lower = c(-1000, 0),</span></span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   upper = c(0, 1000),</span></span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   weight = c(1, 0))</span></span>
<span id="cb190-12"><a href="#cb190-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb190-13"><a href="#cb190-13" aria-hidden="true" tabindex="-1"></a><span class="co"># frost_model &lt;- function(x) step_model(x,</span></span>
<span id="cb190-14"><a href="#cb190-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                                       frost_df)</span></span>
<span id="cb190-15"><a href="#cb190-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb190-16"><a href="#cb190-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert temperature record to hourly values</span></span>
<span id="cb190-17"><a href="#cb190-17" aria-hidden="true" tabindex="-1"></a><span class="co"># hourly &lt;- stack_hourly_temps(CKA_weather,</span></span>
<span id="cb190-18"><a href="#cb190-18" aria-hidden="true" tabindex="-1"></a><span class="co">#                              latitude = 50.625)</span></span>
<span id="cb190-19"><a href="#cb190-19" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb190-20"><a href="#cb190-20" aria-hidden="true" tabindex="-1"></a><span class="co"># frost &lt;- tempResponse(hourly,</span></span>
<span id="cb190-21"><a href="#cb190-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                       models = c(frost = frost_model))</span></span>
<span id="cb190-22"><a href="#cb190-22" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb190-23"><a href="#cb190-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb190-24"><a href="#cb190-24" aria-hidden="true" tabindex="-1"></a><span class="co"># # Investigate if there is a long-term trend in the number of frost hours during bloom</span></span>
<span id="cb190-25"><a href="#cb190-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Bloom_frost_trend &lt;- </span></span>
<span id="cb190-26"><a href="#cb190-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   aggregate(</span></span>
<span id="cb190-27"><a href="#cb190-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     Daily_frost$Frost_hours,</span></span>
<span id="cb190-28"><a href="#cb190-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     by = list(Daily_frost$Year,</span></span>
<span id="cb190-29"><a href="#cb190-29" aria-hidden="true" tabindex="-1"></a><span class="co">#               Daily_frost$Bloom_frost),</span></span>
<span id="cb190-30"><a href="#cb190-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     FUN = function(x) sum(x,</span></span>
<span id="cb190-31"><a href="#cb190-31" aria-hidden="true" tabindex="-1"></a><span class="co">#                           na.rm = TRUE))</span></span>
<span id="cb190-32"><a href="#cb190-32" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb190-33"><a href="#cb190-33" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(Bloom_frost_trend) &lt;- c(&quot;Year&quot;,</span></span>
<span id="cb190-34"><a href="#cb190-34" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  &quot;Frost_timing&quot;,</span></span>
<span id="cb190-35"><a href="#cb190-35" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  &quot;Frost_hours&quot;)</span></span>
<span id="cb190-36"><a href="#cb190-36" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb190-37"><a href="#cb190-37" aria-hidden="true" tabindex="-1"></a><span class="co"># DuringBloom &lt;-</span></span>
<span id="cb190-38"><a href="#cb190-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   Bloom_frost_trend[</span></span>
<span id="cb190-39"><a href="#cb190-39" aria-hidden="true" tabindex="-1"></a><span class="co">#     which(Bloom_frost_trend$Frost_timing == &quot;During bloom&quot;),]</span></span>
<span id="cb190-40"><a href="#cb190-40" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb190-41"><a href="#cb190-41" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(data = DuringBloom,</span></span>
<span id="cb190-42"><a href="#cb190-42" aria-hidden="true" tabindex="-1"></a><span class="co">#        aes(Year,</span></span>
<span id="cb190-43"><a href="#cb190-43" aria-hidden="true" tabindex="-1"></a><span class="co">#            Frost_hours)) +</span></span>
<span id="cb190-44"><a href="#cb190-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col() +</span></span>
<span id="cb190-45"><a href="#cb190-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   ylab(&quot;Frost hours&quot;)</span></span></code></pre></div>
</details>
</div>
<!-- -->
<div class="quarto-embedded-source-code">
<div class="sourceCode" id="cb191" data-shortcodes="false"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &quot;Tree Phenology Assignment&quot;</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> &quot;Olamide Akinlade&quot;</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> &quot;`r format(Sys.time(), &#39;%B %d, %Y&#39;)`&quot;</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_float: true</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: &quot;Contents&quot;</span></span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 5</span></span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number_sections: true</span></span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a><span class="co">    fig_caption: true</span></span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb191-15"><a href="#cb191-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb191-16"><a href="#cb191-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: &#39;Show code&#39;</span></span>
<span id="cb191-17"><a href="#cb191-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb191-18"><a href="#cb191-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code_highlight: tango</span></span>
<span id="cb191-19"><a href="#cb191-19" aria-hidden="true" tabindex="-1"></a><span class="co">    code_download: true</span></span>
<span id="cb191-20"><a href="#cb191-20" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: sandstone</span></span>
<span id="cb191-21"><a href="#cb191-21" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight: tango</span></span>
<span id="cb191-22"><a href="#cb191-22" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb191-23"><a href="#cb191-23" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> </span></span>
<span id="cb191-24"><a href="#cb191-24" aria-hidden="true" tabindex="-1"></a><span class="co">  markdown: </span></span>
<span id="cb191-25"><a href="#cb191-25" aria-hidden="true" tabindex="-1"></a><span class="co">    wrap: 72</span></span>
<span id="cb191-26"><a href="#cb191-26" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb191-27"><a href="#cb191-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-28"><a href="#cb191-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb191-29"><a href="#cb191-29" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(echo = TRUE)</span></span>
<span id="cb191-30"><a href="#cb191-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-31"><a href="#cb191-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-32"><a href="#cb191-32" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-33"><a href="#cb191-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-34"><a href="#cb191-34" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 3: Tree Phenology Analysis</span></span>
<span id="cb191-35"><a href="#cb191-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-36"><a href="#cb191-36" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1.1 Tree Dormancy</span></span>
<span id="cb191-37"><a href="#cb191-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-38"><a href="#cb191-38" aria-hidden="true" tabindex="-1"></a>Winter dormancy may be defined as a trade-off between the length of the</span>
<span id="cb191-39"><a href="#cb191-39" aria-hidden="true" tabindex="-1"></a>growing season and the protection against winter damage. To enter</span>
<span id="cb191-40"><a href="#cb191-40" aria-hidden="true" tabindex="-1"></a>dormancy, vegetative growth is stopped in the late summer or early</span>
<span id="cb191-41"><a href="#cb191-41" aria-hidden="true" tabindex="-1"></a>autumn and the shoots are converted into buds, where the shoot apical</span>
<span id="cb191-42"><a href="#cb191-42" aria-hidden="true" tabindex="-1"></a>meristems are protected by tightly closed and hardened bud scales.</span>
<span id="cb191-43"><a href="#cb191-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-44"><a href="#cb191-44" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1.1.1 Dormancy Phases</span></span>
<span id="cb191-45"><a href="#cb191-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-46"><a href="#cb191-46" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Dormancy Establishment</span>
<span id="cb191-47"><a href="#cb191-47" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Endodormancy 1: Ecodormancy</span>
<span id="cb191-48"><a href="#cb191-48" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Growth resumption</span>
<span id="cb191-49"><a href="#cb191-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-50"><a href="#cb191-50" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1.1.2 Physological processes that regulate dormancy</span></span>
<span id="cb191-51"><a href="#cb191-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-52"><a href="#cb191-52" aria-hidden="true" tabindex="-1"></a>a.  Transport</span>
<span id="cb191-53"><a href="#cb191-53" aria-hidden="true" tabindex="-1"></a>b.  Photohormones</span>
<span id="cb191-54"><a href="#cb191-54" aria-hidden="true" tabindex="-1"></a>c.  Genetics</span>
<span id="cb191-55"><a href="#cb191-55" aria-hidden="true" tabindex="-1"></a>d.  Carbohydrates dynamics</span>
<span id="cb191-56"><a href="#cb191-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-57"><a href="#cb191-57" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on Tree Dormancy***</span></span>
<span id="cb191-58"><a href="#cb191-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-59"><a href="#cb191-59" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Put yourself in the place of a breeder who wants to calculate the</span>
<span id="cb191-60"><a href="#cb191-60" aria-hidden="true" tabindex="-1"></a>    temperature requirements of a newly released cultivar. Which method</span>
<span id="cb191-61"><a href="#cb191-61" aria-hidden="true" tabindex="-1"></a>    will you use to calculate the chilling and forcing periods? Please</span>
<span id="cb191-62"><a href="#cb191-62" aria-hidden="true" tabindex="-1"></a>    justify your answer</span>
<span id="cb191-63"><a href="#cb191-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-64"><a href="#cb191-64" aria-hidden="true" tabindex="-1"></a>Statistical method is recommended to calculate the temperature</span>
<span id="cb191-65"><a href="#cb191-65" aria-hidden="true" tabindex="-1"></a>requirements (chilling and forcing periods) of a newly released</span>
<span id="cb191-66"><a href="#cb191-66" aria-hidden="true" tabindex="-1"></a>cultivar. This involves using partial least square regression analysis</span>
<span id="cb191-67"><a href="#cb191-67" aria-hidden="true" tabindex="-1"></a>for daily temperatures over a continuous period.</span>
<span id="cb191-68"><a href="#cb191-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-69"><a href="#cb191-69" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Which are the advantages (2) of the BBCH scale compared with earlier</span>
<span id="cb191-70"><a href="#cb191-70" aria-hidden="true" tabindex="-1"></a>    scales?</span>
<span id="cb191-71"><a href="#cb191-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-72"><a href="#cb191-72" aria-hidden="true" tabindex="-1"></a>Two advantages of the BBCH scale over traditional scale include: a. It</span>
<span id="cb191-73"><a href="#cb191-73" aria-hidden="true" tabindex="-1"></a>was developed in a general frame for all the species b. It covers the</span>
<span id="cb191-74"><a href="#cb191-74" aria-hidden="true" tabindex="-1"></a>whole development of a plant.</span>
<span id="cb191-75"><a href="#cb191-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-76"><a href="#cb191-76" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Classify the following phenological stages of sweet cherry according</span>
<span id="cb191-77"><a href="#cb191-77" aria-hidden="true" tabindex="-1"></a>    to the BBCH scale:</span>
<span id="cb191-78"><a href="#cb191-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-79"><a href="#cb191-79" aria-hidden="true" tabindex="-1"></a>Phenological stages of cherry + Image 1: 51</span>
<span id="cb191-80"><a href="#cb191-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-81"><a href="#cb191-81" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Image 2: 63</span>
<span id="cb191-82"><a href="#cb191-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-83"><a href="#cb191-83" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Image 3: 87</span>
<span id="cb191-84"><a href="#cb191-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-85"><a href="#cb191-85" aria-hidden="true" tabindex="-1"></a>![Stages of</span>
<span id="cb191-86"><a href="#cb191-86" aria-hidden="true" tabindex="-1"></a>Cherry](&quot;C:\Users\Home\Documents\R Files\Tree_Phenology_Analysis_with_R\data_New_York\pheno_stages.png&quot;)</span>
<span id="cb191-87"><a href="#cb191-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-88"><a href="#cb191-88" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-89"><a href="#cb191-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-90"><a href="#cb191-90" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 4: Climate Change and impact projection</span></span>
<span id="cb191-91"><a href="#cb191-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-92"><a href="#cb191-92" aria-hidden="true" tabindex="-1"></a><span class="fu"># 1.1 Drivers of Climate change include:</span></span>
<span id="cb191-93"><a href="#cb191-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-94"><a href="#cb191-94" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sun: Warms the earth through radiation. It is an important driver of</span>
<span id="cb191-95"><a href="#cb191-95" aria-hidden="true" tabindex="-1"></a>    climate change on geological timescales, but not of recent climate</span>
<span id="cb191-96"><a href="#cb191-96" aria-hidden="true" tabindex="-1"></a>    change.</span>
<span id="cb191-97"><a href="#cb191-97" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Aerosols: They are largely dusts. Suspensions of liquid, solid, or</span>
<span id="cb191-98"><a href="#cb191-98" aria-hidden="true" tabindex="-1"></a>    mixed particles with highly variable chemical composition and size</span>
<span id="cb191-99"><a href="#cb191-99" aria-hidden="true" tabindex="-1"></a>    distribution.</span>
<span id="cb191-100"><a href="#cb191-100" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Clouds: Can have both cooling and warming effect.</span>
<span id="cb191-101"><a href="#cb191-101" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ozone: Surface (tropospheric) ozone: constituent of smog, health</span>
<span id="cb191-102"><a href="#cb191-102" aria-hidden="true" tabindex="-1"></a>    hazard (bad ozone). Greenhouse gas: presence in the stratosphere has</span>
<span id="cb191-103"><a href="#cb191-103" aria-hidden="true" tabindex="-1"></a>    a warming effect. Destroyed by chlorofluorocarbons (CFCs).</span>
<span id="cb191-104"><a href="#cb191-104" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Surface albedo: Reflection of radiation by the land surface. Light</span>
<span id="cb191-105"><a href="#cb191-105" aria-hidden="true" tabindex="-1"></a>    surfaces (e.g. ice, snow) reflect almost all radiation, dark</span>
<span id="cb191-106"><a href="#cb191-106" aria-hidden="true" tabindex="-1"></a>    surfaces (ocean, dark soil, forest) very little.</span>
<span id="cb191-107"><a href="#cb191-107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Greenhouse gases: Atmospheric gases that trap heat on Earth.</span>
<span id="cb191-108"><a href="#cb191-108" aria-hidden="true" tabindex="-1"></a>    Greenhouse effects warms the planet.</span>
<span id="cb191-109"><a href="#cb191-109" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Long-term drivers:</span>
<span id="cb191-110"><a href="#cb191-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-111"><a href="#cb191-111" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on Climate Change***</span></span>
<span id="cb191-112"><a href="#cb191-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-113"><a href="#cb191-113" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>List the main drivers of climate change at the decade to century</span>
<span id="cb191-114"><a href="#cb191-114" aria-hidden="true" tabindex="-1"></a>    scale, and briefly explain the mechanism through which the currently</span>
<span id="cb191-115"><a href="#cb191-115" aria-hidden="true" tabindex="-1"></a>    most important driver affects our climate.</span>
<span id="cb191-116"><a href="#cb191-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-117"><a href="#cb191-117" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sun</span>
<span id="cb191-118"><a href="#cb191-118" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Aerosols</span>
<span id="cb191-119"><a href="#cb191-119" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Clouds</span>
<span id="cb191-120"><a href="#cb191-120" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ozone</span>
<span id="cb191-121"><a href="#cb191-121" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Surface albedo</span>
<span id="cb191-122"><a href="#cb191-122" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Greenhouse gases</span>
<span id="cb191-123"><a href="#cb191-123" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Long-term drivers</span>
<span id="cb191-124"><a href="#cb191-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-125"><a href="#cb191-125" aria-hidden="true" tabindex="-1"></a>Most important: **GHGs** **Greenhouse effect** + Raises Earthâs mean</span>
<span id="cb191-126"><a href="#cb191-126" aria-hidden="true" tabindex="-1"></a>temperature: +14Â°C instead of -18Â°C without GHGs! + Major GHGs: water</span>
<span id="cb191-127"><a href="#cb191-127" aria-hidden="true" tabindex="-1"></a>vapor, CO2 (carbon dioxide), CH4 (methane), N2O (nitrous oxide)</span>
<span id="cb191-128"><a href="#cb191-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-129"><a href="#cb191-129" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Explain briefly what is special about temperature dynamics of recent</span>
<span id="cb191-130"><a href="#cb191-130" aria-hidden="true" tabindex="-1"></a>    decades, and why we have good reasons to be concerned.</span>
<span id="cb191-131"><a href="#cb191-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-132"><a href="#cb191-132" aria-hidden="true" tabindex="-1"></a>Since 1901 strong warming (almost) everywhere on Earth.Up to 8Â°C warmer</span>
<span id="cb191-133"><a href="#cb191-133" aria-hidden="true" tabindex="-1"></a>than the 2003-2018 average. Precipitation anomalies (relative to median</span>
<span id="cb191-134"><a href="#cb191-134" aria-hidden="true" tabindex="-1"></a>prec.) for Cologne/Bonn weather station. Some years with dry</span>
<span id="cb191-135"><a href="#cb191-135" aria-hidden="true" tabindex="-1"></a>springs/summer.</span>
<span id="cb191-136"><a href="#cb191-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-137"><a href="#cb191-137" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>What does the abbreviation âRCPâ stand for, how are RCPs defined,</span>
<span id="cb191-138"><a href="#cb191-138" aria-hidden="true" tabindex="-1"></a>    and what is their role in projecting future climates? Representative</span>
<span id="cb191-139"><a href="#cb191-139" aria-hidden="true" tabindex="-1"></a>    Concentration Pathways (RCPs). It is a new greenhouse forcing</span>
<span id="cb191-140"><a href="#cb191-140" aria-hidden="true" tabindex="-1"></a>    scenarios in the IPCCâs5th Assessment Report. From RCP to inputs for</span>
<span id="cb191-141"><a href="#cb191-141" aria-hidden="true" tabindex="-1"></a>    climate change impact models.</span>
<span id="cb191-142"><a href="#cb191-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-143"><a href="#cb191-143" aria-hidden="true" tabindex="-1"></a>Roles of RCP:</span>
<span id="cb191-144"><a href="#cb191-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-145"><a href="#cb191-145" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Briefly describe the 4 climate impact projection methods described</span>
<span id="cb191-146"><a href="#cb191-146" aria-hidden="true" tabindex="-1"></a>    in the fourth video.</span>
<span id="cb191-147"><a href="#cb191-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-148"><a href="#cb191-148" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Statistical models</span>
<span id="cb191-149"><a href="#cb191-149" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Species distribution modeling</span>
<span id="cb191-150"><a href="#cb191-150" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Process-based models</span>
<span id="cb191-151"><a href="#cb191-151" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Climate analogue analysis</span>
<span id="cb191-152"><a href="#cb191-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-153"><a href="#cb191-153" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-154"><a href="#cb191-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-155"><a href="#cb191-155" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 5: Winter Chill Projections</span></span>
<span id="cb191-156"><a href="#cb191-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-157"><a href="#cb191-157" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on past chill projections***</span></span>
<span id="cb191-158"><a href="#cb191-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-159"><a href="#cb191-159" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Sketch out three data access and processing challenges that had to</span>
<span id="cb191-160"><a href="#cb191-160" aria-hidden="true" tabindex="-1"></a>    be overcome in order to produce chill projections with</span>
<span id="cb191-161"><a href="#cb191-161" aria-hidden="true" tabindex="-1"></a>    state-of-the-art methodology.</span>
<span id="cb191-162"><a href="#cb191-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-163"><a href="#cb191-163" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Accessing Climate Data for Specific Locations: Previous climate</span>
<span id="cb191-164"><a href="#cb191-164" aria-hidden="true" tabindex="-1"></a>    datasets like AFRICLIM and ClimateWizard only provided large-scale</span>
<span id="cb191-165"><a href="#cb191-165" aria-hidden="true" tabindex="-1"></a>    data. To get weather data for specific locations without downloading</span>
<span id="cb191-166"><a href="#cb191-166" aria-hidden="true" tabindex="-1"></a>    too much extra information, an API was created to quickly access</span>
<span id="cb191-167"><a href="#cb191-167" aria-hidden="true" tabindex="-1"></a>    data for single sites</span>
<span id="cb191-168"><a href="#cb191-168" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Converting Daily to Hourly Temperature Data: Chill models need</span>
<span id="cb191-169"><a href="#cb191-169" aria-hidden="true" tabindex="-1"></a>    hourly temperature data, but many databases only give daily</span>
<span id="cb191-170"><a href="#cb191-170" aria-hidden="true" tabindex="-1"></a>    averages. Early methods for converting daily to hourly data werenât</span>
<span id="cb191-171"><a href="#cb191-171" aria-hidden="true" tabindex="-1"></a>    very good, especially in areas with unique temperatures. Improved</span>
<span id="cb191-172"><a href="#cb191-172" aria-hidden="true" tabindex="-1"></a>    algorithms were developed to estimate hourly temperatures more</span>
<span id="cb191-173"><a href="#cb191-173" aria-hidden="true" tabindex="-1"></a>    accurately from daily data</span>
<span id="cb191-174"><a href="#cb191-174" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Handling Large Volumes of Climate Model Outputs: Studying different</span>
<span id="cb191-175"><a href="#cb191-175" aria-hidden="true" tabindex="-1"></a>    climate futures involves dealing with a lot of data from many</span>
<span id="cb191-176"><a href="#cb191-176" aria-hidden="true" tabindex="-1"></a>    climate models, which can be hard to manage. To handle this large</span>
<span id="cb191-177"><a href="#cb191-177" aria-hidden="true" tabindex="-1"></a>    amount of data effectively, workflows were streamlined and selective</span>
<span id="cb191-178"><a href="#cb191-178" aria-hidden="true" tabindex="-1"></a>    processing techniques were used</span>
<span id="cb191-179"><a href="#cb191-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-180"><a href="#cb191-180" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Outline, in your understanding, the basic steps that are necessary</span>
<span id="cb191-181"><a href="#cb191-181" aria-hidden="true" tabindex="-1"></a>    to make such projections.</span>
<span id="cb191-182"><a href="#cb191-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-183"><a href="#cb191-183" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Data Collection and Calibration: collect historical weather data and</span>
<span id="cb191-184"><a href="#cb191-184" aria-hidden="true" tabindex="-1"></a>    use it to calibrate a weather generator for realistic temperature</span>
<span id="cb191-185"><a href="#cb191-185" aria-hidden="true" tabindex="-1"></a>    simulations</span>
<span id="cb191-186"><a href="#cb191-186" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Model Selection and Scenario Setup: choose relevant climate models</span>
<span id="cb191-187"><a href="#cb191-187" aria-hidden="true" tabindex="-1"></a>    and emission scenarios to explore various future climates</span>
<span id="cb191-188"><a href="#cb191-188" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Generate Temperature Projections: downscale climate data, converting</span>
<span id="cb191-189"><a href="#cb191-189" aria-hidden="true" tabindex="-1"></a>    it to daily or hourly temperatures as needed for chill calculations</span>
<span id="cb191-190"><a href="#cb191-190" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Chill Calculation: apply chill models to estimate chill accumulation</span>
<span id="cb191-191"><a href="#cb191-191" aria-hidden="true" tabindex="-1"></a>    across different climate scenarios</span>
<span id="cb191-192"><a href="#cb191-192" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Analysis and Visualization: compare chill projections across models</span>
<span id="cb191-193"><a href="#cb191-193" aria-hidden="true" tabindex="-1"></a>    and scenarios and visualize the findings</span>
<span id="cb191-194"><a href="#cb191-194" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation: validate projections with observed data where</span>
<span id="cb191-195"><a href="#cb191-195" aria-hidden="true" tabindex="-1"></a>    possible and assess agricultural impacts and adaptation needs</span>
<span id="cb191-196"><a href="#cb191-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-197"><a href="#cb191-197" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-198"><a href="#cb191-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-199"><a href="#cb191-199" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 6: Manual Chill Analysis</span></span>
<span id="cb191-200"><a href="#cb191-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-201"><a href="#cb191-201" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-202"><a href="#cb191-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-203"><a href="#cb191-203" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-204"><a href="#cb191-204" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb191-205"><a href="#cb191-205" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb191-206"><a href="#cb191-206" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb191-207"><a href="#cb191-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-208"><a href="#cb191-208" aria-hidden="true" tabindex="-1"></a>Winters_hours_gaps[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb191-209"><a href="#cb191-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-210"><a href="#cb191-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-211"><a href="#cb191-211" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Computing Chilling Hours from Hourly Temperature data***</span></span>
<span id="cb191-212"><a href="#cb191-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-213"><a href="#cb191-213" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Write a basic function that calculates warm hours (<span class="sc">\&gt;</span>25Â°C)</span>
<span id="cb191-214"><a href="#cb191-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-215"><a href="#cb191-215" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-216"><a href="#cb191-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-217"><a href="#cb191-217" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-218"><a href="#cb191-218" aria-hidden="true" tabindex="-1"></a>hourtemps <span class="ot">&lt;-</span> Winters_hours_gaps[,<span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>,</span>
<span id="cb191-219"><a href="#cb191-219" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Month&quot;</span>,</span>
<span id="cb191-220"><a href="#cb191-220" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Day&quot;</span>,</span>
<span id="cb191-221"><a href="#cb191-221" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Hour&quot;</span>,</span>
<span id="cb191-222"><a href="#cb191-222" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Temp&quot;</span>)]</span>
<span id="cb191-223"><a href="#cb191-223" aria-hidden="true" tabindex="-1"></a>hourtemps[, <span class="st">&quot;Chilling_Hour&quot;</span>] <span class="ot">&lt;-</span> hourtemps<span class="sc">$</span>Temp <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> hourtemps<span class="sc">$</span>Temp <span class="sc">&lt;=</span> <span class="fl">7.2</span></span>
<span id="cb191-224"><a href="#cb191-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-225"><a href="#cb191-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-226"><a href="#cb191-226" aria-hidden="true" tabindex="-1"></a>#calculate warm hours</span>
<span id="cb191-227"><a href="#cb191-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-228"><a href="#cb191-228" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-229"><a href="#cb191-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-230"><a href="#cb191-230" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-231"><a href="#cb191-231" aria-hidden="true" tabindex="-1"></a>WH<span class="ot">&lt;-</span><span class="cf">function</span>(hourtemps)</span>
<span id="cb191-232"><a href="#cb191-232" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb191-233"><a href="#cb191-233" aria-hidden="true" tabindex="-1"></a>  hourtemps[, <span class="st">&quot;Warm_Hour&quot;</span>] <span class="ot">&lt;-</span></span>
<span id="cb191-234"><a href="#cb191-234" aria-hidden="true" tabindex="-1"></a>    hourtemps<span class="sc">$</span>Temp <span class="sc">&gt;=</span> <span class="dv">25</span> </span>
<span id="cb191-235"><a href="#cb191-235" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-236"><a href="#cb191-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(hourtemps)</span>
<span id="cb191-237"><a href="#cb191-237" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb191-238"><a href="#cb191-238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-239"><a href="#cb191-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-240"><a href="#cb191-240" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Apply this function to the Winters_hours_gaps dataset</span>
<span id="cb191-241"><a href="#cb191-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-242"><a href="#cb191-242" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-243"><a href="#cb191-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-244"><a href="#cb191-244" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-245"><a href="#cb191-245" aria-hidden="true" tabindex="-1"></a><span class="fu">WH</span>(hourtemps)[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, ]</span>
<span id="cb191-246"><a href="#cb191-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-247"><a href="#cb191-247" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(hourtemps<span class="sc">$</span>Warm_Hour)</span>
<span id="cb191-248"><a href="#cb191-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-249"><a href="#cb191-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-250"><a href="#cb191-250" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Extend this function, so that it can take start and end dates as</span>
<span id="cb191-251"><a href="#cb191-251" aria-hidden="true" tabindex="-1"></a>    inputs and sums up warm hours between these dates</span>
<span id="cb191-252"><a href="#cb191-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-253"><a href="#cb191-253" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-254"><a href="#cb191-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-255"><a href="#cb191-255" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-256"><a href="#cb191-256" aria-hidden="true" tabindex="-1"></a>sum_WH <span class="ot">&lt;-</span> <span class="cf">function</span>(hourtemps, </span>
<span id="cb191-257"><a href="#cb191-257" aria-hidden="true" tabindex="-1"></a>                   startYEARMODAHO,</span>
<span id="cb191-258"><a href="#cb191-258" aria-hidden="true" tabindex="-1"></a>                   endYEARMODAHO)</span>
<span id="cb191-259"><a href="#cb191-259" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-260"><a href="#cb191-260" aria-hidden="true" tabindex="-1"></a>{hourtemps[,<span class="st">&quot;Warm_Hour&quot;</span>] <span class="ot">&lt;-</span> hourtemps<span class="sc">$</span>Temp <span class="sc">&gt;</span> <span class="dv">25</span></span>
<span id="cb191-261"><a href="#cb191-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-262"><a href="#cb191-262" aria-hidden="true" tabindex="-1"></a>startYear <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(startYEARMODAHO, <span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb191-263"><a href="#cb191-263" aria-hidden="true" tabindex="-1"></a>startMonth <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(startYEARMODAHO, <span class="dv">5</span>, <span class="dv">6</span>))</span>
<span id="cb191-264"><a href="#cb191-264" aria-hidden="true" tabindex="-1"></a>startDay <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(startYEARMODAHO, <span class="dv">7</span>, <span class="dv">8</span>))</span>
<span id="cb191-265"><a href="#cb191-265" aria-hidden="true" tabindex="-1"></a>startHour <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(startYEARMODAHO, <span class="dv">9</span>, <span class="dv">10</span>))</span>
<span id="cb191-266"><a href="#cb191-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-267"><a href="#cb191-267" aria-hidden="true" tabindex="-1"></a>endYear <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(endYEARMODAHO, <span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb191-268"><a href="#cb191-268" aria-hidden="true" tabindex="-1"></a>endMonth <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(endYEARMODAHO, <span class="dv">5</span>, <span class="dv">6</span>))</span>
<span id="cb191-269"><a href="#cb191-269" aria-hidden="true" tabindex="-1"></a>endDay <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(endYEARMODAHO, <span class="dv">7</span>, <span class="dv">8</span>))</span>
<span id="cb191-270"><a href="#cb191-270" aria-hidden="true" tabindex="-1"></a>endHour <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(endYEARMODAHO, <span class="dv">9</span>, <span class="dv">10</span>))</span>
<span id="cb191-271"><a href="#cb191-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-272"><a href="#cb191-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-273"><a href="#cb191-273" aria-hidden="true" tabindex="-1"></a>Start_Date <span class="ot">&lt;-</span> <span class="fu">which</span>(hourtemps<span class="sc">$</span>Year <span class="sc">==</span> startYear <span class="sc">&amp;</span></span>
<span id="cb191-274"><a href="#cb191-274" aria-hidden="true" tabindex="-1"></a>                    hourtemps<span class="sc">$</span>Month <span class="sc">==</span> startMonth <span class="sc">&amp;</span></span>
<span id="cb191-275"><a href="#cb191-275" aria-hidden="true" tabindex="-1"></a>                    hourtemps<span class="sc">$</span>Day <span class="sc">==</span> startDay <span class="sc">&amp;</span></span>
<span id="cb191-276"><a href="#cb191-276" aria-hidden="true" tabindex="-1"></a>                    hourtemps<span class="sc">$</span>Hour <span class="sc">==</span> startHour)</span>
<span id="cb191-277"><a href="#cb191-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-278"><a href="#cb191-278" aria-hidden="true" tabindex="-1"></a>End_Date <span class="ot">&lt;-</span> <span class="fu">which</span>(hourtemps<span class="sc">$</span>Year <span class="sc">==</span> endYear <span class="sc">&amp;</span></span>
<span id="cb191-279"><a href="#cb191-279" aria-hidden="true" tabindex="-1"></a>                  hourtemps<span class="sc">$</span>Month <span class="sc">==</span> endMonth <span class="sc">&amp;</span></span>
<span id="cb191-280"><a href="#cb191-280" aria-hidden="true" tabindex="-1"></a>                  hourtemps<span class="sc">$</span>Day <span class="sc">==</span> endDay <span class="sc">&amp;</span></span>
<span id="cb191-281"><a href="#cb191-281" aria-hidden="true" tabindex="-1"></a>                  hourtemps<span class="sc">$</span>Hour <span class="sc">==</span> endHour)</span>
<span id="cb191-282"><a href="#cb191-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-283"><a href="#cb191-283" aria-hidden="true" tabindex="-1"></a>WHs <span class="ot">&lt;-</span> <span class="fu">sum</span>(hourtemps<span class="sc">$</span>Warm_Hour[Start_Date<span class="sc">:</span>End_Date])</span>
<span id="cb191-284"><a href="#cb191-284" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(WHs)</span>
<span id="cb191-285"><a href="#cb191-285" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb191-286"><a href="#cb191-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-287"><a href="#cb191-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-288"><a href="#cb191-288" aria-hidden="true" tabindex="-1"></a>#Example</span>
<span id="cb191-289"><a href="#cb191-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-290"><a href="#cb191-290" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-291"><a href="#cb191-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-292"><a href="#cb191-292" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-293"><a href="#cb191-293" aria-hidden="true" tabindex="-1"></a><span class="fu">sum_WH</span>(Winters_hours_gaps, <span class="at">startYEARMODAHO =</span> <span class="dv">2008070100</span>, </span>
<span id="cb191-294"><a href="#cb191-294" aria-hidden="true" tabindex="-1"></a>                           <span class="at">endYEARMODAHO =</span> <span class="dv">2008073123</span>)</span>
<span id="cb191-295"><a href="#cb191-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-296"><a href="#cb191-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-297"><a href="#cb191-297" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-298"><a href="#cb191-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-299"><a href="#cb191-299" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 7: Winter Chill Projections</span></span>
<span id="cb191-300"><a href="#cb191-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-301"><a href="#cb191-301" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises Chill Models***</span></span>
<span id="cb191-302"><a href="#cb191-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-303"><a href="#cb191-303" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Run the chilling() function on the Winters_hours_gap dataset</span>
<span id="cb191-304"><a href="#cb191-304" aria-hidden="true" tabindex="-1"></a>    #chilling function</span>
<span id="cb191-305"><a href="#cb191-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-306"><a href="#cb191-306" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-307"><a href="#cb191-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-308"><a href="#cb191-308" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-309"><a href="#cb191-309" aria-hidden="true" tabindex="-1"></a>july <span class="ot">&lt;-</span> <span class="fu">chilling</span>(<span class="fu">make_JDay</span>(Winters_hours_gaps),</span>
<span id="cb191-310"><a href="#cb191-310" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Start_JDay =</span> <span class="dv">183</span>, </span>
<span id="cb191-311"><a href="#cb191-311" aria-hidden="true" tabindex="-1"></a>                   <span class="at">End_JDay =</span> <span class="dv">213</span>)</span>
<span id="cb191-312"><a href="#cb191-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-313"><a href="#cb191-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-314"><a href="#cb191-314" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Create your own temperature-weighting chill model using the</span>
<span id="cb191-315"><a href="#cb191-315" aria-hidden="true" tabindex="-1"></a>    step_model() function #step model</span>
<span id="cb191-316"><a href="#cb191-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-317"><a href="#cb191-317" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-318"><a href="#cb191-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-319"><a href="#cb191-319" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-320"><a href="#cb191-320" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb191-321"><a href="#cb191-321" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1000</span>, <span class="dv">0</span>,  <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>,   <span class="dv">10</span>),  </span>
<span id="cb191-322"><a href="#cb191-322" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">c</span>(    <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">1000</span>), </span>
<span id="cb191-323"><a href="#cb191-323" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">c</span>(   <span class="dv">0</span>, <span class="dv">1</span>,  <span class="dv">2</span>,  <span class="dv">3</span>,  <span class="dv">2</span>,  <span class="dv">1</span>,    <span class="dv">0</span>))</span>
<span id="cb191-324"><a href="#cb191-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-325"><a href="#cb191-325" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df) <span class="sc">%&gt;%</span></span>
<span id="cb191-326"><a href="#cb191-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="st">&quot;striped&quot;</span>, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>, <span class="at">font_size =</span> <span class="dv">12</span>)</span>
<span id="cb191-327"><a href="#cb191-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-328"><a href="#cb191-328" aria-hidden="true" tabindex="-1"></a>custom <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">step_model</span>(x, df)</span>
<span id="cb191-329"><a href="#cb191-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-330"><a href="#cb191-330" aria-hidden="true" tabindex="-1"></a><span class="fu">custom</span>(Winters_hours_gaps<span class="sc">$</span>Temp)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]</span>
<span id="cb191-331"><a href="#cb191-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-332"><a href="#cb191-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-333"><a href="#cb191-333" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Run this model on the Winters_hours_gaps dataset using the</span>
<span id="cb191-334"><a href="#cb191-334" aria-hidden="true" tabindex="-1"></a>    tempResponse() function.</span>
<span id="cb191-335"><a href="#cb191-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-336"><a href="#cb191-336" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-337"><a href="#cb191-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-338"><a href="#cb191-338" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-339"><a href="#cb191-339" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">tempResponse</span>(<span class="fu">make_JDay</span>(Winters_hours_gaps),</span>
<span id="cb191-340"><a href="#cb191-340" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Start_JDay =</span> <span class="dv">183</span>,</span>
<span id="cb191-341"><a href="#cb191-341" aria-hidden="true" tabindex="-1"></a>                       <span class="at">End_JDay =</span> <span class="dv">213</span>,</span>
<span id="cb191-342"><a href="#cb191-342" aria-hidden="true" tabindex="-1"></a>                       <span class="at">models =</span> <span class="fu">list</span>(<span class="at">Chill_Portions =</span> Dynamic_Model, </span>
<span id="cb191-343"><a href="#cb191-343" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">GDH =</span> GDH))</span>
<span id="cb191-344"><a href="#cb191-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-345"><a href="#cb191-345" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(output) <span class="sc">%&gt;%</span></span>
<span id="cb191-346"><a href="#cb191-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="st">&quot;striped&quot;</span>, </span>
<span id="cb191-347"><a href="#cb191-347" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb191-348"><a href="#cb191-348" aria-hidden="true" tabindex="-1"></a>                <span class="at">font_size =</span> <span class="dv">12</span>)</span>
<span id="cb191-349"><a href="#cb191-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-350"><a href="#cb191-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-351"><a href="#cb191-351" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-352"><a href="#cb191-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-353"><a href="#cb191-353" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 8: Making Hourly Temperatures</span></span>
<span id="cb191-354"><a href="#cb191-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-355"><a href="#cb191-355" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on hourly*** </span></span>
<span id="cb191-356"><a href="#cb191-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-357"><a href="#cb191-357" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Choose a location of interest, find out its latitude and produce</span>
<span id="cb191-358"><a href="#cb191-358" aria-hidden="true" tabindex="-1"></a>    plots of daily sunrise, sunset and daylength</span>
<span id="cb191-359"><a href="#cb191-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-360"><a href="#cb191-360" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-361"><a href="#cb191-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-362"><a href="#cb191-362" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-363"><a href="#cb191-363" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(chillR)</span>
<span id="cb191-364"><a href="#cb191-364" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb191-365"><a href="#cb191-365" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb191-366"><a href="#cb191-366" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-367"><a href="#cb191-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-368"><a href="#cb191-368" aria-hidden="true" tabindex="-1"></a><span class="fu"># sunset time and daylength at Rochester (Latitude: 43.15Â°N) over the</span></span>
<span id="cb191-369"><a href="#cb191-369" aria-hidden="true" tabindex="-1"></a>course of the year.</span>
<span id="cb191-370"><a href="#cb191-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-371"><a href="#cb191-371" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-372"><a href="#cb191-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-373"><a href="#cb191-373" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-374"><a href="#cb191-374" aria-hidden="true" tabindex="-1"></a>Days <span class="ot">&lt;-</span> <span class="fu">daylength</span>(<span class="at">latitude =</span> <span class="dv">43</span>,</span>
<span id="cb191-375"><a href="#cb191-375" aria-hidden="true" tabindex="-1"></a>                  <span class="at">JDay =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>)</span>
<span id="cb191-376"><a href="#cb191-376" aria-hidden="true" tabindex="-1"></a>Days_df <span class="ot">&lt;-</span></span>
<span id="cb191-377"><a href="#cb191-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb191-378"><a href="#cb191-378" aria-hidden="true" tabindex="-1"></a>    <span class="at">JDay =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>,</span>
<span id="cb191-379"><a href="#cb191-379" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sunrise =</span> Days<span class="sc">$</span>Sunrise,</span>
<span id="cb191-380"><a href="#cb191-380" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sunset =</span> Days<span class="sc">$</span>Sunset,</span>
<span id="cb191-381"><a href="#cb191-381" aria-hidden="true" tabindex="-1"></a>    <span class="at">Daylength =</span> Days<span class="sc">$</span>Daylength</span>
<span id="cb191-382"><a href="#cb191-382" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb191-383"><a href="#cb191-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-384"><a href="#cb191-384" aria-hidden="true" tabindex="-1"></a>Days_df <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(Days_df, <span class="at">cols=</span><span class="fu">c</span>(Sunrise<span class="sc">:</span>Daylength))</span>
<span id="cb191-385"><a href="#cb191-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-386"><a href="#cb191-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-387"><a href="#cb191-387" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Days_df, <span class="fu">aes</span>(JDay, value)) <span class="sc">+</span></span>
<span id="cb191-388"><a href="#cb191-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb191-389"><a href="#cb191-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(name)) <span class="sc">+</span></span>
<span id="cb191-390"><a href="#cb191-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Time of Day / Daylength (Hours)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-391"><a href="#cb191-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb191-392"><a href="#cb191-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-393"><a href="#cb191-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-394"><a href="#cb191-394" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Produce an hourly dataset, based on idealized daily curves, for the</span>
<span id="cb191-395"><a href="#cb191-395" aria-hidden="true" tabindex="-1"></a>    KA_weather dataset (included in chillR)</span>
<span id="cb191-396"><a href="#cb191-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-397"><a href="#cb191-397" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-398"><a href="#cb191-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-399"><a href="#cb191-399" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-400"><a href="#cb191-400" aria-hidden="true" tabindex="-1"></a><span class="fu">stack_hourly_temps</span>(KA_weather, <span class="at">latitude =</span> <span class="dv">43</span>) [[<span class="dv">1</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,]</span>
<span id="cb191-401"><a href="#cb191-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-402"><a href="#cb191-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-403"><a href="#cb191-403" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Produce empirical temperature curve parameters for the Winters_hours_gaps dataset, and use them to predict hourly values from daily temperatures (this is very similar to the example above,but please make sure you understand whatâs going on).</span>
<span id="cb191-404"><a href="#cb191-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-405"><a href="#cb191-405" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-406"><a href="#cb191-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-407"><a href="#cb191-407" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-408"><a href="#cb191-408" aria-hidden="true" tabindex="-1"></a>empi_curve <span class="ot">&lt;-</span> <span class="fu">Empirical_daily_temperature_curve</span>(Winters_hours_gaps)</span>
<span id="cb191-409"><a href="#cb191-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-410"><a href="#cb191-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-411"><a href="#cb191-411" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-412"><a href="#cb191-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-413"><a href="#cb191-413" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-414"><a href="#cb191-414" aria-hidden="true" tabindex="-1"></a>Winters_daily <span class="ot">&lt;-</span> <span class="fu">make_all_day_table</span>(Winters_hours_gaps, <span class="at">input_timestep =</span> <span class="st">&quot;hour&quot;</span>)</span>
<span id="cb191-415"><a href="#cb191-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-416"><a href="#cb191-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-417"><a href="#cb191-417" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-418"><a href="#cb191-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-419"><a href="#cb191-419" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 9: Some Useful tools in R</span></span>
<span id="cb191-420"><a href="#cb191-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-421"><a href="#cb191-421" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on useful R tools*** </span></span>
<span id="cb191-422"><a href="#cb191-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-423"><a href="#cb191-423" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Based on the Winters_hours_gaps dataset, use magrittr pipes and</span>
<span id="cb191-424"><a href="#cb191-424" aria-hidden="true" tabindex="-1"></a>    functions of the tidyverse to accomplish the following:</span>
<span id="cb191-425"><a href="#cb191-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-426"><a href="#cb191-426" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Convert the dataset into a tibble</span>
<span id="cb191-427"><a href="#cb191-427" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Select only the top 10 rows of the dataset</span>
<span id="cb191-428"><a href="#cb191-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-429"><a href="#cb191-429" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-430"><a href="#cb191-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-431"><a href="#cb191-431" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-432"><a href="#cb191-432" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(chillR)</span>
<span id="cb191-433"><a href="#cb191-433" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb191-434"><a href="#cb191-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-435"><a href="#cb191-435" aria-hidden="true" tabindex="-1"></a>WHG <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Winters_hours_gaps[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ])</span>
<span id="cb191-436"><a href="#cb191-436" aria-hidden="true" tabindex="-1"></a>WHG</span>
<span id="cb191-437"><a href="#cb191-437" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-438"><a href="#cb191-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-439"><a href="#cb191-439" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Convert the tibble to a long format, with separate rows for</span>
<span id="cb191-440"><a href="#cb191-440" aria-hidden="true" tabindex="-1"></a>    Temp_gaps and Temp</span>
<span id="cb191-441"><a href="#cb191-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-442"><a href="#cb191-442" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-443"><a href="#cb191-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-444"><a href="#cb191-444" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-445"><a href="#cb191-445" aria-hidden="true" tabindex="-1"></a>WHGlong <span class="ot">&lt;-</span> WHG <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> Temp_gaps<span class="sc">:</span>Temp)</span>
<span id="cb191-446"><a href="#cb191-446" aria-hidden="true" tabindex="-1"></a>WHGlong</span>
<span id="cb191-447"><a href="#cb191-447" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-448"><a href="#cb191-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-449"><a href="#cb191-449" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use ggplot2 to plot Temp_gaps and Temp as facets (point or line</span>
<span id="cb191-450"><a href="#cb191-450" aria-hidden="true" tabindex="-1"></a>    plot)</span>
<span id="cb191-451"><a href="#cb191-451" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-452"><a href="#cb191-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-453"><a href="#cb191-453" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-454"><a href="#cb191-454" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(WHGlong, <span class="fu">aes</span>(Hour, value)) <span class="sc">+</span></span>
<span id="cb191-455"><a href="#cb191-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour=</span><span class="fl">0.2</span>), <span class="at">size=</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb191-456"><a href="#cb191-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">12</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-457"><a href="#cb191-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Temperature (Â°C)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-458"><a href="#cb191-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb191-459"><a href="#cb191-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-460"><a href="#cb191-460" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb191-461"><a href="#cb191-461" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Convert the dataset back to the wide format</span>
<span id="cb191-462"><a href="#cb191-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-463"><a href="#cb191-463" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-464"><a href="#cb191-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-465"><a href="#cb191-465" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-466"><a href="#cb191-466" aria-hidden="true" tabindex="-1"></a>WHGwide <span class="ot">&lt;-</span> WHGlong <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name)</span>
<span id="cb191-467"><a href="#cb191-467" aria-hidden="true" tabindex="-1"></a>WHGwide</span>
<span id="cb191-468"><a href="#cb191-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-469"><a href="#cb191-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-470"><a href="#cb191-470" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Select only the following columns: Year, Month, Day and Temp</span>
<span id="cb191-471"><a href="#cb191-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-472"><a href="#cb191-472" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-473"><a href="#cb191-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-474"><a href="#cb191-474" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-475"><a href="#cb191-475" aria-hidden="true" tabindex="-1"></a>WHG <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(Year, Month, Day, Temp))</span>
<span id="cb191-476"><a href="#cb191-476" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-477"><a href="#cb191-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-478"><a href="#cb191-478" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sort the dataset by the Temp column, in descending order</span>
<span id="cb191-479"><a href="#cb191-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-480"><a href="#cb191-480" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-481"><a href="#cb191-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-482"><a href="#cb191-482" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-483"><a href="#cb191-483" aria-hidden="true" tabindex="-1"></a>WHG <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Temp))</span>
<span id="cb191-484"><a href="#cb191-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-485"><a href="#cb191-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-486"><a href="#cb191-486" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>For the Winter_hours_gaps dataset, write a for loop to convert all</span>
<span id="cb191-487"><a href="#cb191-487" aria-hidden="true" tabindex="-1"></a>    temperatures (Temp column) to degrees Fahrenheit</span>
<span id="cb191-488"><a href="#cb191-488" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-489"><a href="#cb191-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-490"><a href="#cb191-490" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-491"><a href="#cb191-491" aria-hidden="true" tabindex="-1"></a>Temp <span class="ot">&lt;-</span> Winters_hours_gaps<span class="sc">$</span>Temp[<span class="dv">183</span><span class="sc">:</span><span class="dv">213</span>] <span class="co"># JDay for July</span></span>
<span id="cb191-492"><a href="#cb191-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-493"><a href="#cb191-493" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> Temp)</span>
<span id="cb191-494"><a href="#cb191-494" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb191-495"><a href="#cb191-495" aria-hidden="true" tabindex="-1"></a>  Fahrenheit <span class="ot">&lt;-</span> i <span class="sc">*</span> <span class="fl">1.8</span> <span class="sc">+</span> <span class="dv">32</span> </span>
<span id="cb191-496"><a href="#cb191-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(Fahrenheit) </span>
<span id="cb191-497"><a href="#cb191-497" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb191-498"><a href="#cb191-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-499"><a href="#cb191-499" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb191-500"><a href="#cb191-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-501"><a href="#cb191-501" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Execute the same operation with a function from the apply family</span>
<span id="cb191-502"><a href="#cb191-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-503"><a href="#cb191-503" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-504"><a href="#cb191-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-505"><a href="#cb191-505" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-506"><a href="#cb191-506" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> Winters_hours_gaps<span class="sc">$</span>Temp[<span class="dv">183</span><span class="sc">:</span><span class="dv">213</span>]</span>
<span id="cb191-507"><a href="#cb191-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-508"><a href="#cb191-508" aria-hidden="true" tabindex="-1"></a>fahrenheit <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb191-509"><a href="#cb191-509" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">*</span> <span class="fl">1.8</span> <span class="sc">+</span> <span class="dv">32</span></span>
<span id="cb191-510"><a href="#cb191-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-511"><a href="#cb191-511" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(x, fahrenheit)</span>
<span id="cb191-512"><a href="#cb191-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-513"><a href="#cb191-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-514"><a href="#cb191-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-515"><a href="#cb191-515" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Now use the tidyverse function mutate to achieve the same outcome</span>
<span id="cb191-516"><a href="#cb191-516" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-517"><a href="#cb191-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-518"><a href="#cb191-518" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-519"><a href="#cb191-519" aria-hidden="true" tabindex="-1"></a>WHG_F <span class="ot">&lt;-</span> WHG <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Temp_F =</span> Temp <span class="sc">*</span> <span class="fl">1.8</span> <span class="sc">+</span> <span class="dv">32</span>)</span>
<span id="cb191-520"><a href="#cb191-520" aria-hidden="true" tabindex="-1"></a>WHG_F</span>
<span id="cb191-521"><a href="#cb191-521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-522"><a href="#cb191-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-523"><a href="#cb191-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-524"><a href="#cb191-524" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-525"><a href="#cb191-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-526"><a href="#cb191-526" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 10: Getting temperature data</span></span>
<span id="cb191-527"><a href="#cb191-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-528"><a href="#cb191-528" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on getting temperature data*** </span></span>
<span id="cb191-529"><a href="#cb191-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-530"><a href="#cb191-530" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Choose a location of interest and find the 25 closest weather</span>
<span id="cb191-531"><a href="#cb191-531" aria-hidden="true" tabindex="-1"></a>    stations using the handle_gsod function</span>
<span id="cb191-532"><a href="#cb191-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-533"><a href="#cb191-533" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-534"><a href="#cb191-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-535"><a href="#cb191-535" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-536"><a href="#cb191-536" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb191-537"><a href="#cb191-537" aria-hidden="true" tabindex="-1"></a>station_list_Rochester <span class="ot">&lt;-</span><span class="fu">handle_gsod</span>(<span class="at">action=</span><span class="st">&quot;list_stations&quot;</span>,</span>
<span id="cb191-538"><a href="#cb191-538" aria-hidden="true" tabindex="-1"></a>                          <span class="at">location=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">77.60</span>, <span class="fl">43.15</span>),</span>
<span id="cb191-539"><a href="#cb191-539" aria-hidden="true" tabindex="-1"></a>                          <span class="at">time_interval=</span><span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2020</span>))</span>
<span id="cb191-540"><a href="#cb191-540" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb191-541"><a href="#cb191-541" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(kableExtra)</span>
<span id="cb191-542"><a href="#cb191-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-543"><a href="#cb191-543" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(station_list_Rochester) <span class="sc">%&gt;%</span></span>
<span id="cb191-544"><a href="#cb191-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="st">&quot;striped&quot;</span>, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>, <span class="at">font_size =</span> <span class="dv">8</span>)</span>
<span id="cb191-545"><a href="#cb191-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-546"><a href="#cb191-546" aria-hidden="true" tabindex="-1"></a>station_list_Rochester</span>
<span id="cb191-547"><a href="#cb191-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-548"><a href="#cb191-548" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-549"><a href="#cb191-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-550"><a href="#cb191-550" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Download weather data for the most promising station on the list</span>
<span id="cb191-551"><a href="#cb191-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-552"><a href="#cb191-552" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-553"><a href="#cb191-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-554"><a href="#cb191-554" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-555"><a href="#cb191-555" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">handle_gsod</span>(<span class="at">action =</span> <span class="st">&quot;download_weather&quot;</span>,</span>
<span id="cb191-556"><a href="#cb191-556" aria-hidden="true" tabindex="-1"></a>                       <span class="at">location =</span> station_list_Rochester<span class="sc">$</span>chillR_code[<span class="dv">1</span>],</span>
<span id="cb191-557"><a href="#cb191-557" aria-hidden="true" tabindex="-1"></a>                       <span class="at">time_interval =</span> <span class="fu">c</span>(<span class="dv">1990</span>, <span class="dv">2020</span>))</span>
<span id="cb191-558"><a href="#cb191-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-559"><a href="#cb191-559" aria-hidden="true" tabindex="-1"></a>weather[[<span class="dv">1</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,]</span>
<span id="cb191-560"><a href="#cb191-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-561"><a href="#cb191-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-562"><a href="#cb191-562" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Convert the weather data into chillR format</span>
<span id="cb191-563"><a href="#cb191-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-564"><a href="#cb191-564" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-565"><a href="#cb191-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-566"><a href="#cb191-566" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-567"><a href="#cb191-567" aria-hidden="true" tabindex="-1"></a>cleaned_weather <span class="ot">&lt;-</span> <span class="fu">handle_gsod</span>(weather)</span>
<span id="cb191-568"><a href="#cb191-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-569"><a href="#cb191-569" aria-hidden="true" tabindex="-1"></a>cleaned_weather[[<span class="dv">1</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,]</span>
<span id="cb191-570"><a href="#cb191-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-571"><a href="#cb191-571" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;data_New_York&quot;</span>)</span>
<span id="cb191-572"><a href="#cb191-572" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(station_list_Rochester,</span>
<span id="cb191-573"><a href="#cb191-573" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;data_New_York/station_list_Rochester.csv&quot;</span>,</span>
<span id="cb191-574"><a href="#cb191-574" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb191-575"><a href="#cb191-575" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(weather[[<span class="dv">1</span>]],</span>
<span id="cb191-576"><a href="#cb191-576" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;data_New_York/Rochester_weather.csv&quot;</span>,</span>
<span id="cb191-577"><a href="#cb191-577" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb191-578"><a href="#cb191-578" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(cleaned_weather[[<span class="dv">1</span>]],</span>
<span id="cb191-579"><a href="#cb191-579" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;data_New_York/Rochester_chillR_weather.csv&quot;</span>,</span>
<span id="cb191-580"><a href="#cb191-580" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb191-581"><a href="#cb191-581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-582"><a href="#cb191-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-583"><a href="#cb191-583" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-584"><a href="#cb191-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-585"><a href="#cb191-585" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 11: Getting temperature data</span></span>
<span id="cb191-586"><a href="#cb191-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-587"><a href="#cb191-587" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on getting temperature data*** </span></span>
<span id="cb191-588"><a href="#cb191-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-589"><a href="#cb191-589" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Use chillR functions to find out how many gaps you have in this</span>
<span id="cb191-590"><a href="#cb191-590" aria-hidden="true" tabindex="-1"></a>    dataset (even if you have none, please still follow all further</span>
<span id="cb191-591"><a href="#cb191-591" aria-hidden="true" tabindex="-1"></a>    steps)</span>
<span id="cb191-592"><a href="#cb191-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-593"><a href="#cb191-593" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-594"><a href="#cb191-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-595"><a href="#cb191-595" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-596"><a href="#cb191-596" aria-hidden="true" tabindex="-1"></a>Rochester <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data_New_York/Rochester_chillR_weather.csv&quot;</span>)</span>
<span id="cb191-597"><a href="#cb191-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-598"><a href="#cb191-598" aria-hidden="true" tabindex="-1"></a>Rochester_QC <span class="ot">&lt;-</span> <span class="fu">fix_weather</span>(Rochester)<span class="sc">$</span>QC</span>
<span id="cb191-599"><a href="#cb191-599" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-600"><a href="#cb191-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-601"><a href="#cb191-601" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Create a list of the 25 closest weather stations using the</span>
<span id="cb191-602"><a href="#cb191-602" aria-hidden="true" tabindex="-1"></a>    handle_gsod function</span>
<span id="cb191-603"><a href="#cb191-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-604"><a href="#cb191-604" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-605"><a href="#cb191-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-606"><a href="#cb191-606" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-607"><a href="#cb191-607" aria-hidden="true" tabindex="-1"></a>station_list <span class="ot">&lt;-</span> <span class="fu">handle_gsod</span>(<span class="at">action=</span><span class="st">&quot;list_stations&quot;</span>,</span>
<span id="cb191-608"><a href="#cb191-608" aria-hidden="true" tabindex="-1"></a>                            <span class="at">location=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">77.60</span>, <span class="fl">43.15</span>),</span>
<span id="cb191-609"><a href="#cb191-609" aria-hidden="true" tabindex="-1"></a>                              <span class="at">time_interval=</span><span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2020</span>))</span>
<span id="cb191-610"><a href="#cb191-610" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb191-611"><a href="#cb191-611" aria-hidden="true" tabindex="-1"></a>station_list</span>
<span id="cb191-612"><a href="#cb191-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-613"><a href="#cb191-613" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(station_list, <span class="at">n =</span> <span class="dv">26</span>)</span>
<span id="cb191-614"><a href="#cb191-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-615"><a href="#cb191-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-616"><a href="#cb191-616" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Identify suitable weather stations for patching gaps</span>
<span id="cb191-617"><a href="#cb191-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-618"><a href="#cb191-618" aria-hidden="true" tabindex="-1"></a>#download stations number 4, 5, and 10 these will be used to patch</span>
<span id="cb191-619"><a href="#cb191-619" aria-hidden="true" tabindex="-1"></a>the gaps</span>
<span id="cb191-620"><a href="#cb191-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-621"><a href="#cb191-621" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Download weather data for promising stations, convert them to chillR</span>
<span id="cb191-622"><a href="#cb191-622" aria-hidden="true" tabindex="-1"></a>    format and compile them in a list</span>
<span id="cb191-623"><a href="#cb191-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-624"><a href="#cb191-624" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-625"><a href="#cb191-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-626"><a href="#cb191-626" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-627"><a href="#cb191-627" aria-hidden="true" tabindex="-1"></a>patch_weather<span class="ot">&lt;-</span></span>
<span id="cb191-628"><a href="#cb191-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handle_gsod</span>(<span class="at">action =</span> <span class="st">&quot;download_weather&quot;</span>,</span>
<span id="cb191-629"><a href="#cb191-629" aria-hidden="true" tabindex="-1"></a>              <span class="at">location =</span> <span class="fu">as.character</span>(station_list<span class="sc">$</span>chillR_code[<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">10</span>)]),</span>
<span id="cb191-630"><a href="#cb191-630" aria-hidden="true" tabindex="-1"></a>              <span class="at">time_interval =</span> <span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2020</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb191-631"><a href="#cb191-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handle_gsod</span>()</span>
<span id="cb191-632"><a href="#cb191-632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-633"><a href="#cb191-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-634"><a href="#cb191-634" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Use the patch_daily_temperatures function to fill gaps</span>
<span id="cb191-635"><a href="#cb191-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-636"><a href="#cb191-636" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-637"><a href="#cb191-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-638"><a href="#cb191-638" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-639"><a href="#cb191-639" aria-hidden="true" tabindex="-1"></a>patched <span class="ot">&lt;-</span> <span class="fu">patch_daily_temperatures</span>(<span class="at">weather =</span> Rochester,</span>
<span id="cb191-640"><a href="#cb191-640" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">patch_weather =</span> patch_weather)</span>
<span id="cb191-641"><a href="#cb191-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-642"><a href="#cb191-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-643"><a href="#cb191-643" aria-hidden="true" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">1</span>]]</span>
<span id="cb191-644"><a href="#cb191-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-645"><a href="#cb191-645" aria-hidden="true" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">2</span>]]</span>
<span id="cb191-646"><a href="#cb191-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-647"><a href="#cb191-647" aria-hidden="true" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">3</span>]]</span>
<span id="cb191-648"><a href="#cb191-648" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-649"><a href="#cb191-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-650"><a href="#cb191-650" aria-hidden="true" tabindex="-1"></a>#set minimum quality criteria</span>
<span id="cb191-651"><a href="#cb191-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-652"><a href="#cb191-652" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-653"><a href="#cb191-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-654"><a href="#cb191-654" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-655"><a href="#cb191-655" aria-hidden="true" tabindex="-1"></a>patched <span class="ot">&lt;-</span> <span class="fu">patch_daily_temperatures</span>(<span class="at">weather =</span> Rochester,</span>
<span id="cb191-656"><a href="#cb191-656" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">patch_weather =</span> patch_weather,</span>
<span id="cb191-657"><a href="#cb191-657" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">max_mean_bias =</span> <span class="dv">1</span>,</span>
<span id="cb191-658"><a href="#cb191-658" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">max_stdev_bias =</span> <span class="dv">2</span>)</span>
<span id="cb191-659"><a href="#cb191-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-660"><a href="#cb191-660" aria-hidden="true" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">1</span>]]</span>
<span id="cb191-661"><a href="#cb191-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-662"><a href="#cb191-662" aria-hidden="true" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">2</span>]]</span>
<span id="cb191-663"><a href="#cb191-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-664"><a href="#cb191-664" aria-hidden="true" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">3</span>]]</span>
<span id="cb191-665"><a href="#cb191-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-666"><a href="#cb191-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-667"><a href="#cb191-667" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>Investigate the results - have all gaps been filled?</span>
<span id="cb191-668"><a href="#cb191-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-669"><a href="#cb191-669" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-670"><a href="#cb191-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-671"><a href="#cb191-671" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-672"><a href="#cb191-672" aria-hidden="true" tabindex="-1"></a>post_patch_stats <span class="ot">&lt;-</span> <span class="fu">fix_weather</span>(patched)<span class="sc">$</span>QC</span>
<span id="cb191-673"><a href="#cb191-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-674"><a href="#cb191-674" aria-hidden="true" tabindex="-1"></a>post_patch_stats</span>
<span id="cb191-675"><a href="#cb191-675" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-676"><a href="#cb191-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-677"><a href="#cb191-677" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>If necessary, repeat until you have a dataset you can work with in</span>
<span id="cb191-678"><a href="#cb191-678" aria-hidden="true" tabindex="-1"></a>    further analyses</span>
<span id="cb191-679"><a href="#cb191-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-680"><a href="#cb191-680" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-681"><a href="#cb191-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-682"><a href="#cb191-682" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-683"><a href="#cb191-683" aria-hidden="true" tabindex="-1"></a>Rochester_weather<span class="ot">&lt;-</span><span class="fu">fix_weather</span>(patched)</span>
<span id="cb191-684"><a href="#cb191-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-685"><a href="#cb191-685" aria-hidden="true" tabindex="-1"></a>patched_monthly <span class="ot">&lt;-</span> <span class="fu">patch_daily_temps</span>(<span class="at">weather =</span> Rochester,</span>
<span id="cb191-686"><a href="#cb191-686" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">patch_weather =</span> patch_weather,</span>
<span id="cb191-687"><a href="#cb191-687" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">max_mean_bias =</span> <span class="dv">1</span>,</span>
<span id="cb191-688"><a href="#cb191-688" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">max_stdev_bias =</span> <span class="dv">2</span>,</span>
<span id="cb191-689"><a href="#cb191-689" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">time_interval =</span> <span class="st">&quot;month&quot;</span>)</span>
<span id="cb191-690"><a href="#cb191-690" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-691"><a href="#cb191-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-692"><a href="#cb191-692" aria-hidden="true" tabindex="-1"></a>#saving the data for later</span>
<span id="cb191-693"><a href="#cb191-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-694"><a href="#cb191-694" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-695"><a href="#cb191-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-696"><a href="#cb191-696" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-697"><a href="#cb191-697" aria-hidden="true" tabindex="-1"></a>monthly_bias_fixed <span class="ot">&lt;-</span> <span class="fu">fix_weather</span>(patched_monthly)</span>
<span id="cb191-698"><a href="#cb191-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-699"><a href="#cb191-699" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(monthly_bias_fixed<span class="sc">$</span>weather,</span>
<span id="cb191-700"><a href="#cb191-700" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;data_New_York/Rochester_weather.csv&quot;</span>)</span>
<span id="cb191-701"><a href="#cb191-701" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-702"><a href="#cb191-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-703"><a href="#cb191-703" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-704"><a href="#cb191-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-705"><a href="#cb191-705" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 12: Generating temperature scenarios</span></span>
<span id="cb191-706"><a href="#cb191-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-707"><a href="#cb191-707" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on getting temperature data*** </span></span>
<span id="cb191-708"><a href="#cb191-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-709"><a href="#cb191-709" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>For the location you chose for your earlier analyses, use chillRâs</span>
<span id="cb191-710"><a href="#cb191-710" aria-hidden="true" tabindex="-1"></a>    weather generator to produce 100 years of synthetic temperature</span>
<span id="cb191-711"><a href="#cb191-711" aria-hidden="true" tabindex="-1"></a>    data.</span>
<span id="cb191-712"><a href="#cb191-712" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb191-713"><a href="#cb191-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-714"><a href="#cb191-714" aria-hidden="true" tabindex="-1"></a><span class="in">library(chillR)</span></span>
<span id="cb191-715"><a href="#cb191-715" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse) </span></span>
<span id="cb191-716"><a href="#cb191-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-717"><a href="#cb191-717" aria-hidden="true" tabindex="-1"></a><span class="in">Rochester &lt;- read.csv(&#39;data_New_York/Rochester_weather.csv&#39;)</span></span>
<span id="cb191-718"><a href="#cb191-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-719"><a href="#cb191-719" aria-hidden="true" tabindex="-1"></a><span class="in">Temp &lt;- Rochester %&gt;%</span></span>
<span id="cb191-720"><a href="#cb191-720" aria-hidden="true" tabindex="-1"></a><span class="in">  temperature_generation(years = c(1998,2009),</span></span>
<span id="cb191-721"><a href="#cb191-721" aria-hidden="true" tabindex="-1"></a><span class="in">                         sim_years = c(2001,2100))</span></span>
<span id="cb191-722"><a href="#cb191-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-723"><a href="#cb191-723" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb191-724"><a href="#cb191-724" aria-hidden="true" tabindex="-1"></a><span class="in">library(magrittr)</span></span>
<span id="cb191-725"><a href="#cb191-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-726"><a href="#cb191-726" aria-hidden="true" tabindex="-1"></a><span class="in">Temperatures &lt;- Rochester %&gt;% </span></span>
<span id="cb191-727"><a href="#cb191-727" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Year, Month, Day, Tmin, Tmax) %&gt;% </span></span>
<span id="cb191-728"><a href="#cb191-728" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Year %in% 1998:2009) %&gt;%</span></span>
<span id="cb191-729"><a href="#cb191-729" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(Data_source = &quot;observed&quot;) %&gt;%</span></span>
<span id="cb191-730"><a href="#cb191-730" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(</span></span>
<span id="cb191-731"><a href="#cb191-731" aria-hidden="true" tabindex="-1"></a><span class="in">    Temp[[1]] %&gt;% select(c(Year,</span></span>
<span id="cb191-732"><a href="#cb191-732" aria-hidden="true" tabindex="-1"></a><span class="in">                           Month,</span></span>
<span id="cb191-733"><a href="#cb191-733" aria-hidden="true" tabindex="-1"></a><span class="in">                           Day,</span></span>
<span id="cb191-734"><a href="#cb191-734" aria-hidden="true" tabindex="-1"></a><span class="in">                           Tmin,</span></span>
<span id="cb191-735"><a href="#cb191-735" aria-hidden="true" tabindex="-1"></a><span class="in">                           Tmax)) %&gt;%</span></span>
<span id="cb191-736"><a href="#cb191-736" aria-hidden="true" tabindex="-1"></a><span class="in">      cbind(Data_source = &quot;simulated&quot;)</span></span>
<span id="cb191-737"><a href="#cb191-737" aria-hidden="true" tabindex="-1"></a><span class="in">    ) %&gt;%</span></span>
<span id="cb191-738"><a href="#cb191-738" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Date = as.Date(ISOdate(2000,</span></span>
<span id="cb191-739"><a href="#cb191-739" aria-hidden="true" tabindex="-1"></a><span class="in">                                Month,</span></span>
<span id="cb191-740"><a href="#cb191-740" aria-hidden="true" tabindex="-1"></a><span class="in">                                Day)))</span></span>
<span id="cb191-741"><a href="#cb191-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-742"><a href="#cb191-742" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = Temperatures,</span></span>
<span id="cb191-743"><a href="#cb191-743" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Date,</span></span>
<span id="cb191-744"><a href="#cb191-744" aria-hidden="true" tabindex="-1"></a><span class="in">           Tmin)) +</span></span>
<span id="cb191-745"><a href="#cb191-745" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(aes(colour = factor(Year))) +</span></span>
<span id="cb191-746"><a href="#cb191-746" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(Data_source)) +</span></span>
<span id="cb191-747"><a href="#cb191-747" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb191-748"><a href="#cb191-748" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = &quot;none&quot;) +</span></span>
<span id="cb191-749"><a href="#cb191-749" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = &quot;%b&quot;)</span></span>
<span id="cb191-750"><a href="#cb191-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-751"><a href="#cb191-751" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = Temperatures,</span></span>
<span id="cb191-752"><a href="#cb191-752" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Date,</span></span>
<span id="cb191-753"><a href="#cb191-753" aria-hidden="true" tabindex="-1"></a><span class="in">           Tmax)) +</span></span>
<span id="cb191-754"><a href="#cb191-754" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(aes(colour = factor(Year))) +</span></span>
<span id="cb191-755"><a href="#cb191-755" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(Data_source)) +</span></span>
<span id="cb191-756"><a href="#cb191-756" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb191-757"><a href="#cb191-757" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = &quot;none&quot;) +</span></span>
<span id="cb191-758"><a href="#cb191-758" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = &quot;%b&quot;)</span></span>
<span id="cb191-759"><a href="#cb191-759" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-760"><a href="#cb191-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-761"><a href="#cb191-761" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Calculate winter chill (in Chill Portions) for your synthetic</span>
<span id="cb191-762"><a href="#cb191-762" aria-hidden="true" tabindex="-1"></a>    weather, and illustrate your results as histograms and cumulative</span>
<span id="cb191-763"><a href="#cb191-763" aria-hidden="true" tabindex="-1"></a>    distributions.</span>
<span id="cb191-764"><a href="#cb191-764" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb191-765"><a href="#cb191-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-766"><a href="#cb191-766" aria-hidden="true" tabindex="-1"></a><span class="in">library(chillR)</span></span>
<span id="cb191-767"><a href="#cb191-767" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse) </span></span>
<span id="cb191-768"><a href="#cb191-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-769"><a href="#cb191-769" aria-hidden="true" tabindex="-1"></a><span class="in">Rochester &lt;- read.csv(&#39;data_New_York/Rochester_weather.csv&#39;)</span></span>
<span id="cb191-770"><a href="#cb191-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-771"><a href="#cb191-771" aria-hidden="true" tabindex="-1"></a><span class="in">Temp &lt;- Rochester %&gt;%</span></span>
<span id="cb191-772"><a href="#cb191-772" aria-hidden="true" tabindex="-1"></a><span class="in">  temperature_generation(years = c(1998,2009),</span></span>
<span id="cb191-773"><a href="#cb191-773" aria-hidden="true" tabindex="-1"></a><span class="in">                         sim_years = c(2001,2100))</span></span>
<span id="cb191-774"><a href="#cb191-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-775"><a href="#cb191-775" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb191-776"><a href="#cb191-776" aria-hidden="true" tabindex="-1"></a><span class="in">library(magrittr)</span></span>
<span id="cb191-777"><a href="#cb191-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-778"><a href="#cb191-778" aria-hidden="true" tabindex="-1"></a><span class="in">Temperatures &lt;- Rochester %&gt;% </span></span>
<span id="cb191-779"><a href="#cb191-779" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Year, Month, Day, Tmin, Tmax) %&gt;% </span></span>
<span id="cb191-780"><a href="#cb191-780" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Year %in% 1998:2009) %&gt;%</span></span>
<span id="cb191-781"><a href="#cb191-781" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(Data_source = &quot;observed&quot;) %&gt;%</span></span>
<span id="cb191-782"><a href="#cb191-782" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(</span></span>
<span id="cb191-783"><a href="#cb191-783" aria-hidden="true" tabindex="-1"></a><span class="in">    Temp[[1]] %&gt;% select(c(Year,</span></span>
<span id="cb191-784"><a href="#cb191-784" aria-hidden="true" tabindex="-1"></a><span class="in">                           Month,</span></span>
<span id="cb191-785"><a href="#cb191-785" aria-hidden="true" tabindex="-1"></a><span class="in">                           Day,</span></span>
<span id="cb191-786"><a href="#cb191-786" aria-hidden="true" tabindex="-1"></a><span class="in">                           Tmin,</span></span>
<span id="cb191-787"><a href="#cb191-787" aria-hidden="true" tabindex="-1"></a><span class="in">                           Tmax)) %&gt;%</span></span>
<span id="cb191-788"><a href="#cb191-788" aria-hidden="true" tabindex="-1"></a><span class="in">      cbind(Data_source = &quot;simulated&quot;)</span></span>
<span id="cb191-789"><a href="#cb191-789" aria-hidden="true" tabindex="-1"></a><span class="in">    ) %&gt;%</span></span>
<span id="cb191-790"><a href="#cb191-790" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Date = as.Date(ISOdate(2000,</span></span>
<span id="cb191-791"><a href="#cb191-791" aria-hidden="true" tabindex="-1"></a><span class="in">                                Month,</span></span>
<span id="cb191-792"><a href="#cb191-792" aria-hidden="true" tabindex="-1"></a><span class="in">                                Day)))</span></span>
<span id="cb191-793"><a href="#cb191-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-794"><a href="#cb191-794" aria-hidden="true" tabindex="-1"></a><span class="in">chill_observed &lt;- Temperatures %&gt;%</span></span>
<span id="cb191-795"><a href="#cb191-795" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == &quot;observed&quot;) %&gt;%</span></span>
<span id="cb191-796"><a href="#cb191-796" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 43.15) %&gt;%</span></span>
<span id="cb191-797"><a href="#cb191-797" aria-hidden="true" tabindex="-1"></a><span class="in">  chilling(Start_JDay = 305,</span></span>
<span id="cb191-798"><a href="#cb191-798" aria-hidden="true" tabindex="-1"></a><span class="in">           End_JDay = 59)</span></span>
<span id="cb191-799"><a href="#cb191-799" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-800"><a href="#cb191-800" aria-hidden="true" tabindex="-1"></a><span class="in">chill_simulated &lt;- Temperatures %&gt;%</span></span>
<span id="cb191-801"><a href="#cb191-801" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == &quot;simulated&quot;) %&gt;%</span></span>
<span id="cb191-802"><a href="#cb191-802" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 43.15) %&gt;%</span></span>
<span id="cb191-803"><a href="#cb191-803" aria-hidden="true" tabindex="-1"></a><span class="in">  chilling(Start_JDay = 305,</span></span>
<span id="cb191-804"><a href="#cb191-804" aria-hidden="true" tabindex="-1"></a><span class="in">           End_JDay = 59)</span></span>
<span id="cb191-805"><a href="#cb191-805" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-806"><a href="#cb191-806" aria-hidden="true" tabindex="-1"></a><span class="in">chill_comparison &lt;-</span></span>
<span id="cb191-807"><a href="#cb191-807" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(chill_observed,</span></span>
<span id="cb191-808"><a href="#cb191-808" aria-hidden="true" tabindex="-1"></a><span class="in">        Data_source = &quot;observed&quot;) %&gt;%</span></span>
<span id="cb191-809"><a href="#cb191-809" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(cbind(chill_simulated,</span></span>
<span id="cb191-810"><a href="#cb191-810" aria-hidden="true" tabindex="-1"></a><span class="in">              Data_source = &quot;simulated&quot;))</span></span>
<span id="cb191-811"><a href="#cb191-811" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-812"><a href="#cb191-812" aria-hidden="true" tabindex="-1"></a><span class="in">chill_comparison_full_seasons &lt;- </span></span>
<span id="cb191-813"><a href="#cb191-813" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_comparison %&gt;%</span></span>
<span id="cb191-814"><a href="#cb191-814" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Perc_complete == 100)</span></span>
<span id="cb191-815"><a href="#cb191-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-816"><a href="#cb191-816" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(chill_comparison_full_seasons,</span></span>
<span id="cb191-817"><a href="#cb191-817" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = Chill_portions)) + </span></span>
<span id="cb191-818"><a href="#cb191-818" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(binwidth = 1,</span></span>
<span id="cb191-819"><a href="#cb191-819" aria-hidden="true" tabindex="-1"></a><span class="in">                 aes(fill = factor(Data_source))) +</span></span>
<span id="cb191-820"><a href="#cb191-820" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb191-821"><a href="#cb191-821" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = &quot;Data source&quot;) +</span></span>
<span id="cb191-822"><a href="#cb191-822" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab(&quot;Chill accumulation (Chill Portions)&quot;) +</span></span>
<span id="cb191-823"><a href="#cb191-823" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(&quot;Frequency&quot;)</span></span>
<span id="cb191-824"><a href="#cb191-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-825"><a href="#cb191-825" aria-hidden="true" tabindex="-1"></a><span class="in">chill_simulations &lt;-</span></span>
<span id="cb191-826"><a href="#cb191-826" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_comparison_full_seasons %&gt;%</span></span>
<span id="cb191-827"><a href="#cb191-827" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == &quot;simulated&quot;)</span></span>
<span id="cb191-828"><a href="#cb191-828" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-829"><a href="#cb191-829" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(chill_simulations,</span></span>
<span id="cb191-830"><a href="#cb191-830" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = Chill_portions)) +</span></span>
<span id="cb191-831"><a href="#cb191-831" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_ecdf(geom = &quot;step&quot;,</span></span>
<span id="cb191-832"><a href="#cb191-832" aria-hidden="true" tabindex="-1"></a><span class="in">            lwd = 1.5,</span></span>
<span id="cb191-833"><a href="#cb191-833" aria-hidden="true" tabindex="-1"></a><span class="in">            col = &quot;blue&quot;) +</span></span>
<span id="cb191-834"><a href="#cb191-834" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(&quot;Cumulative probability&quot;) +</span></span>
<span id="cb191-835"><a href="#cb191-835" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab(&quot;Chill accumulation (in Chill Portions)&quot;) +</span></span>
<span id="cb191-836"><a href="#cb191-836" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb191-837"><a href="#cb191-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-838"><a href="#cb191-838" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-839"><a href="#cb191-839" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Produce similar plots for the number of freezing hours (<span class="sc">\&lt;</span>0Â°C) in</span>
<span id="cb191-840"><a href="#cb191-840" aria-hidden="true" tabindex="-1"></a>    April (or October, if your site is in the Southern Hemisphere) for</span>
<span id="cb191-841"><a href="#cb191-841" aria-hidden="true" tabindex="-1"></a>    your location of interest.</span>
<span id="cb191-842"><a href="#cb191-842" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb191-843"><a href="#cb191-843" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb191-844"><a href="#cb191-844" aria-hidden="true" tabindex="-1"></a><span class="in">library(chillR)</span></span>
<span id="cb191-845"><a href="#cb191-845" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse) </span></span>
<span id="cb191-846"><a href="#cb191-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-847"><a href="#cb191-847" aria-hidden="true" tabindex="-1"></a><span class="in">Rochester &lt;- read.csv(&#39;data_New_York/Rochester_weather.csv&#39;)</span></span>
<span id="cb191-848"><a href="#cb191-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-849"><a href="#cb191-849" aria-hidden="true" tabindex="-1"></a><span class="in">Temp &lt;- Rochester %&gt;%</span></span>
<span id="cb191-850"><a href="#cb191-850" aria-hidden="true" tabindex="-1"></a><span class="in">  temperature_generation(years = c(1998,2009),</span></span>
<span id="cb191-851"><a href="#cb191-851" aria-hidden="true" tabindex="-1"></a><span class="in">                         sim_years = c(2001,2100))</span></span>
<span id="cb191-852"><a href="#cb191-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-853"><a href="#cb191-853" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb191-854"><a href="#cb191-854" aria-hidden="true" tabindex="-1"></a><span class="in">library(magrittr)</span></span>
<span id="cb191-855"><a href="#cb191-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-856"><a href="#cb191-856" aria-hidden="true" tabindex="-1"></a><span class="in">Temperatures &lt;- Rochester %&gt;% </span></span>
<span id="cb191-857"><a href="#cb191-857" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Year, Month, Day, Tmin, Tmax) %&gt;% </span></span>
<span id="cb191-858"><a href="#cb191-858" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Year %in% 1998:2009) %&gt;%</span></span>
<span id="cb191-859"><a href="#cb191-859" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(Data_source = &quot;observed&quot;) %&gt;%</span></span>
<span id="cb191-860"><a href="#cb191-860" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(</span></span>
<span id="cb191-861"><a href="#cb191-861" aria-hidden="true" tabindex="-1"></a><span class="in">    Temp[[1]] %&gt;% select(c(Year,</span></span>
<span id="cb191-862"><a href="#cb191-862" aria-hidden="true" tabindex="-1"></a><span class="in">                           Month,</span></span>
<span id="cb191-863"><a href="#cb191-863" aria-hidden="true" tabindex="-1"></a><span class="in">                           Day,</span></span>
<span id="cb191-864"><a href="#cb191-864" aria-hidden="true" tabindex="-1"></a><span class="in">                           Tmin,</span></span>
<span id="cb191-865"><a href="#cb191-865" aria-hidden="true" tabindex="-1"></a><span class="in">                           Tmax)) %&gt;%</span></span>
<span id="cb191-866"><a href="#cb191-866" aria-hidden="true" tabindex="-1"></a><span class="in">      cbind(Data_source = &quot;simulated&quot;)</span></span>
<span id="cb191-867"><a href="#cb191-867" aria-hidden="true" tabindex="-1"></a><span class="in">    ) %&gt;%</span></span>
<span id="cb191-868"><a href="#cb191-868" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Date = as.Date(ISOdate(2000,</span></span>
<span id="cb191-869"><a href="#cb191-869" aria-hidden="true" tabindex="-1"></a><span class="in">                                Month,</span></span>
<span id="cb191-870"><a href="#cb191-870" aria-hidden="true" tabindex="-1"></a><span class="in">                                Day)))</span></span>
<span id="cb191-871"><a href="#cb191-871" aria-hidden="true" tabindex="-1"></a><span class="in">df &lt;- data.frame(</span></span>
<span id="cb191-872"><a href="#cb191-872" aria-hidden="true" tabindex="-1"></a><span class="in">  lower =  c(-1000,    0),</span></span>
<span id="cb191-873"><a href="#cb191-873" aria-hidden="true" tabindex="-1"></a><span class="in">  upper =  c(    0, 1000),</span></span>
<span id="cb191-874"><a href="#cb191-874" aria-hidden="true" tabindex="-1"></a><span class="in">  weight = c(    1,    0))</span></span>
<span id="cb191-875"><a href="#cb191-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-876"><a href="#cb191-876" aria-hidden="true" tabindex="-1"></a><span class="in">freezing_hours &lt;- function(x) step_model(x,df)</span></span>
<span id="cb191-877"><a href="#cb191-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-878"><a href="#cb191-878" aria-hidden="true" tabindex="-1"></a><span class="in">chill_observed &lt;- Temperatures %&gt;%</span></span>
<span id="cb191-879"><a href="#cb191-879" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == &quot;observed&quot;) %&gt;%</span></span>
<span id="cb191-880"><a href="#cb191-880" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 43.15) %&gt;%</span></span>
<span id="cb191-881"><a href="#cb191-881" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse(Start_JDay = 91,</span></span>
<span id="cb191-882"><a href="#cb191-882" aria-hidden="true" tabindex="-1"></a><span class="in">               End_JDay = 120,</span></span>
<span id="cb191-883"><a href="#cb191-883" aria-hidden="true" tabindex="-1"></a><span class="in">               models = list(Frost = freezing_hours,</span></span>
<span id="cb191-884"><a href="#cb191-884" aria-hidden="true" tabindex="-1"></a><span class="in">                             Chill_portions = Dynamic_Model,</span></span>
<span id="cb191-885"><a href="#cb191-885" aria-hidden="true" tabindex="-1"></a><span class="in">                             GDH = GDH))</span></span>
<span id="cb191-886"><a href="#cb191-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-887"><a href="#cb191-887" aria-hidden="true" tabindex="-1"></a><span class="in">chill_simulated &lt;- Temperatures %&gt;%</span></span>
<span id="cb191-888"><a href="#cb191-888" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == &quot;simulated&quot;) %&gt;%</span></span>
<span id="cb191-889"><a href="#cb191-889" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 43.15) %&gt;%</span></span>
<span id="cb191-890"><a href="#cb191-890" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse(Start_JDay = 91,</span></span>
<span id="cb191-891"><a href="#cb191-891" aria-hidden="true" tabindex="-1"></a><span class="in">               End_JDay = 120,</span></span>
<span id="cb191-892"><a href="#cb191-892" aria-hidden="true" tabindex="-1"></a><span class="in">               models=list(Frost = freezing_hours,</span></span>
<span id="cb191-893"><a href="#cb191-893" aria-hidden="true" tabindex="-1"></a><span class="in">                           Chill_portions = Dynamic_Model,</span></span>
<span id="cb191-894"><a href="#cb191-894" aria-hidden="true" tabindex="-1"></a><span class="in">                           GDH = GDH))</span></span>
<span id="cb191-895"><a href="#cb191-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-896"><a href="#cb191-896" aria-hidden="true" tabindex="-1"></a><span class="in">chill_comparison &lt;-</span></span>
<span id="cb191-897"><a href="#cb191-897" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(chill_observed,</span></span>
<span id="cb191-898"><a href="#cb191-898" aria-hidden="true" tabindex="-1"></a><span class="in">        Data_source = &quot;observed&quot;) %&gt;%</span></span>
<span id="cb191-899"><a href="#cb191-899" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(cbind(chill_simulated,</span></span>
<span id="cb191-900"><a href="#cb191-900" aria-hidden="true" tabindex="-1"></a><span class="in">              Data_source = &quot;simulated&quot;))</span></span>
<span id="cb191-901"><a href="#cb191-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-902"><a href="#cb191-902" aria-hidden="true" tabindex="-1"></a><span class="in">chill_comparison_full_seasons &lt;-</span></span>
<span id="cb191-903"><a href="#cb191-903" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_comparison %&gt;%</span></span>
<span id="cb191-904"><a href="#cb191-904" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Perc_complete == 100)</span></span>
<span id="cb191-905"><a href="#cb191-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-906"><a href="#cb191-906" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(chill_comparison_full_seasons,</span></span>
<span id="cb191-907"><a href="#cb191-907" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = Frost)) + </span></span>
<span id="cb191-908"><a href="#cb191-908" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(binwidth = 25,</span></span>
<span id="cb191-909"><a href="#cb191-909" aria-hidden="true" tabindex="-1"></a><span class="in">                 aes(fill = factor(Data_source))) +</span></span>
<span id="cb191-910"><a href="#cb191-910" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 10) +</span></span>
<span id="cb191-911"><a href="#cb191-911" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = &quot;Data source&quot;) +</span></span>
<span id="cb191-912"><a href="#cb191-912" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab(&quot;Frost incidence during April (hours)&quot;) +</span></span>
<span id="cb191-913"><a href="#cb191-913" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(&quot;Frequency&quot;)</span></span>
<span id="cb191-914"><a href="#cb191-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-915"><a href="#cb191-915" aria-hidden="true" tabindex="-1"></a><span class="in">chill_simulations &lt;-</span></span>
<span id="cb191-916"><a href="#cb191-916" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_comparison_full_seasons %&gt;%</span></span>
<span id="cb191-917"><a href="#cb191-917" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == &quot;simulated&quot;)</span></span>
<span id="cb191-918"><a href="#cb191-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-919"><a href="#cb191-919" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(chill_simulations,</span></span>
<span id="cb191-920"><a href="#cb191-920" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = Frost)) +</span></span>
<span id="cb191-921"><a href="#cb191-921" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_ecdf(geom = &quot;step&quot;,</span></span>
<span id="cb191-922"><a href="#cb191-922" aria-hidden="true" tabindex="-1"></a><span class="in">            lwd = 1.5,</span></span>
<span id="cb191-923"><a href="#cb191-923" aria-hidden="true" tabindex="-1"></a><span class="in">            col = &quot;blue&quot;) +</span></span>
<span id="cb191-924"><a href="#cb191-924" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(&quot;Cumulative probability&quot;) +</span></span>
<span id="cb191-925"><a href="#cb191-925" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab(&quot;Frost incidence during April (hours)&quot;) +</span></span>
<span id="cb191-926"><a href="#cb191-926" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb191-927"><a href="#cb191-927" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-928"><a href="#cb191-928" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-929"><a href="#cb191-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-930"><a href="#cb191-930" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 14: Generating historic temperature scenarios</span></span>
<span id="cb191-931"><a href="#cb191-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-932"><a href="#cb191-932" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on historic temperature scenarios*** </span></span>
<span id="cb191-933"><a href="#cb191-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-934"><a href="#cb191-934" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>For the location you chose for previous exercises, produce historic temperature scenarios representing several years of the historic record (your choice).</span>
<span id="cb191-935"><a href="#cb191-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-936"><a href="#cb191-936" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb191-937"><a href="#cb191-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-938"><a href="#cb191-938" aria-hidden="true" tabindex="-1"></a><span class="in">library(chillR)</span></span>
<span id="cb191-939"><a href="#cb191-939" aria-hidden="true" tabindex="-1"></a><span class="in">library(magrittr)</span></span>
<span id="cb191-940"><a href="#cb191-940" aria-hidden="true" tabindex="-1"></a><span class="in">require(kableExtra)</span></span>
<span id="cb191-941"><a href="#cb191-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-942"><a href="#cb191-942" aria-hidden="true" tabindex="-1"></a><span class="in"># downloading weather station list for the vicinity of Rochester</span></span>
<span id="cb191-943"><a href="#cb191-943" aria-hidden="true" tabindex="-1"></a><span class="in">station_list &lt;- handle_gsod(action = &quot;list_stations&quot;,</span></span>
<span id="cb191-944"><a href="#cb191-944" aria-hidden="true" tabindex="-1"></a><span class="in">                            location=c(-77.60, 43.15))</span></span>
<span id="cb191-945"><a href="#cb191-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-946"><a href="#cb191-946" aria-hidden="true" tabindex="-1"></a><span class="in"># downloading weather data for Greater Rochester International AP and convert it to chillR format</span></span>
<span id="cb191-947"><a href="#cb191-947" aria-hidden="true" tabindex="-1"></a><span class="in">Rochester_weather &lt;- handle_gsod(action = &quot;download_weather&quot;,</span></span>
<span id="cb191-948"><a href="#cb191-948" aria-hidden="true" tabindex="-1"></a><span class="in">                            location = station_list$chillR_code[1],</span></span>
<span id="cb191-949"><a href="#cb191-949" aria-hidden="true" tabindex="-1"></a><span class="in">                            time_interval = c(1973,2019)) %&gt;%</span></span>
<span id="cb191-950"><a href="#cb191-950" aria-hidden="true" tabindex="-1"></a><span class="in">  handle_gsod()</span></span>
<span id="cb191-951"><a href="#cb191-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-952"><a href="#cb191-952" aria-hidden="true" tabindex="-1"></a><span class="in"># check record for missing data</span></span>
<span id="cb191-953"><a href="#cb191-953" aria-hidden="true" tabindex="-1"></a><span class="in">fix_weather(Rochester_weather$&#39;GREATER ROCHESTER INTERNATIONAL AP&#39;)$QC</span></span>
<span id="cb191-954"><a href="#cb191-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-955"><a href="#cb191-955" aria-hidden="true" tabindex="-1"></a><span class="in">Rochester_patched &lt;- patch_daily_temperatures(</span></span>
<span id="cb191-956"><a href="#cb191-956" aria-hidden="true" tabindex="-1"></a><span class="in">  weather = Rochester_weather$&#39;GREATER ROCHESTER INTERNATIONAL AP&#39;,</span></span>
<span id="cb191-957"><a href="#cb191-957" aria-hidden="true" tabindex="-1"></a><span class="in">  patch_weather = list(KA_weather))</span></span>
<span id="cb191-958"><a href="#cb191-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-959"><a href="#cb191-959" aria-hidden="true" tabindex="-1"></a><span class="in">fix_weather(Rochester_patched)$QC</span></span>
<span id="cb191-960"><a href="#cb191-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-961"><a href="#cb191-961" aria-hidden="true" tabindex="-1"></a><span class="in"># interpolating these gaps now</span></span>
<span id="cb191-962"><a href="#cb191-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-963"><a href="#cb191-963" aria-hidden="true" tabindex="-1"></a><span class="in">Rochester&lt;-fix_weather(Rochester_patched)</span></span>
<span id="cb191-964"><a href="#cb191-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-965"><a href="#cb191-965" aria-hidden="true" tabindex="-1"></a><span class="in">Rochester_temps&lt;-Rochester$weather</span></span>
<span id="cb191-966"><a href="#cb191-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-967"><a href="#cb191-967" aria-hidden="true" tabindex="-1"></a><span class="in">scenario_1980 &lt;- temperature_scenario_from_records(weather = Rochester_temps,</span></span>
<span id="cb191-968"><a href="#cb191-968" aria-hidden="true" tabindex="-1"></a><span class="in">                                                   year = 1980)</span></span>
<span id="cb191-969"><a href="#cb191-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-970"><a href="#cb191-970" aria-hidden="true" tabindex="-1"></a><span class="in">scenario_1980$&#39;1980&#39;$data</span></span>
<span id="cb191-971"><a href="#cb191-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-972"><a href="#cb191-972" aria-hidden="true" tabindex="-1"></a><span class="in">#what could have happened in 1980 not what happpened</span></span>
<span id="cb191-973"><a href="#cb191-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-974"><a href="#cb191-974" aria-hidden="true" tabindex="-1"></a><span class="in">temps_1980 &lt;- temperature_generation(weather = Rochester_temps,</span></span>
<span id="cb191-975"><a href="#cb191-975" aria-hidden="true" tabindex="-1"></a><span class="in">                                     years = c(1973, 2019),</span></span>
<span id="cb191-976"><a href="#cb191-976" aria-hidden="true" tabindex="-1"></a><span class="in">                                     sim_years = c(2001, 2100),</span></span>
<span id="cb191-977"><a href="#cb191-977" aria-hidden="true" tabindex="-1"></a><span class="in">                                     temperature_scenario = scenario_1980)</span></span>
<span id="cb191-978"><a href="#cb191-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-979"><a href="#cb191-979" aria-hidden="true" tabindex="-1"></a><span class="in">scenario_1996 &lt;- temperature_scenario_from_records(weather = Rochester_temps,</span></span>
<span id="cb191-980"><a href="#cb191-980" aria-hidden="true" tabindex="-1"></a><span class="in">                                                   year = 1996)</span></span>
<span id="cb191-981"><a href="#cb191-981" aria-hidden="true" tabindex="-1"></a><span class="in">scenario_1996$&#39;1996&#39;$data</span></span>
<span id="cb191-982"><a href="#cb191-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-983"><a href="#cb191-983" aria-hidden="true" tabindex="-1"></a><span class="in">relative_scenario &lt;- temperature_scenario_baseline_adjustment(</span></span>
<span id="cb191-984"><a href="#cb191-984" aria-hidden="true" tabindex="-1"></a><span class="in">  baseline = scenario_1996,</span></span>
<span id="cb191-985"><a href="#cb191-985" aria-hidden="true" tabindex="-1"></a><span class="in">  temperature_scenario = scenario_1980)</span></span>
<span id="cb191-986"><a href="#cb191-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-987"><a href="#cb191-987" aria-hidden="true" tabindex="-1"></a><span class="in"># error message here</span></span>
<span id="cb191-988"><a href="#cb191-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-989"><a href="#cb191-989" aria-hidden="true" tabindex="-1"></a><span class="in">temps_1980 &lt;- temperature_generation(weather = Rochester_temps,</span></span>
<span id="cb191-990"><a href="#cb191-990" aria-hidden="true" tabindex="-1"></a><span class="in">                                     years = c(1973, 2019),</span></span>
<span id="cb191-991"><a href="#cb191-991" aria-hidden="true" tabindex="-1"></a><span class="in">                                     sim_years = c(2001, 2100),</span></span>
<span id="cb191-992"><a href="#cb191-992" aria-hidden="true" tabindex="-1"></a><span class="in">                                     temperature_scenario = relative_scenario)</span></span>
<span id="cb191-993"><a href="#cb191-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-994"><a href="#cb191-994" aria-hidden="true" tabindex="-1"></a><span class="in">all_past_scenarios &lt;- temperature_scenario_from_records(</span></span>
<span id="cb191-995"><a href="#cb191-995" aria-hidden="true" tabindex="-1"></a><span class="in">  weather = Rochester_temps,</span></span>
<span id="cb191-996"><a href="#cb191-996" aria-hidden="true" tabindex="-1"></a><span class="in">  year = c(1980,</span></span>
<span id="cb191-997"><a href="#cb191-997" aria-hidden="true" tabindex="-1"></a><span class="in">           1990,</span></span>
<span id="cb191-998"><a href="#cb191-998" aria-hidden="true" tabindex="-1"></a><span class="in">           2000,</span></span>
<span id="cb191-999"><a href="#cb191-999" aria-hidden="true" tabindex="-1"></a><span class="in">           2010))</span></span>
<span id="cb191-1000"><a href="#cb191-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1001"><a href="#cb191-1001" aria-hidden="true" tabindex="-1"></a><span class="in">adjusted_scenarios &lt;- temperature_scenario_baseline_adjustment(</span></span>
<span id="cb191-1002"><a href="#cb191-1002" aria-hidden="true" tabindex="-1"></a><span class="in">  baseline = scenario_1996,</span></span>
<span id="cb191-1003"><a href="#cb191-1003" aria-hidden="true" tabindex="-1"></a><span class="in">  temperature_scenario = all_past_scenarios)</span></span>
<span id="cb191-1004"><a href="#cb191-1004" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-1005"><a href="#cb191-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1006"><a href="#cb191-1006" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb191-1007"><a href="#cb191-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1008"><a href="#cb191-1008" aria-hidden="true" tabindex="-1"></a><span class="in">all_past_scenario_temps &lt;- temperature_generation(</span></span>
<span id="cb191-1009"><a href="#cb191-1009" aria-hidden="true" tabindex="-1"></a><span class="in">  weather = Rochester_temps,</span></span>
<span id="cb191-1010"><a href="#cb191-1010" aria-hidden="true" tabindex="-1"></a><span class="in">  years = c(1973,2019),</span></span>
<span id="cb191-1011"><a href="#cb191-1011" aria-hidden="true" tabindex="-1"></a><span class="in">  sim_years = c(2001,2100),</span></span>
<span id="cb191-1012"><a href="#cb191-1012" aria-hidden="true" tabindex="-1"></a><span class="in">  temperature_scenario = adjusted_scenarios)</span></span>
<span id="cb191-1013"><a href="#cb191-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1014"><a href="#cb191-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-1015"><a href="#cb191-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1016"><a href="#cb191-1016" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, echo=FALSE}</span></span>
<span id="cb191-1017"><a href="#cb191-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1018"><a href="#cb191-1018" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(all_past_scenario_temps,&quot;data_New_York&quot;,&quot;all_past_temps&quot;)</span></span>
<span id="cb191-1019"><a href="#cb191-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-1020"><a href="#cb191-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1021"><a href="#cb191-1021" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb191-1022"><a href="#cb191-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1023"><a href="#cb191-1023" aria-hidden="true" tabindex="-1"></a><span class="in">all_past_scenario_temps &lt;- load_temperature_scenarios(&quot;data_New_York&quot;,&quot;all_past_temps&quot;)</span></span>
<span id="cb191-1024"><a href="#cb191-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```</span> </span>
<span id="cb191-1025"><a href="#cb191-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1026"><a href="#cb191-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb191-1027"><a href="#cb191-1027" aria-hidden="true" tabindex="-1"></a><span class="in">frost_model &lt;- function(x)</span></span>
<span id="cb191-1028"><a href="#cb191-1028" aria-hidden="true" tabindex="-1"></a><span class="in">  step_model(x,</span></span>
<span id="cb191-1029"><a href="#cb191-1029" aria-hidden="true" tabindex="-1"></a><span class="in">             data.frame(</span></span>
<span id="cb191-1030"><a href="#cb191-1030" aria-hidden="true" tabindex="-1"></a><span class="in">               lower=c(-1000, 0),</span></span>
<span id="cb191-1031"><a href="#cb191-1031" aria-hidden="true" tabindex="-1"></a><span class="in">               upper=c(0, 1000),</span></span>
<span id="cb191-1032"><a href="#cb191-1032" aria-hidden="true" tabindex="-1"></a><span class="in">               weight=c(1, 0)))</span></span>
<span id="cb191-1033"><a href="#cb191-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1034"><a href="#cb191-1034" aria-hidden="true" tabindex="-1"></a><span class="in">models &lt;- list(Chill_Portions = Dynamic_Model,</span></span>
<span id="cb191-1035"><a href="#cb191-1035" aria-hidden="true" tabindex="-1"></a><span class="in">               GDH = GDH,</span></span>
<span id="cb191-1036"><a href="#cb191-1036" aria-hidden="true" tabindex="-1"></a><span class="in">               Frost_H = frost_model)</span></span>
<span id="cb191-1037"><a href="#cb191-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1038"><a href="#cb191-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1039"><a href="#cb191-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1040"><a href="#cb191-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1041"><a href="#cb191-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1042"><a href="#cb191-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1043"><a href="#cb191-1043" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list &lt;- tempResponse_daily_list(all_past_scenario_temps,</span></span>
<span id="cb191-1044"><a href="#cb191-1044" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    latitude = 43.15,</span></span>
<span id="cb191-1045"><a href="#cb191-1045" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    Start_JDay = 305,</span></span>
<span id="cb191-1046"><a href="#cb191-1046" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    End_JDay = 59,</span></span>
<span id="cb191-1047"><a href="#cb191-1047" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    models = models)</span></span>
<span id="cb191-1048"><a href="#cb191-1048" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-1049"><a href="#cb191-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1050"><a href="#cb191-1050" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Produce chill distributions for these scenarios and plot them.</span>
<span id="cb191-1051"><a href="#cb191-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1052"><a href="#cb191-1052" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb191-1053"><a href="#cb191-1053" aria-hidden="true" tabindex="-1"></a><span class="in">scenarios &lt;- names(chill_hist_scenario_list)[1:4]</span></span>
<span id="cb191-1054"><a href="#cb191-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1055"><a href="#cb191-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1056"><a href="#cb191-1056" aria-hidden="true" tabindex="-1"></a><span class="in">all_scenarios &lt;- chill_hist_scenario_list[[scenarios[1]]] %&gt;%</span></span>
<span id="cb191-1057"><a href="#cb191-1057" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(scenario = as.numeric(scenarios[1]))</span></span>
<span id="cb191-1058"><a href="#cb191-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1059"><a href="#cb191-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1060"><a href="#cb191-1060" aria-hidden="true" tabindex="-1"></a><span class="in">for (sc in scenarios[2:4])</span></span>
<span id="cb191-1061"><a href="#cb191-1061" aria-hidden="true" tabindex="-1"></a><span class="in"> all_scenarios &lt;- all_scenarios %&gt;%</span></span>
<span id="cb191-1062"><a href="#cb191-1062" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(chill_hist_scenario_list[[sc]] %&gt;%</span></span>
<span id="cb191-1063"><a href="#cb191-1063" aria-hidden="true" tabindex="-1"></a><span class="in">          cbind(</span></span>
<span id="cb191-1064"><a href="#cb191-1064" aria-hidden="true" tabindex="-1"></a><span class="in">            scenario=as.numeric(sc))</span></span>
<span id="cb191-1065"><a href="#cb191-1065" aria-hidden="true" tabindex="-1"></a><span class="in">        ) %&gt;%</span></span>
<span id="cb191-1066"><a href="#cb191-1066" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Perc_complete == 100)</span></span>
<span id="cb191-1067"><a href="#cb191-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1068"><a href="#cb191-1068" aria-hidden="true" tabindex="-1"></a><span class="in"># Let&#39;s compute the actual &#39;observed&#39; chill for comparison</span></span>
<span id="cb191-1069"><a href="#cb191-1069" aria-hidden="true" tabindex="-1"></a><span class="in">actual_chill &lt;- tempResponse_daily_list(Rochester_temps,</span></span>
<span id="cb191-1070"><a href="#cb191-1070" aria-hidden="true" tabindex="-1"></a><span class="in">                                        latitude = 43.15,</span></span>
<span id="cb191-1071"><a href="#cb191-1071" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Start_JDay = 305,</span></span>
<span id="cb191-1072"><a href="#cb191-1072" aria-hidden="true" tabindex="-1"></a><span class="in">                                        End_JDay = 59,</span></span>
<span id="cb191-1073"><a href="#cb191-1073" aria-hidden="true" tabindex="-1"></a><span class="in">                                        models)[[1]] %&gt;%</span></span>
<span id="cb191-1074"><a href="#cb191-1074" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Perc_complete == 100)</span></span>
<span id="cb191-1075"><a href="#cb191-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1076"><a href="#cb191-1076" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = all_scenarios,</span></span>
<span id="cb191-1077"><a href="#cb191-1077" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(scenario,</span></span>
<span id="cb191-1078"><a href="#cb191-1078" aria-hidden="true" tabindex="-1"></a><span class="in">           Chill_Portions,</span></span>
<span id="cb191-1079"><a href="#cb191-1079" aria-hidden="true" tabindex="-1"></a><span class="in">           fill = factor(scenario))) +</span></span>
<span id="cb191-1080"><a href="#cb191-1080" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75)) +</span></span>
<span id="cb191-1081"><a href="#cb191-1081" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(&quot;Chill accumulation (Chill Portions)&quot;) +</span></span>
<span id="cb191-1082"><a href="#cb191-1082" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab(&quot;Scenario year&quot;) +</span></span>
<span id="cb191-1083"><a href="#cb191-1083" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 10) +</span></span>
<span id="cb191-1084"><a href="#cb191-1084" aria-hidden="true" tabindex="-1"></a><span class="in">  ylim(c(0,90)) +</span></span>
<span id="cb191-1085"><a href="#cb191-1085" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = actual_chill,</span></span>
<span id="cb191-1086"><a href="#cb191-1086" aria-hidden="true" tabindex="-1"></a><span class="in">             aes(End_year,</span></span>
<span id="cb191-1087"><a href="#cb191-1087" aria-hidden="true" tabindex="-1"></a><span class="in">                 Chill_Portions,</span></span>
<span id="cb191-1088"><a href="#cb191-1088" aria-hidden="true" tabindex="-1"></a><span class="in">                 fill = &quot;blue&quot;),</span></span>
<span id="cb191-1089"><a href="#cb191-1089" aria-hidden="true" tabindex="-1"></a><span class="in">             col = &quot;blue&quot;,</span></span>
<span id="cb191-1090"><a href="#cb191-1090" aria-hidden="true" tabindex="-1"></a><span class="in">             show.legend = FALSE) +</span></span>
<span id="cb191-1091"><a href="#cb191-1091" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_discrete(name = &quot;Scenario&quot;,</span></span>
<span id="cb191-1092"><a href="#cb191-1092" aria-hidden="true" tabindex="-1"></a><span class="in">                      breaks = unique(all_scenarios$scenario)) </span></span>
<span id="cb191-1093"><a href="#cb191-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1094"><a href="#cb191-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1095"><a href="#cb191-1095" aria-hidden="true" tabindex="-1"></a><span class="in">temperature_means &lt;- </span></span>
<span id="cb191-1096"><a href="#cb191-1096" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(Year = min(Rochester_temps$Year):max(Rochester_temps$Year),</span></span>
<span id="cb191-1097"><a href="#cb191-1097" aria-hidden="true" tabindex="-1"></a><span class="in">             Tmin = aggregate(Rochester_temps$Tmin,</span></span>
<span id="cb191-1098"><a href="#cb191-1098" aria-hidden="true" tabindex="-1"></a><span class="in">                              FUN = &quot;mean&quot;,</span></span>
<span id="cb191-1099"><a href="#cb191-1099" aria-hidden="true" tabindex="-1"></a><span class="in">                              by = list(Rochester_temps$Year))[,2],</span></span>
<span id="cb191-1100"><a href="#cb191-1100" aria-hidden="true" tabindex="-1"></a><span class="in">             Tmax=aggregate(Rochester_temps$Tmax,</span></span>
<span id="cb191-1101"><a href="#cb191-1101" aria-hidden="true" tabindex="-1"></a><span class="in">                            FUN = &quot;mean&quot;,</span></span>
<span id="cb191-1102"><a href="#cb191-1102" aria-hidden="true" tabindex="-1"></a><span class="in">                            by = list(Rochester_temps$Year))[,2]) %&gt;%</span></span>
<span id="cb191-1103"><a href="#cb191-1103" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(runn_mean_Tmin = runn_mean(Tmin,15),</span></span>
<span id="cb191-1104"><a href="#cb191-1104" aria-hidden="true" tabindex="-1"></a><span class="in">         runn_mean_Tmax = runn_mean(Tmax,15))</span></span>
<span id="cb191-1105"><a href="#cb191-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1106"><a href="#cb191-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1107"><a href="#cb191-1107" aria-hidden="true" tabindex="-1"></a><span class="in">Tmin_regression &lt;- lm(Tmin ~ Year,</span></span>
<span id="cb191-1108"><a href="#cb191-1108" aria-hidden="true" tabindex="-1"></a><span class="in">                      temperature_means)</span></span>
<span id="cb191-1109"><a href="#cb191-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1110"><a href="#cb191-1110" aria-hidden="true" tabindex="-1"></a><span class="in">Tmax_regression &lt;- lm(Tmax ~ Year,</span></span>
<span id="cb191-1111"><a href="#cb191-1111" aria-hidden="true" tabindex="-1"></a><span class="in">                      temperature_means)</span></span>
<span id="cb191-1112"><a href="#cb191-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1113"><a href="#cb191-1113" aria-hidden="true" tabindex="-1"></a><span class="in">temperature_means &lt;- temperature_means %&gt;%</span></span>
<span id="cb191-1114"><a href="#cb191-1114" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(regression_Tmin = Tmin_regression$coefficients[1]+</span></span>
<span id="cb191-1115"><a href="#cb191-1115" aria-hidden="true" tabindex="-1"></a><span class="in">           Tmin_regression$coefficients[2]*temperature_means$Year,</span></span>
<span id="cb191-1116"><a href="#cb191-1116" aria-hidden="true" tabindex="-1"></a><span class="in">         regression_Tmax = Tmax_regression$coefficients[1]+</span></span>
<span id="cb191-1117"><a href="#cb191-1117" aria-hidden="true" tabindex="-1"></a><span class="in">           Tmax_regression$coefficients[2]*temperature_means$Year</span></span>
<span id="cb191-1118"><a href="#cb191-1118" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb191-1119"><a href="#cb191-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1120"><a href="#cb191-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1121"><a href="#cb191-1121" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(temperature_means,</span></span>
<span id="cb191-1122"><a href="#cb191-1122" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Year,</span></span>
<span id="cb191-1123"><a href="#cb191-1123" aria-hidden="true" tabindex="-1"></a><span class="in">           Tmin)) + </span></span>
<span id="cb191-1124"><a href="#cb191-1124" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() + </span></span>
<span id="cb191-1125"><a href="#cb191-1125" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(data = temperature_means,</span></span>
<span id="cb191-1126"><a href="#cb191-1126" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(Year,</span></span>
<span id="cb191-1127"><a href="#cb191-1127" aria-hidden="true" tabindex="-1"></a><span class="in">                runn_mean_Tmin),</span></span>
<span id="cb191-1128"><a href="#cb191-1128" aria-hidden="true" tabindex="-1"></a><span class="in">            lwd = 2,</span></span>
<span id="cb191-1129"><a href="#cb191-1129" aria-hidden="true" tabindex="-1"></a><span class="in">            col = &quot;blue&quot;) + </span></span>
<span id="cb191-1130"><a href="#cb191-1130" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(data = temperature_means,</span></span>
<span id="cb191-1131"><a href="#cb191-1131" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(Year,</span></span>
<span id="cb191-1132"><a href="#cb191-1132" aria-hidden="true" tabindex="-1"></a><span class="in">                regression_Tmin),</span></span>
<span id="cb191-1133"><a href="#cb191-1133" aria-hidden="true" tabindex="-1"></a><span class="in">            lwd = 2,</span></span>
<span id="cb191-1134"><a href="#cb191-1134" aria-hidden="true" tabindex="-1"></a><span class="in">            col = &quot;red&quot;) +</span></span>
<span id="cb191-1135"><a href="#cb191-1135" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb191-1136"><a href="#cb191-1136" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(&quot;Mean monthly minimum temperature (Â°C)&quot;)</span></span>
<span id="cb191-1137"><a href="#cb191-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1138"><a href="#cb191-1138" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(temperature_means,</span></span>
<span id="cb191-1139"><a href="#cb191-1139" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Year,</span></span>
<span id="cb191-1140"><a href="#cb191-1140" aria-hidden="true" tabindex="-1"></a><span class="in">           Tmax)) + </span></span>
<span id="cb191-1141"><a href="#cb191-1141" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() + </span></span>
<span id="cb191-1142"><a href="#cb191-1142" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(data = temperature_means,</span></span>
<span id="cb191-1143"><a href="#cb191-1143" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(Year,</span></span>
<span id="cb191-1144"><a href="#cb191-1144" aria-hidden="true" tabindex="-1"></a><span class="in">                runn_mean_Tmax),</span></span>
<span id="cb191-1145"><a href="#cb191-1145" aria-hidden="true" tabindex="-1"></a><span class="in">            lwd = 2,</span></span>
<span id="cb191-1146"><a href="#cb191-1146" aria-hidden="true" tabindex="-1"></a><span class="in">            col = &quot;blue&quot;) + </span></span>
<span id="cb191-1147"><a href="#cb191-1147" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(data = temperature_means,</span></span>
<span id="cb191-1148"><a href="#cb191-1148" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(Year, </span></span>
<span id="cb191-1149"><a href="#cb191-1149" aria-hidden="true" tabindex="-1"></a><span class="in">                regression_Tmax),</span></span>
<span id="cb191-1150"><a href="#cb191-1150" aria-hidden="true" tabindex="-1"></a><span class="in">            lwd = 2,</span></span>
<span id="cb191-1151"><a href="#cb191-1151" aria-hidden="true" tabindex="-1"></a><span class="in">            col = &quot;red&quot;) +</span></span>
<span id="cb191-1152"><a href="#cb191-1152" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb191-1153"><a href="#cb191-1153" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(&quot;Mean monthly maximum temperature (Â°C)&quot;)</span></span>
<span id="cb191-1154"><a href="#cb191-1154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-1155"><a href="#cb191-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1156"><a href="#cb191-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1157"><a href="#cb191-1157" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-1158"><a href="#cb191-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1159"><a href="#cb191-1159" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb191-1160"><a href="#cb191-1160" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 15: Future temperature scenarios</span></span>
<span id="cb191-1161"><a href="#cb191-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1162"><a href="#cb191-1162" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on future temperature scenarios** </span></span>
<span id="cb191-1163"><a href="#cb191-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1164"><a href="#cb191-1164" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Briefly describe the differences between the RCPs and the SSPs.</span>
<span id="cb191-1165"><a href="#cb191-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1166"><a href="#cb191-1166" aria-hidden="true" tabindex="-1"></a>Representative Concentration Pathways (RCPs) are climate change scenarios to project future greenhouse gas concentrations.These pathways (or trajectories) describe future greenhouse gas concentrations (not emissions) and have been formally adopted by the IPCC. The pathways describe different climate change scenarios, all of which were considered possible depending on the amount of greenhouse gases (GHG) emitted in the years to come. </span>
<span id="cb191-1167"><a href="#cb191-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1168"><a href="#cb191-1168" aria-hidden="true" tabindex="-1"></a>Shared Socioeconomic Pathways (SSPs) are climate change scenarios of projected socioeconomic global changes up to 2100 as defined in the IPCC Sixth Assessment Report on climate change in 2021.The SRES scenarios are &quot;baseline&quot; (or &quot;reference&quot;) scenarios, which means that they do not take into account any current or future measures to limit greenhouse gas (GHG) emissions.</span>
<span id="cb191-1169"><a href="#cb191-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1170"><a href="#cb191-1170" aria-hidden="true" tabindex="-1"></a>A major difference between both models is that RCPs focus on Emissions and Radiative Forcing while SSPs emphasize Socioeconomic Pathways.In phenology SSPs integrate societal drivers, allowing phenologists to link temperature scenarios with land use changes, habitat fragmentation, or conservation efforts.</span>
<span id="cb191-1171"><a href="#cb191-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1172"><a href="#cb191-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1173"><a href="#cb191-1173" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 16: Generating CMIP6 temperature scenarios</span></span>
<span id="cb191-1174"><a href="#cb191-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1175"><a href="#cb191-1175" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on generating CMIP6 temperature scenarios*** </span></span>
<span id="cb191-1176"><a href="#cb191-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1177"><a href="#cb191-1177" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Analyze the historic and future impact of climate change on two agroclimatic metrics of your choice, for the location youâve chosen for your earlier analyses.</span>
<span id="cb191-1178"><a href="#cb191-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1179"><a href="#cb191-1179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb191-1180"><a href="#cb191-1180" aria-hidden="true" tabindex="-1"></a><span class="in">require(chillR)</span></span>
<span id="cb191-1181"><a href="#cb191-1181" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb191-1182"><a href="#cb191-1182" aria-hidden="true" tabindex="-1"></a><span class="in">library(ecmwfr)</span></span>
<span id="cb191-1183"><a href="#cb191-1183" aria-hidden="true" tabindex="-1"></a><span class="in">require(tidyverse)</span></span>
<span id="cb191-1184"><a href="#cb191-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1185"><a href="#cb191-1185" aria-hidden="true" tabindex="-1"></a><span class="in">#read Rochester_temps</span></span>
<span id="cb191-1186"><a href="#cb191-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1187"><a href="#cb191-1187" aria-hidden="true" tabindex="-1"></a><span class="in">Rochester_temps &lt;- read_tab(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_temps.csv&quot;)</span></span>
<span id="cb191-1188"><a href="#cb191-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1189"><a href="#cb191-1189" aria-hidden="true" tabindex="-1"></a><span class="in">location=c(-77.60, 43.15) #Rochester</span></span>
<span id="cb191-1190"><a href="#cb191-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1191"><a href="#cb191-1191" aria-hidden="true" tabindex="-1"></a><span class="in">area &lt;- c(45, -79, 40, -71)</span></span>
<span id="cb191-1192"><a href="#cb191-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1193"><a href="#cb191-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1194"><a href="#cb191-1194" aria-hidden="true" tabindex="-1"></a><span class="in">download_cmip6_ecmwfr(</span></span>
<span id="cb191-1195"><a href="#cb191-1195" aria-hidden="true" tabindex="-1"></a><span class="in">  scenarios = c(&quot;ssp126&quot;, &quot;ssp245&quot;, &quot;ssp370&quot;, &quot;ssp585&quot;),</span></span>
<span id="cb191-1196"><a href="#cb191-1196" aria-hidden="true" tabindex="-1"></a><span class="in">  area = area,</span></span>
<span id="cb191-1197"><a href="#cb191-1197" aria-hidden="true" tabindex="-1"></a><span class="in">  key = &#39;e1bd6995-c569-4df1-bbe8-3549cb586e4a&#39;,</span></span>
<span id="cb191-1198"><a href="#cb191-1198" aria-hidden="true" tabindex="-1"></a><span class="in">  model = &#39;default&#39;,</span></span>
<span id="cb191-1199"><a href="#cb191-1199" aria-hidden="true" tabindex="-1"></a><span class="in">  frequency = &#39;monthly&#39;,</span></span>
<span id="cb191-1200"><a href="#cb191-1200" aria-hidden="true" tabindex="-1"></a><span class="in">  variable = c(&#39;Tmin&#39;,  &#39;Tmax&#39;),</span></span>
<span id="cb191-1201"><a href="#cb191-1201" aria-hidden="true" tabindex="-1"></a><span class="in">  year_start = 2015,</span></span>
<span id="cb191-1202"><a href="#cb191-1202" aria-hidden="true" tabindex="-1"></a><span class="in">  year_end = 2100)</span></span>
<span id="cb191-1203"><a href="#cb191-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1204"><a href="#cb191-1204" aria-hidden="true" tabindex="-1"></a><span class="in">download_baseline_cmip6_ecmwfr(</span></span>
<span id="cb191-1205"><a href="#cb191-1205" aria-hidden="true" tabindex="-1"></a><span class="in">  area = area,</span></span>
<span id="cb191-1206"><a href="#cb191-1206" aria-hidden="true" tabindex="-1"></a><span class="in">  key = &#39;e1bd6995-c569-4df1-bbe8-3549cb586e4a&#39;,</span></span>
<span id="cb191-1207"><a href="#cb191-1207" aria-hidden="true" tabindex="-1"></a><span class="in">  model = &#39;match_downloaded&#39;,</span></span>
<span id="cb191-1208"><a href="#cb191-1208" aria-hidden="true" tabindex="-1"></a><span class="in">  frequency = &#39;monthly&#39;,</span></span>
<span id="cb191-1209"><a href="#cb191-1209" aria-hidden="true" tabindex="-1"></a><span class="in">  variable = c(&#39;Tmin&#39;, &#39;Tmax&#39;),</span></span>
<span id="cb191-1210"><a href="#cb191-1210" aria-hidden="true" tabindex="-1"></a><span class="in">  year_start = 1986, </span></span>
<span id="cb191-1211"><a href="#cb191-1211" aria-hidden="true" tabindex="-1"></a><span class="in">  year_end = 2014, </span></span>
<span id="cb191-1212"><a href="#cb191-1212" aria-hidden="true" tabindex="-1"></a><span class="in">  month = 1:12)</span></span>
<span id="cb191-1213"><a href="#cb191-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1214"><a href="#cb191-1214" aria-hidden="true" tabindex="-1"></a><span class="in">download_baseline_cmip6_ecmwfr(</span></span>
<span id="cb191-1215"><a href="#cb191-1215" aria-hidden="true" tabindex="-1"></a><span class="in">  area = area,</span></span>
<span id="cb191-1216"><a href="#cb191-1216" aria-hidden="true" tabindex="-1"></a><span class="in">  key = &#39;e1bd6995-c569-4df1-bbe8-3549cb586e4a&#39;,</span></span>
<span id="cb191-1217"><a href="#cb191-1217" aria-hidden="true" tabindex="-1"></a><span class="in">  model = &#39;match_downloaded&#39;,</span></span>
<span id="cb191-1218"><a href="#cb191-1218" aria-hidden="true" tabindex="-1"></a><span class="in">  frequency = &#39;monthly&#39;,</span></span>
<span id="cb191-1219"><a href="#cb191-1219" aria-hidden="true" tabindex="-1"></a><span class="in">  variable = c(&#39;Tmin&#39;, &#39;Tmax&#39;),</span></span>
<span id="cb191-1220"><a href="#cb191-1220" aria-hidden="true" tabindex="-1"></a><span class="in">  year_start = 1986,</span></span>
<span id="cb191-1221"><a href="#cb191-1221" aria-hidden="true" tabindex="-1"></a><span class="in">  year_end = 2014,</span></span>
<span id="cb191-1222"><a href="#cb191-1222" aria-hidden="true" tabindex="-1"></a><span class="in">  month = 1:12)</span></span>
<span id="cb191-1223"><a href="#cb191-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1224"><a href="#cb191-1224" aria-hidden="true" tabindex="-1"></a><span class="in">station &lt;- data.frame(</span></span>
<span id="cb191-1225"><a href="#cb191-1225" aria-hidden="true" tabindex="-1"></a><span class="in">  station_name = c(&quot;Rochester&quot;),</span></span>
<span id="cb191-1226"><a href="#cb191-1226" aria-hidden="true" tabindex="-1"></a><span class="in">  longitude = c(-77.60),</span></span>
<span id="cb191-1227"><a href="#cb191-1227" aria-hidden="true" tabindex="-1"></a><span class="in">  latitude = c(43.15))</span></span>
<span id="cb191-1228"><a href="#cb191-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1229"><a href="#cb191-1229" aria-hidden="true" tabindex="-1"></a><span class="in">library(ncdf4)</span></span>
<span id="cb191-1230"><a href="#cb191-1230" aria-hidden="true" tabindex="-1"></a><span class="in">library(PCICt)</span></span>
<span id="cb191-1231"><a href="#cb191-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1232"><a href="#cb191-1232" aria-hidden="true" tabindex="-1"></a><span class="in">extracted &lt;- extract_cmip6_data(stations = station)</span></span>
<span id="cb191-1233"><a href="#cb191-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1234"><a href="#cb191-1234" aria-hidden="true" tabindex="-1"></a><span class="in">head(extracted$`ssp126_AWI-CM-1-1-MR`)</span></span>
<span id="cb191-1235"><a href="#cb191-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1236"><a href="#cb191-1236" aria-hidden="true" tabindex="-1"></a><span class="in">change_scenarios &lt;- </span></span>
<span id="cb191-1237"><a href="#cb191-1237" aria-hidden="true" tabindex="-1"></a><span class="in">  gen_rel_change_scenario(extracted,</span></span>
<span id="cb191-1238"><a href="#cb191-1238" aria-hidden="true" tabindex="-1"></a><span class="in">                          scenarios = c(2050, 2085),</span></span>
<span id="cb191-1239"><a href="#cb191-1239" aria-hidden="true" tabindex="-1"></a><span class="in">                          reference_period = c(1986:2014),</span></span>
<span id="cb191-1240"><a href="#cb191-1240" aria-hidden="true" tabindex="-1"></a><span class="in">                          future_window_width = 30)</span></span>
<span id="cb191-1241"><a href="#cb191-1241" aria-hidden="true" tabindex="-1"></a><span class="in">head(change_scenarios)</span></span>
<span id="cb191-1242"><a href="#cb191-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1243"><a href="#cb191-1243" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(change_scenarios, &quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/all_change_scenarios.csv&quot;, row.names = FALSE)</span></span>
<span id="cb191-1244"><a href="#cb191-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1245"><a href="#cb191-1245" aria-hidden="true" tabindex="-1"></a><span class="in">change_scenarios &lt;- read.csv(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/all_change_scenarios.csv&quot;)</span></span>
<span id="cb191-1246"><a href="#cb191-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1247"><a href="#cb191-1247" aria-hidden="true" tabindex="-1"></a><span class="in">scen_list &lt;- convert_scen_information(change_scenarios)</span></span>
<span id="cb191-1248"><a href="#cb191-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1249"><a href="#cb191-1249" aria-hidden="true" tabindex="-1"></a><span class="in">scen_frame &lt;- convert_scen_information(scen_list)</span></span>
<span id="cb191-1250"><a href="#cb191-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1251"><a href="#cb191-1251" aria-hidden="true" tabindex="-1"></a><span class="in">scen_list$Rochester$ssp126$`ACCESS-CM2`$&#39;2050&#39;</span></span>
<span id="cb191-1252"><a href="#cb191-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1253"><a href="#cb191-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1254"><a href="#cb191-1254" aria-hidden="true" tabindex="-1"></a><span class="in">temps_1996 &lt;- temperature_scenario_from_records(Rochester_temps,</span></span>
<span id="cb191-1255"><a href="#cb191-1255" aria-hidden="true" tabindex="-1"></a><span class="in">                                                1996)</span></span>
<span id="cb191-1256"><a href="#cb191-1256" aria-hidden="true" tabindex="-1"></a><span class="in">temps_2000 &lt;- temperature_scenario_from_records(Rochester_temps,</span></span>
<span id="cb191-1257"><a href="#cb191-1257" aria-hidden="true" tabindex="-1"></a><span class="in">                                                2000)</span></span>
<span id="cb191-1258"><a href="#cb191-1258" aria-hidden="true" tabindex="-1"></a><span class="in">temps_1996</span></span>
<span id="cb191-1259"><a href="#cb191-1259" aria-hidden="true" tabindex="-1"></a><span class="in">temps_2000</span></span>
<span id="cb191-1260"><a href="#cb191-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1261"><a href="#cb191-1261" aria-hidden="true" tabindex="-1"></a><span class="in">base &lt;- temperature_scenario_baseline_adjustment(temps_1996,</span></span>
<span id="cb191-1262"><a href="#cb191-1262" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 temps_2000)</span></span>
<span id="cb191-1263"><a href="#cb191-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1264"><a href="#cb191-1264" aria-hidden="true" tabindex="-1"></a><span class="in">base</span></span>
<span id="cb191-1265"><a href="#cb191-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1266"><a href="#cb191-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1267"><a href="#cb191-1267" aria-hidden="true" tabindex="-1"></a><span class="in">scen_list &lt;- convert_scen_information(change_scenarios,</span></span>
<span id="cb191-1268"><a href="#cb191-1268" aria-hidden="true" tabindex="-1"></a><span class="in">                                      give_structure = FALSE)</span></span>
<span id="cb191-1269"><a href="#cb191-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1270"><a href="#cb191-1270" aria-hidden="true" tabindex="-1"></a><span class="in">adjusted_list &lt;- temperature_scenario_baseline_adjustment(base,</span></span>
<span id="cb191-1271"><a href="#cb191-1271" aria-hidden="true" tabindex="-1"></a><span class="in">                                                          scen_list,</span></span>
<span id="cb191-1272"><a href="#cb191-1272" aria-hidden="true" tabindex="-1"></a><span class="in">                   temperature_check_args = </span></span>
<span id="cb191-1273"><a href="#cb191-1273" aria-hidden="true" tabindex="-1"></a><span class="in">                     list(scenario_check_thresholds = c(-5, 15)))</span></span>
<span id="cb191-1274"><a href="#cb191-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1275"><a href="#cb191-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1276"><a href="#cb191-1276" aria-hidden="true" tabindex="-1"></a><span class="in"># temps &lt;- temperature_generation(Rochester_temps,</span></span>
<span id="cb191-1277"><a href="#cb191-1277" aria-hidden="true" tabindex="-1"></a><span class="in">#                                 years = c(1973, 2019),</span></span>
<span id="cb191-1278"><a href="#cb191-1278" aria-hidden="true" tabindex="-1"></a><span class="in">#                                 sim_years = c(2001, 2100),</span></span>
<span id="cb191-1279"><a href="#cb191-1279" aria-hidden="true" tabindex="-1"></a><span class="in">#                                 adjusted_list,  </span></span>
<span id="cb191-1280"><a href="#cb191-1280" aria-hidden="true" tabindex="-1"></a><span class="in">#                                 temperature_check_args = </span></span>
<span id="cb191-1281"><a href="#cb191-1281" aria-hidden="true" tabindex="-1"></a><span class="in">#                                   list( scenario_check_thresholds = c(-5, 15)))</span></span>
<span id="cb191-1282"><a href="#cb191-1282" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb191-1283"><a href="#cb191-1283" aria-hidden="true" tabindex="-1"></a><span class="in"># save_temperature_scenarios(temps,</span></span>
<span id="cb191-1284"><a href="#cb191-1284" aria-hidden="true" tabindex="-1"></a><span class="in">#                            &quot;data_New_York/future_climate&quot;,&quot;Rochester_future&quot;)</span></span>
<span id="cb191-1285"><a href="#cb191-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1286"><a href="#cb191-1286" aria-hidden="true" tabindex="-1"></a><span class="in"># temps &lt;- load_temperature_scenarios(&quot;data_New_Year/future_climate&quot;,&quot;Rochester_future_&quot;)</span></span>
<span id="cb191-1287"><a href="#cb191-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1288"><a href="#cb191-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1289"><a href="#cb191-1289" aria-hidden="true" tabindex="-1"></a><span class="in"># now we have temperature scenarios</span></span>
<span id="cb191-1290"><a href="#cb191-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1291"><a href="#cb191-1291" aria-hidden="true" tabindex="-1"></a><span class="in">for(scen in 1:length(adjusted_list))</span></span>
<span id="cb191-1292"><a href="#cb191-1292" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb191-1293"><a href="#cb191-1293" aria-hidden="true" tabindex="-1"></a><span class="in">  if(!file.exists(paste0(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate/Rochester_future_&quot;,</span></span>
<span id="cb191-1294"><a href="#cb191-1294" aria-hidden="true" tabindex="-1"></a><span class="in">                       scen,&quot;_&quot;,</span></span>
<span id="cb191-1295"><a href="#cb191-1295" aria-hidden="true" tabindex="-1"></a><span class="in">                       names(adjusted_list)[scen],&quot;.csv&quot;)) )</span></span>
<span id="cb191-1296"><a href="#cb191-1296" aria-hidden="true" tabindex="-1"></a><span class="in">  {temp_temp &lt;- temperature_generation(Rochester_temps,</span></span>
<span id="cb191-1297"><a href="#cb191-1297" aria-hidden="true" tabindex="-1"></a><span class="in">                                   years = c(1973, 2019),</span></span>
<span id="cb191-1298"><a href="#cb191-1298" aria-hidden="true" tabindex="-1"></a><span class="in">                                   sim_years = c(2001, 2100),</span></span>
<span id="cb191-1299"><a href="#cb191-1299" aria-hidden="true" tabindex="-1"></a><span class="in">                                   adjusted_list[scen],  </span></span>
<span id="cb191-1300"><a href="#cb191-1300" aria-hidden="true" tabindex="-1"></a><span class="in">                                   temperature_check_args = </span></span>
<span id="cb191-1301"><a href="#cb191-1301" aria-hidden="true" tabindex="-1"></a><span class="in">                                     list( scenario_check_thresholds = c(-5, 15)))</span></span>
<span id="cb191-1302"><a href="#cb191-1302" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(temp_temp[[1]],paste0(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate/Rochester_future_&quot;,scen,&quot;_&quot;,names(adjusted_list)[scen],&quot;.csv&quot;),</span></span>
<span id="cb191-1303"><a href="#cb191-1303" aria-hidden="true" tabindex="-1"></a><span class="in">                             row.names=FALSE)</span></span>
<span id="cb191-1304"><a href="#cb191-1304" aria-hidden="true" tabindex="-1"></a><span class="in">  print(paste(&quot;Processed object&quot;,scen,&quot;of&quot;, length(adjusted_list)))</span></span>
<span id="cb191-1305"><a href="#cb191-1305" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-1306"><a href="#cb191-1306" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb191-1307"><a href="#cb191-1307" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb191-1308"><a href="#cb191-1308" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-1309"><a href="#cb191-1309" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb191-1310"><a href="#cb191-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1311"><a href="#cb191-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1312"><a href="#cb191-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1313"><a href="#cb191-1313" aria-hidden="true" tabindex="-1"></a><span class="in">temps &lt;- load_temperature_scenarios(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;,&quot;Rochester_future_&quot;)</span></span>
<span id="cb191-1314"><a href="#cb191-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1315"><a href="#cb191-1315" aria-hidden="true" tabindex="-1"></a><span class="in">frost_model &lt;- function(x)</span></span>
<span id="cb191-1316"><a href="#cb191-1316" aria-hidden="true" tabindex="-1"></a><span class="in">  step_model(x,</span></span>
<span id="cb191-1317"><a href="#cb191-1317" aria-hidden="true" tabindex="-1"></a><span class="in">             data.frame(</span></span>
<span id="cb191-1318"><a href="#cb191-1318" aria-hidden="true" tabindex="-1"></a><span class="in">               lower = c(-1000, 0),</span></span>
<span id="cb191-1319"><a href="#cb191-1319" aria-hidden="true" tabindex="-1"></a><span class="in">               upper = c(0, 1000),</span></span>
<span id="cb191-1320"><a href="#cb191-1320" aria-hidden="true" tabindex="-1"></a><span class="in">               weight = c(1, 0)))</span></span>
<span id="cb191-1321"><a href="#cb191-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1322"><a href="#cb191-1322" aria-hidden="true" tabindex="-1"></a><span class="in">models &lt;- list(Chill_Portions = Dynamic_Model,</span></span>
<span id="cb191-1323"><a href="#cb191-1323" aria-hidden="true" tabindex="-1"></a><span class="in">               GDH = GDH,</span></span>
<span id="cb191-1324"><a href="#cb191-1324" aria-hidden="true" tabindex="-1"></a><span class="in">               Frost_H = frost_model)</span></span>
<span id="cb191-1325"><a href="#cb191-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1326"><a href="#cb191-1326" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list &lt;- </span></span>
<span id="cb191-1327"><a href="#cb191-1327" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse_daily_list(temps,</span></span>
<span id="cb191-1328"><a href="#cb191-1328" aria-hidden="true" tabindex="-1"></a><span class="in">                          latitude = 43.15,</span></span>
<span id="cb191-1329"><a href="#cb191-1329" aria-hidden="true" tabindex="-1"></a><span class="in">                          Start_JDay = 305,</span></span>
<span id="cb191-1330"><a href="#cb191-1330" aria-hidden="true" tabindex="-1"></a><span class="in">                          End_JDay = 59,</span></span>
<span id="cb191-1331"><a href="#cb191-1331" aria-hidden="true" tabindex="-1"></a><span class="in">                          models = models)</span></span>
<span id="cb191-1332"><a href="#cb191-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1333"><a href="#cb191-1333" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list &lt;- </span></span>
<span id="cb191-1334"><a href="#cb191-1334" aria-hidden="true" tabindex="-1"></a><span class="in">  lapply(chill_future_scenario_list,</span></span>
<span id="cb191-1335"><a href="#cb191-1335" aria-hidden="true" tabindex="-1"></a><span class="in">         function(x) x %&gt;%</span></span>
<span id="cb191-1336"><a href="#cb191-1336" aria-hidden="true" tabindex="-1"></a><span class="in">           filter(Perc_complete == 100))</span></span>
<span id="cb191-1337"><a href="#cb191-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1338"><a href="#cb191-1338" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(chill_future_scenario_list,</span></span>
<span id="cb191-1339"><a href="#cb191-1339" aria-hidden="true" tabindex="-1"></a><span class="in">                           &quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;,</span></span>
<span id="cb191-1340"><a href="#cb191-1340" aria-hidden="true" tabindex="-1"></a><span class="in">                           &quot;Rochester_futurechill&quot;)</span></span>
<span id="cb191-1341"><a href="#cb191-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1342"><a href="#cb191-1342" aria-hidden="true" tabindex="-1"></a><span class="in"># this would be for spring frost, but we&#39;re not running this</span></span>
<span id="cb191-1343"><a href="#cb191-1343" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list_frost &lt;- </span></span>
<span id="cb191-1344"><a href="#cb191-1344" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse_daily_list(temps,</span></span>
<span id="cb191-1345"><a href="#cb191-1345" aria-hidden="true" tabindex="-1"></a><span class="in">                          latitude = 43.15,</span></span>
<span id="cb191-1346"><a href="#cb191-1346" aria-hidden="true" tabindex="-1"></a><span class="in">                          Start_JDay = 75,</span></span>
<span id="cb191-1347"><a href="#cb191-1347" aria-hidden="true" tabindex="-1"></a><span class="in">                          End_JDay = 120,</span></span>
<span id="cb191-1348"><a href="#cb191-1348" aria-hidden="true" tabindex="-1"></a><span class="in">                          models = list(GDH = GDH,</span></span>
<span id="cb191-1349"><a href="#cb191-1349" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Frost_H = frost_model))</span></span>
<span id="cb191-1350"><a href="#cb191-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1351"><a href="#cb191-1351" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list_frost &lt;- </span></span>
<span id="cb191-1352"><a href="#cb191-1352" aria-hidden="true" tabindex="-1"></a><span class="in">  lapply(chill_future_scenario_list_frost,</span></span>
<span id="cb191-1353"><a href="#cb191-1353" aria-hidden="true" tabindex="-1"></a><span class="in">         function(x) x %&gt;%</span></span>
<span id="cb191-1354"><a href="#cb191-1354" aria-hidden="true" tabindex="-1"></a><span class="in">           filter(Perc_complete == 100))</span></span>
<span id="cb191-1355"><a href="#cb191-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1356"><a href="#cb191-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1357"><a href="#cb191-1357" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(chill_future_scenario_list_frost,</span></span>
<span id="cb191-1358"><a href="#cb191-1358" aria-hidden="true" tabindex="-1"></a><span class="in">                           &quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;,</span></span>
<span id="cb191-1359"><a href="#cb191-1359" aria-hidden="true" tabindex="-1"></a><span class="in">                           &quot;Rochester_futurefrost&quot;)</span></span>
<span id="cb191-1360"><a href="#cb191-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1361"><a href="#cb191-1361" aria-hidden="true" tabindex="-1"></a><span class="in"># simulate for the observed record</span></span>
<span id="cb191-1362"><a href="#cb191-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1363"><a href="#cb191-1363" aria-hidden="true" tabindex="-1"></a><span class="in">Rochester_temps &lt;- read_tab(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_temps.csv&quot;)</span></span>
<span id="cb191-1364"><a href="#cb191-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1365"><a href="#cb191-1365" aria-hidden="true" tabindex="-1"></a><span class="in">observed_chill &lt;- tempResponse_daily_list(Rochester_temps,</span></span>
<span id="cb191-1366"><a href="#cb191-1366" aria-hidden="true" tabindex="-1"></a><span class="in">                                          latitude = 43.15,</span></span>
<span id="cb191-1367"><a href="#cb191-1367" aria-hidden="true" tabindex="-1"></a><span class="in">                                          Start_JDay = 305,</span></span>
<span id="cb191-1368"><a href="#cb191-1368" aria-hidden="true" tabindex="-1"></a><span class="in">                                          End_JDay = 59,</span></span>
<span id="cb191-1369"><a href="#cb191-1369" aria-hidden="true" tabindex="-1"></a><span class="in">                                          models = models)</span></span>
<span id="cb191-1370"><a href="#cb191-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1371"><a href="#cb191-1371" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(observed_chill, &quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_observed_chill_305_59.csv&quot;)</span></span>
<span id="cb191-1372"><a href="#cb191-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1373"><a href="#cb191-1373" aria-hidden="true" tabindex="-1"></a><span class="in"># simulate chill for historic scenarios</span></span>
<span id="cb191-1374"><a href="#cb191-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1375"><a href="#cb191-1375" aria-hidden="true" tabindex="-1"></a><span class="in">hist_temps &lt;- load_temperature_scenarios(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York&quot;,&quot;all_past_temps&quot;)</span></span>
<span id="cb191-1376"><a href="#cb191-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1377"><a href="#cb191-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1378"><a href="#cb191-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1379"><a href="#cb191-1379" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list &lt;- tempResponse_daily_list(hist_temps,</span></span>
<span id="cb191-1380"><a href="#cb191-1380" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    latitude = 43.15,</span></span>
<span id="cb191-1381"><a href="#cb191-1381" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    Start_JDay = 305,</span></span>
<span id="cb191-1382"><a href="#cb191-1382" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    End_JDay = 59,</span></span>
<span id="cb191-1383"><a href="#cb191-1383" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    models = models)</span></span>
<span id="cb191-1384"><a href="#cb191-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1385"><a href="#cb191-1385" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list &lt;- lapply(chill_hist_scenario_list,</span></span>
<span id="cb191-1386"><a href="#cb191-1386" aria-hidden="true" tabindex="-1"></a><span class="in">                                   function(x) x %&gt;%</span></span>
<span id="cb191-1387"><a href="#cb191-1387" aria-hidden="true" tabindex="-1"></a><span class="in">                                     filter(Perc_complete == 100))</span></span>
<span id="cb191-1388"><a href="#cb191-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1389"><a href="#cb191-1389" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(chill_hist_scenario_list,</span></span>
<span id="cb191-1390"><a href="#cb191-1390" aria-hidden="true" tabindex="-1"></a><span class="in">                           &quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;,</span></span>
<span id="cb191-1391"><a href="#cb191-1391" aria-hidden="true" tabindex="-1"></a><span class="in">                           &quot;Rochester_hist_chill_305_59&quot;)</span></span>
<span id="cb191-1392"><a href="#cb191-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1393"><a href="#cb191-1393" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list &lt;- load_temperature_scenarios(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;,&quot;Rochester_futurechill&quot;)</span></span>
<span id="cb191-1394"><a href="#cb191-1394" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list&lt;-load_temperature_scenarios(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York&quot;,&quot;Rochester_hist_chill_305_59&quot;)</span></span>
<span id="cb191-1395"><a href="#cb191-1395" aria-hidden="true" tabindex="-1"></a><span class="in">observed_chill &lt;- read_tab(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_observed_chill_305_59.csv&quot;)</span></span>
<span id="cb191-1396"><a href="#cb191-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1397"><a href="#cb191-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1398"><a href="#cb191-1398" aria-hidden="true" tabindex="-1"></a><span class="in"># prepare for plotting</span></span>
<span id="cb191-1399"><a href="#cb191-1399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1400"><a href="#cb191-1400" aria-hidden="true" tabindex="-1"></a><span class="in">chills &lt;- make_climate_scenario(</span></span>
<span id="cb191-1401"><a href="#cb191-1401" aria-hidden="true" tabindex="-1"></a><span class="in">  metric_summary = chill_hist_scenario_list,</span></span>
<span id="cb191-1402"><a href="#cb191-1402" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = &quot;Historical&quot;,</span></span>
<span id="cb191-1403"><a href="#cb191-1403" aria-hidden="true" tabindex="-1"></a><span class="in">  historic_data = observed_chill,</span></span>
<span id="cb191-1404"><a href="#cb191-1404" aria-hidden="true" tabindex="-1"></a><span class="in">  time_series = TRUE)</span></span>
<span id="cb191-1405"><a href="#cb191-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1406"><a href="#cb191-1406" aria-hidden="true" tabindex="-1"></a><span class="in">plot_climate_scenarios(</span></span>
<span id="cb191-1407"><a href="#cb191-1407" aria-hidden="true" tabindex="-1"></a><span class="in">  climate_scenario_list = chills,</span></span>
<span id="cb191-1408"><a href="#cb191-1408" aria-hidden="true" tabindex="-1"></a><span class="in">  metric = &quot;Chill_Portions&quot;,</span></span>
<span id="cb191-1409"><a href="#cb191-1409" aria-hidden="true" tabindex="-1"></a><span class="in">  metric_label = &quot;Chill (Chill Portions)&quot;)</span></span>
<span id="cb191-1410"><a href="#cb191-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1411"><a href="#cb191-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1412"><a href="#cb191-1412" aria-hidden="true" tabindex="-1"></a><span class="in">list_ssp &lt;- </span></span>
<span id="cb191-1413"><a href="#cb191-1413" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list),</span></span>
<span id="cb191-1414"><a href="#cb191-1414" aria-hidden="true" tabindex="-1"></a><span class="in">           &#39;\\.&#39;) %&gt;%</span></span>
<span id="cb191-1415"><a href="#cb191-1415" aria-hidden="true" tabindex="-1"></a><span class="in">  map(2) %&gt;%</span></span>
<span id="cb191-1416"><a href="#cb191-1416" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb191-1417"><a href="#cb191-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1418"><a href="#cb191-1418" aria-hidden="true" tabindex="-1"></a><span class="in">list_gcm &lt;-</span></span>
<span id="cb191-1419"><a href="#cb191-1419" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), &#39;\\.&#39;) %&gt;%</span></span>
<span id="cb191-1420"><a href="#cb191-1420" aria-hidden="true" tabindex="-1"></a><span class="in">  map(3) %&gt;%</span></span>
<span id="cb191-1421"><a href="#cb191-1421" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb191-1422"><a href="#cb191-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1423"><a href="#cb191-1423" aria-hidden="true" tabindex="-1"></a><span class="in">list_time &lt;-</span></span>
<span id="cb191-1424"><a href="#cb191-1424" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), &#39;\\.&#39;) %&gt;%</span></span>
<span id="cb191-1425"><a href="#cb191-1425" aria-hidden="true" tabindex="-1"></a><span class="in">  map(4) %&gt;%</span></span>
<span id="cb191-1426"><a href="#cb191-1426" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb191-1427"><a href="#cb191-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1428"><a href="#cb191-1428" aria-hidden="true" tabindex="-1"></a><span class="in">SSPs &lt;- c(&quot;ssp126&quot;, &quot;ssp245&quot;, &quot;ssp370&quot;, &quot;ssp585&quot;)</span></span>
<span id="cb191-1429"><a href="#cb191-1429" aria-hidden="true" tabindex="-1"></a><span class="in">Times &lt;- c(2050, 2085)</span></span>
<span id="cb191-1430"><a href="#cb191-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1431"><a href="#cb191-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1432"><a href="#cb191-1432" aria-hidden="true" tabindex="-1"></a><span class="in">for(SSP in SSPs)</span></span>
<span id="cb191-1433"><a href="#cb191-1433" aria-hidden="true" tabindex="-1"></a><span class="in">  for(Time in Times)</span></span>
<span id="cb191-1434"><a href="#cb191-1434" aria-hidden="true" tabindex="-1"></a><span class="in">  {</span></span>
<span id="cb191-1435"><a href="#cb191-1435" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb191-1436"><a href="#cb191-1436" aria-hidden="true" tabindex="-1"></a><span class="in">    # find all scenarios for the ssp and time</span></span>
<span id="cb191-1437"><a href="#cb191-1437" aria-hidden="true" tabindex="-1"></a><span class="in">    chill &lt;- chill_future_scenario_list[list_ssp == SSP &amp;</span></span>
<span id="cb191-1438"><a href="#cb191-1438" aria-hidden="true" tabindex="-1"></a><span class="in">                                          list_time == Time]</span></span>
<span id="cb191-1439"><a href="#cb191-1439" aria-hidden="true" tabindex="-1"></a><span class="in">    names(chill) &lt;- list_gcm[list_ssp == SSP &amp;</span></span>
<span id="cb191-1440"><a href="#cb191-1440" aria-hidden="true" tabindex="-1"></a><span class="in">                               list_time == Time]</span></span>
<span id="cb191-1441"><a href="#cb191-1441" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == &quot;ssp126&quot;) SSPcaption &lt;- &quot;SSP1&quot;</span></span>
<span id="cb191-1442"><a href="#cb191-1442" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == &quot;ssp245&quot;) SSPcaption &lt;- &quot;SSP2&quot;</span></span>
<span id="cb191-1443"><a href="#cb191-1443" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == &quot;ssp370&quot;) SSPcaption &lt;- &quot;SSP3&quot;</span></span>
<span id="cb191-1444"><a href="#cb191-1444" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == &quot;ssp585&quot;) SSPcaption &lt;- &quot;SSP5&quot;    </span></span>
<span id="cb191-1445"><a href="#cb191-1445" aria-hidden="true" tabindex="-1"></a><span class="in">    chills &lt;- chill %&gt;% </span></span>
<span id="cb191-1446"><a href="#cb191-1446" aria-hidden="true" tabindex="-1"></a><span class="in">      make_climate_scenario(</span></span>
<span id="cb191-1447"><a href="#cb191-1447" aria-hidden="true" tabindex="-1"></a><span class="in">        caption = c(SSPcaption,</span></span>
<span id="cb191-1448"><a href="#cb191-1448" aria-hidden="true" tabindex="-1"></a><span class="in">                    Time),</span></span>
<span id="cb191-1449"><a href="#cb191-1449" aria-hidden="true" tabindex="-1"></a><span class="in">        add_to = chills)</span></span>
<span id="cb191-1450"><a href="#cb191-1450" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb191-1451"><a href="#cb191-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1452"><a href="#cb191-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1453"><a href="#cb191-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1454"><a href="#cb191-1454" aria-hidden="true" tabindex="-1"></a><span class="in">info_chill &lt;-</span></span>
<span id="cb191-1455"><a href="#cb191-1455" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_climate_scenarios(</span></span>
<span id="cb191-1456"><a href="#cb191-1456" aria-hidden="true" tabindex="-1"></a><span class="in">    climate_scenario_list = chills,</span></span>
<span id="cb191-1457"><a href="#cb191-1457" aria-hidden="true" tabindex="-1"></a><span class="in">    metric = &quot;Chill_Portions&quot;,</span></span>
<span id="cb191-1458"><a href="#cb191-1458" aria-hidden="true" tabindex="-1"></a><span class="in">    metric_label = &quot;Chill (Chill Portions)&quot;,</span></span>
<span id="cb191-1459"><a href="#cb191-1459" aria-hidden="true" tabindex="-1"></a><span class="in">    texcex = 1)</span></span>
<span id="cb191-1460"><a href="#cb191-1460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1461"><a href="#cb191-1461" aria-hidden="true" tabindex="-1"></a><span class="in">info_heat &lt;-</span></span>
<span id="cb191-1462"><a href="#cb191-1462" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_climate_scenarios(</span></span>
<span id="cb191-1463"><a href="#cb191-1463" aria-hidden="true" tabindex="-1"></a><span class="in">    climate_scenario_list = chills,</span></span>
<span id="cb191-1464"><a href="#cb191-1464" aria-hidden="true" tabindex="-1"></a><span class="in">    metric = &quot;GDH&quot;,</span></span>
<span id="cb191-1465"><a href="#cb191-1465" aria-hidden="true" tabindex="-1"></a><span class="in">    metric_label = &quot;Heat (Growing Degree Hours)&quot;,</span></span>
<span id="cb191-1466"><a href="#cb191-1466" aria-hidden="true" tabindex="-1"></a><span class="in">    texcex = 1)</span></span>
<span id="cb191-1467"><a href="#cb191-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1468"><a href="#cb191-1468" aria-hidden="true" tabindex="-1"></a><span class="in">info_frost &lt;- </span></span>
<span id="cb191-1469"><a href="#cb191-1469" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_climate_scenarios(  </span></span>
<span id="cb191-1470"><a href="#cb191-1470" aria-hidden="true" tabindex="-1"></a><span class="in">    climate_scenario_list=chills,</span></span>
<span id="cb191-1471"><a href="#cb191-1471" aria-hidden="true" tabindex="-1"></a><span class="in">    metric=&quot;Frost_H&quot;,</span></span>
<span id="cb191-1472"><a href="#cb191-1472" aria-hidden="true" tabindex="-1"></a><span class="in">    metric_label=&quot;Frost incidence (hours)&quot;,</span></span>
<span id="cb191-1473"><a href="#cb191-1473" aria-hidden="true" tabindex="-1"></a><span class="in">    texcex=1)</span></span>
<span id="cb191-1474"><a href="#cb191-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1475"><a href="#cb191-1475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1476"><a href="#cb191-1476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1477"><a href="#cb191-1477" aria-hidden="true" tabindex="-1"></a><span class="in">info_chill[[2]]</span></span>
<span id="cb191-1478"><a href="#cb191-1478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-1479"><a href="#cb191-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1480"><a href="#cb191-1480" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-1481"><a href="#cb191-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1482"><a href="#cb191-1482" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 18: Plotting Climate Scenarios</span></span>
<span id="cb191-1483"><a href="#cb191-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1484"><a href="#cb191-1484" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on plotting future projections*** </span></span>
<span id="cb191-1485"><a href="#cb191-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1486"><a href="#cb191-1486" aria-hidden="true" tabindex="-1"></a>1.Produce similar plots for the weather station you selected for earlier exercises.</span>
<span id="cb191-1487"><a href="#cb191-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1488"><a href="#cb191-1488" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb191-1489"><a href="#cb191-1489" aria-hidden="true" tabindex="-1"></a><span class="in">library(chillR)</span></span>
<span id="cb191-1490"><a href="#cb191-1490" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb191-1491"><a href="#cb191-1491" aria-hidden="true" tabindex="-1"></a><span class="in">#library(ggpmisc)</span></span>
<span id="cb191-1492"><a href="#cb191-1492" aria-hidden="true" tabindex="-1"></a><span class="in">#library(patchwork)</span></span>
<span id="cb191-1493"><a href="#cb191-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1494"><a href="#cb191-1494" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list &lt;- load_temperature_scenarios(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York&quot;,</span></span>
<span id="cb191-1495"><a href="#cb191-1495" aria-hidden="true" tabindex="-1"></a><span class="in">                                                       &quot;Rochester_hist_chill_305_59&quot;)</span></span>
<span id="cb191-1496"><a href="#cb191-1496" aria-hidden="true" tabindex="-1"></a><span class="in">actual_chill &lt;- read_tab(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_observed_chill_305_59.csv&quot;)</span></span>
<span id="cb191-1497"><a href="#cb191-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1498"><a href="#cb191-1498" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list &lt;- load_temperature_scenarios(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;,</span></span>
<span id="cb191-1499"><a href="#cb191-1499" aria-hidden="true" tabindex="-1"></a><span class="in">                                                         &quot;Rochester_futurechill&quot;)</span></span>
<span id="cb191-1500"><a href="#cb191-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1501"><a href="#cb191-1501" aria-hidden="true" tabindex="-1"></a><span class="in">chills &lt;- make_climate_scenario(</span></span>
<span id="cb191-1502"><a href="#cb191-1502" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_hist_scenario_list,</span></span>
<span id="cb191-1503"><a href="#cb191-1503" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = &quot;Historic&quot;,</span></span>
<span id="cb191-1504"><a href="#cb191-1504" aria-hidden="true" tabindex="-1"></a><span class="in">  historic_data = actual_chill,</span></span>
<span id="cb191-1505"><a href="#cb191-1505" aria-hidden="true" tabindex="-1"></a><span class="in">  time_series = TRUE)</span></span>
<span id="cb191-1506"><a href="#cb191-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1507"><a href="#cb191-1507" aria-hidden="true" tabindex="-1"></a><span class="in">SSPs &lt;- c(&quot;ssp126&quot;, &quot;ssp245&quot;, &quot;ssp370&quot;, &quot;ssp585&quot;)</span></span>
<span id="cb191-1508"><a href="#cb191-1508" aria-hidden="true" tabindex="-1"></a><span class="in">Times &lt;- c(2050, 2085)</span></span>
<span id="cb191-1509"><a href="#cb191-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1510"><a href="#cb191-1510" aria-hidden="true" tabindex="-1"></a><span class="in">list_ssp &lt;- </span></span>
<span id="cb191-1511"><a href="#cb191-1511" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), &#39;\\.&#39;) %&gt;%</span></span>
<span id="cb191-1512"><a href="#cb191-1512" aria-hidden="true" tabindex="-1"></a><span class="in">  map(2) %&gt;%</span></span>
<span id="cb191-1513"><a href="#cb191-1513" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb191-1514"><a href="#cb191-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1515"><a href="#cb191-1515" aria-hidden="true" tabindex="-1"></a><span class="in">list_gcm &lt;-</span></span>
<span id="cb191-1516"><a href="#cb191-1516" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), &#39;\\.&#39;) %&gt;%</span></span>
<span id="cb191-1517"><a href="#cb191-1517" aria-hidden="true" tabindex="-1"></a><span class="in">  map(3) %&gt;%</span></span>
<span id="cb191-1518"><a href="#cb191-1518" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb191-1519"><a href="#cb191-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1520"><a href="#cb191-1520" aria-hidden="true" tabindex="-1"></a><span class="in">list_time &lt;-</span></span>
<span id="cb191-1521"><a href="#cb191-1521" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), &#39;\\.&#39;) %&gt;%</span></span>
<span id="cb191-1522"><a href="#cb191-1522" aria-hidden="true" tabindex="-1"></a><span class="in">  map(4) %&gt;%</span></span>
<span id="cb191-1523"><a href="#cb191-1523" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb191-1524"><a href="#cb191-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1525"><a href="#cb191-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1526"><a href="#cb191-1526" aria-hidden="true" tabindex="-1"></a><span class="in">for(SSP in SSPs)</span></span>
<span id="cb191-1527"><a href="#cb191-1527" aria-hidden="true" tabindex="-1"></a><span class="in">  for(Time in Times)</span></span>
<span id="cb191-1528"><a href="#cb191-1528" aria-hidden="true" tabindex="-1"></a><span class="in">    {</span></span>
<span id="cb191-1529"><a href="#cb191-1529" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb191-1530"><a href="#cb191-1530" aria-hidden="true" tabindex="-1"></a><span class="in">    # find all scenarios for the ssp and time</span></span>
<span id="cb191-1531"><a href="#cb191-1531" aria-hidden="true" tabindex="-1"></a><span class="in">    chill &lt;- chill_future_scenario_list[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb191-1532"><a href="#cb191-1532" aria-hidden="true" tabindex="-1"></a><span class="in">    names(chill) &lt;- list_gcm[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb191-1533"><a href="#cb191-1533" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == &quot;ssp126&quot;) SSPcaption &lt;- &quot;SSP1&quot;</span></span>
<span id="cb191-1534"><a href="#cb191-1534" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == &quot;ssp245&quot;) SSPcaption &lt;- &quot;SSP2&quot;</span></span>
<span id="cb191-1535"><a href="#cb191-1535" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == &quot;ssp370&quot;) SSPcaption &lt;- &quot;SSP3&quot;</span></span>
<span id="cb191-1536"><a href="#cb191-1536" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == &quot;ssp585&quot;) SSPcaption &lt;- &quot;SSP5&quot;    </span></span>
<span id="cb191-1537"><a href="#cb191-1537" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == &quot;2050&quot;) Time_caption &lt;- &quot;2050&quot;</span></span>
<span id="cb191-1538"><a href="#cb191-1538" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == &quot;2085&quot;) Time_caption &lt;- &quot;2085&quot;</span></span>
<span id="cb191-1539"><a href="#cb191-1539" aria-hidden="true" tabindex="-1"></a><span class="in">    chills &lt;- chill %&gt;% </span></span>
<span id="cb191-1540"><a href="#cb191-1540" aria-hidden="true" tabindex="-1"></a><span class="in">      make_climate_scenario(</span></span>
<span id="cb191-1541"><a href="#cb191-1541" aria-hidden="true" tabindex="-1"></a><span class="in">        caption = c(SSPcaption,</span></span>
<span id="cb191-1542"><a href="#cb191-1542" aria-hidden="true" tabindex="-1"></a><span class="in">                    Time_caption),</span></span>
<span id="cb191-1543"><a href="#cb191-1543" aria-hidden="true" tabindex="-1"></a><span class="in">        add_to = chills)</span></span>
<span id="cb191-1544"><a href="#cb191-1544" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb191-1545"><a href="#cb191-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1546"><a href="#cb191-1546" aria-hidden="true" tabindex="-1"></a><span class="in">plot_climate_scenarios(</span></span>
<span id="cb191-1547"><a href="#cb191-1547" aria-hidden="true" tabindex="-1"></a><span class="in">  climate_scenario_list = chills,</span></span>
<span id="cb191-1548"><a href="#cb191-1548" aria-hidden="true" tabindex="-1"></a><span class="in">  metric = &quot;Chill_Portions&quot;,</span></span>
<span id="cb191-1549"><a href="#cb191-1549" aria-hidden="true" tabindex="-1"></a><span class="in">  metric_label = &quot;Chill (Chill Portions)&quot;,</span></span>
<span id="cb191-1550"><a href="#cb191-1550" aria-hidden="true" tabindex="-1"></a><span class="in">  texcex = 1)</span></span>
<span id="cb191-1551"><a href="#cb191-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1552"><a href="#cb191-1552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1553"><a href="#cb191-1553" aria-hidden="true" tabindex="-1"></a><span class="in"># We&#39;ll first process the past scenarios (element 1 of the chills list).</span></span>
<span id="cb191-1554"><a href="#cb191-1554" aria-hidden="true" tabindex="-1"></a><span class="in"># Within the data element, we have a list of multiple data.frames for</span></span>
<span id="cb191-1555"><a href="#cb191-1555" aria-hidden="true" tabindex="-1"></a><span class="in"># the various past scenarios.</span></span>
<span id="cb191-1556"><a href="#cb191-1556" aria-hidden="true" tabindex="-1"></a><span class="in"># Using a &#39;for&#39; loop, we cycle through all these data.frames.</span></span>
<span id="cb191-1557"><a href="#cb191-1557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1558"><a href="#cb191-1558" aria-hidden="true" tabindex="-1"></a><span class="in">for(nam in names(chills[[1]]$data))</span></span>
<span id="cb191-1559"><a href="#cb191-1559" aria-hidden="true" tabindex="-1"></a><span class="in">  {</span></span>
<span id="cb191-1560"><a href="#cb191-1560" aria-hidden="true" tabindex="-1"></a><span class="in">   # Extract the data frame.</span></span>
<span id="cb191-1561"><a href="#cb191-1561" aria-hidden="true" tabindex="-1"></a><span class="in">   ch &lt;- chills[[1]]$data[[nam]]</span></span>
<span id="cb191-1562"><a href="#cb191-1562" aria-hidden="true" tabindex="-1"></a><span class="in">   # Add columns for the new information we have to add and fill them.</span></span>
<span id="cb191-1563"><a href="#cb191-1563" aria-hidden="true" tabindex="-1"></a><span class="in">   ch[,&quot;GCM&quot;] &lt;- &quot;none&quot;</span></span>
<span id="cb191-1564"><a href="#cb191-1564" aria-hidden="true" tabindex="-1"></a><span class="in">   ch[,&quot;SSP&quot;] &lt;- &quot;none&quot;</span></span>
<span id="cb191-1565"><a href="#cb191-1565" aria-hidden="true" tabindex="-1"></a><span class="in">   ch[,&quot;Year&quot;] &lt;- as.numeric(nam)</span></span>
<span id="cb191-1566"><a href="#cb191-1566" aria-hidden="true" tabindex="-1"></a><span class="in">   </span></span>
<span id="cb191-1567"><a href="#cb191-1567" aria-hidden="true" tabindex="-1"></a><span class="in">   # Now check if this is the first time we&#39;ve gone through this loop.</span></span>
<span id="cb191-1568"><a href="#cb191-1568" aria-hidden="true" tabindex="-1"></a><span class="in">   # If this is the first time, the ch data.frame becomes the output</span></span>
<span id="cb191-1569"><a href="#cb191-1569" aria-hidden="true" tabindex="-1"></a><span class="in">   # object (past_simulated).</span></span>
<span id="cb191-1570"><a href="#cb191-1570" aria-hidden="true" tabindex="-1"></a><span class="in">   # If it is not the first time (&#39;else&#39;), we add the current data.frame</span></span>
<span id="cb191-1571"><a href="#cb191-1571" aria-hidden="true" tabindex="-1"></a><span class="in">   # to the &#39;past_simulated&#39; object</span></span>
<span id="cb191-1572"><a href="#cb191-1572" aria-hidden="true" tabindex="-1"></a><span class="in">  if(nam == names(chills[[1]]$data)[1])</span></span>
<span id="cb191-1573"><a href="#cb191-1573" aria-hidden="true" tabindex="-1"></a><span class="in">    past_simulated &lt;- ch else</span></span>
<span id="cb191-1574"><a href="#cb191-1574" aria-hidden="true" tabindex="-1"></a><span class="in">      past_simulated &lt;- rbind(past_simulated,</span></span>
<span id="cb191-1575"><a href="#cb191-1575" aria-hidden="true" tabindex="-1"></a><span class="in">                              ch)</span></span>
<span id="cb191-1576"><a href="#cb191-1576" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb191-1577"><a href="#cb191-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1578"><a href="#cb191-1578" aria-hidden="true" tabindex="-1"></a><span class="in"># We add another column called &#39;Scenario&#39; and label all rows as &#39;Historical&#39; </span></span>
<span id="cb191-1579"><a href="#cb191-1579" aria-hidden="true" tabindex="-1"></a><span class="in">past_simulated[&quot;Scenario&quot;] &lt;- &quot;Historical&quot;</span></span>
<span id="cb191-1580"><a href="#cb191-1580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1581"><a href="#cb191-1581" aria-hidden="true" tabindex="-1"></a><span class="in">head(past_simulated)</span></span>
<span id="cb191-1582"><a href="#cb191-1582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1583"><a href="#cb191-1583" aria-hidden="true" tabindex="-1"></a><span class="in">past_simulated &lt;- past_simulated %&gt;% filter(Perc_complete == 100)</span></span>
<span id="cb191-1584"><a href="#cb191-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1585"><a href="#cb191-1585" aria-hidden="true" tabindex="-1"></a><span class="in"># We&#39;ll want to add the historic observation too, so let&#39;s simplify the</span></span>
<span id="cb191-1586"><a href="#cb191-1586" aria-hidden="true" tabindex="-1"></a><span class="in"># pointer to this information for easier use later</span></span>
<span id="cb191-1587"><a href="#cb191-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1588"><a href="#cb191-1588" aria-hidden="true" tabindex="-1"></a><span class="in">past_observed &lt;- chills[[1]][[&quot;historic_data&quot;]]</span></span>
<span id="cb191-1589"><a href="#cb191-1589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1590"><a href="#cb191-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1591"><a href="#cb191-1591" aria-hidden="true" tabindex="-1"></a><span class="in">head(past_observed)</span></span>
<span id="cb191-1592"><a href="#cb191-1592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1593"><a href="#cb191-1593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1594"><a href="#cb191-1594" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract future data</span></span>
<span id="cb191-1595"><a href="#cb191-1595" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 2:length(chills))</span></span>
<span id="cb191-1596"><a href="#cb191-1596" aria-hidden="true" tabindex="-1"></a><span class="in">  for(nam in names(chills[[i]]$data))</span></span>
<span id="cb191-1597"><a href="#cb191-1597" aria-hidden="true" tabindex="-1"></a><span class="in">    {ch &lt;- chills[[i]]$data[[nam]]</span></span>
<span id="cb191-1598"><a href="#cb191-1598" aria-hidden="true" tabindex="-1"></a><span class="in">     ch[,&quot;GCM&quot;] &lt;- nam</span></span>
<span id="cb191-1599"><a href="#cb191-1599" aria-hidden="true" tabindex="-1"></a><span class="in">     ch[,&quot;SSP&quot;] &lt;- chills[[i]]$caption[1]</span></span>
<span id="cb191-1600"><a href="#cb191-1600" aria-hidden="true" tabindex="-1"></a><span class="in">     ch[,&quot;Year&quot;] &lt;- chills[[i]]$caption[2]</span></span>
<span id="cb191-1601"><a href="#cb191-1601" aria-hidden="true" tabindex="-1"></a><span class="in">     if(i == 2 &amp; nam == names(chills[[i]]$data)[1])</span></span>
<span id="cb191-1602"><a href="#cb191-1602" aria-hidden="true" tabindex="-1"></a><span class="in">       future_data &lt;- ch else</span></span>
<span id="cb191-1603"><a href="#cb191-1603" aria-hidden="true" tabindex="-1"></a><span class="in">         future_data &lt;- rbind(future_data,ch)</span></span>
<span id="cb191-1604"><a href="#cb191-1604" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb191-1605"><a href="#cb191-1605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1606"><a href="#cb191-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1607"><a href="#cb191-1607" aria-hidden="true" tabindex="-1"></a><span class="in">head(future_data)</span></span>
<span id="cb191-1608"><a href="#cb191-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1609"><a href="#cb191-1609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1610"><a href="#cb191-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1611"><a href="#cb191-1611" aria-hidden="true" tabindex="-1"></a><span class="in">metric &lt;- &quot;GDH&quot;</span></span>
<span id="cb191-1612"><a href="#cb191-1612" aria-hidden="true" tabindex="-1"></a><span class="in">axis_label &lt;- &quot;Heat (in GDH)&quot;</span></span>
<span id="cb191-1613"><a href="#cb191-1613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1614"><a href="#cb191-1614" aria-hidden="true" tabindex="-1"></a><span class="in"># get extreme values for the axis scale</span></span>
<span id="cb191-1615"><a href="#cb191-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1616"><a href="#cb191-1616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1617"><a href="#cb191-1617" aria-hidden="true" tabindex="-1"></a><span class="in">rng &lt;- range(past_observed[[metric]],</span></span>
<span id="cb191-1618"><a href="#cb191-1618" aria-hidden="true" tabindex="-1"></a><span class="in">             past_simulated[[metric]],</span></span>
<span id="cb191-1619"><a href="#cb191-1619" aria-hidden="true" tabindex="-1"></a><span class="in">             future_data[[metric]])  </span></span>
<span id="cb191-1620"><a href="#cb191-1620" aria-hidden="true" tabindex="-1"></a><span class="in">rng</span></span>
<span id="cb191-1621"><a href="#cb191-1621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1622"><a href="#cb191-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1623"><a href="#cb191-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1624"><a href="#cb191-1624" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- ggplot() +</span></span>
<span id="cb191-1625"><a href="#cb191-1625" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot(data = past_simulated,</span></span>
<span id="cb191-1626"><a href="#cb191-1626" aria-hidden="true" tabindex="-1"></a><span class="in">               aes_string(&quot;as.numeric(Year)&quot;,</span></span>
<span id="cb191-1627"><a href="#cb191-1627" aria-hidden="true" tabindex="-1"></a><span class="in">                          metric,</span></span>
<span id="cb191-1628"><a href="#cb191-1628" aria-hidden="true" tabindex="-1"></a><span class="in">                          group = &quot;Year&quot;),</span></span>
<span id="cb191-1629"><a href="#cb191-1629" aria-hidden="true" tabindex="-1"></a><span class="in">               fill = &quot;skyblue&quot;)</span></span>
<span id="cb191-1630"><a href="#cb191-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1631"><a href="#cb191-1631" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot</span></span>
<span id="cb191-1632"><a href="#cb191-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1633"><a href="#cb191-1633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1634"><a href="#cb191-1634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1635"><a href="#cb191-1635" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- past_plot +</span></span>
<span id="cb191-1636"><a href="#cb191-1636" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(</span></span>
<span id="cb191-1637"><a href="#cb191-1637" aria-hidden="true" tabindex="-1"></a><span class="in">    limits = c(0, </span></span>
<span id="cb191-1638"><a href="#cb191-1638" aria-hidden="true" tabindex="-1"></a><span class="in">               round(rng[2] + rng[2]/10))) +</span></span>
<span id="cb191-1639"><a href="#cb191-1639" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = &quot;Year&quot;, </span></span>
<span id="cb191-1640"><a href="#cb191-1640" aria-hidden="true" tabindex="-1"></a><span class="in">       y = axis_label)</span></span>
<span id="cb191-1641"><a href="#cb191-1641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1642"><a href="#cb191-1642" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot</span></span>
<span id="cb191-1643"><a href="#cb191-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1644"><a href="#cb191-1644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1645"><a href="#cb191-1645" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- past_plot +</span></span>
<span id="cb191-1646"><a href="#cb191-1646" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(~ Scenario) +</span></span>
<span id="cb191-1647"><a href="#cb191-1647" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) </span></span>
<span id="cb191-1648"><a href="#cb191-1648" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-1649"><a href="#cb191-1649" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot</span></span>
<span id="cb191-1650"><a href="#cb191-1650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1651"><a href="#cb191-1651" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-1652"><a href="#cb191-1652" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- past_plot +  </span></span>
<span id="cb191-1653"><a href="#cb191-1653" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.background = element_blank(),</span></span>
<span id="cb191-1654"><a href="#cb191-1654" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = &quot;bold&quot;),</span></span>
<span id="cb191-1655"><a href="#cb191-1655" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(angle = 45,</span></span>
<span id="cb191-1656"><a href="#cb191-1656" aria-hidden="true" tabindex="-1"></a><span class="in">                                   hjust = 1)) </span></span>
<span id="cb191-1657"><a href="#cb191-1657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1658"><a href="#cb191-1658" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot</span></span>
<span id="cb191-1659"><a href="#cb191-1659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1660"><a href="#cb191-1660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1661"><a href="#cb191-1661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1662"><a href="#cb191-1662" aria-hidden="true" tabindex="-1"></a><span class="in"># add historic data</span></span>
<span id="cb191-1663"><a href="#cb191-1663" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- past_plot +</span></span>
<span id="cb191-1664"><a href="#cb191-1664" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = past_observed,</span></span>
<span id="cb191-1665"><a href="#cb191-1665" aria-hidden="true" tabindex="-1"></a><span class="in">             aes_string(&quot;End_year&quot;,</span></span>
<span id="cb191-1666"><a href="#cb191-1666" aria-hidden="true" tabindex="-1"></a><span class="in">                        metric),</span></span>
<span id="cb191-1667"><a href="#cb191-1667" aria-hidden="true" tabindex="-1"></a><span class="in">             col = &quot;blue&quot;)</span></span>
<span id="cb191-1668"><a href="#cb191-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1669"><a href="#cb191-1669" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot</span></span>
<span id="cb191-1670"><a href="#cb191-1670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1671"><a href="#cb191-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1672"><a href="#cb191-1672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1673"><a href="#cb191-1673" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- 2050</span></span>
<span id="cb191-1674"><a href="#cb191-1674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1675"><a href="#cb191-1675" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050 &lt;-</span></span>
<span id="cb191-1676"><a href="#cb191-1676" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(data = future_data[future_data$Year == y,]) +</span></span>
<span id="cb191-1677"><a href="#cb191-1677" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot(aes_string(&quot;GCM&quot;, </span></span>
<span id="cb191-1678"><a href="#cb191-1678" aria-hidden="true" tabindex="-1"></a><span class="in">                          metric, </span></span>
<span id="cb191-1679"><a href="#cb191-1679" aria-hidden="true" tabindex="-1"></a><span class="in">                          fill = &quot;GCM&quot;))</span></span>
<span id="cb191-1680"><a href="#cb191-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1681"><a href="#cb191-1681" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050</span></span>
<span id="cb191-1682"><a href="#cb191-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1683"><a href="#cb191-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1684"><a href="#cb191-1684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1685"><a href="#cb191-1685" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050 &lt;- future_2050 +</span></span>
<span id="cb191-1686"><a href="#cb191-1686" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(SSP), nrow = 1) +</span></span>
<span id="cb191-1687"><a href="#cb191-1687" aria-hidden="true" tabindex="-1"></a><span class="in">   scale_x_discrete(labels = NULL,</span></span>
<span id="cb191-1688"><a href="#cb191-1688" aria-hidden="true" tabindex="-1"></a><span class="in">                    expand = expansion(add = 1)) </span></span>
<span id="cb191-1689"><a href="#cb191-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1690"><a href="#cb191-1690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1691"><a href="#cb191-1691" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggpmisc)</span></span>
<span id="cb191-1692"><a href="#cb191-1692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1693"><a href="#cb191-1693" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050 &lt;- future_2050 +</span></span>
<span id="cb191-1694"><a href="#cb191-1694" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(limits = c(0, </span></span>
<span id="cb191-1695"><a href="#cb191-1695" aria-hidden="true" tabindex="-1"></a><span class="in">                                round(round(1.1*rng[2])))) +</span></span>
<span id="cb191-1696"><a href="#cb191-1696" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text_npc(aes(npcx = &quot;center&quot;, </span></span>
<span id="cb191-1697"><a href="#cb191-1697" aria-hidden="true" tabindex="-1"></a><span class="in">                      npcy = &quot;top&quot;,</span></span>
<span id="cb191-1698"><a href="#cb191-1698" aria-hidden="true" tabindex="-1"></a><span class="in">                      label = Year),</span></span>
<span id="cb191-1699"><a href="#cb191-1699" aria-hidden="true" tabindex="-1"></a><span class="in">                  size = 5)</span></span>
<span id="cb191-1700"><a href="#cb191-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1701"><a href="#cb191-1701" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050</span></span>
<span id="cb191-1702"><a href="#cb191-1702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1703"><a href="#cb191-1703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1704"><a href="#cb191-1704" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050 &lt;- future_2050 +</span></span>
<span id="cb191-1705"><a href="#cb191-1705" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb191-1706"><a href="#cb191-1706" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.ticks.y = element_blank(),</span></span>
<span id="cb191-1707"><a href="#cb191-1707" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text = element_blank(),</span></span>
<span id="cb191-1708"><a href="#cb191-1708" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title = element_blank(),</span></span>
<span id="cb191-1709"><a href="#cb191-1709" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.position = &quot;bottom&quot;,</span></span>
<span id="cb191-1710"><a href="#cb191-1710" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.margin = margin(0,</span></span>
<span id="cb191-1711"><a href="#cb191-1711" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb191-1712"><a href="#cb191-1712" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb191-1713"><a href="#cb191-1713" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb191-1714"><a href="#cb191-1714" aria-hidden="true" tabindex="-1"></a><span class="in">                               &quot;cm&quot;),</span></span>
<span id="cb191-1715"><a href="#cb191-1715" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.background = element_rect(),</span></span>
<span id="cb191-1716"><a href="#cb191-1716" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb191-1717"><a href="#cb191-1717" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = &quot;bold&quot;),</span></span>
<span id="cb191-1718"><a href="#cb191-1718" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.box.spacing = unit(0, &quot;cm&quot;),</span></span>
<span id="cb191-1719"><a href="#cb191-1719" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.subtitle = element_text(hjust = 0.5,</span></span>
<span id="cb191-1720"><a href="#cb191-1720" aria-hidden="true" tabindex="-1"></a><span class="in">                                     vjust = -1,</span></span>
<span id="cb191-1721"><a href="#cb191-1721" aria-hidden="true" tabindex="-1"></a><span class="in">                                     size = 15 * 1.05,</span></span>
<span id="cb191-1722"><a href="#cb191-1722" aria-hidden="true" tabindex="-1"></a><span class="in">                                     face = &quot;bold&quot;)) </span></span>
<span id="cb191-1723"><a href="#cb191-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1724"><a href="#cb191-1724" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050</span></span>
<span id="cb191-1725"><a href="#cb191-1725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1726"><a href="#cb191-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1727"><a href="#cb191-1727" aria-hidden="true" tabindex="-1"></a><span class="in">future_plot_list &lt;- list()</span></span>
<span id="cb191-1728"><a href="#cb191-1728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1729"><a href="#cb191-1729" aria-hidden="true" tabindex="-1"></a><span class="in">time_points &lt;- c(2050, 2085)</span></span>
<span id="cb191-1730"><a href="#cb191-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1731"><a href="#cb191-1731" aria-hidden="true" tabindex="-1"></a><span class="in">for(y in time_points)</span></span>
<span id="cb191-1732"><a href="#cb191-1732" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb191-1733"><a href="#cb191-1733" aria-hidden="true" tabindex="-1"></a><span class="in">  future_plot_list[[which(y == time_points)]] &lt;-</span></span>
<span id="cb191-1734"><a href="#cb191-1734" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(data = future_data[which(future_data$Year==y),]) +</span></span>
<span id="cb191-1735"><a href="#cb191-1735" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_boxplot(aes_string(&quot;GCM&quot;,</span></span>
<span id="cb191-1736"><a href="#cb191-1736" aria-hidden="true" tabindex="-1"></a><span class="in">                            metric,</span></span>
<span id="cb191-1737"><a href="#cb191-1737" aria-hidden="true" tabindex="-1"></a><span class="in">                            fill=&quot;GCM&quot;)) +</span></span>
<span id="cb191-1738"><a href="#cb191-1738" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(vars(SSP), nrow = 1) +</span></span>
<span id="cb191-1739"><a href="#cb191-1739" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_discrete(labels = NULL,</span></span>
<span id="cb191-1740"><a href="#cb191-1740" aria-hidden="true" tabindex="-1"></a><span class="in">                     expand = expansion(add = 1)) +</span></span>
<span id="cb191-1741"><a href="#cb191-1741" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_y_continuous(limits = c(0, </span></span>
<span id="cb191-1742"><a href="#cb191-1742" aria-hidden="true" tabindex="-1"></a><span class="in">                                  round(round(1.1*rng[2])))) +</span></span>
<span id="cb191-1743"><a href="#cb191-1743" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text_npc(aes(npcx = &quot;center&quot;,</span></span>
<span id="cb191-1744"><a href="#cb191-1744" aria-hidden="true" tabindex="-1"></a><span class="in">                      npcy = &quot;top&quot;, </span></span>
<span id="cb191-1745"><a href="#cb191-1745" aria-hidden="true" tabindex="-1"></a><span class="in">                      label = Year),</span></span>
<span id="cb191-1746"><a href="#cb191-1746" aria-hidden="true" tabindex="-1"></a><span class="in">                  size = 5) +</span></span>
<span id="cb191-1747"><a href="#cb191-1747" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) +</span></span>
<span id="cb191-1748"><a href="#cb191-1748" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(axis.ticks.y = element_blank(),</span></span>
<span id="cb191-1749"><a href="#cb191-1749" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.text = element_blank(),</span></span>
<span id="cb191-1750"><a href="#cb191-1750" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title = element_blank(),</span></span>
<span id="cb191-1751"><a href="#cb191-1751" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.position = &quot;bottom&quot;,</span></span>
<span id="cb191-1752"><a href="#cb191-1752" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.margin = margin(0, </span></span>
<span id="cb191-1753"><a href="#cb191-1753" aria-hidden="true" tabindex="-1"></a><span class="in">                                 0, </span></span>
<span id="cb191-1754"><a href="#cb191-1754" aria-hidden="true" tabindex="-1"></a><span class="in">                                 0, </span></span>
<span id="cb191-1755"><a href="#cb191-1755" aria-hidden="true" tabindex="-1"></a><span class="in">                                 0, </span></span>
<span id="cb191-1756"><a href="#cb191-1756" aria-hidden="true" tabindex="-1"></a><span class="in">                                 &quot;cm&quot;),</span></span>
<span id="cb191-1757"><a href="#cb191-1757" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.background = element_rect(),</span></span>
<span id="cb191-1758"><a href="#cb191-1758" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.background = element_blank(),</span></span>
<span id="cb191-1759"><a href="#cb191-1759" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text = element_text(face = &quot;bold&quot;),</span></span>
<span id="cb191-1760"><a href="#cb191-1760" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.box.spacing = unit(0, &quot;cm&quot;),</span></span>
<span id="cb191-1761"><a href="#cb191-1761" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.subtitle = element_text(</span></span>
<span id="cb191-1762"><a href="#cb191-1762" aria-hidden="true" tabindex="-1"></a><span class="in">            hjust = 0.5,</span></span>
<span id="cb191-1763"><a href="#cb191-1763" aria-hidden="true" tabindex="-1"></a><span class="in">            vjust = -1,</span></span>
<span id="cb191-1764"><a href="#cb191-1764" aria-hidden="true" tabindex="-1"></a><span class="in">            size = 15 * 1.05,</span></span>
<span id="cb191-1765"><a href="#cb191-1765" aria-hidden="true" tabindex="-1"></a><span class="in">            face = &quot;bold&quot;)) </span></span>
<span id="cb191-1766"><a href="#cb191-1766" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb191-1767"><a href="#cb191-1767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1768"><a href="#cb191-1768" aria-hidden="true" tabindex="-1"></a><span class="in">future_plot_list</span></span>
<span id="cb191-1769"><a href="#cb191-1769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1770"><a href="#cb191-1770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1771"><a href="#cb191-1771" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)</span></span>
<span id="cb191-1772"><a href="#cb191-1772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1773"><a href="#cb191-1773" aria-hidden="true" tabindex="-1"></a><span class="in">both_plots &lt;- past_plot + future_plot_list</span></span>
<span id="cb191-1774"><a href="#cb191-1774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1775"><a href="#cb191-1775" aria-hidden="true" tabindex="-1"></a><span class="in">both_plots</span></span>
<span id="cb191-1776"><a href="#cb191-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1777"><a href="#cb191-1777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1778"><a href="#cb191-1778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1779"><a href="#cb191-1779" aria-hidden="true" tabindex="-1"></a><span class="in">plot &lt;- both_plots +</span></span>
<span id="cb191-1780"><a href="#cb191-1780" aria-hidden="true" tabindex="-1"></a><span class="in">           plot_layout(guides = &quot;collect&quot;,</span></span>
<span id="cb191-1781"><a href="#cb191-1781" aria-hidden="true" tabindex="-1"></a><span class="in">                       widths = c(1,</span></span>
<span id="cb191-1782"><a href="#cb191-1782" aria-hidden="true" tabindex="-1"></a><span class="in">                                  rep(1.8,</span></span>
<span id="cb191-1783"><a href="#cb191-1783" aria-hidden="true" tabindex="-1"></a><span class="in">                                      length(future_plot_list))))</span></span>
<span id="cb191-1784"><a href="#cb191-1784" aria-hidden="true" tabindex="-1"></a><span class="in">         </span></span>
<span id="cb191-1785"><a href="#cb191-1785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1786"><a href="#cb191-1786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1787"><a href="#cb191-1787" aria-hidden="true" tabindex="-1"></a><span class="in">plot &lt;- plot &amp; theme(legend.position = &quot;bottom&quot;,</span></span>
<span id="cb191-1788"><a href="#cb191-1788" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.text = element_text(size = 8),</span></span>
<span id="cb191-1789"><a href="#cb191-1789" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.title = element_text(size = 10),</span></span>
<span id="cb191-1790"><a href="#cb191-1790" aria-hidden="true" tabindex="-1"></a><span class="in">                     axis.title.x = element_blank())</span></span>
<span id="cb191-1791"><a href="#cb191-1791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1792"><a href="#cb191-1792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1793"><a href="#cb191-1793" aria-hidden="true" tabindex="-1"></a><span class="in">plot</span></span>
<span id="cb191-1794"><a href="#cb191-1794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1795"><a href="#cb191-1795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1796"><a href="#cb191-1796" aria-hidden="true" tabindex="-1"></a><span class="in">         </span></span>
<span id="cb191-1797"><a href="#cb191-1797" aria-hidden="true" tabindex="-1"></a><span class="in">metric &lt;- &quot;Chill_Portions&quot;</span></span>
<span id="cb191-1798"><a href="#cb191-1798" aria-hidden="true" tabindex="-1"></a><span class="in">axis_label &lt;- &quot;Chill (in CP)&quot;</span></span>
<span id="cb191-1799"><a href="#cb191-1799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1800"><a href="#cb191-1800" aria-hidden="true" tabindex="-1"></a><span class="in"># get extreme values for the axis scale</span></span>
<span id="cb191-1801"><a href="#cb191-1801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1802"><a href="#cb191-1802" aria-hidden="true" tabindex="-1"></a><span class="in">rng &lt;- range(past_observed[[metric]],</span></span>
<span id="cb191-1803"><a href="#cb191-1803" aria-hidden="true" tabindex="-1"></a><span class="in">             past_simulated[[metric]],</span></span>
<span id="cb191-1804"><a href="#cb191-1804" aria-hidden="true" tabindex="-1"></a><span class="in">             future_data[[metric]])  </span></span>
<span id="cb191-1805"><a href="#cb191-1805" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- ggplot() +</span></span>
<span id="cb191-1806"><a href="#cb191-1806" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot(data = past_simulated,</span></span>
<span id="cb191-1807"><a href="#cb191-1807" aria-hidden="true" tabindex="-1"></a><span class="in">               aes_string(&quot;as.numeric(Year)&quot;,</span></span>
<span id="cb191-1808"><a href="#cb191-1808" aria-hidden="true" tabindex="-1"></a><span class="in">                          metric,group=&quot;Year&quot;),</span></span>
<span id="cb191-1809"><a href="#cb191-1809" aria-hidden="true" tabindex="-1"></a><span class="in">               fill=&quot;skyblue&quot;) +</span></span>
<span id="cb191-1810"><a href="#cb191-1810" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(limits = c(0, </span></span>
<span id="cb191-1811"><a href="#cb191-1811" aria-hidden="true" tabindex="-1"></a><span class="in">                                round(round(1.1*rng[2])))) +</span></span>
<span id="cb191-1812"><a href="#cb191-1812" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = &quot;Year&quot;, y = axis_label) +</span></span>
<span id="cb191-1813"><a href="#cb191-1813" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(~ Scenario) +</span></span>
<span id="cb191-1814"><a href="#cb191-1814" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +  </span></span>
<span id="cb191-1815"><a href="#cb191-1815" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.background = element_blank(),</span></span>
<span id="cb191-1816"><a href="#cb191-1816" aria-hidden="true" tabindex="-1"></a><span class="in">           strip.text = element_text(face = &quot;bold&quot;),</span></span>
<span id="cb191-1817"><a href="#cb191-1817" aria-hidden="true" tabindex="-1"></a><span class="in">           axis.text.x = element_text(angle=45, hjust=1)) +</span></span>
<span id="cb191-1818"><a href="#cb191-1818" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = past_observed,</span></span>
<span id="cb191-1819"><a href="#cb191-1819" aria-hidden="true" tabindex="-1"></a><span class="in">             aes_string(&quot;End_year&quot;,</span></span>
<span id="cb191-1820"><a href="#cb191-1820" aria-hidden="true" tabindex="-1"></a><span class="in">                        metric),</span></span>
<span id="cb191-1821"><a href="#cb191-1821" aria-hidden="true" tabindex="-1"></a><span class="in">             col=&quot;blue&quot;)</span></span>
<span id="cb191-1822"><a href="#cb191-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1823"><a href="#cb191-1823" aria-hidden="true" tabindex="-1"></a><span class="in">future_plot_list &lt;- list()</span></span>
<span id="cb191-1824"><a href="#cb191-1824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1825"><a href="#cb191-1825" aria-hidden="true" tabindex="-1"></a><span class="in">for(y in c(2050,</span></span>
<span id="cb191-1826"><a href="#cb191-1826" aria-hidden="true" tabindex="-1"></a><span class="in">           2085))</span></span>
<span id="cb191-1827"><a href="#cb191-1827" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb191-1828"><a href="#cb191-1828" aria-hidden="true" tabindex="-1"></a><span class="in">  future_plot_list[[which(y == c(2050,2085))]] &lt;-</span></span>
<span id="cb191-1829"><a href="#cb191-1829" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(data = future_data[which(future_data$Year==y),]) +</span></span>
<span id="cb191-1830"><a href="#cb191-1830" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_boxplot(aes_string(&quot;GCM&quot;, </span></span>
<span id="cb191-1831"><a href="#cb191-1831" aria-hidden="true" tabindex="-1"></a><span class="in">                            metric, </span></span>
<span id="cb191-1832"><a href="#cb191-1832" aria-hidden="true" tabindex="-1"></a><span class="in">                            fill=&quot;GCM&quot;)) +</span></span>
<span id="cb191-1833"><a href="#cb191-1833" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(SSP), nrow = 1) +</span></span>
<span id="cb191-1834"><a href="#cb191-1834" aria-hidden="true" tabindex="-1"></a><span class="in">   scale_x_discrete(labels = NULL,</span></span>
<span id="cb191-1835"><a href="#cb191-1835" aria-hidden="true" tabindex="-1"></a><span class="in">                    expand = expansion(add = 1)) +</span></span>
<span id="cb191-1836"><a href="#cb191-1836" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(limits = c(0,</span></span>
<span id="cb191-1837"><a href="#cb191-1837" aria-hidden="true" tabindex="-1"></a><span class="in">                                round(round(1.1*rng[2])))) +</span></span>
<span id="cb191-1838"><a href="#cb191-1838" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text_npc(aes(npcx = &quot;center&quot;, </span></span>
<span id="cb191-1839"><a href="#cb191-1839" aria-hidden="true" tabindex="-1"></a><span class="in">                      npcy = &quot;top&quot;, </span></span>
<span id="cb191-1840"><a href="#cb191-1840" aria-hidden="true" tabindex="-1"></a><span class="in">                      label = Year),</span></span>
<span id="cb191-1841"><a href="#cb191-1841" aria-hidden="true" tabindex="-1"></a><span class="in">                  size = 5) +</span></span>
<span id="cb191-1842"><a href="#cb191-1842" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb191-1843"><a href="#cb191-1843" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.ticks.y = element_blank(),</span></span>
<span id="cb191-1844"><a href="#cb191-1844" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text = element_blank(),</span></span>
<span id="cb191-1845"><a href="#cb191-1845" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title = element_blank(),</span></span>
<span id="cb191-1846"><a href="#cb191-1846" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.position = &quot;bottom&quot;,</span></span>
<span id="cb191-1847"><a href="#cb191-1847" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.margin = margin(0,</span></span>
<span id="cb191-1848"><a href="#cb191-1848" aria-hidden="true" tabindex="-1"></a><span class="in">                               0, </span></span>
<span id="cb191-1849"><a href="#cb191-1849" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb191-1850"><a href="#cb191-1850" aria-hidden="true" tabindex="-1"></a><span class="in">                               0, </span></span>
<span id="cb191-1851"><a href="#cb191-1851" aria-hidden="true" tabindex="-1"></a><span class="in">                               &quot;cm&quot;),</span></span>
<span id="cb191-1852"><a href="#cb191-1852" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.background = element_rect(),</span></span>
<span id="cb191-1853"><a href="#cb191-1853" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb191-1854"><a href="#cb191-1854" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = &quot;bold&quot;),</span></span>
<span id="cb191-1855"><a href="#cb191-1855" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.box.spacing = unit(0, &quot;cm&quot;),</span></span>
<span id="cb191-1856"><a href="#cb191-1856" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.subtitle = element_text(hjust = 0.5, </span></span>
<span id="cb191-1857"><a href="#cb191-1857" aria-hidden="true" tabindex="-1"></a><span class="in">                                     vjust = -1,</span></span>
<span id="cb191-1858"><a href="#cb191-1858" aria-hidden="true" tabindex="-1"></a><span class="in">                                     size = 15 * 1.05,</span></span>
<span id="cb191-1859"><a href="#cb191-1859" aria-hidden="true" tabindex="-1"></a><span class="in">                                     face = &quot;bold&quot;)) </span></span>
<span id="cb191-1860"><a href="#cb191-1860" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb191-1861"><a href="#cb191-1861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1862"><a href="#cb191-1862" aria-hidden="true" tabindex="-1"></a><span class="in">plot &lt;- (past_plot +</span></span>
<span id="cb191-1863"><a href="#cb191-1863" aria-hidden="true" tabindex="-1"></a><span class="in">           future_plot_list +</span></span>
<span id="cb191-1864"><a href="#cb191-1864" aria-hidden="true" tabindex="-1"></a><span class="in">           plot_layout(guides = &quot;collect&quot;,</span></span>
<span id="cb191-1865"><a href="#cb191-1865" aria-hidden="true" tabindex="-1"></a><span class="in">                       widths = c(1,rep(1.8,length(future_plot_list))))</span></span>
<span id="cb191-1866"><a href="#cb191-1866" aria-hidden="true" tabindex="-1"></a><span class="in">         ) &amp; theme(legend.position = &quot;bottom&quot;,</span></span>
<span id="cb191-1867"><a href="#cb191-1867" aria-hidden="true" tabindex="-1"></a><span class="in">                   legend.text = element_text(size = 8),</span></span>
<span id="cb191-1868"><a href="#cb191-1868" aria-hidden="true" tabindex="-1"></a><span class="in">                   legend.title = element_text(size = 10),</span></span>
<span id="cb191-1869"><a href="#cb191-1869" aria-hidden="true" tabindex="-1"></a><span class="in">                   axis.title.x=element_blank())</span></span>
<span id="cb191-1870"><a href="#cb191-1870" aria-hidden="true" tabindex="-1"></a><span class="in">plot</span></span>
<span id="cb191-1871"><a href="#cb191-1871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1872"><a href="#cb191-1872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1873"><a href="#cb191-1873" aria-hidden="true" tabindex="-1"></a><span class="in">         </span></span>
<span id="cb191-1874"><a href="#cb191-1874" aria-hidden="true" tabindex="-1"></a><span class="in">metric &lt;- &quot;Frost_H&quot;</span></span>
<span id="cb191-1875"><a href="#cb191-1875" aria-hidden="true" tabindex="-1"></a><span class="in">axis_label &lt;- &quot;Frost duration (in hours)&quot;</span></span>
<span id="cb191-1876"><a href="#cb191-1876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1877"><a href="#cb191-1877" aria-hidden="true" tabindex="-1"></a><span class="in"># get extreme values for the axis scale</span></span>
<span id="cb191-1878"><a href="#cb191-1878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1879"><a href="#cb191-1879" aria-hidden="true" tabindex="-1"></a><span class="in">rng &lt;- range(past_observed[[metric]],</span></span>
<span id="cb191-1880"><a href="#cb191-1880" aria-hidden="true" tabindex="-1"></a><span class="in">             past_simulated[[metric]],</span></span>
<span id="cb191-1881"><a href="#cb191-1881" aria-hidden="true" tabindex="-1"></a><span class="in">             future_data[[metric]])  </span></span>
<span id="cb191-1882"><a href="#cb191-1882" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- ggplot() +</span></span>
<span id="cb191-1883"><a href="#cb191-1883" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot(data = past_simulated,</span></span>
<span id="cb191-1884"><a href="#cb191-1884" aria-hidden="true" tabindex="-1"></a><span class="in">               aes_string(&quot;as.numeric(Year)&quot;,</span></span>
<span id="cb191-1885"><a href="#cb191-1885" aria-hidden="true" tabindex="-1"></a><span class="in">                          metric,group=&quot;Year&quot;),</span></span>
<span id="cb191-1886"><a href="#cb191-1886" aria-hidden="true" tabindex="-1"></a><span class="in">               fill=&quot;skyblue&quot;) +</span></span>
<span id="cb191-1887"><a href="#cb191-1887" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(limits = c(0, </span></span>
<span id="cb191-1888"><a href="#cb191-1888" aria-hidden="true" tabindex="-1"></a><span class="in">                                round(round(1.1*rng[2])))) +</span></span>
<span id="cb191-1889"><a href="#cb191-1889" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = &quot;Year&quot;, y = axis_label) +</span></span>
<span id="cb191-1890"><a href="#cb191-1890" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(~ Scenario) +</span></span>
<span id="cb191-1891"><a href="#cb191-1891" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +  </span></span>
<span id="cb191-1892"><a href="#cb191-1892" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.background = element_blank(),</span></span>
<span id="cb191-1893"><a href="#cb191-1893" aria-hidden="true" tabindex="-1"></a><span class="in">           strip.text = element_text(face = &quot;bold&quot;),</span></span>
<span id="cb191-1894"><a href="#cb191-1894" aria-hidden="true" tabindex="-1"></a><span class="in">           axis.text.x = element_text(angle=45, hjust=1)) +</span></span>
<span id="cb191-1895"><a href="#cb191-1895" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = past_observed,</span></span>
<span id="cb191-1896"><a href="#cb191-1896" aria-hidden="true" tabindex="-1"></a><span class="in">             aes_string(&quot;End_year&quot;,</span></span>
<span id="cb191-1897"><a href="#cb191-1897" aria-hidden="true" tabindex="-1"></a><span class="in">                        metric),</span></span>
<span id="cb191-1898"><a href="#cb191-1898" aria-hidden="true" tabindex="-1"></a><span class="in">             col=&quot;blue&quot;)</span></span>
<span id="cb191-1899"><a href="#cb191-1899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1900"><a href="#cb191-1900" aria-hidden="true" tabindex="-1"></a><span class="in">future_plot_list &lt;- list()</span></span>
<span id="cb191-1901"><a href="#cb191-1901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1902"><a href="#cb191-1902" aria-hidden="true" tabindex="-1"></a><span class="in">for(y in c(2050,</span></span>
<span id="cb191-1903"><a href="#cb191-1903" aria-hidden="true" tabindex="-1"></a><span class="in">           2085))</span></span>
<span id="cb191-1904"><a href="#cb191-1904" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb191-1905"><a href="#cb191-1905" aria-hidden="true" tabindex="-1"></a><span class="in">  future_plot_list[[which(y == c(2050,2085))]] &lt;-</span></span>
<span id="cb191-1906"><a href="#cb191-1906" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(data = future_data[which(future_data$Year==y),]) +</span></span>
<span id="cb191-1907"><a href="#cb191-1907" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_boxplot(aes_string(&quot;GCM&quot;, </span></span>
<span id="cb191-1908"><a href="#cb191-1908" aria-hidden="true" tabindex="-1"></a><span class="in">                            metric, </span></span>
<span id="cb191-1909"><a href="#cb191-1909" aria-hidden="true" tabindex="-1"></a><span class="in">                            fill=&quot;GCM&quot;)) +</span></span>
<span id="cb191-1910"><a href="#cb191-1910" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(SSP), nrow = 1) +</span></span>
<span id="cb191-1911"><a href="#cb191-1911" aria-hidden="true" tabindex="-1"></a><span class="in">   scale_x_discrete(labels = NULL,</span></span>
<span id="cb191-1912"><a href="#cb191-1912" aria-hidden="true" tabindex="-1"></a><span class="in">                    expand = expansion(add = 1)) +</span></span>
<span id="cb191-1913"><a href="#cb191-1913" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(limits = c(0,</span></span>
<span id="cb191-1914"><a href="#cb191-1914" aria-hidden="true" tabindex="-1"></a><span class="in">                                round(round(1.1*rng[2])))) +</span></span>
<span id="cb191-1915"><a href="#cb191-1915" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text_npc(aes(npcx = &quot;center&quot;, </span></span>
<span id="cb191-1916"><a href="#cb191-1916" aria-hidden="true" tabindex="-1"></a><span class="in">                      npcy = &quot;top&quot;, </span></span>
<span id="cb191-1917"><a href="#cb191-1917" aria-hidden="true" tabindex="-1"></a><span class="in">                      label = Year),</span></span>
<span id="cb191-1918"><a href="#cb191-1918" aria-hidden="true" tabindex="-1"></a><span class="in">                  size = 5) +</span></span>
<span id="cb191-1919"><a href="#cb191-1919" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb191-1920"><a href="#cb191-1920" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.ticks.y = element_blank(),</span></span>
<span id="cb191-1921"><a href="#cb191-1921" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text = element_blank(),</span></span>
<span id="cb191-1922"><a href="#cb191-1922" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title = element_blank(),</span></span>
<span id="cb191-1923"><a href="#cb191-1923" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.position = &quot;bottom&quot;,</span></span>
<span id="cb191-1924"><a href="#cb191-1924" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.margin = margin(0,</span></span>
<span id="cb191-1925"><a href="#cb191-1925" aria-hidden="true" tabindex="-1"></a><span class="in">                               0, </span></span>
<span id="cb191-1926"><a href="#cb191-1926" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb191-1927"><a href="#cb191-1927" aria-hidden="true" tabindex="-1"></a><span class="in">                               0, </span></span>
<span id="cb191-1928"><a href="#cb191-1928" aria-hidden="true" tabindex="-1"></a><span class="in">                               &quot;cm&quot;),</span></span>
<span id="cb191-1929"><a href="#cb191-1929" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.background = element_rect(),</span></span>
<span id="cb191-1930"><a href="#cb191-1930" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb191-1931"><a href="#cb191-1931" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = &quot;bold&quot;),</span></span>
<span id="cb191-1932"><a href="#cb191-1932" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.box.spacing = unit(0, &quot;cm&quot;),</span></span>
<span id="cb191-1933"><a href="#cb191-1933" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.subtitle = element_text(hjust = 0.5, </span></span>
<span id="cb191-1934"><a href="#cb191-1934" aria-hidden="true" tabindex="-1"></a><span class="in">                                     vjust = -1,</span></span>
<span id="cb191-1935"><a href="#cb191-1935" aria-hidden="true" tabindex="-1"></a><span class="in">                                     size = 15 * 1.05,</span></span>
<span id="cb191-1936"><a href="#cb191-1936" aria-hidden="true" tabindex="-1"></a><span class="in">                                     face = &quot;bold&quot;)) </span></span>
<span id="cb191-1937"><a href="#cb191-1937" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb191-1938"><a href="#cb191-1938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1939"><a href="#cb191-1939" aria-hidden="true" tabindex="-1"></a><span class="in">plot &lt;- (past_plot +</span></span>
<span id="cb191-1940"><a href="#cb191-1940" aria-hidden="true" tabindex="-1"></a><span class="in">           future_plot_list +</span></span>
<span id="cb191-1941"><a href="#cb191-1941" aria-hidden="true" tabindex="-1"></a><span class="in">           plot_layout(guides = &quot;collect&quot;,</span></span>
<span id="cb191-1942"><a href="#cb191-1942" aria-hidden="true" tabindex="-1"></a><span class="in">                       widths = c(1,rep(1.8,length(future_plot_list))))</span></span>
<span id="cb191-1943"><a href="#cb191-1943" aria-hidden="true" tabindex="-1"></a><span class="in">         ) &amp; theme(legend.position = &quot;bottom&quot;,</span></span>
<span id="cb191-1944"><a href="#cb191-1944" aria-hidden="true" tabindex="-1"></a><span class="in">                   legend.text = element_text(size = 8),</span></span>
<span id="cb191-1945"><a href="#cb191-1945" aria-hidden="true" tabindex="-1"></a><span class="in">                   legend.title = element_text(size = 10),</span></span>
<span id="cb191-1946"><a href="#cb191-1946" aria-hidden="true" tabindex="-1"></a><span class="in">                   axis.title.x=element_blank())</span></span>
<span id="cb191-1947"><a href="#cb191-1947" aria-hidden="true" tabindex="-1"></a><span class="in">plot</span></span>
<span id="cb191-1948"><a href="#cb191-1948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1949"><a href="#cb191-1949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-1950"><a href="#cb191-1950" aria-hidden="true" tabindex="-1"></a><span class="in">plot_scenarios_gg &lt;- function(past_observed,</span></span>
<span id="cb191-1951"><a href="#cb191-1951" aria-hidden="true" tabindex="-1"></a><span class="in">                              past_simulated,</span></span>
<span id="cb191-1952"><a href="#cb191-1952" aria-hidden="true" tabindex="-1"></a><span class="in">                              future_data,</span></span>
<span id="cb191-1953"><a href="#cb191-1953" aria-hidden="true" tabindex="-1"></a><span class="in">                              metric,</span></span>
<span id="cb191-1954"><a href="#cb191-1954" aria-hidden="true" tabindex="-1"></a><span class="in">                              axis_label,</span></span>
<span id="cb191-1955"><a href="#cb191-1955" aria-hidden="true" tabindex="-1"></a><span class="in">                              time_points)</span></span>
<span id="cb191-1956"><a href="#cb191-1956" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb191-1957"><a href="#cb191-1957" aria-hidden="true" tabindex="-1"></a><span class="in">  rng &lt;- range(past_observed[[metric]],</span></span>
<span id="cb191-1958"><a href="#cb191-1958" aria-hidden="true" tabindex="-1"></a><span class="in">               past_simulated[[metric]],</span></span>
<span id="cb191-1959"><a href="#cb191-1959" aria-hidden="true" tabindex="-1"></a><span class="in">               future_data[[metric]])  </span></span>
<span id="cb191-1960"><a href="#cb191-1960" aria-hidden="true" tabindex="-1"></a><span class="in">  past_plot &lt;- ggplot() +</span></span>
<span id="cb191-1961"><a href="#cb191-1961" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_boxplot(data = past_simulated,</span></span>
<span id="cb191-1962"><a href="#cb191-1962" aria-hidden="true" tabindex="-1"></a><span class="in">                 aes_string(&quot;as.numeric(Year)&quot;,</span></span>
<span id="cb191-1963"><a href="#cb191-1963" aria-hidden="true" tabindex="-1"></a><span class="in">                            metric,</span></span>
<span id="cb191-1964"><a href="#cb191-1964" aria-hidden="true" tabindex="-1"></a><span class="in">                            group=&quot;Year&quot;),</span></span>
<span id="cb191-1965"><a href="#cb191-1965" aria-hidden="true" tabindex="-1"></a><span class="in">                 fill=&quot;skyblue&quot;) +</span></span>
<span id="cb191-1966"><a href="#cb191-1966" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_y_continuous(limits = c(0, </span></span>
<span id="cb191-1967"><a href="#cb191-1967" aria-hidden="true" tabindex="-1"></a><span class="in">                                  round(round(1.1*rng[2])))) +</span></span>
<span id="cb191-1968"><a href="#cb191-1968" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(x = &quot;Year&quot;, y = axis_label) +</span></span>
<span id="cb191-1969"><a href="#cb191-1969" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_grid(~ Scenario) +</span></span>
<span id="cb191-1970"><a href="#cb191-1970" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) +  </span></span>
<span id="cb191-1971"><a href="#cb191-1971" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(strip.background = element_blank(),</span></span>
<span id="cb191-1972"><a href="#cb191-1972" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text = element_text(face = &quot;bold&quot;),</span></span>
<span id="cb191-1973"><a href="#cb191-1973" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.text.x = element_text(angle=45, </span></span>
<span id="cb191-1974"><a href="#cb191-1974" aria-hidden="true" tabindex="-1"></a><span class="in">                                     hjust=1)) +</span></span>
<span id="cb191-1975"><a href="#cb191-1975" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(data = past_observed,</span></span>
<span id="cb191-1976"><a href="#cb191-1976" aria-hidden="true" tabindex="-1"></a><span class="in">               aes_string(&quot;End_year&quot;,</span></span>
<span id="cb191-1977"><a href="#cb191-1977" aria-hidden="true" tabindex="-1"></a><span class="in">                          metric),</span></span>
<span id="cb191-1978"><a href="#cb191-1978" aria-hidden="true" tabindex="-1"></a><span class="in">               col=&quot;blue&quot;)</span></span>
<span id="cb191-1979"><a href="#cb191-1979" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-1980"><a href="#cb191-1980" aria-hidden="true" tabindex="-1"></a><span class="in">  future_plot_list &lt;- list()</span></span>
<span id="cb191-1981"><a href="#cb191-1981" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-1982"><a href="#cb191-1982" aria-hidden="true" tabindex="-1"></a><span class="in">  for(y in time_points)</span></span>
<span id="cb191-1983"><a href="#cb191-1983" aria-hidden="true" tabindex="-1"></a><span class="in">  {</span></span>
<span id="cb191-1984"><a href="#cb191-1984" aria-hidden="true" tabindex="-1"></a><span class="in">    future_plot_list[[which(y == time_points)]] &lt;-</span></span>
<span id="cb191-1985"><a href="#cb191-1985" aria-hidden="true" tabindex="-1"></a><span class="in">      ggplot(data = future_data[which(future_data$Year==y),]) +</span></span>
<span id="cb191-1986"><a href="#cb191-1986" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_boxplot(aes_string(&quot;GCM&quot;, </span></span>
<span id="cb191-1987"><a href="#cb191-1987" aria-hidden="true" tabindex="-1"></a><span class="in">                              metric, </span></span>
<span id="cb191-1988"><a href="#cb191-1988" aria-hidden="true" tabindex="-1"></a><span class="in">                              fill=&quot;GCM&quot;)) +</span></span>
<span id="cb191-1989"><a href="#cb191-1989" aria-hidden="true" tabindex="-1"></a><span class="in">      facet_wrap(vars(SSP), nrow = 1) +</span></span>
<span id="cb191-1990"><a href="#cb191-1990" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_x_discrete(labels = NULL,</span></span>
<span id="cb191-1991"><a href="#cb191-1991" aria-hidden="true" tabindex="-1"></a><span class="in">                       expand = expansion(add = 1)) +</span></span>
<span id="cb191-1992"><a href="#cb191-1992" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_y_continuous(limits = c(0, </span></span>
<span id="cb191-1993"><a href="#cb191-1993" aria-hidden="true" tabindex="-1"></a><span class="in">                                    round(round(1.1*rng[2])))) +</span></span>
<span id="cb191-1994"><a href="#cb191-1994" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_text_npc(aes(npcx = &quot;center&quot;,</span></span>
<span id="cb191-1995"><a href="#cb191-1995" aria-hidden="true" tabindex="-1"></a><span class="in">                        npcy = &quot;top&quot;,</span></span>
<span id="cb191-1996"><a href="#cb191-1996" aria-hidden="true" tabindex="-1"></a><span class="in">                        label = Year),</span></span>
<span id="cb191-1997"><a href="#cb191-1997" aria-hidden="true" tabindex="-1"></a><span class="in">                    size = 5) +</span></span>
<span id="cb191-1998"><a href="#cb191-1998" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_bw(base_size = 15) +</span></span>
<span id="cb191-1999"><a href="#cb191-1999" aria-hidden="true" tabindex="-1"></a><span class="in">      theme(axis.ticks.y = element_blank(),</span></span>
<span id="cb191-2000"><a href="#cb191-2000" aria-hidden="true" tabindex="-1"></a><span class="in">            axis.text = element_blank(),</span></span>
<span id="cb191-2001"><a href="#cb191-2001" aria-hidden="true" tabindex="-1"></a><span class="in">            axis.title = element_blank(),</span></span>
<span id="cb191-2002"><a href="#cb191-2002" aria-hidden="true" tabindex="-1"></a><span class="in">            legend.position = &quot;bottom&quot;,</span></span>
<span id="cb191-2003"><a href="#cb191-2003" aria-hidden="true" tabindex="-1"></a><span class="in">            legend.margin = margin(0,</span></span>
<span id="cb191-2004"><a href="#cb191-2004" aria-hidden="true" tabindex="-1"></a><span class="in">                                   0, </span></span>
<span id="cb191-2005"><a href="#cb191-2005" aria-hidden="true" tabindex="-1"></a><span class="in">                                   0, </span></span>
<span id="cb191-2006"><a href="#cb191-2006" aria-hidden="true" tabindex="-1"></a><span class="in">                                   0, </span></span>
<span id="cb191-2007"><a href="#cb191-2007" aria-hidden="true" tabindex="-1"></a><span class="in">                                   &quot;cm&quot;),</span></span>
<span id="cb191-2008"><a href="#cb191-2008" aria-hidden="true" tabindex="-1"></a><span class="in">            legend.background = element_rect(),</span></span>
<span id="cb191-2009"><a href="#cb191-2009" aria-hidden="true" tabindex="-1"></a><span class="in">            strip.background = element_blank(),</span></span>
<span id="cb191-2010"><a href="#cb191-2010" aria-hidden="true" tabindex="-1"></a><span class="in">            strip.text = element_text(face = &quot;bold&quot;),</span></span>
<span id="cb191-2011"><a href="#cb191-2011" aria-hidden="true" tabindex="-1"></a><span class="in">            legend.box.spacing = unit(0, &quot;cm&quot;),</span></span>
<span id="cb191-2012"><a href="#cb191-2012" aria-hidden="true" tabindex="-1"></a><span class="in">            plot.subtitle = element_text(hjust = 0.5,</span></span>
<span id="cb191-2013"><a href="#cb191-2013" aria-hidden="true" tabindex="-1"></a><span class="in">                                         vjust = -1,</span></span>
<span id="cb191-2014"><a href="#cb191-2014" aria-hidden="true" tabindex="-1"></a><span class="in">                                         size = 15 * 1.05,</span></span>
<span id="cb191-2015"><a href="#cb191-2015" aria-hidden="true" tabindex="-1"></a><span class="in">                                         face = &quot;bold&quot;)) </span></span>
<span id="cb191-2016"><a href="#cb191-2016" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb191-2017"><a href="#cb191-2017" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-2018"><a href="#cb191-2018" aria-hidden="true" tabindex="-1"></a><span class="in">  plot &lt;- (past_plot +</span></span>
<span id="cb191-2019"><a href="#cb191-2019" aria-hidden="true" tabindex="-1"></a><span class="in">             future_plot_list +</span></span>
<span id="cb191-2020"><a href="#cb191-2020" aria-hidden="true" tabindex="-1"></a><span class="in">             plot_layout(guides = &quot;collect&quot;,</span></span>
<span id="cb191-2021"><a href="#cb191-2021" aria-hidden="true" tabindex="-1"></a><span class="in">                         widths = c(1,rep(1.8,length(future_plot_list))))</span></span>
<span id="cb191-2022"><a href="#cb191-2022" aria-hidden="true" tabindex="-1"></a><span class="in">           ) &amp; theme(legend.position = &quot;bottom&quot;,</span></span>
<span id="cb191-2023"><a href="#cb191-2023" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.text = element_text(size=8),</span></span>
<span id="cb191-2024"><a href="#cb191-2024" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.title = element_text(size=10),</span></span>
<span id="cb191-2025"><a href="#cb191-2025" aria-hidden="true" tabindex="-1"></a><span class="in">                     axis.title.x=element_blank())</span></span>
<span id="cb191-2026"><a href="#cb191-2026" aria-hidden="true" tabindex="-1"></a><span class="in">  plot</span></span>
<span id="cb191-2027"><a href="#cb191-2027" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-2028"><a href="#cb191-2028" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb191-2029"><a href="#cb191-2029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2030"><a href="#cb191-2030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2031"><a href="#cb191-2031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2032"><a href="#cb191-2032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2033"><a href="#cb191-2033" aria-hidden="true" tabindex="-1"></a><span class="in">plot_scenarios_gg(past_observed = past_observed,</span></span>
<span id="cb191-2034"><a href="#cb191-2034" aria-hidden="true" tabindex="-1"></a><span class="in">                  past_simulated = past_simulated,</span></span>
<span id="cb191-2035"><a href="#cb191-2035" aria-hidden="true" tabindex="-1"></a><span class="in">                  future_data = future_data,</span></span>
<span id="cb191-2036"><a href="#cb191-2036" aria-hidden="true" tabindex="-1"></a><span class="in">                  metric = &quot;GDH&quot;,</span></span>
<span id="cb191-2037"><a href="#cb191-2037" aria-hidden="true" tabindex="-1"></a><span class="in">                  axis_label = &quot;Heat (in Growing Degree Hours)&quot;,</span></span>
<span id="cb191-2038"><a href="#cb191-2038" aria-hidden="true" tabindex="-1"></a><span class="in">                  time_points = c(2050, 2085))</span></span>
<span id="cb191-2039"><a href="#cb191-2039" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-2040"><a href="#cb191-2040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2041"><a href="#cb191-2041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2042"><a href="#cb191-2042" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb191-2043"><a href="#cb191-2043" aria-hidden="true" tabindex="-1"></a><span class="in">plot_scenarios_gg(past_observed = past_observed,</span></span>
<span id="cb191-2044"><a href="#cb191-2044" aria-hidden="true" tabindex="-1"></a><span class="in">                  past_simulated = past_simulated,</span></span>
<span id="cb191-2045"><a href="#cb191-2045" aria-hidden="true" tabindex="-1"></a><span class="in">                  future_data = future_data,</span></span>
<span id="cb191-2046"><a href="#cb191-2046" aria-hidden="true" tabindex="-1"></a><span class="in">                  metric = &quot;Chill_Portions&quot;,</span></span>
<span id="cb191-2047"><a href="#cb191-2047" aria-hidden="true" tabindex="-1"></a><span class="in">                  axis_label = &quot;Chill (in Chill Portions)&quot;,</span></span>
<span id="cb191-2048"><a href="#cb191-2048" aria-hidden="true" tabindex="-1"></a><span class="in">                  time_points = c(2050, 2085))</span></span>
<span id="cb191-2049"><a href="#cb191-2049" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-2050"><a href="#cb191-2050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2051"><a href="#cb191-2051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2052"><a href="#cb191-2052" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb191-2053"><a href="#cb191-2053" aria-hidden="true" tabindex="-1"></a><span class="in">plot_scenarios_gg(past_observed = past_observed,</span></span>
<span id="cb191-2054"><a href="#cb191-2054" aria-hidden="true" tabindex="-1"></a><span class="in">                  past_simulated = past_simulated,</span></span>
<span id="cb191-2055"><a href="#cb191-2055" aria-hidden="true" tabindex="-1"></a><span class="in">                  future_data = future_data,</span></span>
<span id="cb191-2056"><a href="#cb191-2056" aria-hidden="true" tabindex="-1"></a><span class="in">                  metric = &quot;Frost_H&quot;,</span></span>
<span id="cb191-2057"><a href="#cb191-2057" aria-hidden="true" tabindex="-1"></a><span class="in">                  axis_label = &quot;Frost duration (in hours)&quot;,</span></span>
<span id="cb191-2058"><a href="#cb191-2058" aria-hidden="true" tabindex="-1"></a><span class="in">                  time_points = c(2050, 2085))</span></span>
<span id="cb191-2059"><a href="#cb191-2059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2060"><a href="#cb191-2060" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_frost_plot.png&quot;, </span></span>
<span id="cb191-2061"><a href="#cb191-2061" aria-hidden="true" tabindex="-1"></a><span class="in">       width = 10,</span></span>
<span id="cb191-2062"><a href="#cb191-2062" aria-hidden="true" tabindex="-1"></a><span class="in">       height = 8,</span></span>
<span id="cb191-2063"><a href="#cb191-2063" aria-hidden="true" tabindex="-1"></a><span class="in">       dpi = 600)</span></span>
<span id="cb191-2064"><a href="#cb191-2064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2065"><a href="#cb191-2065" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-2066"><a href="#cb191-2066" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-2067"><a href="#cb191-2067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2068"><a href="#cb191-2068" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 19: Chill model comparison</span></span>
<span id="cb191-2069"><a href="#cb191-2069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2070"><a href="#cb191-2070" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on chill model comparison*** </span></span>
<span id="cb191-2071"><a href="#cb191-2071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2072"><a href="#cb191-2072" aria-hidden="true" tabindex="-1"></a>1.Produce similar plots for the weather station you selected for earlier exercises.</span>
<span id="cb191-2073"><a href="#cb191-2073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2074"><a href="#cb191-2074" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb191-2075"><a href="#cb191-2075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2076"><a href="#cb191-2076" aria-hidden="true" tabindex="-1"></a><span class="in"> library(chillR)</span></span>
<span id="cb191-2077"><a href="#cb191-2077" aria-hidden="true" tabindex="-1"></a><span class="in"> library(tidyverse)</span></span>
<span id="cb191-2078"><a href="#cb191-2078" aria-hidden="true" tabindex="-1"></a><span class="in"> library(colorRamps)</span></span>
<span id="cb191-2079"><a href="#cb191-2079" aria-hidden="true" tabindex="-1"></a><span class="in"> library(patchwork)</span></span>
<span id="cb191-2080"><a href="#cb191-2080" aria-hidden="true" tabindex="-1"></a><span class="in"> library(gganimate)</span></span>
<span id="cb191-2081"><a href="#cb191-2081" aria-hidden="true" tabindex="-1"></a><span class="in"> </span></span>
<span id="cb191-2082"><a href="#cb191-2082" aria-hidden="true" tabindex="-1"></a><span class="in"> SSPs &lt;- c(&quot;ssp126&quot;, &quot;ssp245&quot;, &quot;ssp370&quot;, &quot;ssp585&quot;)</span></span>
<span id="cb191-2083"><a href="#cb191-2083" aria-hidden="true" tabindex="-1"></a><span class="in"> Times &lt;- c(2050, 2085)</span></span>
<span id="cb191-2084"><a href="#cb191-2084" aria-hidden="true" tabindex="-1"></a><span class="in"> </span></span>
<span id="cb191-2085"><a href="#cb191-2085" aria-hidden="true" tabindex="-1"></a><span class="in"> library(chillR)</span></span>
<span id="cb191-2086"><a href="#cb191-2086" aria-hidden="true" tabindex="-1"></a><span class="in"> library(devtools)</span></span>
<span id="cb191-2087"><a href="#cb191-2087" aria-hidden="true" tabindex="-1"></a><span class="in"> install_github(&quot;EduardoFernandezC/dormancyR&quot;)</span></span>
<span id="cb191-2088"><a href="#cb191-2088" aria-hidden="true" tabindex="-1"></a><span class="in"> library(dormancyR)</span></span>
<span id="cb191-2089"><a href="#cb191-2089" aria-hidden="true" tabindex="-1"></a><span class="in"> </span></span>
<span id="cb191-2090"><a href="#cb191-2090" aria-hidden="true" tabindex="-1"></a><span class="in"> hourly_models &lt;- list( Chilling_units = chilling_units,</span></span>
<span id="cb191-2091"><a href="#cb191-2091" aria-hidden="true" tabindex="-1"></a><span class="in">      Low_chill = low_chill_model,</span></span>
<span id="cb191-2092"><a href="#cb191-2092" aria-hidden="true" tabindex="-1"></a><span class="in">      Modified_Utah = modified_utah_model,</span></span>
<span id="cb191-2093"><a href="#cb191-2093" aria-hidden="true" tabindex="-1"></a><span class="in">      North_Carolina = north_carolina_model,</span></span>
<span id="cb191-2094"><a href="#cb191-2094" aria-hidden="true" tabindex="-1"></a><span class="in">      Positive_Utah = positive_utah_model,</span></span>
<span id="cb191-2095"><a href="#cb191-2095" aria-hidden="true" tabindex="-1"></a><span class="in">      Chilling_Hours = Chilling_Hours,</span></span>
<span id="cb191-2096"><a href="#cb191-2096" aria-hidden="true" tabindex="-1"></a><span class="in">      Utah_Chill_Units = Utah_Model,</span></span>
<span id="cb191-2097"><a href="#cb191-2097" aria-hidden="true" tabindex="-1"></a><span class="in">      Chill_Portions = Dynamic_Model)</span></span>
<span id="cb191-2098"><a href="#cb191-2098" aria-hidden="true" tabindex="-1"></a><span class="in"> </span></span>
<span id="cb191-2099"><a href="#cb191-2099" aria-hidden="true" tabindex="-1"></a><span class="in">  daily_models &lt;- list(Rate_of_Chill = rate_of_chill,</span></span>
<span id="cb191-2100"><a href="#cb191-2100" aria-hidden="true" tabindex="-1"></a><span class="in">                       Chill_Days = chill_days,</span></span>
<span id="cb191-2101"><a href="#cb191-2101" aria-hidden="true" tabindex="-1"></a><span class="in">                       Exponential_Chill = exponential_chill,</span></span>
<span id="cb191-2102"><a href="#cb191-2102" aria-hidden="true" tabindex="-1"></a><span class="in">                      Triangular_Chill_Haninnen = triangular_chill_1,</span></span>
<span id="cb191-2103"><a href="#cb191-2103" aria-hidden="true" tabindex="-1"></a><span class="in">                     Triangular_Chill_Legave = triangular_chill_2)</span></span>
<span id="cb191-2104"><a href="#cb191-2104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2105"><a href="#cb191-2105" aria-hidden="true" tabindex="-1"></a><span class="in">metrics &lt;- c(names(daily_models),</span></span>
<span id="cb191-2106"><a href="#cb191-2106" aria-hidden="true" tabindex="-1"></a><span class="in">             names(hourly_models))</span></span>
<span id="cb191-2107"><a href="#cb191-2107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2108"><a href="#cb191-2108" aria-hidden="true" tabindex="-1"></a><span class="in">model_labels = c(&quot;Rate of Chill&quot;,</span></span>
<span id="cb191-2109"><a href="#cb191-2109" aria-hidden="true" tabindex="-1"></a><span class="in">                 &quot;Chill Days&quot;,</span></span>
<span id="cb191-2110"><a href="#cb191-2110" aria-hidden="true" tabindex="-1"></a><span class="in">                 &quot;Exponential Chill&quot;,</span></span>
<span id="cb191-2111"><a href="#cb191-2111" aria-hidden="true" tabindex="-1"></a><span class="in">                 &quot;Triangular Chill (HÃ¤ninnen)&quot;,</span></span>
<span id="cb191-2112"><a href="#cb191-2112" aria-hidden="true" tabindex="-1"></a><span class="in">                 &quot;Triangular Chill (Legave)&quot;,</span></span>
<span id="cb191-2113"><a href="#cb191-2113" aria-hidden="true" tabindex="-1"></a><span class="in">                 &quot;Chilling Units&quot;,</span></span>
<span id="cb191-2114"><a href="#cb191-2114" aria-hidden="true" tabindex="-1"></a><span class="in">                 &quot;Low-Chill Chill Units&quot;,</span></span>
<span id="cb191-2115"><a href="#cb191-2115" aria-hidden="true" tabindex="-1"></a><span class="in">                 &quot;Modified Utah Chill Units&quot;,</span></span>
<span id="cb191-2116"><a href="#cb191-2116" aria-hidden="true" tabindex="-1"></a><span class="in">                 &quot;North Carolina Chill Units&quot;,</span></span>
<span id="cb191-2117"><a href="#cb191-2117" aria-hidden="true" tabindex="-1"></a><span class="in">                 &quot;Positive Utah Chill Units&quot;,</span></span>
<span id="cb191-2118"><a href="#cb191-2118" aria-hidden="true" tabindex="-1"></a><span class="in">                 &quot;Chilling Hours&quot;,</span></span>
<span id="cb191-2119"><a href="#cb191-2119" aria-hidden="true" tabindex="-1"></a><span class="in">                 &quot;Utah Chill Units&quot;,</span></span>
<span id="cb191-2120"><a href="#cb191-2120" aria-hidden="true" tabindex="-1"></a><span class="in">                 &quot;Chill Portions&quot;)</span></span>
<span id="cb191-2121"><a href="#cb191-2121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2122"><a href="#cb191-2122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2123"><a href="#cb191-2123" aria-hidden="true" tabindex="-1"></a><span class="in">data.frame(Metric=model_labels,&#39;Function name&#39;=metrics)</span></span>
<span id="cb191-2124"><a href="#cb191-2124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2125"><a href="#cb191-2125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2126"><a href="#cb191-2126" aria-hidden="true" tabindex="-1"></a><span class="in">data.frame(Metric=model_labels,&#39;Function name&#39;=metrics)</span></span>
<span id="cb191-2127"><a href="#cb191-2127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2128"><a href="#cb191-2128" aria-hidden="true" tabindex="-1"></a><span class="in">Rochester_temps &lt;- read_tab(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_temps.csv&quot;)</span></span>
<span id="cb191-2129"><a href="#cb191-2129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2130"><a href="#cb191-2130" aria-hidden="true" tabindex="-1"></a><span class="in">Temps &lt;- load_temperature_scenarios(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York&quot;,</span></span>
<span id="cb191-2131"><a href="#cb191-2131" aria-hidden="true" tabindex="-1"></a><span class="in">                                    &quot;all_past_temps&quot;)</span></span>
<span id="cb191-2132"><a href="#cb191-2132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2133"><a href="#cb191-2133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2134"><a href="#cb191-2134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2135"><a href="#cb191-2135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2136"><a href="#cb191-2136" aria-hidden="true" tabindex="-1"></a><span class="in">Start_JDay &lt;- 305</span></span>
<span id="cb191-2137"><a href="#cb191-2137" aria-hidden="true" tabindex="-1"></a><span class="in">End_JDay &lt;- 59</span></span>
<span id="cb191-2138"><a href="#cb191-2138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2139"><a href="#cb191-2139" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models_past_scenarios &lt;-</span></span>
<span id="cb191-2140"><a href="#cb191-2140" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse_list_daily(Temps,</span></span>
<span id="cb191-2141"><a href="#cb191-2141" aria-hidden="true" tabindex="-1"></a><span class="in">                          Start_JDay = Start_JDay,</span></span>
<span id="cb191-2142"><a href="#cb191-2142" aria-hidden="true" tabindex="-1"></a><span class="in">                          End_JDay = End_JDay,</span></span>
<span id="cb191-2143"><a href="#cb191-2143" aria-hidden="true" tabindex="-1"></a><span class="in">                          models = daily_models) # list of daily temperatures function for min and max temps</span></span>
<span id="cb191-2144"><a href="#cb191-2144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2145"><a href="#cb191-2145" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models_past_scenarios &lt;- lapply(</span></span>
<span id="cb191-2146"><a href="#cb191-2146" aria-hidden="true" tabindex="-1"></a><span class="in">  daily_models_past_scenarios,</span></span>
<span id="cb191-2147"><a href="#cb191-2147" aria-hidden="true" tabindex="-1"></a><span class="in">  function(x) x[which(x$Perc_complete&gt;90),]) # allows us to apply models</span></span>
<span id="cb191-2148"><a href="#cb191-2148" aria-hidden="true" tabindex="-1"></a><span class="in"># total of 99 seasons</span></span>
<span id="cb191-2149"><a href="#cb191-2149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2150"><a href="#cb191-2150" aria-hidden="true" tabindex="-1"></a><span class="in">hourly_models_past_scenarios &lt;-</span></span>
<span id="cb191-2151"><a href="#cb191-2151" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse_daily_list(Temps,</span></span>
<span id="cb191-2152"><a href="#cb191-2152" aria-hidden="true" tabindex="-1"></a><span class="in">                          latitude = 43.156,</span></span>
<span id="cb191-2153"><a href="#cb191-2153" aria-hidden="true" tabindex="-1"></a><span class="in">                          Start_JDay = Start_JDay,</span></span>
<span id="cb191-2154"><a href="#cb191-2154" aria-hidden="true" tabindex="-1"></a><span class="in">                          End_JDay = End_JDay,</span></span>
<span id="cb191-2155"><a href="#cb191-2155" aria-hidden="true" tabindex="-1"></a><span class="in">                          models = hourly_models,</span></span>
<span id="cb191-2156"><a href="#cb191-2156" aria-hidden="true" tabindex="-1"></a><span class="in">                          misstolerance = 10)</span></span>
<span id="cb191-2157"><a href="#cb191-2157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2158"><a href="#cb191-2158" aria-hidden="true" tabindex="-1"></a><span class="in">past_scenarios &lt;- daily_models_past_scenarios # combine the two models</span></span>
<span id="cb191-2159"><a href="#cb191-2159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2160"><a href="#cb191-2160" aria-hidden="true" tabindex="-1"></a><span class="in">past_scenarios &lt;- lapply(</span></span>
<span id="cb191-2161"><a href="#cb191-2161" aria-hidden="true" tabindex="-1"></a><span class="in">  names(past_scenarios),</span></span>
<span id="cb191-2162"><a href="#cb191-2162" aria-hidden="true" tabindex="-1"></a><span class="in">  function(x)</span></span>
<span id="cb191-2163"><a href="#cb191-2163" aria-hidden="true" tabindex="-1"></a><span class="in">    cbind(past_scenarios[[x]],</span></span>
<span id="cb191-2164"><a href="#cb191-2164" aria-hidden="true" tabindex="-1"></a><span class="in">          hourly_models_past_scenarios[[x]][,names(hourly_models)]))</span></span>
<span id="cb191-2165"><a href="#cb191-2165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2166"><a href="#cb191-2166" aria-hidden="true" tabindex="-1"></a><span class="in">names(past_scenarios) &lt;- names(daily_models_past_scenarios)</span></span>
<span id="cb191-2167"><a href="#cb191-2167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2168"><a href="#cb191-2168" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models_observed &lt;-</span></span>
<span id="cb191-2169"><a href="#cb191-2169" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse_daily(Rochester_temps,</span></span>
<span id="cb191-2170"><a href="#cb191-2170" aria-hidden="true" tabindex="-1"></a><span class="in">                     Start_JDay = Start_JDay,</span></span>
<span id="cb191-2171"><a href="#cb191-2171" aria-hidden="true" tabindex="-1"></a><span class="in">                     End_JDay = End_JDay,</span></span>
<span id="cb191-2172"><a href="#cb191-2172" aria-hidden="true" tabindex="-1"></a><span class="in">                     models = daily_models)</span></span>
<span id="cb191-2173"><a href="#cb191-2173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2174"><a href="#cb191-2174" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models_observed &lt;-</span></span>
<span id="cb191-2175"><a href="#cb191-2175" aria-hidden="true" tabindex="-1"></a><span class="in">  daily_models_observed[which(daily_models_observed$Perc_complete&gt;90),]</span></span>
<span id="cb191-2176"><a href="#cb191-2176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2177"><a href="#cb191-2177" aria-hidden="true" tabindex="-1"></a><span class="in">hourly_models_observed &lt;-</span></span>
<span id="cb191-2178"><a href="#cb191-2178" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse_daily_list(Rochester_temps,</span></span>
<span id="cb191-2179"><a href="#cb191-2179" aria-hidden="true" tabindex="-1"></a><span class="in">                          latitude= 43.156,</span></span>
<span id="cb191-2180"><a href="#cb191-2180" aria-hidden="true" tabindex="-1"></a><span class="in">                          Start_JDay = Start_JDay,</span></span>
<span id="cb191-2181"><a href="#cb191-2181" aria-hidden="true" tabindex="-1"></a><span class="in">                          End_JDay = End_JDay,</span></span>
<span id="cb191-2182"><a href="#cb191-2182" aria-hidden="true" tabindex="-1"></a><span class="in">                          models = hourly_models,</span></span>
<span id="cb191-2183"><a href="#cb191-2183" aria-hidden="true" tabindex="-1"></a><span class="in">                          misstolerance = 10)</span></span>
<span id="cb191-2184"><a href="#cb191-2184" aria-hidden="true" tabindex="-1"></a><span class="in"># run from here later</span></span>
<span id="cb191-2185"><a href="#cb191-2185" aria-hidden="true" tabindex="-1"></a><span class="in">past_observed &lt;- cbind(</span></span>
<span id="cb191-2186"><a href="#cb191-2186" aria-hidden="true" tabindex="-1"></a><span class="in">  daily_models_observed,</span></span>
<span id="cb191-2187"><a href="#cb191-2187" aria-hidden="true" tabindex="-1"></a><span class="in">  hourly_models_observed[[1]][,names(hourly_models)])</span></span>
<span id="cb191-2188"><a href="#cb191-2188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2189"><a href="#cb191-2189" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(past_scenarios,</span></span>
<span id="cb191-2190"><a href="#cb191-2190" aria-hidden="true" tabindex="-1"></a><span class="in">                           &quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;,</span></span>
<span id="cb191-2191"><a href="#cb191-2191" aria-hidden="true" tabindex="-1"></a><span class="in">                           &quot;Rochester_multichill_305_59_historic&quot;)</span></span>
<span id="cb191-2192"><a href="#cb191-2192" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(past_observed,</span></span>
<span id="cb191-2193"><a href="#cb191-2193" aria-hidden="true" tabindex="-1"></a><span class="in">          &quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate/Rochester_multichill_305_59_observed.csv&quot;,</span></span>
<span id="cb191-2194"><a href="#cb191-2194" aria-hidden="true" tabindex="-1"></a><span class="in">          row.names=FALSE)</span></span>
<span id="cb191-2195"><a href="#cb191-2195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2196"><a href="#cb191-2196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2197"><a href="#cb191-2197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2198"><a href="#cb191-2198" aria-hidden="true" tabindex="-1"></a><span class="in">future_temps &lt;- load_temperature_scenarios(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;,&quot;Rochester_future_&quot;)</span></span>
<span id="cb191-2199"><a href="#cb191-2199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2200"><a href="#cb191-2200" aria-hidden="true" tabindex="-1"></a><span class="in">SSPs &lt;- c(&quot;ssp126&quot;, &quot;ssp245&quot;, &quot;ssp370&quot;, &quot;ssp585&quot;)</span></span>
<span id="cb191-2201"><a href="#cb191-2201" aria-hidden="true" tabindex="-1"></a><span class="in">Times &lt;- c(2050, 2085)</span></span>
<span id="cb191-2202"><a href="#cb191-2202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2203"><a href="#cb191-2203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2204"><a href="#cb191-2204" aria-hidden="true" tabindex="-1"></a><span class="in">list_ssp &lt;-</span></span>
<span id="cb191-2205"><a href="#cb191-2205" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(future_temps), &#39;\\.&#39;) %&gt;%</span></span>
<span id="cb191-2206"><a href="#cb191-2206" aria-hidden="true" tabindex="-1"></a><span class="in">  map(2) %&gt;%</span></span>
<span id="cb191-2207"><a href="#cb191-2207" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb191-2208"><a href="#cb191-2208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2209"><a href="#cb191-2209" aria-hidden="true" tabindex="-1"></a><span class="in">list_gcm &lt;-</span></span>
<span id="cb191-2210"><a href="#cb191-2210" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(future_temps), &#39;\\.&#39;) %&gt;%</span></span>
<span id="cb191-2211"><a href="#cb191-2211" aria-hidden="true" tabindex="-1"></a><span class="in">  map(3) %&gt;%</span></span>
<span id="cb191-2212"><a href="#cb191-2212" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb191-2213"><a href="#cb191-2213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2214"><a href="#cb191-2214" aria-hidden="true" tabindex="-1"></a><span class="in">list_time &lt;-</span></span>
<span id="cb191-2215"><a href="#cb191-2215" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(future_temps), &#39;\\.&#39;) %&gt;%</span></span>
<span id="cb191-2216"><a href="#cb191-2216" aria-hidden="true" tabindex="-1"></a><span class="in">  map(4) %&gt;%</span></span>
<span id="cb191-2217"><a href="#cb191-2217" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb191-2218"><a href="#cb191-2218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2219"><a href="#cb191-2219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2220"><a href="#cb191-2220" aria-hidden="true" tabindex="-1"></a><span class="in">for(SSP in SSPs)</span></span>
<span id="cb191-2221"><a href="#cb191-2221" aria-hidden="true" tabindex="-1"></a><span class="in">  for(Time in Times)</span></span>
<span id="cb191-2222"><a href="#cb191-2222" aria-hidden="true" tabindex="-1"></a><span class="in">    {</span></span>
<span id="cb191-2223"><a href="#cb191-2223" aria-hidden="true" tabindex="-1"></a><span class="in">    Temps &lt;- future_temps[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb191-2224"><a href="#cb191-2224" aria-hidden="true" tabindex="-1"></a><span class="in">    names(Temps) &lt;- list_gcm[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb191-2225"><a href="#cb191-2225" aria-hidden="true" tabindex="-1"></a><span class="in">    daily_models_future_scenarios &lt;- tempResponse_list_daily(</span></span>
<span id="cb191-2226"><a href="#cb191-2226" aria-hidden="true" tabindex="-1"></a><span class="in">      Temps,</span></span>
<span id="cb191-2227"><a href="#cb191-2227" aria-hidden="true" tabindex="-1"></a><span class="in">      Start_JDay = Start_JDay,</span></span>
<span id="cb191-2228"><a href="#cb191-2228" aria-hidden="true" tabindex="-1"></a><span class="in">      End_JDay = End_JDay,</span></span>
<span id="cb191-2229"><a href="#cb191-2229" aria-hidden="true" tabindex="-1"></a><span class="in">      models = daily_models)</span></span>
<span id="cb191-2230"><a href="#cb191-2230" aria-hidden="true" tabindex="-1"></a><span class="in">    daily_models_future_scenarios&lt;-lapply(</span></span>
<span id="cb191-2231"><a href="#cb191-2231" aria-hidden="true" tabindex="-1"></a><span class="in">      daily_models_future_scenarios,</span></span>
<span id="cb191-2232"><a href="#cb191-2232" aria-hidden="true" tabindex="-1"></a><span class="in">      function(x) x[which(x$Perc_complete&gt;90),])</span></span>
<span id="cb191-2233"><a href="#cb191-2233" aria-hidden="true" tabindex="-1"></a><span class="in">    hourly_models_future_scenarios&lt;-</span></span>
<span id="cb191-2234"><a href="#cb191-2234" aria-hidden="true" tabindex="-1"></a><span class="in">      tempResponse_daily_list(</span></span>
<span id="cb191-2235"><a href="#cb191-2235" aria-hidden="true" tabindex="-1"></a><span class="in">        Temps,</span></span>
<span id="cb191-2236"><a href="#cb191-2236" aria-hidden="true" tabindex="-1"></a><span class="in">        latitude = 43.156,</span></span>
<span id="cb191-2237"><a href="#cb191-2237" aria-hidden="true" tabindex="-1"></a><span class="in">        Start_JDay = Start_JDay,</span></span>
<span id="cb191-2238"><a href="#cb191-2238" aria-hidden="true" tabindex="-1"></a><span class="in">        End_JDay = End_JDay,</span></span>
<span id="cb191-2239"><a href="#cb191-2239" aria-hidden="true" tabindex="-1"></a><span class="in">        models=hourly_models,</span></span>
<span id="cb191-2240"><a href="#cb191-2240" aria-hidden="true" tabindex="-1"></a><span class="in">        misstolerance = 10)</span></span>
<span id="cb191-2241"><a href="#cb191-2241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2242"><a href="#cb191-2242" aria-hidden="true" tabindex="-1"></a><span class="in">    future_scenarios &lt;- daily_models_future_scenarios</span></span>
<span id="cb191-2243"><a href="#cb191-2243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2244"><a href="#cb191-2244" aria-hidden="true" tabindex="-1"></a><span class="in">    future_scenarios &lt;- lapply(</span></span>
<span id="cb191-2245"><a href="#cb191-2245" aria-hidden="true" tabindex="-1"></a><span class="in">      names(future_scenarios),</span></span>
<span id="cb191-2246"><a href="#cb191-2246" aria-hidden="true" tabindex="-1"></a><span class="in">      function(x)</span></span>
<span id="cb191-2247"><a href="#cb191-2247" aria-hidden="true" tabindex="-1"></a><span class="in">        cbind(future_scenarios[[x]],</span></span>
<span id="cb191-2248"><a href="#cb191-2248" aria-hidden="true" tabindex="-1"></a><span class="in">              hourly_models_future_scenarios[[x]][,names(hourly_models)]))</span></span>
<span id="cb191-2249"><a href="#cb191-2249" aria-hidden="true" tabindex="-1"></a><span class="in">    names(future_scenarios)&lt;-names(daily_models_future_scenarios)</span></span>
<span id="cb191-2250"><a href="#cb191-2250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2251"><a href="#cb191-2251" aria-hidden="true" tabindex="-1"></a><span class="in">    chill&lt;-future_scenarios</span></span>
<span id="cb191-2252"><a href="#cb191-2252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2253"><a href="#cb191-2253" aria-hidden="true" tabindex="-1"></a><span class="in">    save_temperature_scenarios(</span></span>
<span id="cb191-2254"><a href="#cb191-2254" aria-hidden="true" tabindex="-1"></a><span class="in">      chill,</span></span>
<span id="cb191-2255"><a href="#cb191-2255" aria-hidden="true" tabindex="-1"></a><span class="in">      &quot;data_New_York/future_climate&quot;,</span></span>
<span id="cb191-2256"><a href="#cb191-2256" aria-hidden="true" tabindex="-1"></a><span class="in">      paste0(&quot;Rochester_multichill_305_59_&quot;,Time,&quot;_&quot;,SSP))</span></span>
<span id="cb191-2257"><a href="#cb191-2257" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb191-2258"><a href="#cb191-2258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2259"><a href="#cb191-2259" aria-hidden="true" tabindex="-1"></a><span class="in">chill_past_scenarios &lt;- load_temperature_scenarios(</span></span>
<span id="cb191-2260"><a href="#cb191-2260" aria-hidden="true" tabindex="-1"></a><span class="in">  &quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;,</span></span>
<span id="cb191-2261"><a href="#cb191-2261" aria-hidden="true" tabindex="-1"></a><span class="in">  &quot;Rochester_multichill_305_59_historic&quot;)</span></span>
<span id="cb191-2262"><a href="#cb191-2262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2263"><a href="#cb191-2263" aria-hidden="true" tabindex="-1"></a><span class="in">chill_observed &lt;-</span></span>
<span id="cb191-2264"><a href="#cb191-2264" aria-hidden="true" tabindex="-1"></a><span class="in">  read_tab(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate/Rochester_multichill_305_59_observed.csv&quot;)</span></span>
<span id="cb191-2265"><a href="#cb191-2265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2266"><a href="#cb191-2266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2267"><a href="#cb191-2267" aria-hidden="true" tabindex="-1"></a><span class="in">chills &lt;- make_climate_scenario(chill_past_scenarios,</span></span>
<span id="cb191-2268"><a href="#cb191-2268" aria-hidden="true" tabindex="-1"></a><span class="in">                                caption = &quot;Historic&quot;,</span></span>
<span id="cb191-2269"><a href="#cb191-2269" aria-hidden="true" tabindex="-1"></a><span class="in">                                historic_data = chill_observed,</span></span>
<span id="cb191-2270"><a href="#cb191-2270" aria-hidden="true" tabindex="-1"></a><span class="in">                                time_series = TRUE)</span></span>
<span id="cb191-2271"><a href="#cb191-2271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2272"><a href="#cb191-2272" aria-hidden="true" tabindex="-1"></a><span class="in">for(SSP in SSPs)</span></span>
<span id="cb191-2273"><a href="#cb191-2273" aria-hidden="true" tabindex="-1"></a><span class="in">  for(Time in Times)</span></span>
<span id="cb191-2274"><a href="#cb191-2274" aria-hidden="true" tabindex="-1"></a><span class="in">    {</span></span>
<span id="cb191-2275"><a href="#cb191-2275" aria-hidden="true" tabindex="-1"></a><span class="in">    chill &lt;- load_temperature_scenarios(</span></span>
<span id="cb191-2276"><a href="#cb191-2276" aria-hidden="true" tabindex="-1"></a><span class="in">      &quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/future_climate&quot;,</span></span>
<span id="cb191-2277"><a href="#cb191-2277" aria-hidden="true" tabindex="-1"></a><span class="in">      paste0(&quot;Rochester_multichill_305_59_&quot;,Time,&quot;_&quot;,SSP))</span></span>
<span id="cb191-2278"><a href="#cb191-2278" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == &quot;ssp126&quot;) SSPcaption &lt;- &quot;SSP1&quot;</span></span>
<span id="cb191-2279"><a href="#cb191-2279" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == &quot;ssp245&quot;) SSPcaption &lt;- &quot;SSP2&quot;</span></span>
<span id="cb191-2280"><a href="#cb191-2280" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == &quot;ssp370&quot;) SSPcaption &lt;- &quot;SSP3&quot;</span></span>
<span id="cb191-2281"><a href="#cb191-2281" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == &quot;ssp585&quot;) SSPcaption &lt;- &quot;SSP5&quot;</span></span>
<span id="cb191-2282"><a href="#cb191-2282" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == &quot;2050&quot;) Time_caption &lt;- &quot;2050&quot;</span></span>
<span id="cb191-2283"><a href="#cb191-2283" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == &quot;2085&quot;) Time_caption &lt;- &quot;2085&quot;</span></span>
<span id="cb191-2284"><a href="#cb191-2284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2285"><a href="#cb191-2285" aria-hidden="true" tabindex="-1"></a><span class="in">    chills &lt;- make_climate_scenario(chill,</span></span>
<span id="cb191-2286"><a href="#cb191-2286" aria-hidden="true" tabindex="-1"></a><span class="in">                                    caption = c(SSPcaption,</span></span>
<span id="cb191-2287"><a href="#cb191-2287" aria-hidden="true" tabindex="-1"></a><span class="in">                                                Time_caption),</span></span>
<span id="cb191-2288"><a href="#cb191-2288" aria-hidden="true" tabindex="-1"></a><span class="in">                                    add_to = chills)</span></span>
<span id="cb191-2289"><a href="#cb191-2289" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb191-2290"><a href="#cb191-2290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2291"><a href="#cb191-2291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2292"><a href="#cb191-2292" aria-hidden="true" tabindex="-1"></a><span class="in">plot_climate_scenarios(chills,</span></span>
<span id="cb191-2293"><a href="#cb191-2293" aria-hidden="true" tabindex="-1"></a><span class="in">                       metric=&quot;Rate_of_Chill&quot;,</span></span>
<span id="cb191-2294"><a href="#cb191-2294" aria-hidden="true" tabindex="-1"></a><span class="in">                       metric_label=&quot;Rate of Chill&quot;,</span></span>
<span id="cb191-2295"><a href="#cb191-2295" aria-hidden="true" tabindex="-1"></a><span class="in">                       year_name=&quot;End_Year&quot;)</span></span>
<span id="cb191-2296"><a href="#cb191-2296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2297"><a href="#cb191-2297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2298"><a href="#cb191-2298" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(chills))</span></span>
<span id="cb191-2299"><a href="#cb191-2299" aria-hidden="true" tabindex="-1"></a><span class="in">   {ch &lt;- chills[[i]]</span></span>
<span id="cb191-2300"><a href="#cb191-2300" aria-hidden="true" tabindex="-1"></a><span class="in">   if(ch$caption[1] == &quot;Historic&quot;)</span></span>
<span id="cb191-2301"><a href="#cb191-2301" aria-hidden="true" tabindex="-1"></a><span class="in">     {GCMs &lt;- rep(&quot;none&quot;,length(names(ch$data)))</span></span>
<span id="cb191-2302"><a href="#cb191-2302" aria-hidden="true" tabindex="-1"></a><span class="in">      SSPs &lt;- rep(&quot;none&quot;,length(names(ch$data)))</span></span>
<span id="cb191-2303"><a href="#cb191-2303" aria-hidden="true" tabindex="-1"></a><span class="in">      Years &lt;- as.numeric(ch$labels)</span></span>
<span id="cb191-2304"><a href="#cb191-2304" aria-hidden="true" tabindex="-1"></a><span class="in">      Scenario &lt;- rep(&quot;Historic&quot;,</span></span>
<span id="cb191-2305"><a href="#cb191-2305" aria-hidden="true" tabindex="-1"></a><span class="in">                      length(names(ch$data)))} else</span></span>
<span id="cb191-2306"><a href="#cb191-2306" aria-hidden="true" tabindex="-1"></a><span class="in">                        {GCMs &lt;- names(ch$data)</span></span>
<span id="cb191-2307"><a href="#cb191-2307" aria-hidden="true" tabindex="-1"></a><span class="in">                        SSPs &lt;- rep(ch$caption[1],</span></span>
<span id="cb191-2308"><a href="#cb191-2308" aria-hidden="true" tabindex="-1"></a><span class="in">                                    length(names(ch$data)))</span></span>
<span id="cb191-2309"><a href="#cb191-2309" aria-hidden="true" tabindex="-1"></a><span class="in">                        Years &lt;- rep(as.numeric(ch$caption[2]),</span></span>
<span id="cb191-2310"><a href="#cb191-2310" aria-hidden="true" tabindex="-1"></a><span class="in">                                     length(names(ch$data)))</span></span>
<span id="cb191-2311"><a href="#cb191-2311" aria-hidden="true" tabindex="-1"></a><span class="in">                        Scenario &lt;- rep(&quot;Future&quot;,</span></span>
<span id="cb191-2312"><a href="#cb191-2312" aria-hidden="true" tabindex="-1"></a><span class="in">                                        length(names(ch$data)))}</span></span>
<span id="cb191-2313"><a href="#cb191-2313" aria-hidden="true" tabindex="-1"></a><span class="in">   for(nam in names(ch$data))</span></span>
<span id="cb191-2314"><a href="#cb191-2314" aria-hidden="true" tabindex="-1"></a><span class="in">     {for(met in metrics)</span></span>
<span id="cb191-2315"><a href="#cb191-2315" aria-hidden="true" tabindex="-1"></a><span class="in">       {temp_res &lt;-</span></span>
<span id="cb191-2316"><a href="#cb191-2316" aria-hidden="true" tabindex="-1"></a><span class="in">         data.frame(Metric = met,</span></span>
<span id="cb191-2317"><a href="#cb191-2317" aria-hidden="true" tabindex="-1"></a><span class="in">                    GCM = GCMs[which(nam == names(ch$data))],</span></span>
<span id="cb191-2318"><a href="#cb191-2318" aria-hidden="true" tabindex="-1"></a><span class="in">                    SSP = SSPs[which(nam == names(ch$data))],</span></span>
<span id="cb191-2319"><a href="#cb191-2319" aria-hidden="true" tabindex="-1"></a><span class="in">                    Year = Years[which(nam == names(ch$data))],</span></span>
<span id="cb191-2320"><a href="#cb191-2320" aria-hidden="true" tabindex="-1"></a><span class="in">                    Result = quantile(ch$data[[nam]][,met],0.1), # 10% quantile</span></span>
<span id="cb191-2321"><a href="#cb191-2321" aria-hidden="true" tabindex="-1"></a><span class="in">                    Scenario = Scenario[which(nam == names(ch$data))])</span></span>
<span id="cb191-2322"><a href="#cb191-2322" aria-hidden="true" tabindex="-1"></a><span class="in">       if(i == 1 &amp; nam == names(ch$data)[1] &amp; met == metrics[1])</span></span>
<span id="cb191-2323"><a href="#cb191-2323" aria-hidden="true" tabindex="-1"></a><span class="in">         results &lt;- temp_res else</span></span>
<span id="cb191-2324"><a href="#cb191-2324" aria-hidden="true" tabindex="-1"></a><span class="in">           results &lt;- rbind(results,</span></span>
<span id="cb191-2325"><a href="#cb191-2325" aria-hidden="true" tabindex="-1"></a><span class="in">                            temp_res)</span></span>
<span id="cb191-2326"><a href="#cb191-2326" aria-hidden="true" tabindex="-1"></a><span class="in">         }</span></span>
<span id="cb191-2327"><a href="#cb191-2327" aria-hidden="true" tabindex="-1"></a><span class="in">     }</span></span>
<span id="cb191-2328"><a href="#cb191-2328" aria-hidden="true" tabindex="-1"></a><span class="in">   }</span></span>
<span id="cb191-2329"><a href="#cb191-2329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2330"><a href="#cb191-2330" aria-hidden="true" tabindex="-1"></a><span class="in">for(met in metrics)</span></span>
<span id="cb191-2331"><a href="#cb191-2331" aria-hidden="true" tabindex="-1"></a><span class="in">  results[which(results$Metric == met),&quot;SWC&quot;] &lt;-</span></span>
<span id="cb191-2332"><a href="#cb191-2332" aria-hidden="true" tabindex="-1"></a><span class="in">    results[which(results$Metric == met),&quot;Result&quot;]/</span></span>
<span id="cb191-2333"><a href="#cb191-2333" aria-hidden="true" tabindex="-1"></a><span class="in">      results[which(results$Metric == met &amp; results$Year == 1980),</span></span>
<span id="cb191-2334"><a href="#cb191-2334" aria-hidden="true" tabindex="-1"></a><span class="in">              &quot;Result&quot;]-1</span></span>
<span id="cb191-2335"><a href="#cb191-2335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2336"><a href="#cb191-2336" aria-hidden="true" tabindex="-1"></a><span class="in">rng = range(results$SWC)</span></span>
<span id="cb191-2337"><a href="#cb191-2337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2338"><a href="#cb191-2338" aria-hidden="true" tabindex="-1"></a><span class="in">p_future &lt;- ggplot(results[which(!results$GCM == &quot;none&quot;),],</span></span>
<span id="cb191-2339"><a href="#cb191-2339" aria-hidden="true" tabindex="-1"></a><span class="in">                   aes(GCM,</span></span>
<span id="cb191-2340"><a href="#cb191-2340" aria-hidden="true" tabindex="-1"></a><span class="in">                       y = factor(Metric,</span></span>
<span id="cb191-2341"><a href="#cb191-2341" aria-hidden="true" tabindex="-1"></a><span class="in">                                  levels = metrics),</span></span>
<span id="cb191-2342"><a href="#cb191-2342" aria-hidden="true" tabindex="-1"></a><span class="in">                       fill = SWC)) +</span></span>
<span id="cb191-2343"><a href="#cb191-2343" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile()</span></span>
<span id="cb191-2344"><a href="#cb191-2344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2345"><a href="#cb191-2345" aria-hidden="true" tabindex="-1"></a><span class="in">p_future</span></span>
<span id="cb191-2346"><a href="#cb191-2346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2347"><a href="#cb191-2347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2348"><a href="#cb191-2348" aria-hidden="true" tabindex="-1"></a><span class="in">p_future &lt;-</span></span>
<span id="cb191-2349"><a href="#cb191-2349" aria-hidden="true" tabindex="-1"></a><span class="in">  p_future +</span></span>
<span id="cb191-2350"><a href="#cb191-2350" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(SSP ~ Year)</span></span>
<span id="cb191-2351"><a href="#cb191-2351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2352"><a href="#cb191-2352" aria-hidden="true" tabindex="-1"></a><span class="in">p_future</span></span>
<span id="cb191-2353"><a href="#cb191-2353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2354"><a href="#cb191-2354" aria-hidden="true" tabindex="-1"></a><span class="in">p_future &lt;-</span></span>
<span id="cb191-2355"><a href="#cb191-2355" aria-hidden="true" tabindex="-1"></a><span class="in">  p_future +</span></span>
<span id="cb191-2356"><a href="#cb191-2356" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 10) +</span></span>
<span id="cb191-2357"><a href="#cb191-2357" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text = element_text(size = 6))</span></span>
<span id="cb191-2358"><a href="#cb191-2358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2359"><a href="#cb191-2359" aria-hidden="true" tabindex="-1"></a><span class="in">p_future</span></span>
<span id="cb191-2360"><a href="#cb191-2360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2361"><a href="#cb191-2361" aria-hidden="true" tabindex="-1"></a><span class="in">library(colorRamps)</span></span>
<span id="cb191-2362"><a href="#cb191-2362" aria-hidden="true" tabindex="-1"></a><span class="in">p_future &lt;-</span></span>
<span id="cb191-2363"><a href="#cb191-2363" aria-hidden="true" tabindex="-1"></a><span class="in">  p_future +</span></span>
<span id="cb191-2364"><a href="#cb191-2364" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(colours = rev(matlab.like(15)),</span></span>
<span id="cb191-2365"><a href="#cb191-2365" aria-hidden="true" tabindex="-1"></a><span class="in">                       labels = scales::percent,</span></span>
<span id="cb191-2366"><a href="#cb191-2366" aria-hidden="true" tabindex="-1"></a><span class="in">                       limits = rng)</span></span>
<span id="cb191-2367"><a href="#cb191-2367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2368"><a href="#cb191-2368" aria-hidden="true" tabindex="-1"></a><span class="in">p_future</span></span>
<span id="cb191-2369"><a href="#cb191-2369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2370"><a href="#cb191-2370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2371"><a href="#cb191-2371" aria-hidden="true" tabindex="-1"></a><span class="in">p_future &lt;-</span></span>
<span id="cb191-2372"><a href="#cb191-2372" aria-hidden="true" tabindex="-1"></a><span class="in">  p_future  +</span></span>
<span id="cb191-2373"><a href="#cb191-2373" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.x = element_text(angle = 75,</span></span>
<span id="cb191-2374"><a href="#cb191-2374" aria-hidden="true" tabindex="-1"></a><span class="in">                                   hjust = 1,</span></span>
<span id="cb191-2375"><a href="#cb191-2375" aria-hidden="true" tabindex="-1"></a><span class="in">                                   vjust = 1)) +</span></span>
<span id="cb191-2376"><a href="#cb191-2376" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = &quot;Change in\nSafe Winter Chill\nsince 1975&quot;) +</span></span>
<span id="cb191-2377"><a href="#cb191-2377" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(labels = model_labels) +</span></span>
<span id="cb191-2378"><a href="#cb191-2378" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(&quot;Chill metric&quot;)</span></span>
<span id="cb191-2379"><a href="#cb191-2379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2380"><a href="#cb191-2380" aria-hidden="true" tabindex="-1"></a><span class="in">p_future</span></span>
<span id="cb191-2381"><a href="#cb191-2381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2382"><a href="#cb191-2382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2383"><a href="#cb191-2383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2384"><a href="#cb191-2384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2385"><a href="#cb191-2385" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb191-2386"><a href="#cb191-2386" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(results[which(results$GCM == &quot;none&quot;),],</span></span>
<span id="cb191-2387"><a href="#cb191-2387" aria-hidden="true" tabindex="-1"></a><span class="in">         aes(Year,</span></span>
<span id="cb191-2388"><a href="#cb191-2388" aria-hidden="true" tabindex="-1"></a><span class="in">             y = factor(Metric,</span></span>
<span id="cb191-2389"><a href="#cb191-2389" aria-hidden="true" tabindex="-1"></a><span class="in">                        levels=metrics),</span></span>
<span id="cb191-2390"><a href="#cb191-2390" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = SWC)) +</span></span>
<span id="cb191-2391"><a href="#cb191-2391" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile()</span></span>
<span id="cb191-2392"><a href="#cb191-2392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2393"><a href="#cb191-2393" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb191-2394"><a href="#cb191-2394" aria-hidden="true" tabindex="-1"></a><span class="in">  p_past +</span></span>
<span id="cb191-2395"><a href="#cb191-2395" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 10) +</span></span>
<span id="cb191-2396"><a href="#cb191-2396" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text = element_text(size = 6))</span></span>
<span id="cb191-2397"><a href="#cb191-2397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2398"><a href="#cb191-2398" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb191-2399"><a href="#cb191-2399" aria-hidden="true" tabindex="-1"></a><span class="in">  p_past +</span></span>
<span id="cb191-2400"><a href="#cb191-2400" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(colours = rev(matlab.like(15)),</span></span>
<span id="cb191-2401"><a href="#cb191-2401" aria-hidden="true" tabindex="-1"></a><span class="in">                       labels = scales::percent,</span></span>
<span id="cb191-2402"><a href="#cb191-2402" aria-hidden="true" tabindex="-1"></a><span class="in">                       limits = rng)</span></span>
<span id="cb191-2403"><a href="#cb191-2403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2404"><a href="#cb191-2404" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb191-2405"><a href="#cb191-2405" aria-hidden="true" tabindex="-1"></a><span class="in">  p_past +</span></span>
<span id="cb191-2406"><a href="#cb191-2406" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(position = &quot;top&quot;)</span></span>
<span id="cb191-2407"><a href="#cb191-2407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2408"><a href="#cb191-2408" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb191-2409"><a href="#cb191-2409" aria-hidden="true" tabindex="-1"></a><span class="in">  p_past +</span></span>
<span id="cb191-2410"><a href="#cb191-2410" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = &quot;Change in\nSafe Winter Chill\nsince 1975&quot;) +</span></span>
<span id="cb191-2411"><a href="#cb191-2411" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(labels = model_labels) +</span></span>
<span id="cb191-2412"><a href="#cb191-2412" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(&quot;Chill metric&quot;)</span></span>
<span id="cb191-2413"><a href="#cb191-2413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2414"><a href="#cb191-2414" aria-hidden="true" tabindex="-1"></a><span class="in">p_past</span></span>
<span id="cb191-2415"><a href="#cb191-2415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2416"><a href="#cb191-2416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2417"><a href="#cb191-2417" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)</span></span>
<span id="cb191-2418"><a href="#cb191-2418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2419"><a href="#cb191-2419" aria-hidden="true" tabindex="-1"></a><span class="in">chill_comp_plot&lt;-</span></span>
<span id="cb191-2420"><a href="#cb191-2420" aria-hidden="true" tabindex="-1"></a><span class="in">  (p_past +</span></span>
<span id="cb191-2421"><a href="#cb191-2421" aria-hidden="true" tabindex="-1"></a><span class="in">     p_future +</span></span>
<span id="cb191-2422"><a href="#cb191-2422" aria-hidden="true" tabindex="-1"></a><span class="in">     plot_layout(guides = &quot;collect&quot;,</span></span>
<span id="cb191-2423"><a href="#cb191-2423" aria-hidden="true" tabindex="-1"></a><span class="in">                 nrow = 2,</span></span>
<span id="cb191-2424"><a href="#cb191-2424" aria-hidden="true" tabindex="-1"></a><span class="in">                 heights = c(1,3))) &amp;</span></span>
<span id="cb191-2425"><a href="#cb191-2425" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = &quot;right&quot;,</span></span>
<span id="cb191-2426"><a href="#cb191-2426" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb191-2427"><a href="#cb191-2427" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = &quot;bold&quot;))</span></span>
<span id="cb191-2428"><a href="#cb191-2428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2429"><a href="#cb191-2429" aria-hidden="true" tabindex="-1"></a><span class="in">chill_comp_plot</span></span>
<span id="cb191-2430"><a href="#cb191-2430" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results &lt;- results[which(results$GCM == &quot;none&quot;),]</span></span>
<span id="cb191-2431"><a href="#cb191-2431" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results$SSP &lt;- &quot;SSP1&quot;</span></span>
<span id="cb191-2432"><a href="#cb191-2432" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_2 &lt;- hist_results</span></span>
<span id="cb191-2433"><a href="#cb191-2433" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_2$SSP &lt;- &quot;SSP2&quot;</span></span>
<span id="cb191-2434"><a href="#cb191-2434" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_3 &lt;- hist_results</span></span>
<span id="cb191-2435"><a href="#cb191-2435" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_3$SSP &lt;- &quot;SSP3&quot;</span></span>
<span id="cb191-2436"><a href="#cb191-2436" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_4 &lt;- hist_results</span></span>
<span id="cb191-2437"><a href="#cb191-2437" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_4$SSP &lt;- &quot;SSP5&quot;</span></span>
<span id="cb191-2438"><a href="#cb191-2438" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results &lt;- rbind(hist_results,</span></span>
<span id="cb191-2439"><a href="#cb191-2439" aria-hidden="true" tabindex="-1"></a><span class="in">                      hist_results_2,</span></span>
<span id="cb191-2440"><a href="#cb191-2440" aria-hidden="true" tabindex="-1"></a><span class="in">                      hist_results_3,</span></span>
<span id="cb191-2441"><a href="#cb191-2441" aria-hidden="true" tabindex="-1"></a><span class="in">                      hist_results_4)</span></span>
<span id="cb191-2442"><a href="#cb191-2442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2443"><a href="#cb191-2443" aria-hidden="true" tabindex="-1"></a><span class="in">future_results &lt;- results[which(!results$GCM == &quot;none&quot;),]</span></span>
<span id="cb191-2444"><a href="#cb191-2444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2445"><a href="#cb191-2445" aria-hidden="true" tabindex="-1"></a><span class="in">GCM_aggregate &lt;- aggregate(</span></span>
<span id="cb191-2446"><a href="#cb191-2446" aria-hidden="true" tabindex="-1"></a><span class="in">  future_results$SWC,</span></span>
<span id="cb191-2447"><a href="#cb191-2447" aria-hidden="true" tabindex="-1"></a><span class="in">  by=list(future_results$Metric,</span></span>
<span id="cb191-2448"><a href="#cb191-2448" aria-hidden="true" tabindex="-1"></a><span class="in">          future_results$SSP,</span></span>
<span id="cb191-2449"><a href="#cb191-2449" aria-hidden="true" tabindex="-1"></a><span class="in">          future_results$Year),</span></span>
<span id="cb191-2450"><a href="#cb191-2450" aria-hidden="true" tabindex="-1"></a><span class="in">  FUN=mean)</span></span>
<span id="cb191-2451"><a href="#cb191-2451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2452"><a href="#cb191-2452" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(GCM_aggregate) &lt;- c(&quot;Metric&quot;,</span></span>
<span id="cb191-2453"><a href="#cb191-2453" aria-hidden="true" tabindex="-1"></a><span class="in">                             &quot;SSP&quot;,</span></span>
<span id="cb191-2454"><a href="#cb191-2454" aria-hidden="true" tabindex="-1"></a><span class="in">                             &quot;Year&quot;,</span></span>
<span id="cb191-2455"><a href="#cb191-2455" aria-hidden="true" tabindex="-1"></a><span class="in">                             &quot;SWC&quot;)</span></span>
<span id="cb191-2456"><a href="#cb191-2456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2457"><a href="#cb191-2457" aria-hidden="true" tabindex="-1"></a><span class="in">SSP_Time_series&lt;-rbind(hist_results[,c(&quot;Metric&quot;,</span></span>
<span id="cb191-2458"><a href="#cb191-2458" aria-hidden="true" tabindex="-1"></a><span class="in">                                       &quot;SSP&quot;,</span></span>
<span id="cb191-2459"><a href="#cb191-2459" aria-hidden="true" tabindex="-1"></a><span class="in">                                       &quot;Year&quot;,</span></span>
<span id="cb191-2460"><a href="#cb191-2460" aria-hidden="true" tabindex="-1"></a><span class="in">                                       &quot;SWC&quot;)],</span></span>
<span id="cb191-2461"><a href="#cb191-2461" aria-hidden="true" tabindex="-1"></a><span class="in">                       GCM_aggregate)</span></span>
<span id="cb191-2462"><a href="#cb191-2462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2463"><a href="#cb191-2463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2464"><a href="#cb191-2464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2465"><a href="#cb191-2465" aria-hidden="true" tabindex="-1"></a><span class="in">SSP_Time_series$Year &lt;- as.numeric(SSP_Time_series$Year)</span></span>
<span id="cb191-2466"><a href="#cb191-2466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2467"><a href="#cb191-2467" aria-hidden="true" tabindex="-1"></a><span class="in">chill_change_plot&lt;-</span></span>
<span id="cb191-2468"><a href="#cb191-2468" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(data = SSP_Time_series,</span></span>
<span id="cb191-2469"><a href="#cb191-2469" aria-hidden="true" tabindex="-1"></a><span class="in">         aes(x = Year,</span></span>
<span id="cb191-2470"><a href="#cb191-2470" aria-hidden="true" tabindex="-1"></a><span class="in">             y = SWC,</span></span>
<span id="cb191-2471"><a href="#cb191-2471" aria-hidden="true" tabindex="-1"></a><span class="in">             col = factor(Metric,</span></span>
<span id="cb191-2472"><a href="#cb191-2472" aria-hidden="true" tabindex="-1"></a><span class="in">                          levels = metrics))) +</span></span>
<span id="cb191-2473"><a href="#cb191-2473" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.3) +</span></span>
<span id="cb191-2474"><a href="#cb191-2474" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~SSP,</span></span>
<span id="cb191-2475"><a href="#cb191-2475" aria-hidden="true" tabindex="-1"></a><span class="in">             nrow = 3) +</span></span>
<span id="cb191-2476"><a href="#cb191-2476" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 10) +</span></span>
<span id="cb191-2477"><a href="#cb191-2477" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(col = &quot;Change in\nSafe Winter Chill\nsince 1980&quot;) +</span></span>
<span id="cb191-2478"><a href="#cb191-2478" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_discrete(labels = model_labels) +</span></span>
<span id="cb191-2479"><a href="#cb191-2479" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(labels = scales::percent) +</span></span>
<span id="cb191-2480"><a href="#cb191-2480" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.background = element_blank(),</span></span>
<span id="cb191-2481"><a href="#cb191-2481" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = &quot;bold&quot;)) +</span></span>
<span id="cb191-2482"><a href="#cb191-2482" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(&quot;Safe Winter Chill&quot;)</span></span>
<span id="cb191-2483"><a href="#cb191-2483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2484"><a href="#cb191-2484" aria-hidden="true" tabindex="-1"></a><span class="in">chill_change_plot</span></span>
<span id="cb191-2485"><a href="#cb191-2485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2486"><a href="#cb191-2486" aria-hidden="true" tabindex="-1"></a><span class="in">library(gganimate)</span></span>
<span id="cb191-2487"><a href="#cb191-2487" aria-hidden="true" tabindex="-1"></a><span class="in">library(gifski)</span></span>
<span id="cb191-2488"><a href="#cb191-2488" aria-hidden="true" tabindex="-1"></a><span class="in">library(png)</span></span>
<span id="cb191-2489"><a href="#cb191-2489" aria-hidden="true" tabindex="-1"></a><span class="in">library(transformr)</span></span>
<span id="cb191-2490"><a href="#cb191-2490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2491"><a href="#cb191-2491" aria-hidden="true" tabindex="-1"></a><span class="in">ccp&lt;-chill_change_plot +</span></span>
<span id="cb191-2492"><a href="#cb191-2492" aria-hidden="true" tabindex="-1"></a><span class="in">  transition_reveal(Year)</span></span>
<span id="cb191-2493"><a href="#cb191-2493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2494"><a href="#cb191-2494" aria-hidden="true" tabindex="-1"></a><span class="in"># trying out different numbers of frames per second</span></span>
<span id="cb191-2495"><a href="#cb191-2495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2496"><a href="#cb191-2496" aria-hidden="true" tabindex="-1"></a><span class="in">animate(ccp, fps=1)</span></span>
<span id="cb191-2497"><a href="#cb191-2497" aria-hidden="true" tabindex="-1"></a><span class="in">anim_save(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/chill_comparison_animation_1.gif&quot;,</span></span>
<span id="cb191-2498"><a href="#cb191-2498" aria-hidden="true" tabindex="-1"></a><span class="in">          animation = last_animation())</span></span>
<span id="cb191-2499"><a href="#cb191-2499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2500"><a href="#cb191-2500" aria-hidden="true" tabindex="-1"></a><span class="in">animate(ccp, fps=100)</span></span>
<span id="cb191-2501"><a href="#cb191-2501" aria-hidden="true" tabindex="-1"></a><span class="in">anim_save(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/chill_comparison_animation_100.gif&quot;,</span></span>
<span id="cb191-2502"><a href="#cb191-2502" aria-hidden="true" tabindex="-1"></a><span class="in">          animation = last_animation())</span></span>
<span id="cb191-2503"><a href="#cb191-2503" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-2504"><a href="#cb191-2504" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-2505"><a href="#cb191-2505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2506"><a href="#cb191-2506" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 20: Simple Phenology Analysis</span></span>
<span id="cb191-2507"><a href="#cb191-2507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2508"><a href="#cb191-2508" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on simple phenology analysis*** </span></span>
<span id="cb191-2509"><a href="#cb191-2509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2510"><a href="#cb191-2510" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Provide a brief narrative describing what p-hacking is, and why this is a problematic approach to data analysis.</span>
<span id="cb191-2511"><a href="#cb191-2511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2512"><a href="#cb191-2512" aria-hidden="true" tabindex="-1"></a>P-hacking, (data fishing), is the manipulation of data analysis to obtain statistically significant results, often by repeatedly testing different hypotheses, adjusting variables, or selectively reporting findings until a desired p-value (typically &lt; 0.05) is achieved. </span>
<span id="cb191-2513"><a href="#cb191-2513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2514"><a href="#cb191-2514" aria-hidden="true" tabindex="-1"></a>This is problematic because it increases the likelihood of false positivesâresults that appear significant but are actually due to chance and it causes over-fitting during data analysis. </span>
<span id="cb191-2515"><a href="#cb191-2515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2516"><a href="#cb191-2516" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Provide a sketch of your causal understanding of the relationship between temperature and bloom dates.</span>
<span id="cb191-2517"><a href="#cb191-2517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2518"><a href="#cb191-2518" aria-hidden="true" tabindex="-1"></a>Temperature - Time</span>
<span id="cb191-2519"><a href="#cb191-2519" aria-hidden="true" tabindex="-1"></a>Climate change has caused:</span>
<span id="cb191-2520"><a href="#cb191-2520" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Warmer winter = delay in bloom dates</span>
<span id="cb191-2521"><a href="#cb191-2521" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rising spring temperature = advanced bloom dates</span>
<span id="cb191-2522"><a href="#cb191-2522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2523"><a href="#cb191-2523" aria-hidden="true" tabindex="-1"></a>Temperatures have been rising over time and phenology has advanced over time so later years generally feature earlier bloom dates.</span>
<span id="cb191-2524"><a href="#cb191-2524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2525"><a href="#cb191-2525" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>What do we need to know to build a process-based model from this?</span>
<span id="cb191-2526"><a href="#cb191-2526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2527"><a href="#cb191-2527" aria-hidden="true" tabindex="-1"></a>Regression equation isn&#39;t very useful for this process.</span>
<span id="cb191-2528"><a href="#cb191-2528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2529"><a href="#cb191-2529" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-2530"><a href="#cb191-2530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2531"><a href="#cb191-2531" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 21: Delineating temperature response phases with PLS regression</span></span>
<span id="cb191-2532"><a href="#cb191-2532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2533"><a href="#cb191-2533" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on chill model comparison*** </span></span>
<span id="cb191-2534"><a href="#cb191-2534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2535"><a href="#cb191-2535" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Briefly explain why you shouldnât take the results of a PLS regression analysis between temperature and phenology at face value. </span>
<span id="cb191-2536"><a href="#cb191-2536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2537"><a href="#cb191-2537" aria-hidden="true" tabindex="-1"></a>PLS should not be used as a data mining tool but in conjuction with a theory on how the system works to detect meaningful pattterns. </span>
<span id="cb191-2538"><a href="#cb191-2538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2539"><a href="#cb191-2539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2540"><a href="#cb191-2540" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>What do you need in addition in order to make sense of such outputs?</span>
<span id="cb191-2541"><a href="#cb191-2541" aria-hidden="true" tabindex="-1"></a>Replicate the PLS analysis for the Roter Boskoop dataset that you used in a previous lesson.</span>
<span id="cb191-2542"><a href="#cb191-2542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2543"><a href="#cb191-2543" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-2544"><a href="#cb191-2544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2545"><a href="#cb191-2545" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-2546"><a href="#cb191-2546" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb191-2547"><a href="#cb191-2547" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb191-2548"><a href="#cb191-2548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2549"><a href="#cb191-2549" aria-hidden="true" tabindex="-1"></a>Roter_first <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Roter_Boskoop_bloom_1958_2019.csv.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb191-2550"><a href="#cb191-2550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, First_bloom) <span class="sc">%&gt;%</span></span>
<span id="cb191-2551"><a href="#cb191-2551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">1</span>, <span class="dv">4</span>)),</span>
<span id="cb191-2552"><a href="#cb191-2552" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">5</span>, <span class="dv">6</span>)),</span>
<span id="cb191-2553"><a href="#cb191-2553" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">7</span>, <span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb191-2554"><a href="#cb191-2554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_JDay</span>() <span class="sc">%&gt;%</span></span>
<span id="cb191-2555"><a href="#cb191-2555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, JDay) <span class="sc">%&gt;%</span></span>
<span id="cb191-2556"><a href="#cb191-2556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Year =</span> Pheno_year,</span>
<span id="cb191-2557"><a href="#cb191-2557" aria-hidden="true" tabindex="-1"></a>         <span class="at">pheno =</span> JDay)</span>
<span id="cb191-2558"><a href="#cb191-2558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2559"><a href="#cb191-2559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2560"><a href="#cb191-2560" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Roter_first)</span>
<span id="cb191-2561"><a href="#cb191-2561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2562"><a href="#cb191-2562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2563"><a href="#cb191-2563" aria-hidden="true" tabindex="-1"></a>KA_temps <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/TMaxTMin1958-2019_patched.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb191-2564"><a href="#cb191-2564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_JDay</span>()</span>
<span id="cb191-2565"><a href="#cb191-2565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2566"><a href="#cb191-2566" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(KA_temps)</span>
<span id="cb191-2567"><a href="#cb191-2567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2568"><a href="#cb191-2568" aria-hidden="true" tabindex="-1"></a>PLS_results <span class="ot">&lt;-</span> <span class="fu">PLS_pheno</span>(KA_temps,</span>
<span id="cb191-2569"><a href="#cb191-2569" aria-hidden="true" tabindex="-1"></a>                         Roter_first)</span>
<span id="cb191-2570"><a href="#cb191-2570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2571"><a href="#cb191-2571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2572"><a href="#cb191-2572" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(PLS_results<span class="sc">$</span>PLS_summary)</span>
<span id="cb191-2573"><a href="#cb191-2573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2574"><a href="#cb191-2574" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS</span>(PLS_results,</span>
<span id="cb191-2575"><a href="#cb191-2575" aria-hidden="true" tabindex="-1"></a>         <span class="at">PLS_results_path =</span> <span class="st">&quot;PLS_out&quot;</span>)</span>
<span id="cb191-2576"><a href="#cb191-2576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-2577"><a href="#cb191-2577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2578"><a href="#cb191-2578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2579"><a href="#cb191-2579" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-2580"><a href="#cb191-2580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2581"><a href="#cb191-2581" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-2582"><a href="#cb191-2582" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb191-2583"><a href="#cb191-2583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2584"><a href="#cb191-2584" aria-hidden="true" tabindex="-1"></a>PLS_gg <span class="ot">&lt;-</span> PLS_results<span class="sc">$</span>PLS_summary <span class="sc">%&gt;%</span></span>
<span id="cb191-2585"><a href="#cb191-2585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">trunc</span>(Date <span class="sc">/</span> <span class="dv">100</span>),</span>
<span id="cb191-2586"><a href="#cb191-2586" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> Date <span class="sc">-</span> Month <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb191-2587"><a href="#cb191-2587" aria-hidden="true" tabindex="-1"></a>         <span class="at">Date =</span> <span class="cn">NULL</span>) </span>
<span id="cb191-2588"><a href="#cb191-2588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2589"><a href="#cb191-2589" aria-hidden="true" tabindex="-1"></a>PLS_gg<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2002</span>, </span>
<span id="cb191-2590"><a href="#cb191-2590" aria-hidden="true" tabindex="-1"></a>                       PLS_gg<span class="sc">$</span>Month, </span>
<span id="cb191-2591"><a href="#cb191-2591" aria-hidden="true" tabindex="-1"></a>                       PLS_gg<span class="sc">$</span>Day)</span>
<span id="cb191-2592"><a href="#cb191-2592" aria-hidden="true" tabindex="-1"></a>PLS_gg<span class="sc">$</span>Date[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span></span>
<span id="cb191-2593"><a href="#cb191-2593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ISOdate</span>(<span class="dv">2001</span>, </span>
<span id="cb191-2594"><a href="#cb191-2594" aria-hidden="true" tabindex="-1"></a>          PLS_gg<span class="sc">$</span>Month[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>], </span>
<span id="cb191-2595"><a href="#cb191-2595" aria-hidden="true" tabindex="-1"></a>          PLS_gg<span class="sc">$</span>Day[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>])</span>
<span id="cb191-2596"><a href="#cb191-2596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2597"><a href="#cb191-2597" aria-hidden="true" tabindex="-1"></a>PLS_gg <span class="ot">&lt;-</span> PLS_gg <span class="sc">%&gt;%</span></span>
<span id="cb191-2598"><a href="#cb191-2598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VIP_importance =</span> VIP <span class="sc">&gt;=</span> <span class="fl">0.8</span>,</span>
<span id="cb191-2599"><a href="#cb191-2599" aria-hidden="true" tabindex="-1"></a>         <span class="at">VIP_Coeff =</span> <span class="fu">factor</span>(<span class="fu">sign</span>(Coef) <span class="sc">*</span> VIP_importance))</span>
<span id="cb191-2600"><a href="#cb191-2600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2601"><a href="#cb191-2601" aria-hidden="true" tabindex="-1"></a>VIP_plot<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb191-2602"><a href="#cb191-2602" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2603"><a href="#cb191-2603" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> VIP)) <span class="sc">+</span></span>
<span id="cb191-2604"><a href="#cb191-2604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&#39;identity&#39;</span>,</span>
<span id="cb191-2605"><a href="#cb191-2605" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">fill =</span> VIP_importance))</span>
<span id="cb191-2606"><a href="#cb191-2606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2607"><a href="#cb191-2607" aria-hidden="true" tabindex="-1"></a>VIP_plot <span class="ot">&lt;-</span> VIP_plot <span class="sc">+</span></span>
<span id="cb191-2608"><a href="#cb191-2608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">&quot;VIP&quot;</span>, </span>
<span id="cb191-2609"><a href="#cb191-2609" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;0.8&quot;</span>,</span>
<span id="cb191-2610"><a href="#cb191-2610" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;&gt;0.8&quot;</span>), </span>
<span id="cb191-2611"><a href="#cb191-2611" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;FALSE&quot;</span><span class="ot">=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb191-2612"><a href="#cb191-2612" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;TRUE&quot;</span><span class="ot">=</span><span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb191-2613"><a href="#cb191-2613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb191-2614"><a href="#cb191-2614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-2615"><a href="#cb191-2615" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-2616"><a href="#cb191-2616" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>() )</span>
<span id="cb191-2617"><a href="#cb191-2617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2618"><a href="#cb191-2618" aria-hidden="true" tabindex="-1"></a>VIP_plot</span>
<span id="cb191-2619"><a href="#cb191-2619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2620"><a href="#cb191-2620" aria-hidden="true" tabindex="-1"></a>coeff_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb191-2621"><a href="#cb191-2621" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2622"><a href="#cb191-2622" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> Coef)) <span class="sc">+</span></span>
<span id="cb191-2623"><a href="#cb191-2623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span><span class="st">&#39;identity&#39;</span>,</span>
<span id="cb191-2624"><a href="#cb191-2624" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">fill =</span> VIP_Coeff)) <span class="sc">+</span></span>
<span id="cb191-2625"><a href="#cb191-2625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Effect direction&quot;</span>, </span>
<span id="cb191-2626"><a href="#cb191-2626" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Advancing&quot;</span>,</span>
<span id="cb191-2627"><a href="#cb191-2627" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Unimportant&quot;</span>,</span>
<span id="cb191-2628"><a href="#cb191-2628" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Delaying&quot;</span>), </span>
<span id="cb191-2629"><a href="#cb191-2629" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;-1&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb191-2630"><a href="#cb191-2630" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb191-2631"><a href="#cb191-2631" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;dark green&quot;</span>)) <span class="sc">+</span></span>
<span id="cb191-2632"><a href="#cb191-2632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb191-2633"><a href="#cb191-2633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;PLS coefficient&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2634"><a href="#cb191-2634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-2635"><a href="#cb191-2635" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-2636"><a href="#cb191-2636" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>() )</span>
<span id="cb191-2637"><a href="#cb191-2637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2638"><a href="#cb191-2638" aria-hidden="true" tabindex="-1"></a>coeff_plot</span>
<span id="cb191-2639"><a href="#cb191-2639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2640"><a href="#cb191-2640" aria-hidden="true" tabindex="-1"></a>temp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg) <span class="sc">+</span></span>
<span id="cb191-2641"><a href="#cb191-2641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2642"><a href="#cb191-2642" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Tmean <span class="sc">-</span> Tstdev,</span>
<span id="cb191-2643"><a href="#cb191-2643" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Tmean <span class="sc">+</span> Tstdev),</span>
<span id="cb191-2644"><a href="#cb191-2644" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2645"><a href="#cb191-2645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2646"><a href="#cb191-2646" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Tmean <span class="sc">-</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb191-2647"><a href="#cb191-2647" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Tmean <span class="sc">+</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb191-2648"><a href="#cb191-2648" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2649"><a href="#cb191-2649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2650"><a href="#cb191-2650" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Tmean <span class="sc">-</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb191-2651"><a href="#cb191-2651" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> Tmean <span class="sc">+</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>)),</span>
<span id="cb191-2652"><a href="#cb191-2652" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;dark green&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2653"><a href="#cb191-2653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2654"><a href="#cb191-2654" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> Tmean)) <span class="sc">+</span></span>
<span id="cb191-2655"><a href="#cb191-2655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb191-2656"><a href="#cb191-2656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(T[mean],<span class="st">&quot; (Â°C)&quot;</span>)))</span>
<span id="cb191-2657"><a href="#cb191-2657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2658"><a href="#cb191-2658" aria-hidden="true" tabindex="-1"></a>temp_plot</span>
<span id="cb191-2659"><a href="#cb191-2659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2660"><a href="#cb191-2660" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb191-2661"><a href="#cb191-2661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2662"><a href="#cb191-2662" aria-hidden="true" tabindex="-1"></a>plot<span class="ot">&lt;-</span> (VIP_plot <span class="sc">+</span></span>
<span id="cb191-2663"><a href="#cb191-2663" aria-hidden="true" tabindex="-1"></a>          coeff_plot <span class="sc">+</span></span>
<span id="cb191-2664"><a href="#cb191-2664" aria-hidden="true" tabindex="-1"></a>          temp_plot <span class="sc">+</span></span>
<span id="cb191-2665"><a href="#cb191-2665" aria-hidden="true" tabindex="-1"></a>          <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb191-2666"><a href="#cb191-2666" aria-hidden="true" tabindex="-1"></a>            <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>)</span>
<span id="cb191-2667"><a href="#cb191-2667" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb191-2668"><a href="#cb191-2668" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb191-2669"><a href="#cb191-2669" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb191-2670"><a href="#cb191-2670" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb191-2671"><a href="#cb191-2671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2672"><a href="#cb191-2672" aria-hidden="true" tabindex="-1"></a>plot</span>
<span id="cb191-2673"><a href="#cb191-2673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2674"><a href="#cb191-2674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2675"><a href="#cb191-2675" aria-hidden="true" tabindex="-1"></a>ggplot_PLS <span class="ot">&lt;-</span> <span class="cf">function</span>(PLS_results)</span>
<span id="cb191-2676"><a href="#cb191-2676" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb191-2677"><a href="#cb191-2677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb191-2678"><a href="#cb191-2678" aria-hidden="true" tabindex="-1"></a>  PLS_gg <span class="ot">&lt;-</span> PLS_results<span class="sc">$</span>PLS_summary <span class="sc">%&gt;%</span></span>
<span id="cb191-2679"><a href="#cb191-2679" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">trunc</span>(Date <span class="sc">/</span> <span class="dv">100</span>),</span>
<span id="cb191-2680"><a href="#cb191-2680" aria-hidden="true" tabindex="-1"></a>           <span class="at">Day =</span> Date <span class="sc">-</span> Month <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb191-2681"><a href="#cb191-2681" aria-hidden="true" tabindex="-1"></a>           <span class="at">Date =</span> <span class="cn">NULL</span>) </span>
<span id="cb191-2682"><a href="#cb191-2682" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-2683"><a href="#cb191-2683" aria-hidden="true" tabindex="-1"></a>  PLS_gg<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2002</span>, </span>
<span id="cb191-2684"><a href="#cb191-2684" aria-hidden="true" tabindex="-1"></a>                         PLS_gg<span class="sc">$</span>Month, </span>
<span id="cb191-2685"><a href="#cb191-2685" aria-hidden="true" tabindex="-1"></a>                         PLS_gg<span class="sc">$</span>Day)</span>
<span id="cb191-2686"><a href="#cb191-2686" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-2687"><a href="#cb191-2687" aria-hidden="true" tabindex="-1"></a>  PLS_gg<span class="sc">$</span>Date[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span></span>
<span id="cb191-2688"><a href="#cb191-2688" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ISOdate</span>(<span class="dv">2001</span>, </span>
<span id="cb191-2689"><a href="#cb191-2689" aria-hidden="true" tabindex="-1"></a>            PLS_gg<span class="sc">$</span>Month[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>], </span>
<span id="cb191-2690"><a href="#cb191-2690" aria-hidden="true" tabindex="-1"></a>            PLS_gg<span class="sc">$</span>Day[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>])</span>
<span id="cb191-2691"><a href="#cb191-2691" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-2692"><a href="#cb191-2692" aria-hidden="true" tabindex="-1"></a>  PLS_gg <span class="ot">&lt;-</span> PLS_gg <span class="sc">%&gt;%</span></span>
<span id="cb191-2693"><a href="#cb191-2693" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">VIP_importance =</span> VIP <span class="sc">&gt;=</span> <span class="fl">0.8</span>,</span>
<span id="cb191-2694"><a href="#cb191-2694" aria-hidden="true" tabindex="-1"></a>           <span class="at">VIP_Coeff =</span> <span class="fu">factor</span>(<span class="fu">sign</span>(Coef) <span class="sc">*</span> VIP_importance))</span>
<span id="cb191-2695"><a href="#cb191-2695" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-2696"><a href="#cb191-2696" aria-hidden="true" tabindex="-1"></a>  VIP_plot<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,<span class="fu">aes</span>(<span class="at">x=</span>Date,<span class="at">y=</span>VIP)) <span class="sc">+</span></span>
<span id="cb191-2697"><a href="#cb191-2697" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&#39;identity&#39;</span>,<span class="fu">aes</span>(<span class="at">fill=</span>VIP<span class="sc">&gt;</span><span class="fl">0.8</span>))</span>
<span id="cb191-2698"><a href="#cb191-2698" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-2699"><a href="#cb191-2699" aria-hidden="true" tabindex="-1"></a>  VIP_plot <span class="ot">&lt;-</span> VIP_plot <span class="sc">+</span></span>
<span id="cb191-2700"><a href="#cb191-2700" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">&quot;VIP&quot;</span>, </span>
<span id="cb191-2701"><a href="#cb191-2701" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;0.8&quot;</span>, <span class="st">&quot;&gt;0.8&quot;</span>), </span>
<span id="cb191-2702"><a href="#cb191-2702" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;FALSE&quot;</span><span class="ot">=</span><span class="st">&quot;grey&quot;</span>, <span class="st">&quot;TRUE&quot;</span><span class="ot">=</span><span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb191-2703"><a href="#cb191-2703" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb191-2704"><a href="#cb191-2704" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-2705"><a href="#cb191-2705" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-2706"><a href="#cb191-2706" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb191-2707"><a href="#cb191-2707" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-2708"><a href="#cb191-2708" aria-hidden="true" tabindex="-1"></a>  coeff_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb191-2709"><a href="#cb191-2709" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2710"><a href="#cb191-2710" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y =</span> Coef)) <span class="sc">+</span></span>
<span id="cb191-2711"><a href="#cb191-2711" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span><span class="st">&#39;identity&#39;</span>,</span>
<span id="cb191-2712"><a href="#cb191-2712" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> VIP_Coeff)) <span class="sc">+</span></span>
<span id="cb191-2713"><a href="#cb191-2713" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Effect direction&quot;</span>, </span>
<span id="cb191-2714"><a href="#cb191-2714" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Advancing&quot;</span>,</span>
<span id="cb191-2715"><a href="#cb191-2715" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Unimportant&quot;</span>,</span>
<span id="cb191-2716"><a href="#cb191-2716" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Delaying&quot;</span>), </span>
<span id="cb191-2717"><a href="#cb191-2717" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;-1&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb191-2718"><a href="#cb191-2718" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb191-2719"><a href="#cb191-2719" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;dark green&quot;</span>)) <span class="sc">+</span></span>
<span id="cb191-2720"><a href="#cb191-2720" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb191-2721"><a href="#cb191-2721" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;PLS coefficient&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2722"><a href="#cb191-2722" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-2723"><a href="#cb191-2723" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-2724"><a href="#cb191-2724" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb191-2725"><a href="#cb191-2725" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-2726"><a href="#cb191-2726" aria-hidden="true" tabindex="-1"></a>  temp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg) <span class="sc">+</span></span>
<span id="cb191-2727"><a href="#cb191-2727" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2728"><a href="#cb191-2728" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> Tmean <span class="sc">-</span> Tstdev,</span>
<span id="cb191-2729"><a href="#cb191-2729" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> Tmean <span class="sc">+</span> Tstdev),</span>
<span id="cb191-2730"><a href="#cb191-2730" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2731"><a href="#cb191-2731" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2732"><a href="#cb191-2732" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> Tmean <span class="sc">-</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb191-2733"><a href="#cb191-2733" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> Tmean <span class="sc">+</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb191-2734"><a href="#cb191-2734" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2735"><a href="#cb191-2735" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2736"><a href="#cb191-2736" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> Tmean <span class="sc">-</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb191-2737"><a href="#cb191-2737" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> Tmean <span class="sc">+</span> Tstdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>)),</span>
<span id="cb191-2738"><a href="#cb191-2738" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;dark green&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2739"><a href="#cb191-2739" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2740"><a href="#cb191-2740" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> Tmean)) <span class="sc">+</span></span>
<span id="cb191-2741"><a href="#cb191-2741" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb191-2742"><a href="#cb191-2742" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(T[mean],<span class="st">&quot; (Â°C)&quot;</span>)))</span>
<span id="cb191-2743"><a href="#cb191-2743" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-2744"><a href="#cb191-2744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(patchwork)</span>
<span id="cb191-2745"><a href="#cb191-2745" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-2746"><a href="#cb191-2746" aria-hidden="true" tabindex="-1"></a>  plot<span class="ot">&lt;-</span> (VIP_plot <span class="sc">+</span></span>
<span id="cb191-2747"><a href="#cb191-2747" aria-hidden="true" tabindex="-1"></a>            coeff_plot <span class="sc">+</span></span>
<span id="cb191-2748"><a href="#cb191-2748" aria-hidden="true" tabindex="-1"></a>            temp_plot <span class="sc">+</span></span>
<span id="cb191-2749"><a href="#cb191-2749" aria-hidden="true" tabindex="-1"></a>            <span class="fu">plot_layout</span>(<span class="at">ncol=</span><span class="dv">1</span>,</span>
<span id="cb191-2750"><a href="#cb191-2750" aria-hidden="true" tabindex="-1"></a>                        <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>)</span>
<span id="cb191-2751"><a href="#cb191-2751" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb191-2752"><a href="#cb191-2752" aria-hidden="true" tabindex="-1"></a>                    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb191-2753"><a href="#cb191-2753" aria-hidden="true" tabindex="-1"></a>                    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb191-2754"><a href="#cb191-2754" aria-hidden="true" tabindex="-1"></a>                    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb191-2755"><a href="#cb191-2755" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-2756"><a href="#cb191-2756" aria-hidden="true" tabindex="-1"></a>  plot}</span>
<span id="cb191-2757"><a href="#cb191-2757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2758"><a href="#cb191-2758" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_PLS</span>(PLS_results)</span>
<span id="cb191-2759"><a href="#cb191-2759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2760"><a href="#cb191-2760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-2761"><a href="#cb191-2761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2762"><a href="#cb191-2762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2763"><a href="#cb191-2763" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Write down your thoughts on why weâre not seeing the temperature response pattern we may have expected. What happened to the chill response?</span>
<span id="cb191-2764"><a href="#cb191-2764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2765"><a href="#cb191-2765" aria-hidden="true" tabindex="-1"></a>PLS responded to temperatures indicating greater heat accumulation which shows early bloom however this is absent for chill accumulation because they are not monotonically related.</span>
<span id="cb191-2766"><a href="#cb191-2766" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-2767"><a href="#cb191-2767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2768"><a href="#cb191-2768" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 22: Successes and limitations of PLS regression analysis</span></span>
<span id="cb191-2769"><a href="#cb191-2769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2770"><a href="#cb191-2770" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on chill model comparison*** </span></span>
<span id="cb191-2771"><a href="#cb191-2771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2772"><a href="#cb191-2772" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Briefly explain in what climatic settings we can expect PLS regression to detect the chilling phase - and in what settings this probably wonât work.</span>
<span id="cb191-2773"><a href="#cb191-2773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2774"><a href="#cb191-2774" aria-hidden="true" tabindex="-1"></a>In locations such as Davis in California, warm temperatures in winter reduces chill accumulation. While in other locations such as Klein-Altendorf and Beijing, when relatively cold, warming may increase the chill.When temperatures are relatively high, chill accumulation would be reduced by warming. At these two locations, there is no monotonic relationship between temperature and chill accumulation. Therefore, PLS would not produce clear results.</span>
<span id="cb191-2775"><a href="#cb191-2775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2776"><a href="#cb191-2776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2777"><a href="#cb191-2777" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>How could we overcome this problem?</span>
<span id="cb191-2778"><a href="#cb191-2778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2779"><a href="#cb191-2779" aria-hidden="true" tabindex="-1"></a>PLS regression failed to pick up the chilling period in relatively cold locations is that there is no monotonic relationship between temperature and chill effectiveness.</span>
<span id="cb191-2780"><a href="#cb191-2780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2781"><a href="#cb191-2781" aria-hidden="true" tabindex="-1"></a>To overcome this problem, we need to convert temperature into something that is monotonically related to chill accumulation. Maybe we can make use of the chill models we already learned about</span>
<span id="cb191-2782"><a href="#cb191-2782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2783"><a href="#cb191-2783" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-2784"><a href="#cb191-2784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2785"><a href="#cb191-2785" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 23: PLS regression with agroclimatic metrics</span></span>
<span id="cb191-2786"><a href="#cb191-2786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2787"><a href="#cb191-2787" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on Chill model comparison*** </span></span>
<span id="cb191-2788"><a href="#cb191-2788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2789"><a href="#cb191-2789" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Repeat the PLS_chill_force procedure for the âRoter Boskoopâ dataset. Include plots of daily chill and heat accumulation.</span>
<span id="cb191-2790"><a href="#cb191-2790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2791"><a href="#cb191-2791" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-2792"><a href="#cb191-2792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2793"><a href="#cb191-2793" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-2794"><a href="#cb191-2794" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb191-2795"><a href="#cb191-2795" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb191-2796"><a href="#cb191-2796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2797"><a href="#cb191-2797" aria-hidden="true" tabindex="-1"></a>temps_hourly <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/TMaxTMin1958-2019_patched.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb191-2798"><a href="#cb191-2798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack_hourly_temps</span>(<span class="at">latitude =</span> <span class="fl">43.1</span>)</span>
<span id="cb191-2799"><a href="#cb191-2799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2800"><a href="#cb191-2800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2801"><a href="#cb191-2801" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temps_hourly<span class="sc">$</span>hourtemps)</span>
<span id="cb191-2802"><a href="#cb191-2802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2803"><a href="#cb191-2803" aria-hidden="true" tabindex="-1"></a>daychill <span class="ot">&lt;-</span> <span class="fu">daily_chill</span>(<span class="at">hourtemps =</span> temps_hourly,</span>
<span id="cb191-2804"><a href="#cb191-2804" aria-hidden="true" tabindex="-1"></a>                        <span class="at">running_mean =</span> <span class="dv">1</span>,</span>
<span id="cb191-2805"><a href="#cb191-2805" aria-hidden="true" tabindex="-1"></a>                        <span class="at">models =</span> <span class="fu">list</span>(</span>
<span id="cb191-2806"><a href="#cb191-2806" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Chilling_Hours =</span> Chilling_Hours,</span>
<span id="cb191-2807"><a href="#cb191-2807" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Utah_Chill_Units =</span> Utah_Model,</span>
<span id="cb191-2808"><a href="#cb191-2808" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Chill_Portions =</span> Dynamic_Model,</span>
<span id="cb191-2809"><a href="#cb191-2809" aria-hidden="true" tabindex="-1"></a>                          <span class="at">GDH =</span> GDH)</span>
<span id="cb191-2810"><a href="#cb191-2810" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb191-2811"><a href="#cb191-2811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2812"><a href="#cb191-2812" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(daychill<span class="sc">$</span>daily_chill)</span>
<span id="cb191-2813"><a href="#cb191-2813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2814"><a href="#cb191-2814" aria-hidden="true" tabindex="-1"></a>dc <span class="ot">&lt;-</span> <span class="fu">make_daily_chill_plot2</span>(daychill,</span>
<span id="cb191-2815"><a href="#cb191-2815" aria-hidden="true" tabindex="-1"></a>                             <span class="at">metrics =</span> <span class="fu">c</span>(<span class="st">&quot;Chill_Portions&quot;</span>),</span>
<span id="cb191-2816"><a href="#cb191-2816" aria-hidden="true" tabindex="-1"></a>                             <span class="at">cumulative =</span> <span class="cn">FALSE</span>,</span>
<span id="cb191-2817"><a href="#cb191-2817" aria-hidden="true" tabindex="-1"></a>                             <span class="at">startdate =</span> <span class="dv">300</span>,</span>
<span id="cb191-2818"><a href="#cb191-2818" aria-hidden="true" tabindex="-1"></a>                             <span class="at">enddate =</span> <span class="dv">30</span>,</span>
<span id="cb191-2819"><a href="#cb191-2819" aria-hidden="true" tabindex="-1"></a>                             <span class="at">focusyears =</span> <span class="fu">c</span>(<span class="dv">2008</span>,<span class="dv">2018</span>), </span>
<span id="cb191-2820"><a href="#cb191-2820" aria-hidden="true" tabindex="-1"></a>                             <span class="at">metriclabels =</span> <span class="st">&quot;Chill Portions&quot;</span>)</span>
<span id="cb191-2821"><a href="#cb191-2821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2822"><a href="#cb191-2822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2823"><a href="#cb191-2823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2824"><a href="#cb191-2824" aria-hidden="true" tabindex="-1"></a>dc <span class="ot">&lt;-</span> <span class="fu">make_daily_chill_plot2</span>(daychill,</span>
<span id="cb191-2825"><a href="#cb191-2825" aria-hidden="true" tabindex="-1"></a>                             <span class="at">metrics =</span> <span class="fu">c</span>(<span class="st">&quot;Chill_Portions&quot;</span>),</span>
<span id="cb191-2826"><a href="#cb191-2826" aria-hidden="true" tabindex="-1"></a>                             <span class="at">cumulative =</span> <span class="cn">TRUE</span>,</span>
<span id="cb191-2827"><a href="#cb191-2827" aria-hidden="true" tabindex="-1"></a>                             <span class="at">startdate =</span> <span class="dv">300</span>,</span>
<span id="cb191-2828"><a href="#cb191-2828" aria-hidden="true" tabindex="-1"></a>                             <span class="at">enddate =</span> <span class="dv">30</span>,</span>
<span id="cb191-2829"><a href="#cb191-2829" aria-hidden="true" tabindex="-1"></a>                             <span class="at">focusyears =</span> <span class="fu">c</span>(<span class="dv">2008</span>),</span>
<span id="cb191-2830"><a href="#cb191-2830" aria-hidden="true" tabindex="-1"></a>                             <span class="at">metriclabels =</span> <span class="st">&quot;Chill Portions&quot;</span>)</span>
<span id="cb191-2831"><a href="#cb191-2831" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb191-2832"><a href="#cb191-2832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2833"><a href="#cb191-2833" aria-hidden="true" tabindex="-1"></a>Roter_Boskoop <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Roter_Boskoop_bloom_1958_2019.csv.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb191-2834"><a href="#cb191-2834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, First_bloom) <span class="sc">%&gt;%</span></span>
<span id="cb191-2835"><a href="#cb191-2835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">1</span>, <span class="dv">4</span>)),</span>
<span id="cb191-2836"><a href="#cb191-2836" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">5</span>, <span class="dv">6</span>)),</span>
<span id="cb191-2837"><a href="#cb191-2837" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">7</span>, <span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb191-2838"><a href="#cb191-2838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_JDay</span>() <span class="sc">%&gt;%</span></span>
<span id="cb191-2839"><a href="#cb191-2839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, </span>
<span id="cb191-2840"><a href="#cb191-2840" aria-hidden="true" tabindex="-1"></a>         JDay) <span class="sc">%&gt;%</span></span>
<span id="cb191-2841"><a href="#cb191-2841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Year =</span> Pheno_year,</span>
<span id="cb191-2842"><a href="#cb191-2842" aria-hidden="true" tabindex="-1"></a>         <span class="at">pheno =</span> JDay) </span>
<span id="cb191-2843"><a href="#cb191-2843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2844"><a href="#cb191-2844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2845"><a href="#cb191-2845" aria-hidden="true" tabindex="-1"></a>plscf <span class="ot">&lt;-</span> <span class="fu">PLS_chill_force</span>(<span class="at">daily_chill_obj =</span> daychill,</span>
<span id="cb191-2846"><a href="#cb191-2846" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bio_data_frame =</span> Roter_Boskoop,</span>
<span id="cb191-2847"><a href="#cb191-2847" aria-hidden="true" tabindex="-1"></a>                         <span class="at">split_month =</span> <span class="dv">6</span>,</span>
<span id="cb191-2848"><a href="#cb191-2848" aria-hidden="true" tabindex="-1"></a>                         <span class="at">chill_models =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb191-2849"><a href="#cb191-2849" aria-hidden="true" tabindex="-1"></a>                         <span class="at">heat_models =</span> <span class="st">&quot;GDH&quot;</span>)</span>
<span id="cb191-2850"><a href="#cb191-2850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2851"><a href="#cb191-2851" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(plscf<span class="sc">$</span>Chill_Portions<span class="sc">$</span>GDH<span class="sc">$</span>PLS_summary)</span>
<span id="cb191-2852"><a href="#cb191-2852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2853"><a href="#cb191-2853" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-2854"><a href="#cb191-2854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2855"><a href="#cb191-2855" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Run PLS_chill_force analyses for all three major chill models. Delineate your best estimates of chilling and forcing phases for all of them.</span>
<span id="cb191-2856"><a href="#cb191-2856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2857"><a href="#cb191-2857" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-2858"><a href="#cb191-2858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2859"><a href="#cb191-2859" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-2860"><a href="#cb191-2860" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS</span>(plscf,</span>
<span id="cb191-2861"><a href="#cb191-2861" aria-hidden="true" tabindex="-1"></a>         <span class="at">PLS_results_path =</span> <span class="st">&quot;data_New_York/plscf_outputs_NY&quot;</span>)</span>
<span id="cb191-2862"><a href="#cb191-2862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2863"><a href="#cb191-2863" aria-hidden="true" tabindex="-1"></a>plscf <span class="ot">&lt;-</span> <span class="fu">PLS_chill_force</span>(<span class="at">daily_chill_obj =</span> daychill,</span>
<span id="cb191-2864"><a href="#cb191-2864" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bio_data_frame =</span> Roter_Boskoop,</span>
<span id="cb191-2865"><a href="#cb191-2865" aria-hidden="true" tabindex="-1"></a>                         <span class="at">split_month =</span> <span class="dv">6</span>,</span>
<span id="cb191-2866"><a href="#cb191-2866" aria-hidden="true" tabindex="-1"></a>                         <span class="at">chill_models =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb191-2867"><a href="#cb191-2867" aria-hidden="true" tabindex="-1"></a>                         <span class="at">heat_models =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb191-2868"><a href="#cb191-2868" aria-hidden="true" tabindex="-1"></a>                         <span class="at">runn_means =</span> <span class="dv">11</span>)</span>
<span id="cb191-2869"><a href="#cb191-2869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2870"><a href="#cb191-2870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2871"><a href="#cb191-2871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2872"><a href="#cb191-2872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2873"><a href="#cb191-2873" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS</span>(plscf,</span>
<span id="cb191-2874"><a href="#cb191-2874" aria-hidden="true" tabindex="-1"></a>         <span class="at">PLS_results_path =</span> <span class="st">&quot;data_New_York/plscf_outputs_NY_11days&quot;</span>)</span>
<span id="cb191-2875"><a href="#cb191-2875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2876"><a href="#cb191-2876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2877"><a href="#cb191-2877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2878"><a href="#cb191-2878" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS</span>(plscf,</span>
<span id="cb191-2879"><a href="#cb191-2879" aria-hidden="true" tabindex="-1"></a>         <span class="at">PLS_results_path =</span> <span class="st">&quot;data_New_York/plscf_outputs_NY_11days_periods&quot;</span>,</span>
<span id="cb191-2880"><a href="#cb191-2880" aria-hidden="true" tabindex="-1"></a>         <span class="at">add_chill =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>,<span class="dv">62</span>),</span>
<span id="cb191-2881"><a href="#cb191-2881" aria-hidden="true" tabindex="-1"></a>         <span class="at">add_heat =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="fl">105.5</span>))</span>
<span id="cb191-2882"><a href="#cb191-2882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2883"><a href="#cb191-2883" aria-hidden="true" tabindex="-1"></a>PLS_gg <span class="ot">&lt;-</span> plscf<span class="sc">$</span>Chill_Portions<span class="sc">$</span>GDH<span class="sc">$</span>PLS_summary <span class="sc">%&gt;%</span></span>
<span id="cb191-2884"><a href="#cb191-2884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">trunc</span>(Date<span class="sc">/</span><span class="dv">100</span>),</span>
<span id="cb191-2885"><a href="#cb191-2885" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> Date <span class="sc">-</span> Month <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb191-2886"><a href="#cb191-2886" aria-hidden="true" tabindex="-1"></a>         <span class="at">Date =</span> <span class="fu">ISOdate</span>(<span class="dv">2002</span>,</span>
<span id="cb191-2887"><a href="#cb191-2887" aria-hidden="true" tabindex="-1"></a>                        Month,</span>
<span id="cb191-2888"><a href="#cb191-2888" aria-hidden="true" tabindex="-1"></a>                        Day))</span>
<span id="cb191-2889"><a href="#cb191-2889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2890"><a href="#cb191-2890" aria-hidden="true" tabindex="-1"></a>PLS_gg[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>,<span class="st">&quot;Date&quot;</span>]<span class="ot">&lt;-</span></span>
<span id="cb191-2891"><a href="#cb191-2891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-2892"><a href="#cb191-2892" aria-hidden="true" tabindex="-1"></a>          PLS_gg<span class="sc">$</span>Month[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>],</span>
<span id="cb191-2893"><a href="#cb191-2893" aria-hidden="true" tabindex="-1"></a>          PLS_gg<span class="sc">$</span>Day[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>])</span>
<span id="cb191-2894"><a href="#cb191-2894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2895"><a href="#cb191-2895" aria-hidden="true" tabindex="-1"></a>PLS_gg <span class="ot">&lt;-</span> PLS_gg <span class="sc">%&gt;%</span></span>
<span id="cb191-2896"><a href="#cb191-2896" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VIP_importance =</span> VIP <span class="sc">&gt;=</span> <span class="fl">0.8</span>,</span>
<span id="cb191-2897"><a href="#cb191-2897" aria-hidden="true" tabindex="-1"></a>         <span class="at">VIP_Coeff =</span> <span class="fu">factor</span>(<span class="fu">sign</span>(Coef) <span class="sc">*</span> VIP_importance))</span>
<span id="cb191-2898"><a href="#cb191-2898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2899"><a href="#cb191-2899" aria-hidden="true" tabindex="-1"></a>chill_start_JDay <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">48</span></span>
<span id="cb191-2900"><a href="#cb191-2900" aria-hidden="true" tabindex="-1"></a>chill_end_JDay <span class="ot">&lt;-</span> <span class="dv">62</span></span>
<span id="cb191-2901"><a href="#cb191-2901" aria-hidden="true" tabindex="-1"></a>heat_start_JDay <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">5</span></span>
<span id="cb191-2902"><a href="#cb191-2902" aria-hidden="true" tabindex="-1"></a>heat_end_JDay <span class="ot">&lt;-</span> <span class="fl">105.5</span></span>
<span id="cb191-2903"><a href="#cb191-2903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2904"><a href="#cb191-2904" aria-hidden="true" tabindex="-1"></a>chill_start_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-2905"><a href="#cb191-2905" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb191-2906"><a href="#cb191-2906" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> chill_start_JDay <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb191-2907"><a href="#cb191-2907" aria-hidden="true" tabindex="-1"></a>chill_end_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-2908"><a href="#cb191-2908" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb191-2909"><a href="#cb191-2909" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span> chill_end_JDay <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb191-2910"><a href="#cb191-2910" aria-hidden="true" tabindex="-1"></a>heat_start_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-2911"><a href="#cb191-2911" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">12</span>,</span>
<span id="cb191-2912"><a href="#cb191-2912" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">31</span>) <span class="sc">+</span> heat_start_JDay <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb191-2913"><a href="#cb191-2913" aria-hidden="true" tabindex="-1"></a>heat_end_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-2914"><a href="#cb191-2914" aria-hidden="true" tabindex="-1"></a>                         <span class="dv">12</span>,</span>
<span id="cb191-2915"><a href="#cb191-2915" aria-hidden="true" tabindex="-1"></a>                         <span class="dv">31</span>) <span class="sc">+</span> heat_end_JDay <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb191-2916"><a href="#cb191-2916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2917"><a href="#cb191-2917" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb191-2918"><a href="#cb191-2918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2919"><a href="#cb191-2919" aria-hidden="true" tabindex="-1"></a>temp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb191-2920"><a href="#cb191-2920" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> Date) <span class="sc">+</span></span>
<span id="cb191-2921"><a href="#cb191-2921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-2922"><a href="#cb191-2922" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb191-2923"><a href="#cb191-2923" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb191-2924"><a href="#cb191-2924" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-2925"><a href="#cb191-2925" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-2926"><a href="#cb191-2926" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-2927"><a href="#cb191-2927" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2928"><a href="#cb191-2928" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-2929"><a href="#cb191-2929" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb191-2930"><a href="#cb191-2930" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb191-2931"><a href="#cb191-2931" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-2932"><a href="#cb191-2932" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-2933"><a href="#cb191-2933" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-2934"><a href="#cb191-2934" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2935"><a href="#cb191-2935" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-2936"><a href="#cb191-2936" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-2937"><a href="#cb191-2937" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb191-2938"><a href="#cb191-2938" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb191-2939"><a href="#cb191-2939" aria-hidden="true" tabindex="-1"></a>             <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-2940"><a href="#cb191-2940" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-2941"><a href="#cb191-2941" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-2942"><a href="#cb191-2942" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb191-2943"><a href="#cb191-2943" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb191-2944"><a href="#cb191-2944" aria-hidden="true" tabindex="-1"></a>             <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-2945"><a href="#cb191-2945" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-2946"><a href="#cb191-2946" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-2947"><a href="#cb191-2947" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-2948"><a href="#cb191-2948" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-2949"><a href="#cb191-2949" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2950"><a href="#cb191-2950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-2951"><a href="#cb191-2951" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">12</span>,</span>
<span id="cb191-2952"><a href="#cb191-2952" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb191-2953"><a href="#cb191-2953" aria-hidden="true" tabindex="-1"></a>               <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-2954"><a href="#cb191-2954" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-2955"><a href="#cb191-2955" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2956"><a href="#cb191-2956" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2957"><a href="#cb191-2957" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev ,</span>
<span id="cb191-2958"><a href="#cb191-2958" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev),</span>
<span id="cb191-2959"><a href="#cb191-2959" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2960"><a href="#cb191-2960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2961"><a href="#cb191-2961" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb191-2962"><a href="#cb191-2962" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb191-2963"><a href="#cb191-2963" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2964"><a href="#cb191-2964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2965"><a href="#cb191-2965" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb191-2966"><a href="#cb191-2966" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>)),</span>
<span id="cb191-2967"><a href="#cb191-2967" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;dark green&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2968"><a href="#cb191-2968" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2969"><a href="#cb191-2969" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> MetricMean ))</span>
<span id="cb191-2970"><a href="#cb191-2970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2971"><a href="#cb191-2971" aria-hidden="true" tabindex="-1"></a>temp_plot</span>
<span id="cb191-2972"><a href="#cb191-2972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2973"><a href="#cb191-2973" aria-hidden="true" tabindex="-1"></a>temp_plot <span class="ot">&lt;-</span> temp_plot <span class="sc">+</span></span>
<span id="cb191-2974"><a href="#cb191-2974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type),</span>
<span id="cb191-2975"><a href="#cb191-2975" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>,</span>
<span id="cb191-2976"><a href="#cb191-2976" aria-hidden="true" tabindex="-1"></a>             <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb191-2977"><a href="#cb191-2977" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span></span>
<span id="cb191-2978"><a href="#cb191-2978" aria-hidden="true" tabindex="-1"></a>               <span class="fu">labeller</span>(<span class="at">Type =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb191-2979"><a href="#cb191-2979" aria-hidden="true" tabindex="-1"></a>               <span class="fu">c</span>(<span class="at">Chill =</span> <span class="st">&quot;Chill (CP)&quot;</span>,</span>
<span id="cb191-2980"><a href="#cb191-2980" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Heat =</span> <span class="st">&quot;Heat (GDH)&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb191-2981"><a href="#cb191-2981" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Daily chill and heat accumulation rates&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-2982"><a href="#cb191-2982" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb191-2983"><a href="#cb191-2983" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-2984"><a href="#cb191-2984" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb191-2985"><a href="#cb191-2985" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span><span class="dv">12</span>),</span>
<span id="cb191-2986"><a href="#cb191-2986" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb191-2987"><a href="#cb191-2987" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb191-2988"><a href="#cb191-2988" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb191-2989"><a href="#cb191-2989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2990"><a href="#cb191-2990" aria-hidden="true" tabindex="-1"></a>temp_plot</span>
<span id="cb191-2991"><a href="#cb191-2991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2992"><a href="#cb191-2992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2993"><a href="#cb191-2993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2994"><a href="#cb191-2994" aria-hidden="true" tabindex="-1"></a>VIP_plot<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb191-2995"><a href="#cb191-2995" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-2996"><a href="#cb191-2996" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> VIP)) <span class="sc">+</span></span>
<span id="cb191-2997"><a href="#cb191-2997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-2998"><a href="#cb191-2998" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb191-2999"><a href="#cb191-2999" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb191-3000"><a href="#cb191-3000" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3001"><a href="#cb191-3001" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3002"><a href="#cb191-3002" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3003"><a href="#cb191-3003" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3004"><a href="#cb191-3004" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3005"><a href="#cb191-3005" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb191-3006"><a href="#cb191-3006" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb191-3007"><a href="#cb191-3007" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3008"><a href="#cb191-3008" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3009"><a href="#cb191-3009" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3010"><a href="#cb191-3010" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3011"><a href="#cb191-3011" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3012"><a href="#cb191-3012" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3013"><a href="#cb191-3013" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb191-3014"><a href="#cb191-3014" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb191-3015"><a href="#cb191-3015" aria-hidden="true" tabindex="-1"></a>             <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3016"><a href="#cb191-3016" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3017"><a href="#cb191-3017" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3018"><a href="#cb191-3018" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb191-3019"><a href="#cb191-3019" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb191-3020"><a href="#cb191-3020" aria-hidden="true" tabindex="-1"></a>             <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3021"><a href="#cb191-3021" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3022"><a href="#cb191-3022" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3023"><a href="#cb191-3023" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3024"><a href="#cb191-3024" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3025"><a href="#cb191-3025" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3026"><a href="#cb191-3026" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3027"><a href="#cb191-3027" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">12</span>,</span>
<span id="cb191-3028"><a href="#cb191-3028" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb191-3029"><a href="#cb191-3029" aria-hidden="true" tabindex="-1"></a>               <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3030"><a href="#cb191-3030" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3031"><a href="#cb191-3031" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3032"><a href="#cb191-3032" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb191-3033"><a href="#cb191-3033" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">fill =</span> VIP <span class="sc">&gt;</span> <span class="fl">0.8</span>))</span>
<span id="cb191-3034"><a href="#cb191-3034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3035"><a href="#cb191-3035" aria-hidden="true" tabindex="-1"></a>VIP_plot</span>
<span id="cb191-3036"><a href="#cb191-3036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3037"><a href="#cb191-3037" aria-hidden="true" tabindex="-1"></a>VIP_plot <span class="ot">&lt;-</span> VIP_plot <span class="sc">+</span> </span>
<span id="cb191-3038"><a href="#cb191-3038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type),</span>
<span id="cb191-3039"><a href="#cb191-3039" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb191-3040"><a href="#cb191-3040" aria-hidden="true" tabindex="-1"></a>             <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb191-3041"><a href="#cb191-3041" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> </span>
<span id="cb191-3042"><a href="#cb191-3042" aria-hidden="true" tabindex="-1"></a>               <span class="fu">labeller</span>(<span class="at">Type =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb191-3043"><a href="#cb191-3043" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(<span class="at">Chill =</span> <span class="st">&quot;VIP for chill&quot;</span>,</span>
<span id="cb191-3044"><a href="#cb191-3044" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Heat =</span> <span class="st">&quot;VIP for heat&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb191-3045"><a href="#cb191-3045" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb191-3046"><a href="#cb191-3046" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,</span>
<span id="cb191-3047"><a href="#cb191-3047" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(plscf<span class="sc">$</span>Chill_Portions<span class="sc">$</span>GDH<span class="sc">$</span>PLS_summary<span class="sc">$</span>VIP))) <span class="sc">+</span></span>
<span id="cb191-3048"><a href="#cb191-3048" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Variable Importance in the Projection (VIP) scores&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3049"><a href="#cb191-3049" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb191-3050"><a href="#cb191-3050" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3051"><a href="#cb191-3051" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb191-3052"><a href="#cb191-3052" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb191-3053"><a href="#cb191-3053" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb191-3054"><a href="#cb191-3054" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb191-3055"><a href="#cb191-3055" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb191-3056"><a href="#cb191-3056" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3057"><a href="#cb191-3057" aria-hidden="true" tabindex="-1"></a>VIP_plot</span>
<span id="cb191-3058"><a href="#cb191-3058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3059"><a href="#cb191-3059" aria-hidden="true" tabindex="-1"></a>VIP_plot <span class="ot">&lt;-</span> VIP_plot <span class="sc">+</span></span>
<span id="cb191-3060"><a href="#cb191-3060" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;VIP&quot;</span>, </span>
<span id="cb191-3061"><a href="#cb191-3061" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;0.8&quot;</span>, <span class="st">&quot;&gt;0.8&quot;</span>), </span>
<span id="cb191-3062"><a href="#cb191-3062" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;FALSE&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb191-3063"><a href="#cb191-3063" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;TRUE&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb191-3064"><a href="#cb191-3064" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3065"><a href="#cb191-3065" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3066"><a href="#cb191-3066" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3067"><a href="#cb191-3067" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb191-3068"><a href="#cb191-3068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3069"><a href="#cb191-3069" aria-hidden="true" tabindex="-1"></a>VIP_plot</span>
<span id="cb191-3070"><a href="#cb191-3070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3071"><a href="#cb191-3071" aria-hidden="true" tabindex="-1"></a>coeff_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb191-3072"><a href="#cb191-3072" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-3073"><a href="#cb191-3073" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> Coef)) <span class="sc">+</span></span>
<span id="cb191-3074"><a href="#cb191-3074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3075"><a href="#cb191-3075" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb191-3076"><a href="#cb191-3076" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb191-3077"><a href="#cb191-3077" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3078"><a href="#cb191-3078" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3079"><a href="#cb191-3079" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3080"><a href="#cb191-3080" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3081"><a href="#cb191-3081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3082"><a href="#cb191-3082" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb191-3083"><a href="#cb191-3083" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb191-3084"><a href="#cb191-3084" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3085"><a href="#cb191-3085" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3086"><a href="#cb191-3086" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3087"><a href="#cb191-3087" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3088"><a href="#cb191-3088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3089"><a href="#cb191-3089" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3090"><a href="#cb191-3090" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb191-3091"><a href="#cb191-3091" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb191-3092"><a href="#cb191-3092" aria-hidden="true" tabindex="-1"></a>             <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3093"><a href="#cb191-3093" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3094"><a href="#cb191-3094" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3095"><a href="#cb191-3095" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">12</span>,</span>
<span id="cb191-3096"><a href="#cb191-3096" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb191-3097"><a href="#cb191-3097" aria-hidden="true" tabindex="-1"></a>             <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3098"><a href="#cb191-3098" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3099"><a href="#cb191-3099" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3100"><a href="#cb191-3100" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3101"><a href="#cb191-3101" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3102"><a href="#cb191-3102" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3103"><a href="#cb191-3103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3104"><a href="#cb191-3104" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">12</span>,</span>
<span id="cb191-3105"><a href="#cb191-3105" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb191-3106"><a href="#cb191-3106" aria-hidden="true" tabindex="-1"></a>               <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3107"><a href="#cb191-3107" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3108"><a href="#cb191-3108" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3109"><a href="#cb191-3109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb191-3110"><a href="#cb191-3110" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">fill =</span> VIP_Coeff))</span>
<span id="cb191-3111"><a href="#cb191-3111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3112"><a href="#cb191-3112" aria-hidden="true" tabindex="-1"></a>coeff_plot</span>
<span id="cb191-3113"><a href="#cb191-3113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3114"><a href="#cb191-3114" aria-hidden="true" tabindex="-1"></a>coeff_plot <span class="ot">&lt;-</span> coeff_plot <span class="sc">+</span></span>
<span id="cb191-3115"><a href="#cb191-3115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type),</span>
<span id="cb191-3116"><a href="#cb191-3116" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb191-3117"><a href="#cb191-3117" aria-hidden="true" tabindex="-1"></a>             <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb191-3118"><a href="#cb191-3118" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span></span>
<span id="cb191-3119"><a href="#cb191-3119" aria-hidden="true" tabindex="-1"></a>               <span class="fu">labeller</span>(</span>
<span id="cb191-3120"><a href="#cb191-3120" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Type =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb191-3121"><a href="#cb191-3121" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="at">Chill =</span> <span class="st">&quot;MC for chill&quot;</span>,</span>
<span id="cb191-3122"><a href="#cb191-3122" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Heat =</span> <span class="st">&quot;MC for heat&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb191-3123"><a href="#cb191-3123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb191-3124"><a href="#cb191-3124" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">min</span>(plscf<span class="sc">$</span>Chill_Portions<span class="sc">$</span>GDH<span class="sc">$</span>PLS_summary<span class="sc">$</span>Coef),</span>
<span id="cb191-3125"><a href="#cb191-3125" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(plscf<span class="sc">$</span>Chill_Portions<span class="sc">$</span>GDH<span class="sc">$</span>PLS_summary<span class="sc">$</span>Coef))) <span class="sc">+</span></span>
<span id="cb191-3126"><a href="#cb191-3126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Model coefficients (MC)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3127"><a href="#cb191-3127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb191-3128"><a href="#cb191-3128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3129"><a href="#cb191-3129" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb191-3130"><a href="#cb191-3130" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb191-3131"><a href="#cb191-3131" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb191-3132"><a href="#cb191-3132" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb191-3133"><a href="#cb191-3133" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb191-3134"><a href="#cb191-3134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3135"><a href="#cb191-3135" aria-hidden="true" tabindex="-1"></a>coeff_plot </span>
<span id="cb191-3136"><a href="#cb191-3136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3137"><a href="#cb191-3137" aria-hidden="true" tabindex="-1"></a>coeff_plot <span class="ot">&lt;-</span> coeff_plot <span class="sc">+</span>  </span>
<span id="cb191-3138"><a href="#cb191-3138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">&quot;Effect direction&quot;</span>, </span>
<span id="cb191-3139"><a href="#cb191-3139" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Advancing&quot;</span>,</span>
<span id="cb191-3140"><a href="#cb191-3140" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Unimportant&quot;</span>,</span>
<span id="cb191-3141"><a href="#cb191-3141" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Delaying&quot;</span>), </span>
<span id="cb191-3142"><a href="#cb191-3142" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;-1&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb191-3143"><a href="#cb191-3143" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb191-3144"><a href="#cb191-3144" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;dark green&quot;</span>)) <span class="sc">+</span></span>
<span id="cb191-3145"><a href="#cb191-3145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;PLS coefficient&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3146"><a href="#cb191-3146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3147"><a href="#cb191-3147" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3148"><a href="#cb191-3148" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3149"><a href="#cb191-3149" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb191-3150"><a href="#cb191-3150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3151"><a href="#cb191-3151" aria-hidden="true" tabindex="-1"></a>coeff_plot</span>
<span id="cb191-3152"><a href="#cb191-3152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3153"><a href="#cb191-3153" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb191-3154"><a href="#cb191-3154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3155"><a href="#cb191-3155" aria-hidden="true" tabindex="-1"></a>plot<span class="ot">&lt;-</span> (VIP_plot <span class="sc">+</span></span>
<span id="cb191-3156"><a href="#cb191-3156" aria-hidden="true" tabindex="-1"></a>          coeff_plot <span class="sc">+</span></span>
<span id="cb191-3157"><a href="#cb191-3157" aria-hidden="true" tabindex="-1"></a>          temp_plot <span class="sc">+</span></span>
<span id="cb191-3158"><a href="#cb191-3158" aria-hidden="true" tabindex="-1"></a>          <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb191-3159"><a href="#cb191-3159" aria-hidden="true" tabindex="-1"></a>            <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>)</span>
<span id="cb191-3160"><a href="#cb191-3160" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb191-3161"><a href="#cb191-3161" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb191-3162"><a href="#cb191-3162" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb191-3163"><a href="#cb191-3163" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb191-3164"><a href="#cb191-3164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3165"><a href="#cb191-3165" aria-hidden="true" tabindex="-1"></a>plot</span>
<span id="cb191-3166"><a href="#cb191-3166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3167"><a href="#cb191-3167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3168"><a href="#cb191-3168" aria-hidden="true" tabindex="-1"></a>plot_PLS_chill_force <span class="ot">&lt;-</span> <span class="cf">function</span>(plscf,</span>
<span id="cb191-3169"><a href="#cb191-3169" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">chill_metric =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb191-3170"><a href="#cb191-3170" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">heat_metric =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb191-3171"><a href="#cb191-3171" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">chill_label =</span> <span class="st">&quot;CP&quot;</span>,</span>
<span id="cb191-3172"><a href="#cb191-3172" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">heat_label =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb191-3173"><a href="#cb191-3173" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">chill_phase =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">48</span>, <span class="dv">62</span>),</span>
<span id="cb191-3174"><a href="#cb191-3174" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">heat_phase =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="fl">105.5</span>))</span>
<span id="cb191-3175"><a href="#cb191-3175" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb191-3176"><a href="#cb191-3176" aria-hidden="true" tabindex="-1"></a>  PLS_gg <span class="ot">&lt;-</span> plscf[[chill_metric]][[heat_metric]]<span class="sc">$</span>PLS_summary <span class="sc">%&gt;%</span></span>
<span id="cb191-3177"><a href="#cb191-3177" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">trunc</span>(Date<span class="sc">/</span><span class="dv">100</span>),</span>
<span id="cb191-3178"><a href="#cb191-3178" aria-hidden="true" tabindex="-1"></a>           <span class="at">Day =</span> Date <span class="sc">-</span> Month <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb191-3179"><a href="#cb191-3179" aria-hidden="true" tabindex="-1"></a>           <span class="at">Date =</span> <span class="fu">ISOdate</span>(<span class="dv">2002</span>,</span>
<span id="cb191-3180"><a href="#cb191-3180" aria-hidden="true" tabindex="-1"></a>                          Month,</span>
<span id="cb191-3181"><a href="#cb191-3181" aria-hidden="true" tabindex="-1"></a>                          Day))</span>
<span id="cb191-3182"><a href="#cb191-3182" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3183"><a href="#cb191-3183" aria-hidden="true" tabindex="-1"></a>  PLS_gg[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>,<span class="st">&quot;Date&quot;</span>]<span class="ot">&lt;-</span></span>
<span id="cb191-3184"><a href="#cb191-3184" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3185"><a href="#cb191-3185" aria-hidden="true" tabindex="-1"></a>            PLS_gg<span class="sc">$</span>Month[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>],</span>
<span id="cb191-3186"><a href="#cb191-3186" aria-hidden="true" tabindex="-1"></a>            PLS_gg<span class="sc">$</span>Day[PLS_gg<span class="sc">$</span>JDay <span class="sc">&lt;=</span> <span class="dv">0</span>])</span>
<span id="cb191-3187"><a href="#cb191-3187" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3188"><a href="#cb191-3188" aria-hidden="true" tabindex="-1"></a>  PLS_gg <span class="ot">&lt;-</span> PLS_gg <span class="sc">%&gt;%</span></span>
<span id="cb191-3189"><a href="#cb191-3189" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">VIP_importance =</span> VIP <span class="sc">&gt;=</span> <span class="fl">0.8</span>,</span>
<span id="cb191-3190"><a href="#cb191-3190" aria-hidden="true" tabindex="-1"></a>           <span class="at">VIP_Coeff =</span> <span class="fu">factor</span>(<span class="fu">sign</span>(Coef) <span class="sc">*</span> VIP_importance))</span>
<span id="cb191-3191"><a href="#cb191-3191" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3192"><a href="#cb191-3192" aria-hidden="true" tabindex="-1"></a>  chill_start_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3193"><a href="#cb191-3193" aria-hidden="true" tabindex="-1"></a>                              <span class="dv">12</span>,</span>
<span id="cb191-3194"><a href="#cb191-3194" aria-hidden="true" tabindex="-1"></a>                              <span class="dv">31</span>) <span class="sc">+</span> chill_phase[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb191-3195"><a href="#cb191-3195" aria-hidden="true" tabindex="-1"></a>  chill_end_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3196"><a href="#cb191-3196" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb191-3197"><a href="#cb191-3197" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> chill_phase[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb191-3198"><a href="#cb191-3198" aria-hidden="true" tabindex="-1"></a>  heat_start_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3199"><a href="#cb191-3199" aria-hidden="true" tabindex="-1"></a>                             <span class="dv">12</span>,</span>
<span id="cb191-3200"><a href="#cb191-3200" aria-hidden="true" tabindex="-1"></a>                             <span class="dv">31</span>) <span class="sc">+</span> heat_phase[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb191-3201"><a href="#cb191-3201" aria-hidden="true" tabindex="-1"></a>  heat_end_date <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3202"><a href="#cb191-3202" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">12</span>,</span>
<span id="cb191-3203"><a href="#cb191-3203" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">31</span>) <span class="sc">+</span> heat_phase[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb191-3204"><a href="#cb191-3204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3205"><a href="#cb191-3205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3206"><a href="#cb191-3206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3207"><a href="#cb191-3207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3208"><a href="#cb191-3208" aria-hidden="true" tabindex="-1"></a>  temp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg) <span class="sc">+</span></span>
<span id="cb191-3209"><a href="#cb191-3209" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3210"><a href="#cb191-3210" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb191-3211"><a href="#cb191-3211" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb191-3212"><a href="#cb191-3212" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3213"><a href="#cb191-3213" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3214"><a href="#cb191-3214" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3215"><a href="#cb191-3215" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3216"><a href="#cb191-3216" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3217"><a href="#cb191-3217" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb191-3218"><a href="#cb191-3218" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb191-3219"><a href="#cb191-3219" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3220"><a href="#cb191-3220" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3221"><a href="#cb191-3221" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3222"><a href="#cb191-3222" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3223"><a href="#cb191-3223" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3224"><a href="#cb191-3224" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3225"><a href="#cb191-3225" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb191-3226"><a href="#cb191-3226" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb191-3227"><a href="#cb191-3227" aria-hidden="true" tabindex="-1"></a>               <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3228"><a href="#cb191-3228" aria-hidden="true" tabindex="-1"></a>                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3229"><a href="#cb191-3229" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3230"><a href="#cb191-3230" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb191-3231"><a href="#cb191-3231" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb191-3232"><a href="#cb191-3232" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3233"><a href="#cb191-3233" aria-hidden="true" tabindex="-1"></a>                   <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3234"><a href="#cb191-3234" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3235"><a href="#cb191-3235" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3236"><a href="#cb191-3236" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3237"><a href="#cb191-3237" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3238"><a href="#cb191-3238" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3239"><a href="#cb191-3239" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">12</span>,</span>
<span id="cb191-3240"><a href="#cb191-3240" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">31</span>) <span class="sc">+</span></span>
<span id="cb191-3241"><a href="#cb191-3241" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3242"><a href="#cb191-3242" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3243"><a href="#cb191-3243" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3244"><a href="#cb191-3244" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-3245"><a href="#cb191-3245" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev ,</span>
<span id="cb191-3246"><a href="#cb191-3246" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev ),</span>
<span id="cb191-3247"><a href="#cb191-3247" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3248"><a href="#cb191-3248" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-3249"><a href="#cb191-3249" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb191-3250"><a href="#cb191-3250" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb191-3251"><a href="#cb191-3251" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3252"><a href="#cb191-3252" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-3253"><a href="#cb191-3253" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> MetricMean <span class="sc">-</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb191-3254"><a href="#cb191-3254" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> MetricMean <span class="sc">+</span> MetricStdev <span class="sc">*</span> (VIP_Coeff <span class="sc">==</span> <span class="dv">1</span>)),</span>
<span id="cb191-3255"><a href="#cb191-3255" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">&quot;dark green&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3256"><a href="#cb191-3256" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-3257"><a href="#cb191-3257" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> MetricMean)) <span class="sc">+</span></span>
<span id="cb191-3258"><a href="#cb191-3258" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type),</span>
<span id="cb191-3259"><a href="#cb191-3259" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>,</span>
<span id="cb191-3260"><a href="#cb191-3260" aria-hidden="true" tabindex="-1"></a>               <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb191-3261"><a href="#cb191-3261" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> </span>
<span id="cb191-3262"><a href="#cb191-3262" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">labeller</span>(</span>
<span id="cb191-3263"><a href="#cb191-3263" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Type =</span></span>
<span id="cb191-3264"><a href="#cb191-3264" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="at">Chill =</span> <span class="fu">paste0</span>(<span class="st">&quot;Chill (&quot;</span>,</span>
<span id="cb191-3265"><a href="#cb191-3265" aria-hidden="true" tabindex="-1"></a>                                                  chill_label,</span>
<span id="cb191-3266"><a href="#cb191-3266" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">&quot;)&quot;</span>),</span>
<span id="cb191-3267"><a href="#cb191-3267" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Heat =</span> <span class="fu">paste0</span>(<span class="st">&quot;Heat (&quot;</span>,</span>
<span id="cb191-3268"><a href="#cb191-3268" aria-hidden="true" tabindex="-1"></a>                                                 heat_label,</span>
<span id="cb191-3269"><a href="#cb191-3269" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">&quot;)&quot;</span>))))) <span class="sc">+</span></span>
<span id="cb191-3270"><a href="#cb191-3270" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Daily chill and heat accumulation rates&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3271"><a href="#cb191-3271" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb191-3272"><a href="#cb191-3272" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3273"><a href="#cb191-3273" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb191-3274"><a href="#cb191-3274" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb191-3275"><a href="#cb191-3275" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb191-3276"><a href="#cb191-3276" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb191-3277"><a href="#cb191-3277" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb191-3278"><a href="#cb191-3278" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3279"><a href="#cb191-3279" aria-hidden="true" tabindex="-1"></a>  VIP_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb191-3280"><a href="#cb191-3280" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-3281"><a href="#cb191-3281" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> VIP)) <span class="sc">+</span></span>
<span id="cb191-3282"><a href="#cb191-3282" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3283"><a href="#cb191-3283" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb191-3284"><a href="#cb191-3284" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb191-3285"><a href="#cb191-3285" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3286"><a href="#cb191-3286" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3287"><a href="#cb191-3287" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3288"><a href="#cb191-3288" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3289"><a href="#cb191-3289" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3290"><a href="#cb191-3290" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb191-3291"><a href="#cb191-3291" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb191-3292"><a href="#cb191-3292" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3293"><a href="#cb191-3293" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3294"><a href="#cb191-3294" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3295"><a href="#cb191-3295" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3296"><a href="#cb191-3296" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3297"><a href="#cb191-3297" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3298"><a href="#cb191-3298" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb191-3299"><a href="#cb191-3299" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3300"><a href="#cb191-3300" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3301"><a href="#cb191-3301" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3302"><a href="#cb191-3302" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb191-3303"><a href="#cb191-3303" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3304"><a href="#cb191-3304" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3305"><a href="#cb191-3305" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3306"><a href="#cb191-3306" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3307"><a href="#cb191-3307" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3308"><a href="#cb191-3308" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3309"><a href="#cb191-3309" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3310"><a href="#cb191-3310" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">12</span>,</span>
<span id="cb191-3311"><a href="#cb191-3311" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3312"><a href="#cb191-3312" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3313"><a href="#cb191-3313" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3314"><a href="#cb191-3314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb191-3315"><a href="#cb191-3315" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> VIP<span class="sc">&gt;</span><span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb191-3316"><a href="#cb191-3316" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type), </span>
<span id="cb191-3317"><a href="#cb191-3317" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb191-3318"><a href="#cb191-3318" aria-hidden="true" tabindex="-1"></a>               <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb191-3319"><a href="#cb191-3319" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> </span>
<span id="cb191-3320"><a href="#cb191-3320" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">labeller</span>(</span>
<span id="cb191-3321"><a href="#cb191-3321" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Type =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="at">Chill=</span><span class="st">&quot;VIP for chill&quot;</span>,</span>
<span id="cb191-3322"><a href="#cb191-3322" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">Heat=</span><span class="st">&quot;VIP for heat&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb191-3323"><a href="#cb191-3323" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb191-3324"><a href="#cb191-3324" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,</span>
<span id="cb191-3325"><a href="#cb191-3325" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(plscf[[chill_metric]][[heat_metric]]<span class="sc">$</span>PLS_summary<span class="sc">$</span>VIP))) <span class="sc">+</span></span>
<span id="cb191-3326"><a href="#cb191-3326" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Variable Importance in the Projection (VIP) scores&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3327"><a href="#cb191-3327" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb191-3328"><a href="#cb191-3328" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3329"><a href="#cb191-3329" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb191-3330"><a href="#cb191-3330" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb191-3331"><a href="#cb191-3331" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb191-3332"><a href="#cb191-3332" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb191-3333"><a href="#cb191-3333" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb191-3334"><a href="#cb191-3334" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;VIP&quot;</span>, </span>
<span id="cb191-3335"><a href="#cb191-3335" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;0.8&quot;</span>, <span class="st">&quot;&gt;0.8&quot;</span>), </span>
<span id="cb191-3336"><a href="#cb191-3336" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;FALSE&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb191-3337"><a href="#cb191-3337" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;TRUE&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb191-3338"><a href="#cb191-3338" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3339"><a href="#cb191-3339" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3340"><a href="#cb191-3340" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3341"><a href="#cb191-3341" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb191-3342"><a href="#cb191-3342" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3343"><a href="#cb191-3343" aria-hidden="true" tabindex="-1"></a>  coeff_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PLS_gg,</span>
<span id="cb191-3344"><a href="#cb191-3344" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-3345"><a href="#cb191-3345" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y =</span> Coef)) <span class="sc">+</span></span>
<span id="cb191-3346"><a href="#cb191-3346" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3347"><a href="#cb191-3347" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> chill_start_date,</span>
<span id="cb191-3348"><a href="#cb191-3348" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> chill_end_date,</span>
<span id="cb191-3349"><a href="#cb191-3349" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3350"><a href="#cb191-3350" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3351"><a href="#cb191-3351" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3352"><a href="#cb191-3352" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3353"><a href="#cb191-3353" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3354"><a href="#cb191-3354" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> heat_start_date,</span>
<span id="cb191-3355"><a href="#cb191-3355" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> heat_end_date,</span>
<span id="cb191-3356"><a href="#cb191-3356" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3357"><a href="#cb191-3357" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3358"><a href="#cb191-3358" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3359"><a href="#cb191-3359" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3360"><a href="#cb191-3360" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb191-3361"><a href="#cb191-3361" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3362"><a href="#cb191-3362" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb191-3363"><a href="#cb191-3363" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">min</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3364"><a href="#cb191-3364" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3365"><a href="#cb191-3365" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3366"><a href="#cb191-3366" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">12</span>,</span>
<span id="cb191-3367"><a href="#cb191-3367" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">max</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3368"><a href="#cb191-3368" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3369"><a href="#cb191-3369" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb191-3370"><a href="#cb191-3370" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb191-3371"><a href="#cb191-3371" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb191-3372"><a href="#cb191-3372" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3373"><a href="#cb191-3373" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-3374"><a href="#cb191-3374" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">12</span>,</span>
<span id="cb191-3375"><a href="#cb191-3375" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">31</span>) <span class="sc">+</span> <span class="fu">median</span>(plscf<span class="sc">$</span>pheno<span class="sc">$</span>pheno,</span>
<span id="cb191-3376"><a href="#cb191-3376" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>,</span>
<span id="cb191-3377"><a href="#cb191-3377" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3378"><a href="#cb191-3378" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb191-3379"><a href="#cb191-3379" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> VIP_Coeff)) <span class="sc">+</span></span>
<span id="cb191-3380"><a href="#cb191-3380" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Type),</span>
<span id="cb191-3381"><a href="#cb191-3381" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb191-3382"><a href="#cb191-3382" aria-hidden="true" tabindex="-1"></a>               <span class="at">strip.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb191-3383"><a href="#cb191-3383" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span></span>
<span id="cb191-3384"><a href="#cb191-3384" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">labeller</span>(</span>
<span id="cb191-3385"><a href="#cb191-3385" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Type =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="at">Chill =</span> <span class="st">&quot;MC for chill&quot;</span>,</span>
<span id="cb191-3386"><a href="#cb191-3386" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">Heat =</span> <span class="st">&quot;MC for heat&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb191-3387"><a href="#cb191-3387" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb191-3388"><a href="#cb191-3388" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">min</span>(plscf[[chill_metric]][[heat_metric]]<span class="sc">$</span>PLS_summary<span class="sc">$</span>Coef),</span>
<span id="cb191-3389"><a href="#cb191-3389" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">max</span>(plscf[[chill_metric]][[heat_metric]]<span class="sc">$</span>PLS_summary<span class="sc">$</span>Coef))) <span class="sc">+</span></span>
<span id="cb191-3390"><a href="#cb191-3390" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Model coefficients (MC)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3391"><a href="#cb191-3391" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb191-3392"><a href="#cb191-3392" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3393"><a href="#cb191-3393" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,</span>
<span id="cb191-3394"><a href="#cb191-3394" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb191-3395"><a href="#cb191-3395" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb191-3396"><a href="#cb191-3396" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb191-3397"><a href="#cb191-3397" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb191-3398"><a href="#cb191-3398" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">&quot;Effect direction&quot;</span>, </span>
<span id="cb191-3399"><a href="#cb191-3399" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Advancing&quot;</span>,</span>
<span id="cb191-3400"><a href="#cb191-3400" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Unimportant&quot;</span>,</span>
<span id="cb191-3401"><a href="#cb191-3401" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Delaying&quot;</span>), </span>
<span id="cb191-3402"><a href="#cb191-3402" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;-1&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb191-3403"><a href="#cb191-3403" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb191-3404"><a href="#cb191-3404" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;dark green&quot;</span>)) <span class="sc">+</span></span>
<span id="cb191-3405"><a href="#cb191-3405" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;PLS coefficient&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3406"><a href="#cb191-3406" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3407"><a href="#cb191-3407" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3408"><a href="#cb191-3408" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb191-3409"><a href="#cb191-3409" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb191-3410"><a href="#cb191-3410" aria-hidden="true" tabindex="-1"></a>   <span class="fu">library</span>(patchwork)</span>
<span id="cb191-3411"><a href="#cb191-3411" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3412"><a href="#cb191-3412" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> (VIP_plot <span class="sc">+</span></span>
<span id="cb191-3413"><a href="#cb191-3413" aria-hidden="true" tabindex="-1"></a>             coeff_plot <span class="sc">+</span></span>
<span id="cb191-3414"><a href="#cb191-3414" aria-hidden="true" tabindex="-1"></a>             temp_plot <span class="sc">+</span></span>
<span id="cb191-3415"><a href="#cb191-3415" aria-hidden="true" tabindex="-1"></a>             <span class="fu">plot_layout</span>(<span class="at">ncol=</span><span class="dv">1</span>,</span>
<span id="cb191-3416"><a href="#cb191-3416" aria-hidden="true" tabindex="-1"></a>                         <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>)</span>
<span id="cb191-3417"><a href="#cb191-3417" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb191-3418"><a href="#cb191-3418" aria-hidden="true" tabindex="-1"></a>                     <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb191-3419"><a href="#cb191-3419" aria-hidden="true" tabindex="-1"></a>                     <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb191-3420"><a href="#cb191-3420" aria-hidden="true" tabindex="-1"></a>                     <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb191-3421"><a href="#cb191-3421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3422"><a href="#cb191-3422" aria-hidden="true" tabindex="-1"></a>plot</span>
<span id="cb191-3423"><a href="#cb191-3423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3424"><a href="#cb191-3424" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb191-3425"><a href="#cb191-3425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3426"><a href="#cb191-3426" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS_chill_force</span>(plscf)</span>
<span id="cb191-3427"><a href="#cb191-3427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-3428"><a href="#cb191-3428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3429"><a href="#cb191-3429" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Plot results for all three analyses, including shaded plot areas for the chilling and forcing periods you estimated. </span>
<span id="cb191-3430"><a href="#cb191-3430" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-3431"><a href="#cb191-3431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3432"><a href="#cb191-3432" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-3433"><a href="#cb191-3433" aria-hidden="true" tabindex="-1"></a>daychill <span class="ot">&lt;-</span> <span class="fu">daily_chill</span>(<span class="at">hourtemps =</span> temps_hourly,</span>
<span id="cb191-3434"><a href="#cb191-3434" aria-hidden="true" tabindex="-1"></a>                        <span class="at">running_mean =</span> <span class="dv">11</span>,</span>
<span id="cb191-3435"><a href="#cb191-3435" aria-hidden="true" tabindex="-1"></a>                        <span class="at">models =</span> <span class="fu">list</span>(<span class="at">Chilling_Hours =</span> Chilling_Hours,</span>
<span id="cb191-3436"><a href="#cb191-3436" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">Utah_Chill_Units =</span> Utah_Model,</span>
<span id="cb191-3437"><a href="#cb191-3437" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">Chill_Portions =</span> Dynamic_Model,</span>
<span id="cb191-3438"><a href="#cb191-3438" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">GDH =</span> GDH)</span>
<span id="cb191-3439"><a href="#cb191-3439" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb191-3440"><a href="#cb191-3440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3441"><a href="#cb191-3441" aria-hidden="true" tabindex="-1"></a>plscf <span class="ot">&lt;-</span> <span class="fu">PLS_chill_force</span>(<span class="at">daily_chill_obj =</span> daychill,</span>
<span id="cb191-3442"><a href="#cb191-3442" aria-hidden="true" tabindex="-1"></a>                         <span class="at">bio_data_frame =</span> Roter_Boskoop,</span>
<span id="cb191-3443"><a href="#cb191-3443" aria-hidden="true" tabindex="-1"></a>                         <span class="at">split_month =</span> <span class="dv">6</span>,</span>
<span id="cb191-3444"><a href="#cb191-3444" aria-hidden="true" tabindex="-1"></a>                         <span class="at">chill_models =</span> <span class="fu">c</span>(<span class="st">&quot;Chilling_Hours&quot;</span>,</span>
<span id="cb191-3445"><a href="#cb191-3445" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;Utah_Chill_Units&quot;</span>,</span>
<span id="cb191-3446"><a href="#cb191-3446" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;Chill_Portions&quot;</span>),</span>
<span id="cb191-3447"><a href="#cb191-3447" aria-hidden="true" tabindex="-1"></a>                       <span class="at">heat_models =</span> <span class="fu">c</span>(<span class="st">&quot;GDH&quot;</span>))</span>
<span id="cb191-3448"><a href="#cb191-3448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3449"><a href="#cb191-3449" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS_chill_force</span>(plscf,</span>
<span id="cb191-3450"><a href="#cb191-3450" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_metric =</span> <span class="st">&quot;Chilling_Hours&quot;</span>,</span>
<span id="cb191-3451"><a href="#cb191-3451" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_metric =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb191-3452"><a href="#cb191-3452" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_label =</span> <span class="st">&quot;CH&quot;</span>,</span>
<span id="cb191-3453"><a href="#cb191-3453" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_label =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb191-3454"><a href="#cb191-3454" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_phase =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb191-3455"><a href="#cb191-3455" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_phase =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb191-3456"><a href="#cb191-3456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3457"><a href="#cb191-3457" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS_chill_force</span>(plscf,</span>
<span id="cb191-3458"><a href="#cb191-3458" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_metric =</span> <span class="st">&quot;Utah_Chill_Units&quot;</span>,</span>
<span id="cb191-3459"><a href="#cb191-3459" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_metric =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb191-3460"><a href="#cb191-3460" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_label =</span> <span class="st">&quot;CU&quot;</span>,</span>
<span id="cb191-3461"><a href="#cb191-3461" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_label =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb191-3462"><a href="#cb191-3462" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_phase =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb191-3463"><a href="#cb191-3463" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_phase =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb191-3464"><a href="#cb191-3464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3465"><a href="#cb191-3465" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_PLS_chill_force</span>(plscf,</span>
<span id="cb191-3466"><a href="#cb191-3466" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_metric =</span> <span class="st">&quot;Chill_Portions&quot;</span>,</span>
<span id="cb191-3467"><a href="#cb191-3467" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_metric =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb191-3468"><a href="#cb191-3468" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_label =</span> <span class="st">&quot;CP&quot;</span>,</span>
<span id="cb191-3469"><a href="#cb191-3469" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_label =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb191-3470"><a href="#cb191-3470" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chill_phase =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb191-3471"><a href="#cb191-3471" aria-hidden="true" tabindex="-1"></a>                     <span class="at">heat_phase =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb191-3472"><a href="#cb191-3472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3473"><a href="#cb191-3473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3474"><a href="#cb191-3474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3475"><a href="#cb191-3475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-3476"><a href="#cb191-3476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3477"><a href="#cb191-3477" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-3478"><a href="#cb191-3478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3479"><a href="#cb191-3479" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 24: PLS regression with agroclimatic metrics</span></span>
<span id="cb191-3480"><a href="#cb191-3480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3481"><a href="#cb191-3481" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on examples of PLS regression with agroclimatic metrics***</span></span>
<span id="cb191-3482"><a href="#cb191-3482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3483"><a href="#cb191-3483" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Look across all the PLS results presented above. Can you detect a pattern in where chilling and forcing periods could be delineated clearly, and where this attempt failed?</span>
<span id="cb191-3484"><a href="#cb191-3484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3485"><a href="#cb191-3485" aria-hidden="true" tabindex="-1"></a>PLS regression doesn&#39;t allow easy delineation of temperature response phases, especially when it comes to the chilling period. This problem didnât really go away after replacing temperatures with agroclimatic metrics in the analysis.</span>
<span id="cb191-3486"><a href="#cb191-3486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3487"><a href="#cb191-3487" aria-hidden="true" tabindex="-1"></a>PLS looks responses of a variable to variation in the input variable. This response should be monotonic (bloom date should be positively or negatively correlated with the input variables). The sign of this relationship should not change halfway through the range of the input variables.</span>
<span id="cb191-3488"><a href="#cb191-3488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3489"><a href="#cb191-3489" aria-hidden="true" tabindex="-1"></a>Another prerequisite for a successful PLS regression, is that there needs to be meaningful variation in the signal variables in the first place.</span>
<span id="cb191-3490"><a href="#cb191-3490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3491"><a href="#cb191-3491" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Think about possible reasons for the success or failure of PLS analysis based on agroclimatic metrics. Write down your thoughts.</span>
<span id="cb191-3492"><a href="#cb191-3492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3493"><a href="#cb191-3493" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-3494"><a href="#cb191-3494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3495"><a href="#cb191-3495" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 25: PLS regression with agroclimatic metrics</span></span>
<span id="cb191-3496"><a href="#cb191-3496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3497"><a href="#cb191-3497" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on expected PLS responsiveness***</span></span>
<span id="cb191-3498"><a href="#cb191-3498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3499"><a href="#cb191-3499" aria-hidden="true" tabindex="-1"></a>Produce chill and heat model sensitivity plots for the location you focused on in previous exercises.</span>
<span id="cb191-3500"><a href="#cb191-3500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3501"><a href="#cb191-3501" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-3502"><a href="#cb191-3502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3503"><a href="#cb191-3503" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-3504"><a href="#cb191-3504" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb191-3505"><a href="#cb191-3505" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb191-3506"><a href="#cb191-3506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3507"><a href="#cb191-3507" aria-hidden="true" tabindex="-1"></a>mon <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Month</span></span>
<span id="cb191-3508"><a href="#cb191-3508" aria-hidden="true" tabindex="-1"></a>ndays <span class="ot">&lt;-</span> <span class="dv">31</span> <span class="co"># Number of days per month</span></span>
<span id="cb191-3509"><a href="#cb191-3509" aria-hidden="true" tabindex="-1"></a>tmin <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb191-3510"><a href="#cb191-3510" aria-hidden="true" tabindex="-1"></a>tmax <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb191-3511"><a href="#cb191-3511" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">&lt;-</span> <span class="dv">43</span> <span class="co">#Rochester</span></span>
<span id="cb191-3512"><a href="#cb191-3512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3513"><a href="#cb191-3513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3514"><a href="#cb191-3514" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">make_all_day_table</span>(</span>
<span id="cb191-3515"><a href="#cb191-3515" aria-hidden="true" tabindex="-1"></a>            <span class="fu">data.frame</span>(<span class="at">Year =</span> <span class="fu">c</span>(<span class="dv">2001</span>, <span class="dv">2001</span>),</span>
<span id="cb191-3516"><a href="#cb191-3516" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Month =</span> <span class="fu">c</span>(mon, mon),</span>
<span id="cb191-3517"><a href="#cb191-3517" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Day =</span> <span class="fu">c</span>(<span class="dv">1</span>, ndays),</span>
<span id="cb191-3518"><a href="#cb191-3518" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Tmin =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb191-3519"><a href="#cb191-3519" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Tmax =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb191-3520"><a href="#cb191-3520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Tmin =</span> tmin,</span>
<span id="cb191-3521"><a href="#cb191-3521" aria-hidden="true" tabindex="-1"></a>         <span class="at">Tmax =</span> tmax)</span>
<span id="cb191-3522"><a href="#cb191-3522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3523"><a href="#cb191-3523" aria-hidden="true" tabindex="-1"></a>hourly_temps <span class="ot">&lt;-</span> <span class="fu">stack_hourly_temps</span>(weather,</span>
<span id="cb191-3524"><a href="#cb191-3524" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latitude =</span> latitude)</span>
<span id="cb191-3525"><a href="#cb191-3525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3526"><a href="#cb191-3526" aria-hidden="true" tabindex="-1"></a>CPs <span class="ot">&lt;-</span> <span class="fu">Dynamic_Model</span>(</span>
<span id="cb191-3527"><a href="#cb191-3527" aria-hidden="true" tabindex="-1"></a>     hourly_temps<span class="sc">$</span>hourtemps<span class="sc">$</span>Temp)</span>
<span id="cb191-3528"><a href="#cb191-3528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3529"><a href="#cb191-3529" aria-hidden="true" tabindex="-1"></a>daily_CPs <span class="ot">&lt;-</span> <span class="fu">tail</span>(CPs, <span class="dv">1</span>) <span class="sc">/</span> <span class="fu">nrow</span>(weather)</span>
<span id="cb191-3530"><a href="#cb191-3530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3531"><a href="#cb191-3531" aria-hidden="true" tabindex="-1"></a>daily_CPs <span class="co">#chill portions</span></span>
<span id="cb191-3532"><a href="#cb191-3532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3533"><a href="#cb191-3533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3534"><a href="#cb191-3534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3535"><a href="#cb191-3535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3536"><a href="#cb191-3536" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">&lt;-</span> <span class="fl">43.1</span></span>
<span id="cb191-3537"><a href="#cb191-3537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3538"><a href="#cb191-3538" aria-hidden="true" tabindex="-1"></a>month_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb191-3539"><a href="#cb191-3539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3540"><a href="#cb191-3540" aria-hidden="true" tabindex="-1"></a>Tmins <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">20</span>) <span class="co"># calculate sensitivity for expected temps in winter</span></span>
<span id="cb191-3541"><a href="#cb191-3541" aria-hidden="true" tabindex="-1"></a>Tmaxs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span><span class="sc">:</span><span class="dv">30</span>) <span class="co"># range</span></span>
<span id="cb191-3542"><a href="#cb191-3542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3543"><a href="#cb191-3543" aria-hidden="true" tabindex="-1"></a>mins <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-3544"><a href="#cb191-3544" aria-hidden="true" tabindex="-1"></a>maxs <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-3545"><a href="#cb191-3545" aria-hidden="true" tabindex="-1"></a>CP <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-3546"><a href="#cb191-3546" aria-hidden="true" tabindex="-1"></a>month <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-3547"><a href="#cb191-3547" aria-hidden="true" tabindex="-1"></a>temp_model <span class="ot">&lt;-</span> Dynamic_Model <span class="co"># model for temp</span></span>
<span id="cb191-3548"><a href="#cb191-3548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3549"><a href="#cb191-3549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3550"><a href="#cb191-3550" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(mon <span class="cf">in</span> month_range)</span>
<span id="cb191-3551"><a href="#cb191-3551" aria-hidden="true" tabindex="-1"></a>    {days_month <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>( <span class="co"># number of days in a month</span></span>
<span id="cb191-3552"><a href="#cb191-3552" aria-hidden="true" tabindex="-1"></a>      <span class="fu">difftime</span>( <span class="fu">ISOdate</span>(<span class="dv">2002</span>, <span class="co"># time difference of 31 days</span></span>
<span id="cb191-3553"><a href="#cb191-3553" aria-hidden="true" tabindex="-1"></a>                        mon<span class="sc">+</span><span class="dv">1</span>,</span>
<span id="cb191-3554"><a href="#cb191-3554" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">1</span>),</span>
<span id="cb191-3555"><a href="#cb191-3555" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ISOdate</span>(<span class="dv">2002</span>,</span>
<span id="cb191-3556"><a href="#cb191-3556" aria-hidden="true" tabindex="-1"></a>                        mon,</span>
<span id="cb191-3557"><a href="#cb191-3557" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">1</span>)))</span>
<span id="cb191-3558"><a href="#cb191-3558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3559"><a href="#cb191-3559" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(mon <span class="sc">==</span> <span class="dv">12</span>) days_month <span class="ot">&lt;-</span> <span class="dv">31</span></span>
<span id="cb191-3560"><a href="#cb191-3560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3561"><a href="#cb191-3561" aria-hidden="true" tabindex="-1"></a>    weather <span class="ot">&lt;-</span> <span class="fu">make_all_day_table</span>(</span>
<span id="cb191-3562"><a href="#cb191-3562" aria-hidden="true" tabindex="-1"></a>                <span class="fu">data.frame</span>(<span class="at">Year =</span> <span class="fu">c</span>(<span class="dv">2001</span>, <span class="dv">2001</span>),</span>
<span id="cb191-3563"><a href="#cb191-3563" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Month =</span> <span class="fu">c</span>(mon, mon),</span>
<span id="cb191-3564"><a href="#cb191-3564" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Day =</span> <span class="fu">c</span>(<span class="dv">1</span>, days_month),</span>
<span id="cb191-3565"><a href="#cb191-3565" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Tmin =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb191-3566"><a href="#cb191-3566" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Tmax =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb191-3567"><a href="#cb191-3567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3568"><a href="#cb191-3568" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(tmin <span class="cf">in</span> Tmins)</span>
<span id="cb191-3569"><a href="#cb191-3569" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(tmax <span class="cf">in</span> Tmaxs)</span>
<span id="cb191-3570"><a href="#cb191-3570" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tmax <span class="sc">&gt;=</span> tmin)</span>
<span id="cb191-3571"><a href="#cb191-3571" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb191-3572"><a href="#cb191-3572" aria-hidden="true" tabindex="-1"></a>          hourtemps <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span></span>
<span id="cb191-3573"><a href="#cb191-3573" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">Tmin =</span> tmin,</span>
<span id="cb191-3574"><a href="#cb191-3574" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Tmax =</span> tmax) <span class="sc">%&gt;%</span></span>
<span id="cb191-3575"><a href="#cb191-3575" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stack_hourly_temps</span>(<span class="at">latitude =</span> latitude) <span class="sc">%&gt;%</span></span>
<span id="cb191-3576"><a href="#cb191-3576" aria-hidden="true" tabindex="-1"></a>            <span class="fu">pluck</span>(<span class="st">&quot;hourtemps&quot;</span>, <span class="st">&quot;Temp&quot;</span>)</span>
<span id="cb191-3577"><a href="#cb191-3577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3578"><a href="#cb191-3578" aria-hidden="true" tabindex="-1"></a>          CP <span class="ot">&lt;-</span> <span class="fu">c</span>(CP,</span>
<span id="cb191-3579"><a href="#cb191-3579" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">tail</span>(<span class="fu">do.call</span>(temp_model,</span>
<span id="cb191-3580"><a href="#cb191-3580" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">list</span>(hourtemps)), <span class="dv">1</span>) <span class="sc">/</span></span>
<span id="cb191-3581"><a href="#cb191-3581" aria-hidden="true" tabindex="-1"></a>                    days_month)</span>
<span id="cb191-3582"><a href="#cb191-3582" aria-hidden="true" tabindex="-1"></a>          mins <span class="ot">&lt;-</span> <span class="fu">c</span>(mins, tmin)</span>
<span id="cb191-3583"><a href="#cb191-3583" aria-hidden="true" tabindex="-1"></a>          maxs <span class="ot">&lt;-</span> <span class="fu">c</span>(maxs, tmax)</span>
<span id="cb191-3584"><a href="#cb191-3584" aria-hidden="true" tabindex="-1"></a>          month <span class="ot">&lt;-</span> <span class="fu">c</span>(month, mon)</span>
<span id="cb191-3585"><a href="#cb191-3585" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb191-3586"><a href="#cb191-3586" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb191-3587"><a href="#cb191-3587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3588"><a href="#cb191-3588" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Month =</span> month,</span>
<span id="cb191-3589"><a href="#cb191-3589" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Tmin =</span> mins,</span>
<span id="cb191-3590"><a href="#cb191-3590" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Tmax =</span> maxs,</span>
<span id="cb191-3591"><a href="#cb191-3591" aria-hidden="true" tabindex="-1"></a>                      CP)</span>
<span id="cb191-3592"><a href="#cb191-3592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3593"><a href="#cb191-3593" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> results[<span class="sc">!</span><span class="fu">is.na</span>(results<span class="sc">$</span>Month),</span>
<span id="cb191-3594"><a href="#cb191-3594" aria-hidden="true" tabindex="-1"></a>                   ]</span>
<span id="cb191-3595"><a href="#cb191-3595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3596"><a href="#cb191-3596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3597"><a href="#cb191-3597" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(results,</span>
<span id="cb191-3598"><a href="#cb191-3598" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/model_sensitivity_development.csv&quot;</span>,</span>
<span id="cb191-3599"><a href="#cb191-3599" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb191-3600"><a href="#cb191-3600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3601"><a href="#cb191-3601" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(results)</span>
<span id="cb191-3602"><a href="#cb191-3602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3603"><a href="#cb191-3603" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/model_sensitivity_development.csv&quot;</span>)</span>
<span id="cb191-3604"><a href="#cb191-3604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3605"><a href="#cb191-3605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3606"><a href="#cb191-3606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3607"><a href="#cb191-3607" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb191-3608"><a href="#cb191-3608" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorRamps)</span>
<span id="cb191-3609"><a href="#cb191-3609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3610"><a href="#cb191-3610" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>Month_names <span class="ot">&lt;-</span> <span class="fu">factor</span>(results<span class="sc">$</span>Month,</span>
<span id="cb191-3611"><a href="#cb191-3611" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> month_range,<span class="co"># october to march</span></span>
<span id="cb191-3612"><a href="#cb191-3612" aria-hidden="true" tabindex="-1"></a>                              <span class="at">labels =</span> month.name[month_range])  </span>
<span id="cb191-3613"><a href="#cb191-3613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3614"><a href="#cb191-3614" aria-hidden="true" tabindex="-1"></a>DM_sensitivity <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(results, <span class="co"># heat map</span></span>
<span id="cb191-3615"><a href="#cb191-3615" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">aes</span>(<span class="at">x =</span> Tmin,</span>
<span id="cb191-3616"><a href="#cb191-3616" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y =</span> Tmax,</span>
<span id="cb191-3617"><a href="#cb191-3617" aria-hidden="true" tabindex="-1"></a>                             <span class="at">fill =</span> CP)) <span class="sc">+</span></span>
<span id="cb191-3618"><a href="#cb191-3618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb191-3619"><a href="#cb191-3619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">alpha</span>(<span class="fu">matlab.like</span>(<span class="dv">15</span>),</span>
<span id="cb191-3620"><a href="#cb191-3620" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">alpha =</span> .<span class="dv">5</span>),</span>
<span id="cb191-3621"><a href="#cb191-3621" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">&quot;Chill/day (CP)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3622"><a href="#cb191-3622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">min</span>(results<span class="sc">$</span>Tmax),</span>
<span id="cb191-3623"><a href="#cb191-3623" aria-hidden="true" tabindex="-1"></a>       <span class="fu">max</span>(results<span class="sc">$</span>Tmax)) <span class="sc">+</span></span>
<span id="cb191-3624"><a href="#cb191-3624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">min</span>(results<span class="sc">$</span>Tmin),</span>
<span id="cb191-3625"><a href="#cb191-3625" aria-hidden="true" tabindex="-1"></a>       <span class="fu">max</span>(results<span class="sc">$</span>Tmin))</span>
<span id="cb191-3626"><a href="#cb191-3626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3627"><a href="#cb191-3627" aria-hidden="true" tabindex="-1"></a>DM_sensitivity</span>
<span id="cb191-3628"><a href="#cb191-3628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3629"><a href="#cb191-3629" aria-hidden="true" tabindex="-1"></a>DM_sensitivity <span class="ot">&lt;-</span> DM_sensitivity <span class="sc">+</span></span>
<span id="cb191-3630"><a href="#cb191-3630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Month_names)) <span class="sc">+</span> <span class="co"># facet_wraps separates them by months</span></span>
<span id="cb191-3631"><a href="#cb191-3631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">min</span>(results<span class="sc">$</span>Tmax),</span>
<span id="cb191-3632"><a href="#cb191-3632" aria-hidden="true" tabindex="-1"></a>       <span class="fu">max</span>(results<span class="sc">$</span>Tmax)) <span class="sc">+</span></span>
<span id="cb191-3633"><a href="#cb191-3633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">min</span>(results<span class="sc">$</span>Tmin),</span>
<span id="cb191-3634"><a href="#cb191-3634" aria-hidden="true" tabindex="-1"></a>       <span class="fu">max</span>(results<span class="sc">$</span>Tmin))</span>
<span id="cb191-3635"><a href="#cb191-3635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3636"><a href="#cb191-3636" aria-hidden="true" tabindex="-1"></a>DM_sensitivity <span class="co"># nothing happens at -20 temp, at temp below freezing -10, we see some reactions,  </span></span>
<span id="cb191-3637"><a href="#cb191-3637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3638"><a href="#cb191-3638" aria-hidden="true" tabindex="-1"></a>temperatures <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/TMaxTMin1958-2019_patched.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb191-3639"><a href="#cb191-3639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Month <span class="sc">%in%</span> month_range) <span class="sc">%&gt;%</span></span>
<span id="cb191-3640"><a href="#cb191-3640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month_names =</span></span>
<span id="cb191-3641"><a href="#cb191-3641" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(Month,</span>
<span id="cb191-3642"><a href="#cb191-3642" aria-hidden="true" tabindex="-1"></a>                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb191-3643"><a href="#cb191-3643" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;October&quot;</span>, <span class="st">&quot;November&quot;</span>, <span class="st">&quot;December&quot;</span>,</span>
<span id="cb191-3644"><a href="#cb191-3644" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;January&quot;</span>, <span class="st">&quot;February&quot;</span>, <span class="st">&quot;March&quot;</span>))) <span class="co">#rename months</span></span>
<span id="cb191-3645"><a href="#cb191-3645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3646"><a href="#cb191-3646" aria-hidden="true" tabindex="-1"></a>temperatures[<span class="fu">which</span>(temperatures<span class="sc">$</span>Tmax <span class="sc">&lt;</span> temperatures<span class="sc">$</span>Tmin),</span>
<span id="cb191-3647"><a href="#cb191-3647" aria-hidden="true" tabindex="-1"></a>             <span class="fu">c</span>(<span class="st">&quot;Tmax&quot;</span>, <span class="st">&quot;Tmin&quot;</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-3648"><a href="#cb191-3648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3649"><a href="#cb191-3649" aria-hidden="true" tabindex="-1"></a>DM_sensitivity <span class="sc">+</span></span>
<span id="cb191-3650"><a href="#cb191-3650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> temperatures,</span>
<span id="cb191-3651"><a href="#cb191-3651" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Tmin,</span>
<span id="cb191-3652"><a href="#cb191-3652" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> Tmax,</span>
<span id="cb191-3653"><a href="#cb191-3653" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="cn">NULL</span>,</span>
<span id="cb191-3654"><a href="#cb191-3654" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;Temperature&quot;</span>),</span>
<span id="cb191-3655"><a href="#cb191-3655" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb191-3656"><a href="#cb191-3656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Month_names)) <span class="sc">+</span></span>
<span id="cb191-3657"><a href="#cb191-3657" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb191-3658"><a href="#cb191-3658" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="st">&quot;Daily temperature </span><span class="sc">\n</span><span class="st">extremes (Â°C)&quot;</span>,</span>
<span id="cb191-3659"><a href="#cb191-3659" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">&quot;Observed at site&quot;</span> ) <span class="sc">+</span></span>
<span id="cb191-3660"><a href="#cb191-3660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">order =</span> <span class="dv">1</span>),</span>
<span id="cb191-3661"><a href="#cb191-3661" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb191-3662"><a href="#cb191-3662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Tmax (Â°C)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3663"><a href="#cb191-3663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Tmin (Â°C)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb191-3664"><a href="#cb191-3664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="co"># Model response in relationship to temps observed in Rochester</span></span>
<span id="cb191-3665"><a href="#cb191-3665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3666"><a href="#cb191-3666" aria-hidden="true" tabindex="-1"></a>Chill_model_sensitivity<span class="ot">&lt;-</span> <span class="co"># creating a function for other locations</span></span>
<span id="cb191-3667"><a href="#cb191-3667" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(latitude,</span>
<span id="cb191-3668"><a href="#cb191-3668" aria-hidden="true" tabindex="-1"></a>           <span class="at">temp_models =</span> <span class="fu">list</span>(<span class="at">Dynamic_Model =</span> Dynamic_Model,</span>
<span id="cb191-3669"><a href="#cb191-3669" aria-hidden="true" tabindex="-1"></a>                              <span class="at">GDH =</span> GDH),</span>
<span id="cb191-3670"><a href="#cb191-3670" aria-hidden="true" tabindex="-1"></a>           <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb191-3671"><a href="#cb191-3671" aria-hidden="true" tabindex="-1"></a>           <span class="at">Tmins =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>),</span>
<span id="cb191-3672"><a href="#cb191-3672" aria-hidden="true" tabindex="-1"></a>           <span class="at">Tmaxs =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">30</span>))</span>
<span id="cb191-3673"><a href="#cb191-3673" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb191-3674"><a href="#cb191-3674" aria-hidden="true" tabindex="-1"></a>  mins <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-3675"><a href="#cb191-3675" aria-hidden="true" tabindex="-1"></a>  maxs <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-3676"><a href="#cb191-3676" aria-hidden="true" tabindex="-1"></a>  metrics <span class="ot">&lt;-</span> <span class="fu">as.list</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,</span>
<span id="cb191-3677"><a href="#cb191-3677" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(temp_models)))</span>
<span id="cb191-3678"><a href="#cb191-3678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(metrics) <span class="ot">&lt;-</span> <span class="fu">names</span>(temp_models)</span>
<span id="cb191-3679"><a href="#cb191-3679" aria-hidden="true" tabindex="-1"></a>  month <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-3680"><a href="#cb191-3680" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb191-3681"><a href="#cb191-3681" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(mon <span class="cf">in</span> month_range)</span>
<span id="cb191-3682"><a href="#cb191-3682" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb191-3683"><a href="#cb191-3683" aria-hidden="true" tabindex="-1"></a>    days_month <span class="ot">&lt;-</span></span>
<span id="cb191-3684"><a href="#cb191-3684" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">difftime</span>( <span class="fu">ISOdate</span>(<span class="dv">2002</span>,</span>
<span id="cb191-3685"><a href="#cb191-3685" aria-hidden="true" tabindex="-1"></a>                                   mon<span class="sc">+</span><span class="dv">1</span>,</span>
<span id="cb191-3686"><a href="#cb191-3686" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">1</span>),</span>
<span id="cb191-3687"><a href="#cb191-3687" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ISOdate</span>(<span class="dv">2002</span>,</span>
<span id="cb191-3688"><a href="#cb191-3688" aria-hidden="true" tabindex="-1"></a>                                   mon,</span>
<span id="cb191-3689"><a href="#cb191-3689" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">1</span>) ))</span>
<span id="cb191-3690"><a href="#cb191-3690" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(mon <span class="sc">==</span> <span class="dv">12</span>) days_month <span class="ot">&lt;-</span> <span class="dv">31</span></span>
<span id="cb191-3691"><a href="#cb191-3691" aria-hidden="true" tabindex="-1"></a>    weather <span class="ot">&lt;-</span> </span>
<span id="cb191-3692"><a href="#cb191-3692" aria-hidden="true" tabindex="-1"></a>      <span class="fu">make_all_day_table</span>(<span class="fu">data.frame</span>(<span class="at">Year =</span> <span class="fu">c</span>(<span class="dv">2001</span>, <span class="dv">2001</span>),</span>
<span id="cb191-3693"><a href="#cb191-3693" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Month =</span> <span class="fu">c</span>(mon, mon),</span>
<span id="cb191-3694"><a href="#cb191-3694" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Day =</span> <span class="fu">c</span>(<span class="dv">1</span>, days_month),</span>
<span id="cb191-3695"><a href="#cb191-3695" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Tmin =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb191-3696"><a href="#cb191-3696" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Tmax =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb191-3697"><a href="#cb191-3697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3698"><a href="#cb191-3698" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb191-3699"><a href="#cb191-3699" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(tmin <span class="cf">in</span> Tmins)</span>
<span id="cb191-3700"><a href="#cb191-3700" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(tmax <span class="cf">in</span> Tmaxs)</span>
<span id="cb191-3701"><a href="#cb191-3701" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tmax <span class="sc">&gt;=</span> tmin)</span>
<span id="cb191-3702"><a href="#cb191-3702" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb191-3703"><a href="#cb191-3703" aria-hidden="true" tabindex="-1"></a>          hourtemps <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span></span>
<span id="cb191-3704"><a href="#cb191-3704" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">Tmin =</span> tmin,</span>
<span id="cb191-3705"><a href="#cb191-3705" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Tmax =</span> tmax) <span class="sc">%&gt;%</span></span>
<span id="cb191-3706"><a href="#cb191-3706" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stack_hourly_temps</span>(</span>
<span id="cb191-3707"><a href="#cb191-3707" aria-hidden="true" tabindex="-1"></a>              <span class="at">latitude =</span> latitude) <span class="sc">%&gt;%</span></span>
<span id="cb191-3708"><a href="#cb191-3708" aria-hidden="true" tabindex="-1"></a>            <span class="fu">pluck</span>(<span class="st">&quot;hourtemps&quot;</span>,</span>
<span id="cb191-3709"><a href="#cb191-3709" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Temp&quot;</span>)</span>
<span id="cb191-3710"><a href="#cb191-3710" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb191-3711"><a href="#cb191-3711" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(tm <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(temp_models))</span>
<span id="cb191-3712"><a href="#cb191-3712" aria-hidden="true" tabindex="-1"></a>            metrics[[tm]] <span class="ot">&lt;-</span> </span>
<span id="cb191-3713"><a href="#cb191-3713" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(metrics[[tm]],</span>
<span id="cb191-3714"><a href="#cb191-3714" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tail</span>(<span class="fu">do.call</span>(temp_models[[tm]],</span>
<span id="cb191-3715"><a href="#cb191-3715" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">list</span>(hourtemps)),<span class="dv">1</span>)<span class="sc">/</span></span>
<span id="cb191-3716"><a href="#cb191-3716" aria-hidden="true" tabindex="-1"></a>                  days_month)</span>
<span id="cb191-3717"><a href="#cb191-3717" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb191-3718"><a href="#cb191-3718" aria-hidden="true" tabindex="-1"></a>          mins <span class="ot">&lt;-</span> <span class="fu">c</span>(mins, tmin)</span>
<span id="cb191-3719"><a href="#cb191-3719" aria-hidden="true" tabindex="-1"></a>          maxs <span class="ot">&lt;-</span> <span class="fu">c</span>(maxs, tmax)</span>
<span id="cb191-3720"><a href="#cb191-3720" aria-hidden="true" tabindex="-1"></a>          month <span class="ot">&lt;-</span> <span class="fu">c</span>(month, mon)</span>
<span id="cb191-3721"><a href="#cb191-3721" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb191-3722"><a href="#cb191-3722" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb191-3723"><a href="#cb191-3723" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">data.frame</span>(<span class="at">Month =</span> month,</span>
<span id="cb191-3724"><a href="#cb191-3724" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Tmin =</span> mins,</span>
<span id="cb191-3725"><a href="#cb191-3725" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Tmax =</span> maxs),</span>
<span id="cb191-3726"><a href="#cb191-3726" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">as.data.frame</span>(metrics))</span>
<span id="cb191-3727"><a href="#cb191-3727" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3728"><a href="#cb191-3728" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> results[<span class="sc">!</span><span class="fu">is.na</span>(results<span class="sc">$</span>Month),]</span>
<span id="cb191-3729"><a href="#cb191-3729" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb191-3730"><a href="#cb191-3730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3731"><a href="#cb191-3731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3732"><a href="#cb191-3732" aria-hidden="true" tabindex="-1"></a>Chill_sensitivity_temps <span class="ot">&lt;-</span></span>
<span id="cb191-3733"><a href="#cb191-3733" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(chill_model_sensitivity_table,</span>
<span id="cb191-3734"><a href="#cb191-3734" aria-hidden="true" tabindex="-1"></a>           temperatures,</span>
<span id="cb191-3735"><a href="#cb191-3735" aria-hidden="true" tabindex="-1"></a>           temp_model,</span>
<span id="cb191-3736"><a href="#cb191-3736" aria-hidden="true" tabindex="-1"></a>           <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb191-3737"><a href="#cb191-3737" aria-hidden="true" tabindex="-1"></a>           <span class="at">Tmins =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>),</span>
<span id="cb191-3738"><a href="#cb191-3738" aria-hidden="true" tabindex="-1"></a>           <span class="at">Tmaxs =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">30</span>),</span>
<span id="cb191-3739"><a href="#cb191-3739" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend_label =</span> <span class="st">&quot;Chill/day (CP)&quot;</span>)</span>
<span id="cb191-3740"><a href="#cb191-3740" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb191-3741"><a href="#cb191-3741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb191-3742"><a href="#cb191-3742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(colorRamps)</span>
<span id="cb191-3743"><a href="#cb191-3743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3744"><a href="#cb191-3744" aria-hidden="true" tabindex="-1"></a>  cmst <span class="ot">&lt;-</span> chill_model_sensitivity_table</span>
<span id="cb191-3745"><a href="#cb191-3745" aria-hidden="true" tabindex="-1"></a>  cmst <span class="ot">&lt;-</span> cmst[<span class="fu">which</span>(cmst<span class="sc">$</span>Month <span class="sc">%in%</span> month_range),]</span>
<span id="cb191-3746"><a href="#cb191-3746" aria-hidden="true" tabindex="-1"></a>  cmst<span class="sc">$</span>Month_names <span class="ot">&lt;-</span> <span class="fu">factor</span>(cmst<span class="sc">$</span>Month,</span>
<span id="cb191-3747"><a href="#cb191-3747" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> month_range,</span>
<span id="cb191-3748"><a href="#cb191-3748" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> month.name[month_range])  </span>
<span id="cb191-3749"><a href="#cb191-3749" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3750"><a href="#cb191-3750" aria-hidden="true" tabindex="-1"></a>  DM_sensitivity<span class="ot">&lt;-</span></span>
<span id="cb191-3751"><a href="#cb191-3751" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(cmst,</span>
<span id="cb191-3752"><a href="#cb191-3752" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">&quot;Tmin&quot;</span>,</span>
<span id="cb191-3753"><a href="#cb191-3753" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="st">&quot;Tmax&quot;</span>,</span>
<span id="cb191-3754"><a href="#cb191-3754" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fill =</span> temp_model)) <span class="sc">+</span></span>
<span id="cb191-3755"><a href="#cb191-3755" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb191-3756"><a href="#cb191-3756" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">alpha</span>(<span class="fu">matlab.like</span>(<span class="dv">15</span>),</span>
<span id="cb191-3757"><a href="#cb191-3757" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">alpha =</span> .<span class="dv">5</span>),</span>
<span id="cb191-3758"><a href="#cb191-3758" aria-hidden="true" tabindex="-1"></a>                         <span class="at">name =</span> legend_label) <span class="sc">+</span></span>
<span id="cb191-3759"><a href="#cb191-3759" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(Tmins[<span class="dv">1</span>],</span>
<span id="cb191-3760"><a href="#cb191-3760" aria-hidden="true" tabindex="-1"></a>         Tmins[<span class="fu">length</span>(Tmins)]) <span class="sc">+</span></span>
<span id="cb191-3761"><a href="#cb191-3761" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(Tmaxs[<span class="dv">1</span>],</span>
<span id="cb191-3762"><a href="#cb191-3762" aria-hidden="true" tabindex="-1"></a>         Tmaxs[<span class="fu">length</span>(Tmaxs)])</span>
<span id="cb191-3763"><a href="#cb191-3763" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3764"><a href="#cb191-3764" aria-hidden="true" tabindex="-1"></a>  temperatures<span class="ot">&lt;-</span></span>
<span id="cb191-3765"><a href="#cb191-3765" aria-hidden="true" tabindex="-1"></a>    temperatures[<span class="fu">which</span>(temperatures<span class="sc">$</span>Month <span class="sc">%in%</span> month_range),]</span>
<span id="cb191-3766"><a href="#cb191-3766" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3767"><a href="#cb191-3767" aria-hidden="true" tabindex="-1"></a>  temperatures[<span class="fu">which</span>(temperatures<span class="sc">$</span>Tmax <span class="sc">&lt;</span> temperatures<span class="sc">$</span>Tmin),</span>
<span id="cb191-3768"><a href="#cb191-3768" aria-hidden="true" tabindex="-1"></a>               <span class="fu">c</span>(<span class="st">&quot;Tmax&quot;</span>, </span>
<span id="cb191-3769"><a href="#cb191-3769" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Tmin&quot;</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-3770"><a href="#cb191-3770" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3771"><a href="#cb191-3771" aria-hidden="true" tabindex="-1"></a>  temperatures<span class="sc">$</span>Month_names <span class="ot">&lt;-</span></span>
<span id="cb191-3772"><a href="#cb191-3772" aria-hidden="true" tabindex="-1"></a>    <span class="fu">factor</span>(temperatures<span class="sc">$</span>Month,</span>
<span id="cb191-3773"><a href="#cb191-3773" aria-hidden="true" tabindex="-1"></a>           <span class="at">levels =</span> month_range,</span>
<span id="cb191-3774"><a href="#cb191-3774" aria-hidden="true" tabindex="-1"></a>           <span class="at">labels =</span> month.name[month_range])  </span>
<span id="cb191-3775"><a href="#cb191-3775" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3776"><a href="#cb191-3776" aria-hidden="true" tabindex="-1"></a>  DM_sensitivity <span class="sc">+</span></span>
<span id="cb191-3777"><a href="#cb191-3777" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> temperatures,</span>
<span id="cb191-3778"><a href="#cb191-3778" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> Tmin,</span>
<span id="cb191-3779"><a href="#cb191-3779" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> Tmax,</span>
<span id="cb191-3780"><a href="#cb191-3780" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="cn">NULL</span>,</span>
<span id="cb191-3781"><a href="#cb191-3781" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">&quot;Temperature&quot;</span>),</span>
<span id="cb191-3782"><a href="#cb191-3782" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb191-3783"><a href="#cb191-3783" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Month_names)) <span class="sc">+</span></span>
<span id="cb191-3784"><a href="#cb191-3784" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb191-3785"><a href="#cb191-3785" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="st">&quot;Daily temperature </span><span class="sc">\n</span><span class="st">extremes (Â°C)&quot;</span>,</span>
<span id="cb191-3786"><a href="#cb191-3786" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">&quot;Observed at site&quot;</span> ) <span class="sc">+</span></span>
<span id="cb191-3787"><a href="#cb191-3787" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">order =</span> <span class="dv">1</span>),</span>
<span id="cb191-3788"><a href="#cb191-3788" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb191-3789"><a href="#cb191-3789" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Tmax (Â°C)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3790"><a href="#cb191-3790" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Tmin (Â°C)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb191-3791"><a href="#cb191-3791" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span>
<span id="cb191-3792"><a href="#cb191-3792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3793"><a href="#cb191-3793" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb191-3794"><a href="#cb191-3794" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-3795"><a href="#cb191-3795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3796"><a href="#cb191-3796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3797"><a href="#cb191-3797" aria-hidden="true" tabindex="-1"></a>Model_sensitivities_CNY <span class="ot">&lt;-</span> <span class="co"># Rochester, New York</span></span>
<span id="cb191-3798"><a href="#cb191-3798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Chill_model_sensitivity</span>(<span class="at">latitude =</span> <span class="dv">43</span>,</span>
<span id="cb191-3799"><a href="#cb191-3799" aria-hidden="true" tabindex="-1"></a>                          <span class="at">temp_models =</span> <span class="fu">list</span>(<span class="at">Dynamic_Model =</span> Dynamic_Model,</span>
<span id="cb191-3800"><a href="#cb191-3800" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">GDH =</span> GDH),</span>
<span id="cb191-3801"><a href="#cb191-3801" aria-hidden="true" tabindex="-1"></a>                          <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="cb191-3802"><a href="#cb191-3802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3803"><a href="#cb191-3803" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(Model_sensitivities_CNY,</span>
<span id="cb191-3804"><a href="#cb191-3804" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Model_sensitivities_CNY.csv&quot;</span>,</span>
<span id="cb191-3805"><a href="#cb191-3805" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb191-3806"><a href="#cb191-3806" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb191-3807"><a href="#cb191-3807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3808"><a href="#cb191-3808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3809"><a href="#cb191-3809" aria-hidden="true" tabindex="-1"></a>Model_sensitivities_CNY <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Model_sensitivities_CNY.csv&quot;</span>)</span>
<span id="cb191-3810"><a href="#cb191-3810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3811"><a href="#cb191-3811" aria-hidden="true" tabindex="-1"></a>Rochester_weather <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_weather.csv&quot;</span>)</span>
<span id="cb191-3812"><a href="#cb191-3812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3813"><a href="#cb191-3813" aria-hidden="true" tabindex="-1"></a><span class="fu">Chill_sensitivity_temps</span>(Model_sensitivities_CNY,</span>
<span id="cb191-3814"><a href="#cb191-3814" aria-hidden="true" tabindex="-1"></a>                        Rochester_weather,</span>
<span id="cb191-3815"><a href="#cb191-3815" aria-hidden="true" tabindex="-1"></a>                        <span class="at">temp_model =</span> <span class="st">&quot;Dynamic_Model&quot;</span>,</span>
<span id="cb191-3816"><a href="#cb191-3816" aria-hidden="true" tabindex="-1"></a>                        <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb191-3817"><a href="#cb191-3817" aria-hidden="true" tabindex="-1"></a>                        <span class="at">legend_label =</span> <span class="st">&quot;Chill per day </span><span class="sc">\n</span><span class="st">(Chill Portions)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3818"><a href="#cb191-3818" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Chill model sensitivity at Rochester, New York&quot;</span>)</span>
<span id="cb191-3819"><a href="#cb191-3819" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-3820"><a href="#cb191-3820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3821"><a href="#cb191-3821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3822"><a href="#cb191-3822" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-3823"><a href="#cb191-3823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3824"><a href="#cb191-3824" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-3825"><a href="#cb191-3825" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb191-3826"><a href="#cb191-3826" aria-hidden="true" tabindex="-1"></a><span class="fu">Chill_sensitivity_temps</span>(Model_sensitivities_CNY,</span>
<span id="cb191-3827"><a href="#cb191-3827" aria-hidden="true" tabindex="-1"></a>                        Rochester_weather,</span>
<span id="cb191-3828"><a href="#cb191-3828" aria-hidden="true" tabindex="-1"></a>                        <span class="at">temp_model =</span> <span class="st">&quot;GDH&quot;</span>,</span>
<span id="cb191-3829"><a href="#cb191-3829" aria-hidden="true" tabindex="-1"></a>                        <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb191-3830"><a href="#cb191-3830" aria-hidden="true" tabindex="-1"></a>                        <span class="at">legend_label =</span> <span class="st">&quot;Heat per day </span><span class="sc">\n</span><span class="st">(GDH)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-3831"><a href="#cb191-3831" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Heat model sensitivity at Rochester, New York&quot;</span>)</span>
<span id="cb191-3832"><a href="#cb191-3832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3833"><a href="#cb191-3833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3834"><a href="#cb191-3834" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-3835"><a href="#cb191-3835" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-3836"><a href="#cb191-3836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3837"><a href="#cb191-3837" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 26: Evaluating PLS outputs</span></span>
<span id="cb191-3838"><a href="#cb191-3838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3839"><a href="#cb191-3839" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on expected PLS results***</span></span>
<span id="cb191-3840"><a href="#cb191-3840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3841"><a href="#cb191-3841" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Reproduce the analysis for the âRoter Boskoopâ dataset.</span>
<span id="cb191-3842"><a href="#cb191-3842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3843"><a href="#cb191-3843" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb191-3844"><a href="#cb191-3844" aria-hidden="true" tabindex="-1"></a><span class="in">library(chillR)</span></span>
<span id="cb191-3845"><a href="#cb191-3845" aria-hidden="true" tabindex="-1"></a><span class="in">library(magrittr)</span></span>
<span id="cb191-3846"><a href="#cb191-3846" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb191-3847"><a href="#cb191-3847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3848"><a href="#cb191-3848" aria-hidden="true" tabindex="-1"></a><span class="in">Roter_first &lt;- read_tab(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Roter_Boskoop_bloom_1958_2019.csv.csv&quot;) %&gt;%</span></span>
<span id="cb191-3849"><a href="#cb191-3849" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Pheno_year, First_bloom) %&gt;%</span></span>
<span id="cb191-3850"><a href="#cb191-3850" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Year = as.numeric(substr(First_bloom, 1, 4)),</span></span>
<span id="cb191-3851"><a href="#cb191-3851" aria-hidden="true" tabindex="-1"></a><span class="in">         Month = as.numeric(substr(First_bloom, 5, 6)),</span></span>
<span id="cb191-3852"><a href="#cb191-3852" aria-hidden="true" tabindex="-1"></a><span class="in">         Day = as.numeric(substr(First_bloom, 7, 8))) %&gt;%</span></span>
<span id="cb191-3853"><a href="#cb191-3853" aria-hidden="true" tabindex="-1"></a><span class="in">  make_JDay() %&gt;%</span></span>
<span id="cb191-3854"><a href="#cb191-3854" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Pheno_year, </span></span>
<span id="cb191-3855"><a href="#cb191-3855" aria-hidden="true" tabindex="-1"></a><span class="in">         JDay) %&gt;%</span></span>
<span id="cb191-3856"><a href="#cb191-3856" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(Year = Pheno_year,</span></span>
<span id="cb191-3857"><a href="#cb191-3857" aria-hidden="true" tabindex="-1"></a><span class="in">         pheno = JDay)</span></span>
<span id="cb191-3858"><a href="#cb191-3858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3859"><a href="#cb191-3859" aria-hidden="true" tabindex="-1"></a><span class="in">temps &lt;- read_tab(&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/TMaxTMin1958-2019_patched.csv&quot;)</span></span>
<span id="cb191-3860"><a href="#cb191-3860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3861"><a href="#cb191-3861" aria-hidden="true" tabindex="-1"></a><span class="in">temps_hourly &lt;- temps %&gt;%</span></span>
<span id="cb191-3862"><a href="#cb191-3862" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 43.1)</span></span>
<span id="cb191-3863"><a href="#cb191-3863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3864"><a href="#cb191-3864" aria-hidden="true" tabindex="-1"></a><span class="in">daychill &lt;- daily_chill(hourtemps = temps_hourly,</span></span>
<span id="cb191-3865"><a href="#cb191-3865" aria-hidden="true" tabindex="-1"></a><span class="in">                        running_mean = 1,</span></span>
<span id="cb191-3866"><a href="#cb191-3866" aria-hidden="true" tabindex="-1"></a><span class="in">                        models = list(Chilling_Hours = Chilling_Hours,</span></span>
<span id="cb191-3867"><a href="#cb191-3867" aria-hidden="true" tabindex="-1"></a><span class="in">                                      Utah_Chill_Units = Utah_Model,</span></span>
<span id="cb191-3868"><a href="#cb191-3868" aria-hidden="true" tabindex="-1"></a><span class="in">                                      Chill_Portions = Dynamic_Model,</span></span>
<span id="cb191-3869"><a href="#cb191-3869" aria-hidden="true" tabindex="-1"></a><span class="in">                                      GDH = GDH)</span></span>
<span id="cb191-3870"><a href="#cb191-3870" aria-hidden="true" tabindex="-1"></a><span class="in">                        )</span></span>
<span id="cb191-3871"><a href="#cb191-3871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3872"><a href="#cb191-3872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3873"><a href="#cb191-3873" aria-hidden="true" tabindex="-1"></a><span class="in">plscf &lt;- PLS_chill_force(daily_chill_obj = daychill,</span></span>
<span id="cb191-3874"><a href="#cb191-3874" aria-hidden="true" tabindex="-1"></a><span class="in">                         bio_data_frame = Roter_first,</span></span>
<span id="cb191-3875"><a href="#cb191-3875" aria-hidden="true" tabindex="-1"></a><span class="in">                         split_month = 6,</span></span>
<span id="cb191-3876"><a href="#cb191-3876" aria-hidden="true" tabindex="-1"></a><span class="in">                         chill_models = &quot;Chill_Portions&quot;,</span></span>
<span id="cb191-3877"><a href="#cb191-3877" aria-hidden="true" tabindex="-1"></a><span class="in">                         heat_models = &quot;GDH&quot;,</span></span>
<span id="cb191-3878"><a href="#cb191-3878" aria-hidden="true" tabindex="-1"></a><span class="in">                         runn_means = 11)</span></span>
<span id="cb191-3879"><a href="#cb191-3879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3880"><a href="#cb191-3880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3881"><a href="#cb191-3881" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb191-3882"><a href="#cb191-3882" aria-hidden="true" tabindex="-1"></a><span class="in">plot_PLS_chill_force &lt;- function(plscf,</span></span>
<span id="cb191-3883"><a href="#cb191-3883" aria-hidden="true" tabindex="-1"></a><span class="in">                                 chill_metric = &quot;Chill_Portions&quot;,</span></span>
<span id="cb191-3884"><a href="#cb191-3884" aria-hidden="true" tabindex="-1"></a><span class="in">                                 heat_metric = &quot;GDH&quot;,</span></span>
<span id="cb191-3885"><a href="#cb191-3885" aria-hidden="true" tabindex="-1"></a><span class="in">                                 chill_label = &quot;CP&quot;,</span></span>
<span id="cb191-3886"><a href="#cb191-3886" aria-hidden="true" tabindex="-1"></a><span class="in">                                 heat_label = &quot;GDH&quot;,</span></span>
<span id="cb191-3887"><a href="#cb191-3887" aria-hidden="true" tabindex="-1"></a><span class="in">                                 chill_phase = c(-48, 62),</span></span>
<span id="cb191-3888"><a href="#cb191-3888" aria-hidden="true" tabindex="-1"></a><span class="in">                                 heat_phase = c(-5, 105.5))</span></span>
<span id="cb191-3889"><a href="#cb191-3889" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb191-3890"><a href="#cb191-3890" aria-hidden="true" tabindex="-1"></a><span class="in">  PLS_gg &lt;- plscf[[chill_metric]][[heat_metric]]$PLS_summary %&gt;%</span></span>
<span id="cb191-3891"><a href="#cb191-3891" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(Month = trunc(Date/100),</span></span>
<span id="cb191-3892"><a href="#cb191-3892" aria-hidden="true" tabindex="-1"></a><span class="in">           Day = Date - Month * 100,</span></span>
<span id="cb191-3893"><a href="#cb191-3893" aria-hidden="true" tabindex="-1"></a><span class="in">           Date = ISOdate(2002,</span></span>
<span id="cb191-3894"><a href="#cb191-3894" aria-hidden="true" tabindex="-1"></a><span class="in">                          Month,</span></span>
<span id="cb191-3895"><a href="#cb191-3895" aria-hidden="true" tabindex="-1"></a><span class="in">                          Day))</span></span>
<span id="cb191-3896"><a href="#cb191-3896" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-3897"><a href="#cb191-3897" aria-hidden="true" tabindex="-1"></a><span class="in">  PLS_gg[PLS_gg$JDay &lt;= 0,&quot;Date&quot;]&lt;-</span></span>
<span id="cb191-3898"><a href="#cb191-3898" aria-hidden="true" tabindex="-1"></a><span class="in">    ISOdate(2001,</span></span>
<span id="cb191-3899"><a href="#cb191-3899" aria-hidden="true" tabindex="-1"></a><span class="in">            PLS_gg$Month[PLS_gg$JDay &lt;= 0],</span></span>
<span id="cb191-3900"><a href="#cb191-3900" aria-hidden="true" tabindex="-1"></a><span class="in">            PLS_gg$Day[PLS_gg$JDay &lt;= 0])</span></span>
<span id="cb191-3901"><a href="#cb191-3901" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-3902"><a href="#cb191-3902" aria-hidden="true" tabindex="-1"></a><span class="in">  PLS_gg &lt;- PLS_gg %&gt;%</span></span>
<span id="cb191-3903"><a href="#cb191-3903" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(VIP_importance = VIP &gt;= 0.8,</span></span>
<span id="cb191-3904"><a href="#cb191-3904" aria-hidden="true" tabindex="-1"></a><span class="in">           VIP_Coeff = factor(sign(Coef) * VIP_importance))</span></span>
<span id="cb191-3905"><a href="#cb191-3905" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-3906"><a href="#cb191-3906" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_start_date &lt;- ISOdate(2001,</span></span>
<span id="cb191-3907"><a href="#cb191-3907" aria-hidden="true" tabindex="-1"></a><span class="in">                              12,</span></span>
<span id="cb191-3908"><a href="#cb191-3908" aria-hidden="true" tabindex="-1"></a><span class="in">                              31) + chill_phase[1] * 24 * 3600</span></span>
<span id="cb191-3909"><a href="#cb191-3909" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_end_date &lt;- ISOdate(2001,</span></span>
<span id="cb191-3910"><a href="#cb191-3910" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb191-3911"><a href="#cb191-3911" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) + chill_phase[2] * 24 * 3600</span></span>
<span id="cb191-3912"><a href="#cb191-3912" aria-hidden="true" tabindex="-1"></a><span class="in">  heat_start_date &lt;- ISOdate(2001,</span></span>
<span id="cb191-3913"><a href="#cb191-3913" aria-hidden="true" tabindex="-1"></a><span class="in">                             12,</span></span>
<span id="cb191-3914"><a href="#cb191-3914" aria-hidden="true" tabindex="-1"></a><span class="in">                             31) + heat_phase[1] * 24 * 3600</span></span>
<span id="cb191-3915"><a href="#cb191-3915" aria-hidden="true" tabindex="-1"></a><span class="in">  heat_end_date &lt;- ISOdate(2001,</span></span>
<span id="cb191-3916"><a href="#cb191-3916" aria-hidden="true" tabindex="-1"></a><span class="in">                           12,</span></span>
<span id="cb191-3917"><a href="#cb191-3917" aria-hidden="true" tabindex="-1"></a><span class="in">                           31) + heat_phase[2] * 24 * 3600</span></span>
<span id="cb191-3918"><a href="#cb191-3918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3919"><a href="#cb191-3919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3920"><a href="#cb191-3920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3921"><a href="#cb191-3921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3922"><a href="#cb191-3922" aria-hidden="true" tabindex="-1"></a><span class="in">  temp_plot &lt;- ggplot(PLS_gg) +</span></span>
<span id="cb191-3923"><a href="#cb191-3923" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate(&quot;rect&quot;,</span></span>
<span id="cb191-3924"><a href="#cb191-3924" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = chill_start_date,</span></span>
<span id="cb191-3925"><a href="#cb191-3925" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = chill_end_date,</span></span>
<span id="cb191-3926"><a href="#cb191-3926" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb191-3927"><a href="#cb191-3927" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb191-3928"><a href="#cb191-3928" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb191-3929"><a href="#cb191-3929" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = &quot;blue&quot;) +</span></span>
<span id="cb191-3930"><a href="#cb191-3930" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate(&quot;rect&quot;,</span></span>
<span id="cb191-3931"><a href="#cb191-3931" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = heat_start_date,</span></span>
<span id="cb191-3932"><a href="#cb191-3932" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = heat_end_date,</span></span>
<span id="cb191-3933"><a href="#cb191-3933" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb191-3934"><a href="#cb191-3934" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb191-3935"><a href="#cb191-3935" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb191-3936"><a href="#cb191-3936" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = &quot;red&quot;) +</span></span>
<span id="cb191-3937"><a href="#cb191-3937" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate(&quot;rect&quot;,</span></span>
<span id="cb191-3938"><a href="#cb191-3938" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = ISOdate(2001,</span></span>
<span id="cb191-3939"><a href="#cb191-3939" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb191-3940"><a href="#cb191-3940" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) +</span></span>
<span id="cb191-3941"><a href="#cb191-3941" aria-hidden="true" tabindex="-1"></a><span class="in">               min(plscf$pheno$pheno,</span></span>
<span id="cb191-3942"><a href="#cb191-3942" aria-hidden="true" tabindex="-1"></a><span class="in">                   na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb191-3943"><a href="#cb191-3943" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = ISOdate(2001,</span></span>
<span id="cb191-3944"><a href="#cb191-3944" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb191-3945"><a href="#cb191-3945" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) +</span></span>
<span id="cb191-3946"><a href="#cb191-3946" aria-hidden="true" tabindex="-1"></a><span class="in">               max(plscf$pheno$pheno,</span></span>
<span id="cb191-3947"><a href="#cb191-3947" aria-hidden="true" tabindex="-1"></a><span class="in">                   na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb191-3948"><a href="#cb191-3948" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb191-3949"><a href="#cb191-3949" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb191-3950"><a href="#cb191-3950" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb191-3951"><a href="#cb191-3951" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = &quot;black&quot;) +</span></span>
<span id="cb191-3952"><a href="#cb191-3952" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_vline(xintercept = ISOdate(2001,</span></span>
<span id="cb191-3953"><a href="#cb191-3953" aria-hidden="true" tabindex="-1"></a><span class="in">                                    12,</span></span>
<span id="cb191-3954"><a href="#cb191-3954" aria-hidden="true" tabindex="-1"></a><span class="in">                                    31) +</span></span>
<span id="cb191-3955"><a href="#cb191-3955" aria-hidden="true" tabindex="-1"></a><span class="in">                 median(plscf$pheno$pheno,</span></span>
<span id="cb191-3956"><a href="#cb191-3956" aria-hidden="true" tabindex="-1"></a><span class="in">                        na.rm=TRUE) * 24 * 3600,</span></span>
<span id="cb191-3957"><a href="#cb191-3957" aria-hidden="true" tabindex="-1"></a><span class="in">               linetype = &quot;dashed&quot;) +</span></span>
<span id="cb191-3958"><a href="#cb191-3958" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_ribbon(aes(x = Date,</span></span>
<span id="cb191-3959"><a href="#cb191-3959" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymin = MetricMean - MetricStdev ,</span></span>
<span id="cb191-3960"><a href="#cb191-3960" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymax = MetricMean + MetricStdev ),</span></span>
<span id="cb191-3961"><a href="#cb191-3961" aria-hidden="true" tabindex="-1"></a><span class="in">                fill = &quot;grey&quot;) +</span></span>
<span id="cb191-3962"><a href="#cb191-3962" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_ribbon(aes(x = Date,</span></span>
<span id="cb191-3963"><a href="#cb191-3963" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymin = MetricMean - MetricStdev * (VIP_Coeff == -1),</span></span>
<span id="cb191-3964"><a href="#cb191-3964" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymax = MetricMean + MetricStdev * (VIP_Coeff == -1)),</span></span>
<span id="cb191-3965"><a href="#cb191-3965" aria-hidden="true" tabindex="-1"></a><span class="in">                fill = &quot;red&quot;) +</span></span>
<span id="cb191-3966"><a href="#cb191-3966" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_ribbon(aes(x = Date,</span></span>
<span id="cb191-3967"><a href="#cb191-3967" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymin = MetricMean - MetricStdev * (VIP_Coeff == 1),</span></span>
<span id="cb191-3968"><a href="#cb191-3968" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymax = MetricMean + MetricStdev * (VIP_Coeff == 1)),</span></span>
<span id="cb191-3969"><a href="#cb191-3969" aria-hidden="true" tabindex="-1"></a><span class="in">                fill = &quot;dark green&quot;) +</span></span>
<span id="cb191-3970"><a href="#cb191-3970" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_line(aes(x = Date,</span></span>
<span id="cb191-3971"><a href="#cb191-3971" aria-hidden="true" tabindex="-1"></a><span class="in">                  y = MetricMean)) +</span></span>
<span id="cb191-3972"><a href="#cb191-3972" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(vars(Type),</span></span>
<span id="cb191-3973"><a href="#cb191-3973" aria-hidden="true" tabindex="-1"></a><span class="in">               scales = &quot;free_y&quot;,</span></span>
<span id="cb191-3974"><a href="#cb191-3974" aria-hidden="true" tabindex="-1"></a><span class="in">               strip.position = &quot;left&quot;,</span></span>
<span id="cb191-3975"><a href="#cb191-3975" aria-hidden="true" tabindex="-1"></a><span class="in">               labeller = </span></span>
<span id="cb191-3976"><a href="#cb191-3976" aria-hidden="true" tabindex="-1"></a><span class="in">                 labeller(</span></span>
<span id="cb191-3977"><a href="#cb191-3977" aria-hidden="true" tabindex="-1"></a><span class="in">                   Type =</span></span>
<span id="cb191-3978"><a href="#cb191-3978" aria-hidden="true" tabindex="-1"></a><span class="in">                     as_labeller(c(Chill = paste0(&quot;Chill (&quot;,</span></span>
<span id="cb191-3979"><a href="#cb191-3979" aria-hidden="true" tabindex="-1"></a><span class="in">                                                  chill_label,</span></span>
<span id="cb191-3980"><a href="#cb191-3980" aria-hidden="true" tabindex="-1"></a><span class="in">                                                  &quot;)&quot;),</span></span>
<span id="cb191-3981"><a href="#cb191-3981" aria-hidden="true" tabindex="-1"></a><span class="in">                                   Heat = paste0(&quot;Heat (&quot;,</span></span>
<span id="cb191-3982"><a href="#cb191-3982" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 heat_label,</span></span>
<span id="cb191-3983"><a href="#cb191-3983" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 &quot;)&quot;))))) +</span></span>
<span id="cb191-3984"><a href="#cb191-3984" aria-hidden="true" tabindex="-1"></a><span class="in">    ggtitle(&quot;Daily chill and heat accumulation rates&quot;) +</span></span>
<span id="cb191-3985"><a href="#cb191-3985" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) + </span></span>
<span id="cb191-3986"><a href="#cb191-3986" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(strip.background = element_blank(),</span></span>
<span id="cb191-3987"><a href="#cb191-3987" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.placement = &quot;outside&quot;,</span></span>
<span id="cb191-3988"><a href="#cb191-3988" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text.y = element_text(size = 12),</span></span>
<span id="cb191-3989"><a href="#cb191-3989" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb191-3990"><a href="#cb191-3990" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.y = element_blank()</span></span>
<span id="cb191-3991"><a href="#cb191-3991" aria-hidden="true" tabindex="-1"></a><span class="in">          )</span></span>
<span id="cb191-3992"><a href="#cb191-3992" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-3993"><a href="#cb191-3993" aria-hidden="true" tabindex="-1"></a><span class="in">  VIP_plot &lt;- ggplot(PLS_gg,</span></span>
<span id="cb191-3994"><a href="#cb191-3994" aria-hidden="true" tabindex="-1"></a><span class="in">                     aes(x = Date,</span></span>
<span id="cb191-3995"><a href="#cb191-3995" aria-hidden="true" tabindex="-1"></a><span class="in">                         y = VIP)) +</span></span>
<span id="cb191-3996"><a href="#cb191-3996" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate(&quot;rect&quot;,</span></span>
<span id="cb191-3997"><a href="#cb191-3997" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = chill_start_date,</span></span>
<span id="cb191-3998"><a href="#cb191-3998" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = chill_end_date,</span></span>
<span id="cb191-3999"><a href="#cb191-3999" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb191-4000"><a href="#cb191-4000" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb191-4001"><a href="#cb191-4001" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb191-4002"><a href="#cb191-4002" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = &quot;blue&quot;) +</span></span>
<span id="cb191-4003"><a href="#cb191-4003" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate(&quot;rect&quot;,</span></span>
<span id="cb191-4004"><a href="#cb191-4004" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = heat_start_date,</span></span>
<span id="cb191-4005"><a href="#cb191-4005" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = heat_end_date,</span></span>
<span id="cb191-4006"><a href="#cb191-4006" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb191-4007"><a href="#cb191-4007" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb191-4008"><a href="#cb191-4008" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb191-4009"><a href="#cb191-4009" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = &quot;red&quot;) +</span></span>
<span id="cb191-4010"><a href="#cb191-4010" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate(&quot;rect&quot;,</span></span>
<span id="cb191-4011"><a href="#cb191-4011" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = ISOdate(2001,</span></span>
<span id="cb191-4012"><a href="#cb191-4012" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb191-4013"><a href="#cb191-4013" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) + min(plscf$pheno$pheno,</span></span>
<span id="cb191-4014"><a href="#cb191-4014" aria-hidden="true" tabindex="-1"></a><span class="in">                                      na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb191-4015"><a href="#cb191-4015" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = ISOdate(2001,</span></span>
<span id="cb191-4016"><a href="#cb191-4016" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb191-4017"><a href="#cb191-4017" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) + max(plscf$pheno$pheno,</span></span>
<span id="cb191-4018"><a href="#cb191-4018" aria-hidden="true" tabindex="-1"></a><span class="in">                                      na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb191-4019"><a href="#cb191-4019" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb191-4020"><a href="#cb191-4020" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb191-4021"><a href="#cb191-4021" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb191-4022"><a href="#cb191-4022" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = &quot;black&quot;) +</span></span>
<span id="cb191-4023"><a href="#cb191-4023" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_vline(xintercept = ISOdate(2001,</span></span>
<span id="cb191-4024"><a href="#cb191-4024" aria-hidden="true" tabindex="-1"></a><span class="in">                                    12,</span></span>
<span id="cb191-4025"><a href="#cb191-4025" aria-hidden="true" tabindex="-1"></a><span class="in">                                    31) + median(plscf$pheno$pheno,</span></span>
<span id="cb191-4026"><a href="#cb191-4026" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb191-4027"><a href="#cb191-4027" aria-hidden="true" tabindex="-1"></a><span class="in">               linetype = &quot;dashed&quot;) +</span></span>
<span id="cb191-4028"><a href="#cb191-4028" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar(stat = &#39;identity&#39;,</span></span>
<span id="cb191-4029"><a href="#cb191-4029" aria-hidden="true" tabindex="-1"></a><span class="in">             aes(fill = VIP&gt;0.8)) +</span></span>
<span id="cb191-4030"><a href="#cb191-4030" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(vars(Type), </span></span>
<span id="cb191-4031"><a href="#cb191-4031" aria-hidden="true" tabindex="-1"></a><span class="in">               scales = &quot;free&quot;,</span></span>
<span id="cb191-4032"><a href="#cb191-4032" aria-hidden="true" tabindex="-1"></a><span class="in">               strip.position = &quot;left&quot;,</span></span>
<span id="cb191-4033"><a href="#cb191-4033" aria-hidden="true" tabindex="-1"></a><span class="in">               labeller = </span></span>
<span id="cb191-4034"><a href="#cb191-4034" aria-hidden="true" tabindex="-1"></a><span class="in">                 labeller(</span></span>
<span id="cb191-4035"><a href="#cb191-4035" aria-hidden="true" tabindex="-1"></a><span class="in">                   Type = as_labeller(c(Chill=&quot;VIP for chill&quot;,</span></span>
<span id="cb191-4036"><a href="#cb191-4036" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Heat=&quot;VIP for heat&quot;)))) +</span></span>
<span id="cb191-4037"><a href="#cb191-4037" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_y_continuous(</span></span>
<span id="cb191-4038"><a href="#cb191-4038" aria-hidden="true" tabindex="-1"></a><span class="in">      limits = c(0,</span></span>
<span id="cb191-4039"><a href="#cb191-4039" aria-hidden="true" tabindex="-1"></a><span class="in">                 max(plscf[[chill_metric]][[heat_metric]]$PLS_summary$VIP))) +</span></span>
<span id="cb191-4040"><a href="#cb191-4040" aria-hidden="true" tabindex="-1"></a><span class="in">    ggtitle(&quot;Variable Importance in the Projection (VIP) scores&quot;) +</span></span>
<span id="cb191-4041"><a href="#cb191-4041" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) + </span></span>
<span id="cb191-4042"><a href="#cb191-4042" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(strip.background = element_blank(),</span></span>
<span id="cb191-4043"><a href="#cb191-4043" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.placement = &quot;outside&quot;,</span></span>
<span id="cb191-4044"><a href="#cb191-4044" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text.y = element_text(size = 12),</span></span>
<span id="cb191-4045"><a href="#cb191-4045" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb191-4046"><a href="#cb191-4046" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.y = element_blank()</span></span>
<span id="cb191-4047"><a href="#cb191-4047" aria-hidden="true" tabindex="-1"></a><span class="in">          ) +</span></span>
<span id="cb191-4048"><a href="#cb191-4048" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_manual(name = &quot;VIP&quot;, </span></span>
<span id="cb191-4049"><a href="#cb191-4049" aria-hidden="true" tabindex="-1"></a><span class="in">                      labels = c(&quot;&lt;0.8&quot;, &quot;&gt;0.8&quot;), </span></span>
<span id="cb191-4050"><a href="#cb191-4050" aria-hidden="true" tabindex="-1"></a><span class="in">                      values = c(&quot;FALSE&quot; = &quot;grey&quot;,</span></span>
<span id="cb191-4051"><a href="#cb191-4051" aria-hidden="true" tabindex="-1"></a><span class="in">                                 &quot;TRUE&quot; = &quot;blue&quot;)) +</span></span>
<span id="cb191-4052"><a href="#cb191-4052" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(axis.text.x = element_blank(),</span></span>
<span id="cb191-4053"><a href="#cb191-4053" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.ticks.x = element_blank(),</span></span>
<span id="cb191-4054"><a href="#cb191-4054" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.x = element_blank(),</span></span>
<span id="cb191-4055"><a href="#cb191-4055" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.y = element_blank())</span></span>
<span id="cb191-4056"><a href="#cb191-4056" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4057"><a href="#cb191-4057" aria-hidden="true" tabindex="-1"></a><span class="in">  coeff_plot &lt;- ggplot(PLS_gg,</span></span>
<span id="cb191-4058"><a href="#cb191-4058" aria-hidden="true" tabindex="-1"></a><span class="in">                       aes(x = Date,</span></span>
<span id="cb191-4059"><a href="#cb191-4059" aria-hidden="true" tabindex="-1"></a><span class="in">                           y = Coef)) +</span></span>
<span id="cb191-4060"><a href="#cb191-4060" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate(&quot;rect&quot;,</span></span>
<span id="cb191-4061"><a href="#cb191-4061" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = chill_start_date,</span></span>
<span id="cb191-4062"><a href="#cb191-4062" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = chill_end_date,</span></span>
<span id="cb191-4063"><a href="#cb191-4063" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb191-4064"><a href="#cb191-4064" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb191-4065"><a href="#cb191-4065" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb191-4066"><a href="#cb191-4066" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = &quot;blue&quot;) +</span></span>
<span id="cb191-4067"><a href="#cb191-4067" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate(&quot;rect&quot;,</span></span>
<span id="cb191-4068"><a href="#cb191-4068" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = heat_start_date,</span></span>
<span id="cb191-4069"><a href="#cb191-4069" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = heat_end_date,</span></span>
<span id="cb191-4070"><a href="#cb191-4070" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb191-4071"><a href="#cb191-4071" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb191-4072"><a href="#cb191-4072" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb191-4073"><a href="#cb191-4073" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = &quot;red&quot;) +</span></span>
<span id="cb191-4074"><a href="#cb191-4074" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate(&quot;rect&quot;,</span></span>
<span id="cb191-4075"><a href="#cb191-4075" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = ISOdate(2001,</span></span>
<span id="cb191-4076"><a href="#cb191-4076" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb191-4077"><a href="#cb191-4077" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) + min(plscf$pheno$pheno,</span></span>
<span id="cb191-4078"><a href="#cb191-4078" aria-hidden="true" tabindex="-1"></a><span class="in">                                      na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb191-4079"><a href="#cb191-4079" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = ISOdate(2001,</span></span>
<span id="cb191-4080"><a href="#cb191-4080" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb191-4081"><a href="#cb191-4081" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) + max(plscf$pheno$pheno,</span></span>
<span id="cb191-4082"><a href="#cb191-4082" aria-hidden="true" tabindex="-1"></a><span class="in">                                      na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb191-4083"><a href="#cb191-4083" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb191-4084"><a href="#cb191-4084" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb191-4085"><a href="#cb191-4085" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb191-4086"><a href="#cb191-4086" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = &quot;black&quot;) +</span></span>
<span id="cb191-4087"><a href="#cb191-4087" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_vline(xintercept = ISOdate(2001,</span></span>
<span id="cb191-4088"><a href="#cb191-4088" aria-hidden="true" tabindex="-1"></a><span class="in">                                    12,</span></span>
<span id="cb191-4089"><a href="#cb191-4089" aria-hidden="true" tabindex="-1"></a><span class="in">                                    31) + median(plscf$pheno$pheno,</span></span>
<span id="cb191-4090"><a href="#cb191-4090" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb191-4091"><a href="#cb191-4091" aria-hidden="true" tabindex="-1"></a><span class="in">               linetype = &quot;dashed&quot;) +</span></span>
<span id="cb191-4092"><a href="#cb191-4092" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar(stat = &#39;identity&#39;,</span></span>
<span id="cb191-4093"><a href="#cb191-4093" aria-hidden="true" tabindex="-1"></a><span class="in">             aes(fill = VIP_Coeff)) +</span></span>
<span id="cb191-4094"><a href="#cb191-4094" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(vars(Type),</span></span>
<span id="cb191-4095"><a href="#cb191-4095" aria-hidden="true" tabindex="-1"></a><span class="in">               scales = &quot;free&quot;,</span></span>
<span id="cb191-4096"><a href="#cb191-4096" aria-hidden="true" tabindex="-1"></a><span class="in">               strip.position = &quot;left&quot;,</span></span>
<span id="cb191-4097"><a href="#cb191-4097" aria-hidden="true" tabindex="-1"></a><span class="in">               labeller =</span></span>
<span id="cb191-4098"><a href="#cb191-4098" aria-hidden="true" tabindex="-1"></a><span class="in">                 labeller(</span></span>
<span id="cb191-4099"><a href="#cb191-4099" aria-hidden="true" tabindex="-1"></a><span class="in">                   Type = as_labeller(c(Chill = &quot;MC for chill&quot;,</span></span>
<span id="cb191-4100"><a href="#cb191-4100" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Heat = &quot;MC for heat&quot;)))) +</span></span>
<span id="cb191-4101"><a href="#cb191-4101" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_y_continuous(</span></span>
<span id="cb191-4102"><a href="#cb191-4102" aria-hidden="true" tabindex="-1"></a><span class="in">      limits = c(min(plscf[[chill_metric]][[heat_metric]]$PLS_summary$Coef),</span></span>
<span id="cb191-4103"><a href="#cb191-4103" aria-hidden="true" tabindex="-1"></a><span class="in">                 max(plscf[[chill_metric]][[heat_metric]]$PLS_summary$Coef))) +</span></span>
<span id="cb191-4104"><a href="#cb191-4104" aria-hidden="true" tabindex="-1"></a><span class="in">    ggtitle(&quot;Model coefficients (MC)&quot;) +</span></span>
<span id="cb191-4105"><a href="#cb191-4105" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) + </span></span>
<span id="cb191-4106"><a href="#cb191-4106" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(strip.background = element_blank(),</span></span>
<span id="cb191-4107"><a href="#cb191-4107" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.placement = &quot;outside&quot;,</span></span>
<span id="cb191-4108"><a href="#cb191-4108" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text.y = element_text(size = 12),</span></span>
<span id="cb191-4109"><a href="#cb191-4109" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb191-4110"><a href="#cb191-4110" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.y = element_blank()</span></span>
<span id="cb191-4111"><a href="#cb191-4111" aria-hidden="true" tabindex="-1"></a><span class="in">          ) +</span></span>
<span id="cb191-4112"><a href="#cb191-4112" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_manual(name = &quot;Effect direction&quot;, </span></span>
<span id="cb191-4113"><a href="#cb191-4113" aria-hidden="true" tabindex="-1"></a><span class="in">                      labels = c(&quot;Advancing&quot;,</span></span>
<span id="cb191-4114"><a href="#cb191-4114" aria-hidden="true" tabindex="-1"></a><span class="in">                                 &quot;Unimportant&quot;,</span></span>
<span id="cb191-4115"><a href="#cb191-4115" aria-hidden="true" tabindex="-1"></a><span class="in">                                 &quot;Delaying&quot;), </span></span>
<span id="cb191-4116"><a href="#cb191-4116" aria-hidden="true" tabindex="-1"></a><span class="in">                      values = c(&quot;-1&quot; = &quot;red&quot;,</span></span>
<span id="cb191-4117"><a href="#cb191-4117" aria-hidden="true" tabindex="-1"></a><span class="in">                                 &quot;0&quot; = &quot;grey&quot;,</span></span>
<span id="cb191-4118"><a href="#cb191-4118" aria-hidden="true" tabindex="-1"></a><span class="in">                                 &quot;1&quot; = &quot;dark green&quot;)) +</span></span>
<span id="cb191-4119"><a href="#cb191-4119" aria-hidden="true" tabindex="-1"></a><span class="in">    ylab(&quot;PLS coefficient&quot;) +</span></span>
<span id="cb191-4120"><a href="#cb191-4120" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(axis.text.x = element_blank(),</span></span>
<span id="cb191-4121"><a href="#cb191-4121" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.ticks.x = element_blank(),</span></span>
<span id="cb191-4122"><a href="#cb191-4122" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.x = element_blank(),</span></span>
<span id="cb191-4123"><a href="#cb191-4123" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.y = element_blank())</span></span>
<span id="cb191-4124"><a href="#cb191-4124" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4125"><a href="#cb191-4125" aria-hidden="true" tabindex="-1"></a><span class="in">  library(patchwork)</span></span>
<span id="cb191-4126"><a href="#cb191-4126" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4127"><a href="#cb191-4127" aria-hidden="true" tabindex="-1"></a><span class="in">  plot &lt;- (VIP_plot +</span></span>
<span id="cb191-4128"><a href="#cb191-4128" aria-hidden="true" tabindex="-1"></a><span class="in">             coeff_plot +</span></span>
<span id="cb191-4129"><a href="#cb191-4129" aria-hidden="true" tabindex="-1"></a><span class="in">             temp_plot +</span></span>
<span id="cb191-4130"><a href="#cb191-4130" aria-hidden="true" tabindex="-1"></a><span class="in">             plot_layout(ncol = 1,</span></span>
<span id="cb191-4131"><a href="#cb191-4131" aria-hidden="true" tabindex="-1"></a><span class="in">                         guides = &quot;collect&quot;)</span></span>
<span id="cb191-4132"><a href="#cb191-4132" aria-hidden="true" tabindex="-1"></a><span class="in">           ) &amp; theme(legend.position = &quot;right&quot;,</span></span>
<span id="cb191-4133"><a href="#cb191-4133" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.text = element_text(size = 8),</span></span>
<span id="cb191-4134"><a href="#cb191-4134" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.title = element_text(size = 10),</span></span>
<span id="cb191-4135"><a href="#cb191-4135" aria-hidden="true" tabindex="-1"></a><span class="in">                     axis.title.x = element_blank())</span></span>
<span id="cb191-4136"><a href="#cb191-4136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4137"><a href="#cb191-4137" aria-hidden="true" tabindex="-1"></a><span class="in">plot</span></span>
<span id="cb191-4138"><a href="#cb191-4138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4139"><a href="#cb191-4139" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb191-4140"><a href="#cb191-4140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4141"><a href="#cb191-4141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4142"><a href="#cb191-4142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4143"><a href="#cb191-4143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4144"><a href="#cb191-4144" aria-hidden="true" tabindex="-1"></a><span class="in">plot_PLS_chill_force(plscf,</span></span>
<span id="cb191-4145"><a href="#cb191-4145" aria-hidden="true" tabindex="-1"></a><span class="in">                     chill_metric = &quot;Chill_Portions&quot;,</span></span>
<span id="cb191-4146"><a href="#cb191-4146" aria-hidden="true" tabindex="-1"></a><span class="in">                     heat_metric = &quot;GDH&quot;,</span></span>
<span id="cb191-4147"><a href="#cb191-4147" aria-hidden="true" tabindex="-1"></a><span class="in">                     chill_label = &quot;CP&quot;,</span></span>
<span id="cb191-4148"><a href="#cb191-4148" aria-hidden="true" tabindex="-1"></a><span class="in">                     heat_label = &quot;GDH&quot;,</span></span>
<span id="cb191-4149"><a href="#cb191-4149" aria-hidden="true" tabindex="-1"></a><span class="in">                     chill_phase = c(-48, 62),</span></span>
<span id="cb191-4150"><a href="#cb191-4150" aria-hidden="true" tabindex="-1"></a><span class="in">                     heat_phase = c(-5, 105.5))</span></span>
<span id="cb191-4151"><a href="#cb191-4151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-4152"><a href="#cb191-4152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4153"><a href="#cb191-4153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4154"><a href="#cb191-4154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb191-4155"><a href="#cb191-4155" aria-hidden="true" tabindex="-1"></a><span class="in">chill_phase &lt;- c(317, 62)</span></span>
<span id="cb191-4156"><a href="#cb191-4156" aria-hidden="true" tabindex="-1"></a><span class="in">heat_phase &lt;- c(360, 105.5)</span></span>
<span id="cb191-4157"><a href="#cb191-4157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4158"><a href="#cb191-4158" aria-hidden="true" tabindex="-1"></a><span class="in">chill &lt;- tempResponse(hourtemps = temps_hourly,</span></span>
<span id="cb191-4159"><a href="#cb191-4159" aria-hidden="true" tabindex="-1"></a><span class="in">                      Start_JDay = chill_phase[1],</span></span>
<span id="cb191-4160"><a href="#cb191-4160" aria-hidden="true" tabindex="-1"></a><span class="in">                      End_JDay = chill_phase[2],</span></span>
<span id="cb191-4161"><a href="#cb191-4161" aria-hidden="true" tabindex="-1"></a><span class="in">                      models = list(Chill_Portions = Dynamic_Model),</span></span>
<span id="cb191-4162"><a href="#cb191-4162" aria-hidden="true" tabindex="-1"></a><span class="in">                      misstolerance = 10)</span></span>
<span id="cb191-4163"><a href="#cb191-4163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4164"><a href="#cb191-4164" aria-hidden="true" tabindex="-1"></a><span class="in">heat &lt;- tempResponse(hourtemps = temps_hourly,</span></span>
<span id="cb191-4165"><a href="#cb191-4165" aria-hidden="true" tabindex="-1"></a><span class="in">                     Start_JDay = heat_phase[1],</span></span>
<span id="cb191-4166"><a href="#cb191-4166" aria-hidden="true" tabindex="-1"></a><span class="in">                     End_JDay = heat_phase[2],</span></span>
<span id="cb191-4167"><a href="#cb191-4167" aria-hidden="true" tabindex="-1"></a><span class="in">                     models = list(GDH = GDH))</span></span>
<span id="cb191-4168"><a href="#cb191-4168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4169"><a href="#cb191-4169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4170"><a href="#cb191-4170" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = chill,</span></span>
<span id="cb191-4171"><a href="#cb191-4171" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = Chill_Portions)) +</span></span>
<span id="cb191-4172"><a href="#cb191-4172" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram() +</span></span>
<span id="cb191-4173"><a href="#cb191-4173" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle(&quot;Chill accumulation during endodormancy (Chill Portions)&quot;) +</span></span>
<span id="cb191-4174"><a href="#cb191-4174" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab(&quot;Chill accumulation (Chill Portions)&quot;) +</span></span>
<span id="cb191-4175"><a href="#cb191-4175" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(&quot;Frequency between 1958 and 2019&quot;) +</span></span>
<span id="cb191-4176"><a href="#cb191-4176" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 12)</span></span>
<span id="cb191-4177"><a href="#cb191-4177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4178"><a href="#cb191-4178" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = heat,</span></span>
<span id="cb191-4179"><a href="#cb191-4179" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = GDH)) +</span></span>
<span id="cb191-4180"><a href="#cb191-4180" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram() +</span></span>
<span id="cb191-4181"><a href="#cb191-4181" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle(&quot;Heat accumulation during ecodormancy (GDH)&quot;) +</span></span>
<span id="cb191-4182"><a href="#cb191-4182" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab(&quot;Heat accumulation (Growing Degree Hours)&quot;) +</span></span>
<span id="cb191-4183"><a href="#cb191-4183" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(&quot;Frequency between 1958 and 2019&quot;) +</span></span>
<span id="cb191-4184"><a href="#cb191-4184" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 12)</span></span>
<span id="cb191-4185"><a href="#cb191-4185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4186"><a href="#cb191-4186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4187"><a href="#cb191-4187" aria-hidden="true" tabindex="-1"></a><span class="in">chill_requirement &lt;- mean(chill$Chill_Portions)</span></span>
<span id="cb191-4188"><a href="#cb191-4188" aria-hidden="true" tabindex="-1"></a><span class="in">chill_req_error &lt;- sd(chill$Chill_Portions)</span></span>
<span id="cb191-4189"><a href="#cb191-4189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4190"><a href="#cb191-4190" aria-hidden="true" tabindex="-1"></a><span class="in">chill_nonpara &lt;- quantile(chill$Chill_Portions,</span></span>
<span id="cb191-4191"><a href="#cb191-4191" aria-hidden="true" tabindex="-1"></a><span class="in">                          c(0.05, 0.5, 0.95))</span></span>
<span id="cb191-4192"><a href="#cb191-4192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4193"><a href="#cb191-4193" aria-hidden="true" tabindex="-1"></a><span class="in">heat_requirement &lt;- mean(heat$GDH)</span></span>
<span id="cb191-4194"><a href="#cb191-4194" aria-hidden="true" tabindex="-1"></a><span class="in">heat_req_error &lt;- sd(heat$GDH)</span></span>
<span id="cb191-4195"><a href="#cb191-4195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4196"><a href="#cb191-4196" aria-hidden="true" tabindex="-1"></a><span class="in">heat_nonpara &lt;- quantile(heat$GDH,</span></span>
<span id="cb191-4197"><a href="#cb191-4197" aria-hidden="true" tabindex="-1"></a><span class="in">                          c(0.05, 0.5, 0.95))</span></span>
<span id="cb191-4198"><a href="#cb191-4198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4199"><a href="#cb191-4199" aria-hidden="true" tabindex="-1"></a><span class="in">chill_phase &lt;- c(317, 62)</span></span>
<span id="cb191-4200"><a href="#cb191-4200" aria-hidden="true" tabindex="-1"></a><span class="in">heat_phase &lt;- c(360, 106)</span></span>
<span id="cb191-4201"><a href="#cb191-4201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4202"><a href="#cb191-4202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4203"><a href="#cb191-4203" aria-hidden="true" tabindex="-1"></a><span class="in">mpt &lt;- make_pheno_trend_plot(weather_data_frame = temps,</span></span>
<span id="cb191-4204"><a href="#cb191-4204" aria-hidden="true" tabindex="-1"></a><span class="in">                             pheno = Roter_first,</span></span>
<span id="cb191-4205"><a href="#cb191-4205" aria-hidden="true" tabindex="-1"></a><span class="in">                             Start_JDay_chill = chill_phase[1],</span></span>
<span id="cb191-4206"><a href="#cb191-4206" aria-hidden="true" tabindex="-1"></a><span class="in">                             End_JDay_chill = chill_phase[2],</span></span>
<span id="cb191-4207"><a href="#cb191-4207" aria-hidden="true" tabindex="-1"></a><span class="in">                             Start_JDay_heat = heat_phase[1],</span></span>
<span id="cb191-4208"><a href="#cb191-4208" aria-hidden="true" tabindex="-1"></a><span class="in">                             End_JDay_heat = heat_phase[2],</span></span>
<span id="cb191-4209"><a href="#cb191-4209" aria-hidden="true" tabindex="-1"></a><span class="in">                             outpath = &quot;data/&quot;,</span></span>
<span id="cb191-4210"><a href="#cb191-4210" aria-hidden="true" tabindex="-1"></a><span class="in">                             file_name = &quot;pheno_trend_plot&quot;,</span></span>
<span id="cb191-4211"><a href="#cb191-4211" aria-hidden="true" tabindex="-1"></a><span class="in">                             plot_title =  &quot;Impacts of chilling and forcing temperatures on pear phenology&quot;,</span></span>
<span id="cb191-4212"><a href="#cb191-4212" aria-hidden="true" tabindex="-1"></a><span class="in">                             image_type = &quot;png&quot;,</span></span>
<span id="cb191-4213"><a href="#cb191-4213" aria-hidden="true" tabindex="-1"></a><span class="in">                             colorscheme = &quot;normal&quot;)</span></span>
<span id="cb191-4214"><a href="#cb191-4214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4215"><a href="#cb191-4215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4216"><a href="#cb191-4216" aria-hidden="true" tabindex="-1"></a><span class="in">mean_temp_period &lt;- function(</span></span>
<span id="cb191-4217"><a href="#cb191-4217" aria-hidden="true" tabindex="-1"></a><span class="in">    temps,</span></span>
<span id="cb191-4218"><a href="#cb191-4218" aria-hidden="true" tabindex="-1"></a><span class="in">    start_JDay,</span></span>
<span id="cb191-4219"><a href="#cb191-4219" aria-hidden="true" tabindex="-1"></a><span class="in">    end_JDay,</span></span>
<span id="cb191-4220"><a href="#cb191-4220" aria-hidden="true" tabindex="-1"></a><span class="in">    end_season = end_JDay)</span></span>
<span id="cb191-4221"><a href="#cb191-4221" aria-hidden="true" tabindex="-1"></a><span class="in">{ temps_JDay &lt;- make_JDay(temps) %&gt;%</span></span>
<span id="cb191-4222"><a href="#cb191-4222" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Season =Year)</span></span>
<span id="cb191-4223"><a href="#cb191-4223" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4224"><a href="#cb191-4224" aria-hidden="true" tabindex="-1"></a><span class="in">  if(start_JDay &gt; end_season)</span></span>
<span id="cb191-4225"><a href="#cb191-4225" aria-hidden="true" tabindex="-1"></a><span class="in">    temps_JDay$Season[which(temps_JDay$JDay &gt;= start_JDay)]&lt;-</span></span>
<span id="cb191-4226"><a href="#cb191-4226" aria-hidden="true" tabindex="-1"></a><span class="in">        temps_JDay$Year[which(temps_JDay$JDay &gt;= start_JDay)]+1</span></span>
<span id="cb191-4227"><a href="#cb191-4227" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4228"><a href="#cb191-4228" aria-hidden="true" tabindex="-1"></a><span class="in">  if(start_JDay &gt; end_season)</span></span>
<span id="cb191-4229"><a href="#cb191-4229" aria-hidden="true" tabindex="-1"></a><span class="in">    sub_temps &lt;- subset(temps_JDay,</span></span>
<span id="cb191-4230"><a href="#cb191-4230" aria-hidden="true" tabindex="-1"></a><span class="in">                        JDay &lt;= end_JDay | JDay &gt;= start_JDay)</span></span>
<span id="cb191-4231"><a href="#cb191-4231" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4232"><a href="#cb191-4232" aria-hidden="true" tabindex="-1"></a><span class="in">  if(start_JDay &lt;= end_JDay)</span></span>
<span id="cb191-4233"><a href="#cb191-4233" aria-hidden="true" tabindex="-1"></a><span class="in">    sub_temps &lt;- subset(temps_JDay,</span></span>
<span id="cb191-4234"><a href="#cb191-4234" aria-hidden="true" tabindex="-1"></a><span class="in">                        JDay &lt;= end_JDay &amp; JDay &gt;= start_JDay)</span></span>
<span id="cb191-4235"><a href="#cb191-4235" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4236"><a href="#cb191-4236" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_temps &lt;- aggregate(sub_temps[, c(&quot;Tmin&quot;, &quot;Tmax&quot;)],</span></span>
<span id="cb191-4237"><a href="#cb191-4237" aria-hidden="true" tabindex="-1"></a><span class="in">                          by = list(sub_temps$Season),</span></span>
<span id="cb191-4238"><a href="#cb191-4238" aria-hidden="true" tabindex="-1"></a><span class="in">                          FUN = function(x) mean(x,</span></span>
<span id="cb191-4239"><a href="#cb191-4239" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 na.rm=TRUE))</span></span>
<span id="cb191-4240"><a href="#cb191-4240" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4241"><a href="#cb191-4241" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_temps[, &quot;n_days&quot;] &lt;- aggregate(sub_temps[, &quot;Tmin&quot;],</span></span>
<span id="cb191-4242"><a href="#cb191-4242" aria-hidden="true" tabindex="-1"></a><span class="in">                                      by = list(sub_temps$Season),</span></span>
<span id="cb191-4243"><a href="#cb191-4243" aria-hidden="true" tabindex="-1"></a><span class="in">                                      FUN = length)[,2]</span></span>
<span id="cb191-4244"><a href="#cb191-4244" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4245"><a href="#cb191-4245" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_temps[, &quot;Tmean&quot;] &lt;- (mean_temps$Tmin + mean_temps$Tmax) / 2</span></span>
<span id="cb191-4246"><a href="#cb191-4246" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_temps &lt;- mean_temps[, c(1, 4, 2, 3, 5)]</span></span>
<span id="cb191-4247"><a href="#cb191-4247" aria-hidden="true" tabindex="-1"></a><span class="in">  colnames(mean_temps)[1] &lt;- &quot;End_year&quot;</span></span>
<span id="cb191-4248"><a href="#cb191-4248" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4249"><a href="#cb191-4249" aria-hidden="true" tabindex="-1"></a><span class="in">  return(mean_temps)</span></span>
<span id="cb191-4250"><a href="#cb191-4250" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb191-4251"><a href="#cb191-4251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4252"><a href="#cb191-4252" aria-hidden="true" tabindex="-1"></a><span class="in">mean_temp_chill &lt;- mean_temp_period(temps = temps,</span></span>
<span id="cb191-4253"><a href="#cb191-4253" aria-hidden="true" tabindex="-1"></a><span class="in">                                    start_JDay = chill_phase[1],</span></span>
<span id="cb191-4254"><a href="#cb191-4254" aria-hidden="true" tabindex="-1"></a><span class="in">                                    end_JDay = chill_phase[2],</span></span>
<span id="cb191-4255"><a href="#cb191-4255" aria-hidden="true" tabindex="-1"></a><span class="in">                                    end_season = 60)</span></span>
<span id="cb191-4256"><a href="#cb191-4256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4257"><a href="#cb191-4257" aria-hidden="true" tabindex="-1"></a><span class="in">mean_temp_heat &lt;- mean_temp_period(temps = temps,</span></span>
<span id="cb191-4258"><a href="#cb191-4258" aria-hidden="true" tabindex="-1"></a><span class="in">                                   start_JDay = heat_phase[1],</span></span>
<span id="cb191-4259"><a href="#cb191-4259" aria-hidden="true" tabindex="-1"></a><span class="in">                                   end_JDay = heat_phase[2],</span></span>
<span id="cb191-4260"><a href="#cb191-4260" aria-hidden="true" tabindex="-1"></a><span class="in">                                   end_season = 60)</span></span>
<span id="cb191-4261"><a href="#cb191-4261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4262"><a href="#cb191-4262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4263"><a href="#cb191-4263" aria-hidden="true" tabindex="-1"></a><span class="in">mean_temp_chill &lt;- </span></span>
<span id="cb191-4264"><a href="#cb191-4264" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_temp_chill[which(mean_temp_chill$n_days &gt;=</span></span>
<span id="cb191-4265"><a href="#cb191-4265" aria-hidden="true" tabindex="-1"></a><span class="in">                          max(mean_temp_chill$n_days)-1),]</span></span>
<span id="cb191-4266"><a href="#cb191-4266" aria-hidden="true" tabindex="-1"></a><span class="in">mean_temp_heat &lt;-</span></span>
<span id="cb191-4267"><a href="#cb191-4267" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_temp_heat[which(mean_temp_heat$n_days &gt;=</span></span>
<span id="cb191-4268"><a href="#cb191-4268" aria-hidden="true" tabindex="-1"></a><span class="in">                         max(mean_temp_heat$n_days)-1),]</span></span>
<span id="cb191-4269"><a href="#cb191-4269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4270"><a href="#cb191-4270" aria-hidden="true" tabindex="-1"></a><span class="in">mean_chill &lt;- mean_temp_chill[, c(&quot;End_year&quot;,</span></span>
<span id="cb191-4271"><a href="#cb191-4271" aria-hidden="true" tabindex="-1"></a><span class="in">                                  &quot;Tmean&quot;)]</span></span>
<span id="cb191-4272"><a href="#cb191-4272" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(mean_chill)[2] &lt;- &quot;Tmean_chill&quot;</span></span>
<span id="cb191-4273"><a href="#cb191-4273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4274"><a href="#cb191-4274" aria-hidden="true" tabindex="-1"></a><span class="in">mean_heat &lt;- mean_temp_heat[,c(&quot;End_year&quot;,</span></span>
<span id="cb191-4275"><a href="#cb191-4275" aria-hidden="true" tabindex="-1"></a><span class="in">                               &quot;Tmean&quot;)]</span></span>
<span id="cb191-4276"><a href="#cb191-4276" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(mean_heat)[2] &lt;- &quot;Tmean_heat&quot;</span></span>
<span id="cb191-4277"><a href="#cb191-4277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4278"><a href="#cb191-4278" aria-hidden="true" tabindex="-1"></a><span class="in">phase_Tmeans &lt;- merge(mean_chill,</span></span>
<span id="cb191-4279"><a href="#cb191-4279" aria-hidden="true" tabindex="-1"></a><span class="in">                      mean_heat, </span></span>
<span id="cb191-4280"><a href="#cb191-4280" aria-hidden="true" tabindex="-1"></a><span class="in">                      by = &quot;End_year&quot;)</span></span>
<span id="cb191-4281"><a href="#cb191-4281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4282"><a href="#cb191-4282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4283"><a href="#cb191-4283" aria-hidden="true" tabindex="-1"></a><span class="in">pheno &lt;- Roter_first</span></span>
<span id="cb191-4284"><a href="#cb191-4284" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(pheno)[1] &lt;- &quot;End_year&quot;</span></span>
<span id="cb191-4285"><a href="#cb191-4285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4286"><a href="#cb191-4286" aria-hidden="true" tabindex="-1"></a><span class="in">Tmeans_pheno &lt;- merge(phase_Tmeans,</span></span>
<span id="cb191-4287"><a href="#cb191-4287" aria-hidden="true" tabindex="-1"></a><span class="in">                      pheno,</span></span>
<span id="cb191-4288"><a href="#cb191-4288" aria-hidden="true" tabindex="-1"></a><span class="in">                      by = &quot;End_year&quot;)</span></span>
<span id="cb191-4289"><a href="#cb191-4289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4290"><a href="#cb191-4290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4291"><a href="#cb191-4291" aria-hidden="true" tabindex="-1"></a><span class="in">head(Tmeans_pheno)</span></span>
<span id="cb191-4292"><a href="#cb191-4292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4293"><a href="#cb191-4293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4294"><a href="#cb191-4294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4295"><a href="#cb191-4295" aria-hidden="true" tabindex="-1"></a><span class="in">library(fields)</span></span>
<span id="cb191-4296"><a href="#cb191-4296" aria-hidden="true" tabindex="-1"></a><span class="in">k &lt;- Krig(x = as.matrix(</span></span>
<span id="cb191-4297"><a href="#cb191-4297" aria-hidden="true" tabindex="-1"></a><span class="in">                Tmeans_pheno[,</span></span>
<span id="cb191-4298"><a href="#cb191-4298" aria-hidden="true" tabindex="-1"></a><span class="in">                             c(&quot;Tmean_chill&quot;,</span></span>
<span id="cb191-4299"><a href="#cb191-4299" aria-hidden="true" tabindex="-1"></a><span class="in">                               &quot;Tmean_heat&quot;)]),</span></span>
<span id="cb191-4300"><a href="#cb191-4300" aria-hidden="true" tabindex="-1"></a><span class="in">          Y = Tmeans_pheno$pheno)</span></span>
<span id="cb191-4301"><a href="#cb191-4301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4302"><a href="#cb191-4302" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- predictSurface(k)</span></span>
<span id="cb191-4303"><a href="#cb191-4303" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(pred$z) &lt;- pred$y</span></span>
<span id="cb191-4304"><a href="#cb191-4304" aria-hidden="true" tabindex="-1"></a><span class="in">rownames(pred$z) &lt;- pred$x</span></span>
<span id="cb191-4305"><a href="#cb191-4305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4306"><a href="#cb191-4306" aria-hidden="true" tabindex="-1"></a><span class="in">library(reshape2)</span></span>
<span id="cb191-4307"><a href="#cb191-4307" aria-hidden="true" tabindex="-1"></a><span class="in">melted &lt;- melt(pred$z)</span></span>
<span id="cb191-4308"><a href="#cb191-4308" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4309"><a href="#cb191-4309" aria-hidden="true" tabindex="-1"></a><span class="in">library(metR)</span></span>
<span id="cb191-4310"><a href="#cb191-4310" aria-hidden="true" tabindex="-1"></a><span class="in">library(colorRamps)</span></span>
<span id="cb191-4311"><a href="#cb191-4311" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4312"><a href="#cb191-4312" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(melted) &lt;- c(&quot;Tmean_chill&quot;,</span></span>
<span id="cb191-4313"><a href="#cb191-4313" aria-hidden="true" tabindex="-1"></a><span class="in">                      &quot;Tmean_heat&quot;,</span></span>
<span id="cb191-4314"><a href="#cb191-4314" aria-hidden="true" tabindex="-1"></a><span class="in">                      &quot;value&quot;)</span></span>
<span id="cb191-4315"><a href="#cb191-4315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4316"><a href="#cb191-4316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4317"><a href="#cb191-4317" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(melted,</span></span>
<span id="cb191-4318"><a href="#cb191-4318" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = Tmean_chill,</span></span>
<span id="cb191-4319"><a href="#cb191-4319" aria-hidden="true" tabindex="-1"></a><span class="in">           y = Tmean_heat,</span></span>
<span id="cb191-4320"><a href="#cb191-4320" aria-hidden="true" tabindex="-1"></a><span class="in">           z = value)) +</span></span>
<span id="cb191-4321"><a href="#cb191-4321" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_contour_fill(bins = 100) +</span></span>
<span id="cb191-4322"><a href="#cb191-4322" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(colours = alpha(matlab.like(15)),</span></span>
<span id="cb191-4323"><a href="#cb191-4323" aria-hidden="true" tabindex="-1"></a><span class="in">                       name = &quot;Bloom date \n(day of the year)&quot;) +</span></span>
<span id="cb191-4324"><a href="#cb191-4324" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_contour(col = &quot;black&quot;)  +</span></span>
<span id="cb191-4325"><a href="#cb191-4325" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = Tmeans_pheno,</span></span>
<span id="cb191-4326"><a href="#cb191-4326" aria-hidden="true" tabindex="-1"></a><span class="in">             aes(x = Tmean_chill,</span></span>
<span id="cb191-4327"><a href="#cb191-4327" aria-hidden="true" tabindex="-1"></a><span class="in">                 y = Tmean_heat,</span></span>
<span id="cb191-4328"><a href="#cb191-4328" aria-hidden="true" tabindex="-1"></a><span class="in">                 z = NULL),</span></span>
<span id="cb191-4329"><a href="#cb191-4329" aria-hidden="true" tabindex="-1"></a><span class="in">             size = 0.7) +</span></span>
<span id="cb191-4330"><a href="#cb191-4330" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text_contour(stroke = 0.2) +</span></span>
<span id="cb191-4331"><a href="#cb191-4331" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(expression(paste(&quot;Forcing phase &quot;, </span></span>
<span id="cb191-4332"><a href="#cb191-4332" aria-hidden="true" tabindex="-1"></a><span class="in">                        T[mean],</span></span>
<span id="cb191-4333"><a href="#cb191-4333" aria-hidden="true" tabindex="-1"></a><span class="in">                        &quot; (&quot;,</span></span>
<span id="cb191-4334"><a href="#cb191-4334" aria-hidden="true" tabindex="-1"></a><span class="in">                        degree,</span></span>
<span id="cb191-4335"><a href="#cb191-4335" aria-hidden="true" tabindex="-1"></a><span class="in">                        &quot;C)&quot;))) +</span></span>
<span id="cb191-4336"><a href="#cb191-4336" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab(expression(paste(&quot;Chilling phase &quot;,</span></span>
<span id="cb191-4337"><a href="#cb191-4337" aria-hidden="true" tabindex="-1"></a><span class="in">                        T[mean],</span></span>
<span id="cb191-4338"><a href="#cb191-4338" aria-hidden="true" tabindex="-1"></a><span class="in">                        &quot; (&quot;,</span></span>
<span id="cb191-4339"><a href="#cb191-4339" aria-hidden="true" tabindex="-1"></a><span class="in">                        degree,</span></span>
<span id="cb191-4340"><a href="#cb191-4340" aria-hidden="true" tabindex="-1"></a><span class="in">                        &quot;C)&quot;)))  +</span></span>
<span id="cb191-4341"><a href="#cb191-4341" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15)</span></span>
<span id="cb191-4342"><a href="#cb191-4342" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb191-4343"><a href="#cb191-4343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4344"><a href="#cb191-4344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4345"><a href="#cb191-4345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4346"><a href="#cb191-4346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4347"><a href="#cb191-4347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4348"><a href="#cb191-4348" aria-hidden="true" tabindex="-1"></a><span class="in">pheno_trend_ggplot &lt;- function(temps,</span></span>
<span id="cb191-4349"><a href="#cb191-4349" aria-hidden="true" tabindex="-1"></a><span class="in">                               pheno,</span></span>
<span id="cb191-4350"><a href="#cb191-4350" aria-hidden="true" tabindex="-1"></a><span class="in">                               chill_phase,</span></span>
<span id="cb191-4351"><a href="#cb191-4351" aria-hidden="true" tabindex="-1"></a><span class="in">                               heat_phase,</span></span>
<span id="cb191-4352"><a href="#cb191-4352" aria-hidden="true" tabindex="-1"></a><span class="in">                               phenology_stage = &quot;Bloom&quot;)</span></span>
<span id="cb191-4353"><a href="#cb191-4353" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb191-4354"><a href="#cb191-4354" aria-hidden="true" tabindex="-1"></a><span class="in">  library(fields)</span></span>
<span id="cb191-4355"><a href="#cb191-4355" aria-hidden="true" tabindex="-1"></a><span class="in">  library(reshape2)</span></span>
<span id="cb191-4356"><a href="#cb191-4356" aria-hidden="true" tabindex="-1"></a><span class="in">  library(metR)</span></span>
<span id="cb191-4357"><a href="#cb191-4357" aria-hidden="true" tabindex="-1"></a><span class="in">  library(ggplot2)</span></span>
<span id="cb191-4358"><a href="#cb191-4358" aria-hidden="true" tabindex="-1"></a><span class="in">  library(colorRamps)</span></span>
<span id="cb191-4359"><a href="#cb191-4359" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4360"><a href="#cb191-4360" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_temp_period &lt;- function(temps,</span></span>
<span id="cb191-4361"><a href="#cb191-4361" aria-hidden="true" tabindex="-1"></a><span class="in">                               start_JDay,</span></span>
<span id="cb191-4362"><a href="#cb191-4362" aria-hidden="true" tabindex="-1"></a><span class="in">                               end_JDay, </span></span>
<span id="cb191-4363"><a href="#cb191-4363" aria-hidden="true" tabindex="-1"></a><span class="in">                               end_season = end_JDay)</span></span>
<span id="cb191-4364"><a href="#cb191-4364" aria-hidden="true" tabindex="-1"></a><span class="in">    { temps_JDay &lt;- make_JDay(temps) %&gt;%</span></span>
<span id="cb191-4365"><a href="#cb191-4365" aria-hidden="true" tabindex="-1"></a><span class="in">      mutate(Season = Year)</span></span>
<span id="cb191-4366"><a href="#cb191-4366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4367"><a href="#cb191-4367" aria-hidden="true" tabindex="-1"></a><span class="in">    if(start_JDay &gt; end_season)</span></span>
<span id="cb191-4368"><a href="#cb191-4368" aria-hidden="true" tabindex="-1"></a><span class="in">      temps_JDay$Season[which(temps_JDay$JDay &gt;= start_JDay)] &lt;-</span></span>
<span id="cb191-4369"><a href="#cb191-4369" aria-hidden="true" tabindex="-1"></a><span class="in">        temps_JDay$Year[which(temps_JDay$JDay &gt;= start_JDay)]+1</span></span>
<span id="cb191-4370"><a href="#cb191-4370" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb191-4371"><a href="#cb191-4371" aria-hidden="true" tabindex="-1"></a><span class="in">    if(start_JDay &gt; end_season)</span></span>
<span id="cb191-4372"><a href="#cb191-4372" aria-hidden="true" tabindex="-1"></a><span class="in">      sub_temps &lt;- subset(temps_JDay,</span></span>
<span id="cb191-4373"><a href="#cb191-4373" aria-hidden="true" tabindex="-1"></a><span class="in">                          JDay &lt;= end_JDay | JDay &gt;= start_JDay)</span></span>
<span id="cb191-4374"><a href="#cb191-4374" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb191-4375"><a href="#cb191-4375" aria-hidden="true" tabindex="-1"></a><span class="in">    if(start_JDay &lt;= end_JDay)</span></span>
<span id="cb191-4376"><a href="#cb191-4376" aria-hidden="true" tabindex="-1"></a><span class="in">      sub_temps &lt;- subset(temps_JDay,</span></span>
<span id="cb191-4377"><a href="#cb191-4377" aria-hidden="true" tabindex="-1"></a><span class="in">                          JDay &lt;= end_JDay &amp; JDay &gt;= start_JDay)</span></span>
<span id="cb191-4378"><a href="#cb191-4378" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb191-4379"><a href="#cb191-4379" aria-hidden="true" tabindex="-1"></a><span class="in">    mean_temps &lt;- aggregate(sub_temps[,</span></span>
<span id="cb191-4380"><a href="#cb191-4380" aria-hidden="true" tabindex="-1"></a><span class="in">                                      c(&quot;Tmin&quot;,</span></span>
<span id="cb191-4381"><a href="#cb191-4381" aria-hidden="true" tabindex="-1"></a><span class="in">                                        &quot;Tmax&quot;)],</span></span>
<span id="cb191-4382"><a href="#cb191-4382" aria-hidden="true" tabindex="-1"></a><span class="in">                            by = list(sub_temps$Season),</span></span>
<span id="cb191-4383"><a href="#cb191-4383" aria-hidden="true" tabindex="-1"></a><span class="in">                            FUN = function(x) mean(x,</span></span>
<span id="cb191-4384"><a href="#cb191-4384" aria-hidden="true" tabindex="-1"></a><span class="in">                                                   na.rm = TRUE))</span></span>
<span id="cb191-4385"><a href="#cb191-4385" aria-hidden="true" tabindex="-1"></a><span class="in">    mean_temps[, &quot;n_days&quot;] &lt;- aggregate(sub_temps[,</span></span>
<span id="cb191-4386"><a href="#cb191-4386" aria-hidden="true" tabindex="-1"></a><span class="in">                                                  &quot;Tmin&quot;],</span></span>
<span id="cb191-4387"><a href="#cb191-4387" aria-hidden="true" tabindex="-1"></a><span class="in">                                        by = list(sub_temps$Season),</span></span>
<span id="cb191-4388"><a href="#cb191-4388" aria-hidden="true" tabindex="-1"></a><span class="in">                                        FUN = length)[,2]</span></span>
<span id="cb191-4389"><a href="#cb191-4389" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb191-4390"><a href="#cb191-4390" aria-hidden="true" tabindex="-1"></a><span class="in">    mean_temps[,&quot;Tmean&quot;] &lt;- (mean_temps$Tmin + mean_temps$Tmax) / 2</span></span>
<span id="cb191-4391"><a href="#cb191-4391" aria-hidden="true" tabindex="-1"></a><span class="in">    mean_temps &lt;- mean_temps[, c(1, 4, 2, 3, 5)]</span></span>
<span id="cb191-4392"><a href="#cb191-4392" aria-hidden="true" tabindex="-1"></a><span class="in">    colnames(mean_temps)[1] &lt;- &quot;End_year&quot;</span></span>
<span id="cb191-4393"><a href="#cb191-4393" aria-hidden="true" tabindex="-1"></a><span class="in">    return(mean_temps)</span></span>
<span id="cb191-4394"><a href="#cb191-4394" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb191-4395"><a href="#cb191-4395" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4396"><a href="#cb191-4396" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_temp_chill &lt;- mean_temp_period(temps = temps,</span></span>
<span id="cb191-4397"><a href="#cb191-4397" aria-hidden="true" tabindex="-1"></a><span class="in">                                      start_JDay = chill_phase[1],</span></span>
<span id="cb191-4398"><a href="#cb191-4398" aria-hidden="true" tabindex="-1"></a><span class="in">                                      end_JDay = chill_phase[2],</span></span>
<span id="cb191-4399"><a href="#cb191-4399" aria-hidden="true" tabindex="-1"></a><span class="in">                                      end_season = heat_phase[2])</span></span>
<span id="cb191-4400"><a href="#cb191-4400" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4401"><a href="#cb191-4401" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_temp_heat &lt;- mean_temp_period(temps = temps,</span></span>
<span id="cb191-4402"><a href="#cb191-4402" aria-hidden="true" tabindex="-1"></a><span class="in">                                     start_JDay = heat_phase[1],</span></span>
<span id="cb191-4403"><a href="#cb191-4403" aria-hidden="true" tabindex="-1"></a><span class="in">                                     end_JDay = heat_phase[2],</span></span>
<span id="cb191-4404"><a href="#cb191-4404" aria-hidden="true" tabindex="-1"></a><span class="in">                                     end_season = heat_phase[2])</span></span>
<span id="cb191-4405"><a href="#cb191-4405" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4406"><a href="#cb191-4406" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_temp_chill &lt;-</span></span>
<span id="cb191-4407"><a href="#cb191-4407" aria-hidden="true" tabindex="-1"></a><span class="in">    mean_temp_chill[which(mean_temp_chill$n_days &gt;= </span></span>
<span id="cb191-4408"><a href="#cb191-4408" aria-hidden="true" tabindex="-1"></a><span class="in">                            max(mean_temp_chill$n_days)-1),]</span></span>
<span id="cb191-4409"><a href="#cb191-4409" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_temp_heat &lt;-</span></span>
<span id="cb191-4410"><a href="#cb191-4410" aria-hidden="true" tabindex="-1"></a><span class="in">    mean_temp_heat[which(mean_temp_heat$n_days &gt;= </span></span>
<span id="cb191-4411"><a href="#cb191-4411" aria-hidden="true" tabindex="-1"></a><span class="in">                           max(mean_temp_heat$n_days)-1),]</span></span>
<span id="cb191-4412"><a href="#cb191-4412" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_chill &lt;- mean_temp_chill[, c(&quot;End_year&quot;,</span></span>
<span id="cb191-4413"><a href="#cb191-4413" aria-hidden="true" tabindex="-1"></a><span class="in">                                    &quot;Tmean&quot;)]</span></span>
<span id="cb191-4414"><a href="#cb191-4414" aria-hidden="true" tabindex="-1"></a><span class="in">  colnames(mean_chill)[2] &lt;- &quot;Tmean_chill&quot;</span></span>
<span id="cb191-4415"><a href="#cb191-4415" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_heat&lt;-mean_temp_heat[,c(&quot;End_year&quot;,</span></span>
<span id="cb191-4416"><a href="#cb191-4416" aria-hidden="true" tabindex="-1"></a><span class="in">                               &quot;Tmean&quot;)]</span></span>
<span id="cb191-4417"><a href="#cb191-4417" aria-hidden="true" tabindex="-1"></a><span class="in">  colnames(mean_heat)[2] &lt;- &quot;Tmean_heat&quot;</span></span>
<span id="cb191-4418"><a href="#cb191-4418" aria-hidden="true" tabindex="-1"></a><span class="in">  phase_Tmeans &lt;- merge(mean_chill,</span></span>
<span id="cb191-4419"><a href="#cb191-4419" aria-hidden="true" tabindex="-1"></a><span class="in">                        mean_heat,</span></span>
<span id="cb191-4420"><a href="#cb191-4420" aria-hidden="true" tabindex="-1"></a><span class="in">                        by = &quot;End_year&quot;)</span></span>
<span id="cb191-4421"><a href="#cb191-4421" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4422"><a href="#cb191-4422" aria-hidden="true" tabindex="-1"></a><span class="in">  colnames(pheno) &lt;- c(&quot;End_year&quot;,</span></span>
<span id="cb191-4423"><a href="#cb191-4423" aria-hidden="true" tabindex="-1"></a><span class="in">                       &quot;pheno&quot;)</span></span>
<span id="cb191-4424"><a href="#cb191-4424" aria-hidden="true" tabindex="-1"></a><span class="in">  Tmeans_pheno &lt;- merge(phase_Tmeans,</span></span>
<span id="cb191-4425"><a href="#cb191-4425" aria-hidden="true" tabindex="-1"></a><span class="in">                        pheno, </span></span>
<span id="cb191-4426"><a href="#cb191-4426" aria-hidden="true" tabindex="-1"></a><span class="in">                        by=&quot;End_year&quot;)</span></span>
<span id="cb191-4427"><a href="#cb191-4427" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4428"><a href="#cb191-4428" aria-hidden="true" tabindex="-1"></a><span class="in">  # Kriging interpolation</span></span>
<span id="cb191-4429"><a href="#cb191-4429" aria-hidden="true" tabindex="-1"></a><span class="in">  k &lt;- Krig(x = as.matrix(Tmeans_pheno[,c(&quot;Tmean_chill&quot;,</span></span>
<span id="cb191-4430"><a href="#cb191-4430" aria-hidden="true" tabindex="-1"></a><span class="in">                                          &quot;Tmean_heat&quot;)]),</span></span>
<span id="cb191-4431"><a href="#cb191-4431" aria-hidden="true" tabindex="-1"></a><span class="in">            Y = Tmeans_pheno$pheno)</span></span>
<span id="cb191-4432"><a href="#cb191-4432" aria-hidden="true" tabindex="-1"></a><span class="in">  pred &lt;- predictSurface(k)</span></span>
<span id="cb191-4433"><a href="#cb191-4433" aria-hidden="true" tabindex="-1"></a><span class="in">  colnames(pred$z) &lt;- pred$y</span></span>
<span id="cb191-4434"><a href="#cb191-4434" aria-hidden="true" tabindex="-1"></a><span class="in">  rownames(pred$z) &lt;- pred$x</span></span>
<span id="cb191-4435"><a href="#cb191-4435" aria-hidden="true" tabindex="-1"></a><span class="in">  melted &lt;- melt(pred$z)</span></span>
<span id="cb191-4436"><a href="#cb191-4436" aria-hidden="true" tabindex="-1"></a><span class="in">  colnames(melted) &lt;- c(&quot;Tmean_chill&quot;,</span></span>
<span id="cb191-4437"><a href="#cb191-4437" aria-hidden="true" tabindex="-1"></a><span class="in">                        &quot;Tmean_heat&quot;,</span></span>
<span id="cb191-4438"><a href="#cb191-4438" aria-hidden="true" tabindex="-1"></a><span class="in">                        &quot;value&quot;)</span></span>
<span id="cb191-4439"><a href="#cb191-4439" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb191-4440"><a href="#cb191-4440" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(melted,</span></span>
<span id="cb191-4441"><a href="#cb191-4441" aria-hidden="true" tabindex="-1"></a><span class="in">         aes(x = Tmean_chill,</span></span>
<span id="cb191-4442"><a href="#cb191-4442" aria-hidden="true" tabindex="-1"></a><span class="in">             y = Tmean_heat,</span></span>
<span id="cb191-4443"><a href="#cb191-4443" aria-hidden="true" tabindex="-1"></a><span class="in">             z = value)) +</span></span>
<span id="cb191-4444"><a href="#cb191-4444" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_contour_fill(bins = 60) +</span></span>
<span id="cb191-4445"><a href="#cb191-4445" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_gradientn(colours = alpha(matlab.like(15)),</span></span>
<span id="cb191-4446"><a href="#cb191-4446" aria-hidden="true" tabindex="-1"></a><span class="in">                         name = paste(phenology_stage,</span></span>
<span id="cb191-4447"><a href="#cb191-4447" aria-hidden="true" tabindex="-1"></a><span class="in">                                      &quot;date \n(day of the year)&quot;)) +</span></span>
<span id="cb191-4448"><a href="#cb191-4448" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_contour(col = &quot;black&quot;) +</span></span>
<span id="cb191-4449"><a href="#cb191-4449" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text_contour(stroke = 0.2) +</span></span>
<span id="cb191-4450"><a href="#cb191-4450" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(data = Tmeans_pheno,</span></span>
<span id="cb191-4451"><a href="#cb191-4451" aria-hidden="true" tabindex="-1"></a><span class="in">               aes(x = Tmean_chill,</span></span>
<span id="cb191-4452"><a href="#cb191-4452" aria-hidden="true" tabindex="-1"></a><span class="in">                   y = Tmean_heat,</span></span>
<span id="cb191-4453"><a href="#cb191-4453" aria-hidden="true" tabindex="-1"></a><span class="in">                   z = NULL),</span></span>
<span id="cb191-4454"><a href="#cb191-4454" aria-hidden="true" tabindex="-1"></a><span class="in">               size = 0.7)  +</span></span>
<span id="cb191-4455"><a href="#cb191-4455" aria-hidden="true" tabindex="-1"></a><span class="in">    ylab(expression(paste(&quot;Forcing phase &quot;,</span></span>
<span id="cb191-4456"><a href="#cb191-4456" aria-hidden="true" tabindex="-1"></a><span class="in">                          T[mean],</span></span>
<span id="cb191-4457"><a href="#cb191-4457" aria-hidden="true" tabindex="-1"></a><span class="in">                          &quot; (&quot;,</span></span>
<span id="cb191-4458"><a href="#cb191-4458" aria-hidden="true" tabindex="-1"></a><span class="in">                          degree,</span></span>
<span id="cb191-4459"><a href="#cb191-4459" aria-hidden="true" tabindex="-1"></a><span class="in">                          &quot;C)&quot;))) +</span></span>
<span id="cb191-4460"><a href="#cb191-4460" aria-hidden="true" tabindex="-1"></a><span class="in">    xlab(expression(paste(&quot;Chilling phase &quot;,</span></span>
<span id="cb191-4461"><a href="#cb191-4461" aria-hidden="true" tabindex="-1"></a><span class="in">                          T[mean],</span></span>
<span id="cb191-4462"><a href="#cb191-4462" aria-hidden="true" tabindex="-1"></a><span class="in">                          &quot; (&quot;,</span></span>
<span id="cb191-4463"><a href="#cb191-4463" aria-hidden="true" tabindex="-1"></a><span class="in">                          degree,</span></span>
<span id="cb191-4464"><a href="#cb191-4464" aria-hidden="true" tabindex="-1"></a><span class="in">                          &quot;C)&quot;))) +</span></span>
<span id="cb191-4465"><a href="#cb191-4465" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15)</span></span>
<span id="cb191-4466"><a href="#cb191-4466" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb191-4467"><a href="#cb191-4467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4468"><a href="#cb191-4468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4469"><a href="#cb191-4469" aria-hidden="true" tabindex="-1"></a><span class="in">chill_phase &lt;- c(317, 62)</span></span>
<span id="cb191-4470"><a href="#cb191-4470" aria-hidden="true" tabindex="-1"></a><span class="in">heat_phase &lt;- c(360, 105.5)</span></span>
<span id="cb191-4471"><a href="#cb191-4471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4472"><a href="#cb191-4472" aria-hidden="true" tabindex="-1"></a><span class="in">pheno_trend_ggplot(temps = temps,</span></span>
<span id="cb191-4473"><a href="#cb191-4473" aria-hidden="true" tabindex="-1"></a><span class="in">                   pheno = Roter_first,</span></span>
<span id="cb191-4474"><a href="#cb191-4474" aria-hidden="true" tabindex="-1"></a><span class="in">                   chill_phase = chill_phase,</span></span>
<span id="cb191-4475"><a href="#cb191-4475" aria-hidden="true" tabindex="-1"></a><span class="in">                   heat_phase = heat_phase,</span></span>
<span id="cb191-4476"><a href="#cb191-4476" aria-hidden="true" tabindex="-1"></a><span class="in">                   phenology_stage = &quot;Bloom&quot;)</span></span>
<span id="cb191-4477"><a href="#cb191-4477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4478"><a href="#cb191-4478" aria-hidden="true" tabindex="-1"></a><span class="in"># Applying to california </span></span>
<span id="cb191-4479"><a href="#cb191-4479" aria-hidden="true" tabindex="-1"></a><span class="in"># Cali_temps &lt;- read_tab(&quot;data/Davis_weather.csv&quot;)</span></span>
<span id="cb191-4480"><a href="#cb191-4480" aria-hidden="true" tabindex="-1"></a><span class="in"># Walnut_pheno &lt;- read_tab(&quot;data/Davis_Payne_leaf_out.csv&quot;) %&gt;%</span></span>
<span id="cb191-4481"><a href="#cb191-4481" aria-hidden="true" tabindex="-1"></a><span class="in">#   mutate(Year = as.numeric(substr(Leaf.date,7,8)),</span></span>
<span id="cb191-4482"><a href="#cb191-4482" aria-hidden="true" tabindex="-1"></a><span class="in">#          Year = Year+(19+(Year&lt;25))*100,</span></span>
<span id="cb191-4483"><a href="#cb191-4483" aria-hidden="true" tabindex="-1"></a><span class="in">#          Month = as.numeric(substr(Leaf.date,4,5)),</span></span>
<span id="cb191-4484"><a href="#cb191-4484" aria-hidden="true" tabindex="-1"></a><span class="in">#          Day = as.numeric(substr(Leaf.date,1,2))) %&gt;%</span></span>
<span id="cb191-4485"><a href="#cb191-4485" aria-hidden="true" tabindex="-1"></a><span class="in">#   make_JDay() %&gt;%</span></span>
<span id="cb191-4486"><a href="#cb191-4486" aria-hidden="true" tabindex="-1"></a><span class="in">#   select(Year, JDay)</span></span>
<span id="cb191-4487"><a href="#cb191-4487" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb191-4488"><a href="#cb191-4488" aria-hidden="true" tabindex="-1"></a><span class="in"># colnames(Walnut_pheno) &lt;- c(&quot;Year&quot;,</span></span>
<span id="cb191-4489"><a href="#cb191-4489" aria-hidden="true" tabindex="-1"></a><span class="in">#                             &quot;pheno&quot;)</span></span>
<span id="cb191-4490"><a href="#cb191-4490" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb191-4491"><a href="#cb191-4491" aria-hidden="true" tabindex="-1"></a><span class="in"># Cali_temps_hourly &lt;- stack_hourly_temps(Cali_temps,</span></span>
<span id="cb191-4492"><a href="#cb191-4492" aria-hidden="true" tabindex="-1"></a><span class="in">#                                         latitude = 38.5)</span></span>
<span id="cb191-4493"><a href="#cb191-4493" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb191-4494"><a href="#cb191-4494" aria-hidden="true" tabindex="-1"></a><span class="in"># Cali_daychill &lt;- daily_chill(hourtemps = Cali_temps_hourly,</span></span>
<span id="cb191-4495"><a href="#cb191-4495" aria-hidden="true" tabindex="-1"></a><span class="in">#                              running_mean = 1,</span></span>
<span id="cb191-4496"><a href="#cb191-4496" aria-hidden="true" tabindex="-1"></a><span class="in">#                              models = list(Chilling_Hours = Chilling_Hours,</span></span>
<span id="cb191-4497"><a href="#cb191-4497" aria-hidden="true" tabindex="-1"></a><span class="in">#                                            Utah_Chill_Units = Utah_Model,</span></span>
<span id="cb191-4498"><a href="#cb191-4498" aria-hidden="true" tabindex="-1"></a><span class="in">#                                            Chill_Portions = Dynamic_Model,</span></span>
<span id="cb191-4499"><a href="#cb191-4499" aria-hidden="true" tabindex="-1"></a><span class="in">#                                            GDH = GDH)</span></span>
<span id="cb191-4500"><a href="#cb191-4500" aria-hidden="true" tabindex="-1"></a><span class="in">#     )</span></span>
<span id="cb191-4501"><a href="#cb191-4501" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb191-4502"><a href="#cb191-4502" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb191-4503"><a href="#cb191-4503" aria-hidden="true" tabindex="-1"></a><span class="in"># plscf &lt;- PLS_chill_force(daily_chill_obj = Cali_daychill,</span></span>
<span id="cb191-4504"><a href="#cb191-4504" aria-hidden="true" tabindex="-1"></a><span class="in">#                          bio_data_frame = Walnut_pheno,</span></span>
<span id="cb191-4505"><a href="#cb191-4505" aria-hidden="true" tabindex="-1"></a><span class="in">#                          split_month = 6,</span></span>
<span id="cb191-4506"><a href="#cb191-4506" aria-hidden="true" tabindex="-1"></a><span class="in">#                          chill_models = &quot;Chill_Portions&quot;,</span></span>
<span id="cb191-4507"><a href="#cb191-4507" aria-hidden="true" tabindex="-1"></a><span class="in">#                          heat_models = &quot;GDH&quot;,</span></span>
<span id="cb191-4508"><a href="#cb191-4508" aria-hidden="true" tabindex="-1"></a><span class="in">#                          runn_means = 11)</span></span>
<span id="cb191-4509"><a href="#cb191-4509" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb191-4510"><a href="#cb191-4510" aria-hidden="true" tabindex="-1"></a><span class="in"># plot_PLS_chill_force(plscf,</span></span>
<span id="cb191-4511"><a href="#cb191-4511" aria-hidden="true" tabindex="-1"></a><span class="in">#                      chill_metric = &quot;Chill_Portions&quot;,</span></span>
<span id="cb191-4512"><a href="#cb191-4512" aria-hidden="true" tabindex="-1"></a><span class="in">#                      heat_metric = &quot;GDH&quot;,</span></span>
<span id="cb191-4513"><a href="#cb191-4513" aria-hidden="true" tabindex="-1"></a><span class="in">#                      chill_label = &quot;CP&quot;,</span></span>
<span id="cb191-4514"><a href="#cb191-4514" aria-hidden="true" tabindex="-1"></a><span class="in">#                      heat_label = &quot;GDH&quot;,</span></span>
<span id="cb191-4515"><a href="#cb191-4515" aria-hidden="true" tabindex="-1"></a><span class="in">#                      chill_phase = c(-56, 5),</span></span>
<span id="cb191-4516"><a href="#cb191-4516" aria-hidden="true" tabindex="-1"></a><span class="in">#                      heat_phase = c(19, 77))</span></span>
<span id="cb191-4517"><a href="#cb191-4517" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb191-4518"><a href="#cb191-4518" aria-hidden="true" tabindex="-1"></a><span class="in"># pheno_trend_ggplot(temps = Cali_temps,</span></span>
<span id="cb191-4519"><a href="#cb191-4519" aria-hidden="true" tabindex="-1"></a><span class="in">#                    pheno = Walnut_pheno,</span></span>
<span id="cb191-4520"><a href="#cb191-4520" aria-hidden="true" tabindex="-1"></a><span class="in">#                    chill_phase = c(309, 5),</span></span>
<span id="cb191-4521"><a href="#cb191-4521" aria-hidden="true" tabindex="-1"></a><span class="in">#                    heat_phase = c(19, 77),</span></span>
<span id="cb191-4522"><a href="#cb191-4522" aria-hidden="true" tabindex="-1"></a><span class="in">#                    phenology_stage = &quot;Leaf emergence&quot;)</span></span>
<span id="cb191-4523"><a href="#cb191-4523" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb191-4524"><a href="#cb191-4524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4525"><a href="#cb191-4525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-4526"><a href="#cb191-4526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4527"><a href="#cb191-4527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4528"><a href="#cb191-4528" aria-hidden="true" tabindex="-1"></a>2.Weâve looked at data from a number of locations so far. How would you expect this surface plot to look like in Beijing? And how should it look in Tunisia?</span>
<span id="cb191-4529"><a href="#cb191-4529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4530"><a href="#cb191-4530" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-4531"><a href="#cb191-4531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4532"><a href="#cb191-4532" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 27: The relative importance of chill and heat</span></span>
<span id="cb191-4533"><a href="#cb191-4533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4534"><a href="#cb191-4534" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on the relative importance of chill and heat***</span></span>
<span id="cb191-4535"><a href="#cb191-4535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4536"><a href="#cb191-4536" aria-hidden="true" tabindex="-1"></a>Describe the temperature response hypothesis outlined in this chapter.</span>
<span id="cb191-4537"><a href="#cb191-4537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4538"><a href="#cb191-4538" aria-hidden="true" tabindex="-1"></a>The temperature response hypothesis explains how the phenology of temperate trees in cold-winter climates responds to temperature variations during the chilling and forcing periods. During the ecodormancy phase, when buds are sensitive to heat, spring phenology is primarily influenced by forcing temperatures, as chill accumulation in such climates is usually high, and winter conditions are favorable for chilling. This stability makes it challenging to define the chilling period in these regions.</span>
<span id="cb191-4539"><a href="#cb191-4539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4540"><a href="#cb191-4540" aria-hidden="true" tabindex="-1"></a>As endodormancy temperatures rise, temperature conditions during chill accumulation begin to influence phenology, introducing a delaying effect. This transition is marked by increasing interaction between chill and forcing temperatures, depicted as upward-bending contour lines in the hypothesis framework. With further warming, chilling temperatures dominate, eventually causing stagnation or delays in budbreak, instead of advancing phenology.</span>
<span id="cb191-4541"><a href="#cb191-4541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4542"><a href="#cb191-4542" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-4543"><a href="#cb191-4543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4544"><a href="#cb191-4544" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 29: Making valid tree phenology models</span></span>
<span id="cb191-4545"><a href="#cb191-4545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4546"><a href="#cb191-4546" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on making valid tree phenology models***</span></span>
<span id="cb191-4547"><a href="#cb191-4547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4548"><a href="#cb191-4548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4549"><a href="#cb191-4549" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Explain the difference between output validation and process validation.</span>
<span id="cb191-4550"><a href="#cb191-4550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4551"><a href="#cb191-4551" aria-hidden="true" tabindex="-1"></a>Output validation assesses a model&#39;s predictive accuracy, while process validation ensures the model&#39;s internal logic is scientifically sound and reflective of real-world processes. For instance, output validation relies on performance metrics like Root Mean Square Error (RMSE) or Model Efficiency to quantify accuracy while requires domain knowledge about the processes to evaluate how well the model represents them. Both are important, but process validation provides deeper confidence in the model&#39;s applicability beyond specific datasets.</span>
<span id="cb191-4552"><a href="#cb191-4552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4553"><a href="#cb191-4553" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Explain what a validity domain is and why it is important to consider this whenever we want to use our model to forecast something.This is the range of conditions that the model is capable of making reliable predictions for. </span>
<span id="cb191-4554"><a href="#cb191-4554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4555"><a href="#cb191-4555" aria-hidden="true" tabindex="-1"></a>Validity domain ensures that models are applied within their appropriate scope, enhancing their reliability and relevance. In application,  model performance to be validated under conditions that resemble those predicted. </span>
<span id="cb191-4556"><a href="#cb191-4556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4557"><a href="#cb191-4557" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>What is validation for purpose?</span>
<span id="cb191-4558"><a href="#cb191-4558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4559"><a href="#cb191-4559" aria-hidden="true" tabindex="-1"></a>Validation for purpose is the process of assessing whether a model is capable of achieving its intended objective in a specific context. It involves reflecting on the model&#39;s goals and evaluating if it can realistically and reliably deliver the required predictions under the conditions of interest. This approach considers the model&#39;s assumptions, structure, and data inputs to determine its applicability for a given task.</span>
<span id="cb191-4560"><a href="#cb191-4560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4561"><a href="#cb191-4561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4562"><a href="#cb191-4562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4563"><a href="#cb191-4563" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>How can we ensure that our model is suitable for the predictions we want to make?</span>
<span id="cb191-4564"><a href="#cb191-4564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4565"><a href="#cb191-4565" aria-hidden="true" tabindex="-1"></a>We must verify that the predictions we wish to make come inside the model&#39;s validity domain, meaning that the requirements for making those predictions closely match the set of requirements that the model is predicated on, in order to make sure our model is appropriate for those predictions.  Additionally, there are instances in which model predictions may remain accurate even when they are outside the model&#39;s validity domain.  The model can still be considered appropriate in certain situations, but it needs to be strongly justified.</span>
<span id="cb191-4566"><a href="#cb191-4566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4567"><a href="#cb191-4567" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb191-4568"><a href="#cb191-4568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4569"><a href="#cb191-4569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4570"><a href="#cb191-4570" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-4571"><a href="#cb191-4571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4572"><a href="#cb191-4572" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 30: The Phenoflex Model</span></span>
<span id="cb191-4573"><a href="#cb191-4573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4574"><a href="#cb191-4574" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on making valid tree phenology models***</span></span>
<span id="cb191-4575"><a href="#cb191-4575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4576"><a href="#cb191-4576" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Parameterize the PhenoFlex model for `Roter Boskoopâ apples.</span>
<span id="cb191-4577"><a href="#cb191-4577" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-4578"><a href="#cb191-4578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4579"><a href="#cb191-4579" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-4580"><a href="#cb191-4580" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb191-4581"><a href="#cb191-4581" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb191-4582"><a href="#cb191-4582" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb191-4583"><a href="#cb191-4583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4584"><a href="#cb191-4584" aria-hidden="true" tabindex="-1"></a>CKA_weather <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/TMaxTMin1958-2019_patched.csv&quot;</span>)</span>
<span id="cb191-4585"><a href="#cb191-4585" aria-hidden="true" tabindex="-1"></a>hourtemps <span class="ot">&lt;-</span> <span class="fu">stack_hourly_temps</span>(CKA_weather, </span>
<span id="cb191-4586"><a href="#cb191-4586" aria-hidden="true" tabindex="-1"></a>                                <span class="at">latitude =</span> <span class="fl">50.6</span>)</span>
<span id="cb191-4587"><a href="#cb191-4587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4588"><a href="#cb191-4588" aria-hidden="true" tabindex="-1"></a>yc <span class="ot">&lt;-</span> <span class="dv">40</span> <span class="co"># chilling requirement</span></span>
<span id="cb191-4589"><a href="#cb191-4589" aria-hidden="true" tabindex="-1"></a>zc <span class="ot">&lt;-</span> <span class="dv">190</span> <span class="co"># heating requirement</span></span>
<span id="cb191-4590"><a href="#cb191-4590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4591"><a href="#cb191-4591" aria-hidden="true" tabindex="-1"></a>iSeason <span class="ot">&lt;-</span> <span class="fu">genSeason</span>(hourtemps,</span>
<span id="cb191-4592"><a href="#cb191-4592" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mrange =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">6</span>), <span class="co"># month range</span></span>
<span id="cb191-4593"><a href="#cb191-4593" aria-hidden="true" tabindex="-1"></a>                     <span class="at">years =</span> <span class="fu">c</span>(<span class="dv">2009</span>))</span>
<span id="cb191-4594"><a href="#cb191-4594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4595"><a href="#cb191-4595" aria-hidden="true" tabindex="-1"></a>season_data <span class="ot">&lt;-</span> hourtemps<span class="sc">$</span>hourtemps[iSeason[[<span class="dv">1</span>]],]</span>
<span id="cb191-4596"><a href="#cb191-4596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4597"><a href="#cb191-4597" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">PhenoFlex</span>(<span class="at">temp =</span> season_data<span class="sc">$</span>Temp,</span>
<span id="cb191-4598"><a href="#cb191-4598" aria-hidden="true" tabindex="-1"></a>                 <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span> <span class="fu">length</span>(season_data<span class="sc">$</span>Temp)),</span>
<span id="cb191-4599"><a href="#cb191-4599" aria-hidden="true" tabindex="-1"></a>                 <span class="at">zc =</span> zc,</span>
<span id="cb191-4600"><a href="#cb191-4600" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stopatzc =</span> <span class="cn">TRUE</span>,</span>
<span id="cb191-4601"><a href="#cb191-4601" aria-hidden="true" tabindex="-1"></a>                 <span class="at">yc =</span> yc,</span>
<span id="cb191-4602"><a href="#cb191-4602" aria-hidden="true" tabindex="-1"></a>                 <span class="at">basic_output =</span> <span class="cn">FALSE</span>)</span>
<span id="cb191-4603"><a href="#cb191-4603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4604"><a href="#cb191-4604" aria-hidden="true" tabindex="-1"></a>DBreakDay <span class="ot">&lt;-</span> res<span class="sc">$</span>bloomindex</span>
<span id="cb191-4605"><a href="#cb191-4605" aria-hidden="true" tabindex="-1"></a>seasontemps <span class="ot">&lt;-</span> hourtemps<span class="sc">$</span>hourtemps[iSeason[[<span class="dv">1</span>]],]</span>
<span id="cb191-4606"><a href="#cb191-4606" aria-hidden="true" tabindex="-1"></a>seasontemps[,<span class="st">&quot;x&quot;</span>] <span class="ot">&lt;-</span> res<span class="sc">$</span>x</span>
<span id="cb191-4607"><a href="#cb191-4607" aria-hidden="true" tabindex="-1"></a>seasontemps[,<span class="st">&quot;y&quot;</span>] <span class="ot">&lt;-</span> res<span class="sc">$</span>y</span>
<span id="cb191-4608"><a href="#cb191-4608" aria-hidden="true" tabindex="-1"></a>seasontemps[,<span class="st">&quot;z&quot;</span>] <span class="ot">&lt;-</span> res<span class="sc">$</span>z</span>
<span id="cb191-4609"><a href="#cb191-4609" aria-hidden="true" tabindex="-1"></a>seasontemps <span class="ot">&lt;-</span> <span class="fu">add_date</span>(seasontemps)</span>
<span id="cb191-4610"><a href="#cb191-4610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4611"><a href="#cb191-4611" aria-hidden="true" tabindex="-1"></a>CR_full <span class="ot">&lt;-</span> seasontemps<span class="sc">$</span>Date[<span class="fu">which</span>(seasontemps<span class="sc">$</span>y <span class="sc">&gt;=</span> yc)[<span class="dv">1</span>]] <span class="co"># the date where chilling requirement is broken</span></span>
<span id="cb191-4612"><a href="#cb191-4612" aria-hidden="true" tabindex="-1"></a>Bloom <span class="ot">&lt;-</span> seasontemps<span class="sc">$</span>Date[<span class="fu">which</span>(seasontemps<span class="sc">$</span>z <span class="sc">&gt;=</span> zc)[<span class="dv">1</span>]]</span>
<span id="cb191-4613"><a href="#cb191-4613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4614"><a href="#cb191-4614" aria-hidden="true" tabindex="-1"></a>chillplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> seasontemps[<span class="dv">1</span><span class="sc">:</span>DBreakDay,],</span>
<span id="cb191-4615"><a href="#cb191-4615" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-4616"><a href="#cb191-4616" aria-hidden="true" tabindex="-1"></a>                        <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb191-4617"><a href="#cb191-4617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb191-4618"><a href="#cb191-4618" aria-hidden="true" tabindex="-1"></a>            <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb191-4619"><a href="#cb191-4619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb191-4620"><a href="#cb191-4620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> yc,</span>
<span id="cb191-4621"><a href="#cb191-4621" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb191-4622"><a href="#cb191-4622" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb191-4623"><a href="#cb191-4623" aria-hidden="true" tabindex="-1"></a>             <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb191-4624"><a href="#cb191-4624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> CR_full,</span>
<span id="cb191-4625"><a href="#cb191-4625" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">3</span>,</span>
<span id="cb191-4626"><a href="#cb191-4626" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb191-4627"><a href="#cb191-4627" aria-hidden="true" tabindex="-1"></a>             <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb191-4628"><a href="#cb191-4628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Chill accumulation (y)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-4629"><a href="#cb191-4629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Chilling&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-4630"><a href="#cb191-4630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>,</span>
<span id="cb191-4631"><a href="#cb191-4631" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;Chill req. (yc)&quot;</span>, </span>
<span id="cb191-4632"><a href="#cb191-4632" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">ISOdate</span>(<span class="dv">2008</span>,<span class="dv">10</span>,<span class="dv">01</span>),</span>
<span id="cb191-4633"><a href="#cb191-4633" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> yc<span class="sc">*</span><span class="fl">1.1</span>,</span>
<span id="cb191-4634"><a href="#cb191-4634" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb191-4635"><a href="#cb191-4635" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">5</span>)</span>
<span id="cb191-4636"><a href="#cb191-4636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4637"><a href="#cb191-4637" aria-hidden="true" tabindex="-1"></a>heatplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> seasontemps[<span class="dv">1</span><span class="sc">:</span>DBreakDay,],</span>
<span id="cb191-4638"><a href="#cb191-4638" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">x =</span> Date,</span>
<span id="cb191-4639"><a href="#cb191-4639" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> z)) <span class="sc">+</span></span>
<span id="cb191-4640"><a href="#cb191-4640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb191-4641"><a href="#cb191-4641" aria-hidden="true" tabindex="-1"></a>            <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb191-4642"><a href="#cb191-4642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb191-4643"><a href="#cb191-4643" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">position =</span> <span class="st">&quot;right&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-4644"><a href="#cb191-4644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> zc,</span>
<span id="cb191-4645"><a href="#cb191-4645" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb191-4646"><a href="#cb191-4646" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb191-4647"><a href="#cb191-4647" aria-hidden="true" tabindex="-1"></a>             <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb191-4648"><a href="#cb191-4648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> CR_full,</span>
<span id="cb191-4649"><a href="#cb191-4649" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">3</span>,</span>
<span id="cb191-4650"><a href="#cb191-4650" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb191-4651"><a href="#cb191-4651" aria-hidden="true" tabindex="-1"></a>             <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb191-4652"><a href="#cb191-4652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> Bloom,</span>
<span id="cb191-4653"><a href="#cb191-4653" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">3</span>,</span>
<span id="cb191-4654"><a href="#cb191-4654" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb191-4655"><a href="#cb191-4655" aria-hidden="true" tabindex="-1"></a>             <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb191-4656"><a href="#cb191-4656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Heat accumulation (z)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-4657"><a href="#cb191-4657" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Forcing&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-4658"><a href="#cb191-4658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>,</span>
<span id="cb191-4659"><a href="#cb191-4659" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;Heat req. (zc)&quot;</span>, </span>
<span id="cb191-4660"><a href="#cb191-4660" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">ISOdate</span>(<span class="dv">2008</span>,<span class="dv">10</span>,<span class="dv">01</span>),</span>
<span id="cb191-4661"><a href="#cb191-4661" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> zc<span class="sc">*</span><span class="fl">0.95</span>,</span>
<span id="cb191-4662"><a href="#cb191-4662" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb191-4663"><a href="#cb191-4663" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">5</span>)</span>
<span id="cb191-4664"><a href="#cb191-4664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4665"><a href="#cb191-4665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4666"><a href="#cb191-4666" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb191-4667"><a href="#cb191-4667" aria-hidden="true" tabindex="-1"></a>chillplot <span class="sc">+</span> heatplot</span>
<span id="cb191-4668"><a href="#cb191-4668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4669"><a href="#cb191-4669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4670"><a href="#cb191-4670" aria-hidden="true" tabindex="-1"></a>yc <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb191-4671"><a href="#cb191-4671" aria-hidden="true" tabindex="-1"></a>zc <span class="ot">&lt;-</span> <span class="dv">190</span></span>
<span id="cb191-4672"><a href="#cb191-4672" aria-hidden="true" tabindex="-1"></a>seasons <span class="ot">&lt;-</span> <span class="dv">1959</span><span class="sc">:</span><span class="dv">2019</span></span>
<span id="cb191-4673"><a href="#cb191-4673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4674"><a href="#cb191-4674" aria-hidden="true" tabindex="-1"></a>iSeason <span class="ot">&lt;-</span> <span class="fu">genSeason</span>(hourtemps,</span>
<span id="cb191-4675"><a href="#cb191-4675" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mrange =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">6</span>),</span>
<span id="cb191-4676"><a href="#cb191-4676" aria-hidden="true" tabindex="-1"></a>                     <span class="at">years =</span> seasons)</span>
<span id="cb191-4677"><a href="#cb191-4677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4678"><a href="#cb191-4678" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (sea <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(seasons))</span>
<span id="cb191-4679"><a href="#cb191-4679" aria-hidden="true" tabindex="-1"></a>{season_data <span class="ot">&lt;-</span> hourtemps<span class="sc">$</span>hourtemps[iSeason[[sea]], ]</span>
<span id="cb191-4680"><a href="#cb191-4680" aria-hidden="true" tabindex="-1"></a> res <span class="ot">&lt;-</span> <span class="fu">PhenoFlex</span>(<span class="at">temp =</span> season_data<span class="sc">$</span>Temp,</span>
<span id="cb191-4681"><a href="#cb191-4681" aria-hidden="true" tabindex="-1"></a>                  <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span> <span class="fu">length</span>(season_data<span class="sc">$</span>Temp)),</span>
<span id="cb191-4682"><a href="#cb191-4682" aria-hidden="true" tabindex="-1"></a>                  <span class="at">zc =</span> zc,</span>
<span id="cb191-4683"><a href="#cb191-4683" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stopatzc =</span> <span class="cn">TRUE</span>,</span>
<span id="cb191-4684"><a href="#cb191-4684" aria-hidden="true" tabindex="-1"></a>                  <span class="at">yc =</span> yc,</span>
<span id="cb191-4685"><a href="#cb191-4685" aria-hidden="true" tabindex="-1"></a>                  <span class="at">basic_output =</span> <span class="cn">FALSE</span>)</span>
<span id="cb191-4686"><a href="#cb191-4686" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span>(sea <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb191-4687"><a href="#cb191-4687" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> season_data<span class="sc">$</span>DATE[res<span class="sc">$</span>bloomindex] <span class="cf">else</span></span>
<span id="cb191-4688"><a href="#cb191-4688" aria-hidden="true" tabindex="-1"></a>      results <span class="ot">&lt;-</span> <span class="fu">c</span>(results,</span>
<span id="cb191-4689"><a href="#cb191-4689" aria-hidden="true" tabindex="-1"></a>                   season_data<span class="sc">$</span>DATE[res<span class="sc">$</span>bloomindex])}</span>
<span id="cb191-4690"><a href="#cb191-4690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4691"><a href="#cb191-4691" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Season =</span> seasons,</span>
<span id="cb191-4692"><a href="#cb191-4692" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Prediction =</span> results)</span>
<span id="cb191-4693"><a href="#cb191-4693" aria-hidden="true" tabindex="-1"></a>predictions<span class="sc">$</span>Prediction <span class="ot">&lt;-</span></span>
<span id="cb191-4694"><a href="#cb191-4694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ISOdate</span>(<span class="dv">2001</span>,</span>
<span id="cb191-4695"><a href="#cb191-4695" aria-hidden="true" tabindex="-1"></a>          <span class="fu">substr</span>(predictions<span class="sc">$</span>Prediction, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb191-4696"><a href="#cb191-4696" aria-hidden="true" tabindex="-1"></a>          <span class="fu">substr</span>(predictions<span class="sc">$</span>Prediction, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb191-4697"><a href="#cb191-4697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4698"><a href="#cb191-4698" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> predictions,</span>
<span id="cb191-4699"><a href="#cb191-4699" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Season,</span>
<span id="cb191-4700"><a href="#cb191-4700" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Prediction)) <span class="sc">+</span></span>
<span id="cb191-4701"><a href="#cb191-4701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb191-4702"><a href="#cb191-4702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb191-4703"><a href="#cb191-4703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Predicted bloom date&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-4704"><a href="#cb191-4704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span>
<span id="cb191-4705"><a href="#cb191-4705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4706"><a href="#cb191-4706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4707"><a href="#cb191-4707" aria-hidden="true" tabindex="-1"></a>Roter_first <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Roter_Boskoop_bloom_1958_2019.csv.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb191-4708"><a href="#cb191-4708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, First_bloom) <span class="sc">%&gt;%</span></span>
<span id="cb191-4709"><a href="#cb191-4709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">1</span>, <span class="dv">4</span>)),</span>
<span id="cb191-4710"><a href="#cb191-4710" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">5</span>, <span class="dv">6</span>)),</span>
<span id="cb191-4711"><a href="#cb191-4711" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(First_bloom, <span class="dv">7</span>, <span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb191-4712"><a href="#cb191-4712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_JDay</span>() <span class="sc">%&gt;%</span></span>
<span id="cb191-4713"><a href="#cb191-4713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Pheno_year, JDay) <span class="sc">%&gt;%</span></span>
<span id="cb191-4714"><a href="#cb191-4714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Year =</span> Pheno_year,</span>
<span id="cb191-4715"><a href="#cb191-4715" aria-hidden="true" tabindex="-1"></a>         <span class="at">pheno =</span> JDay)</span>
<span id="cb191-4716"><a href="#cb191-4716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4717"><a href="#cb191-4717" aria-hidden="true" tabindex="-1"></a>hourtemps <span class="ot">&lt;-</span> </span>
<span id="cb191-4718"><a href="#cb191-4718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/TMaxTMin1958-2019_patched.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb191-4719"><a href="#cb191-4719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack_hourly_temps</span>(<span class="at">latitude =</span> <span class="fl">50.6</span>)</span>
<span id="cb191-4720"><a href="#cb191-4720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4721"><a href="#cb191-4721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4722"><a href="#cb191-4722" aria-hidden="true" tabindex="-1"></a><span class="co"># here&#39;s the order of the parameters (from the helpfile of the</span></span>
<span id="cb191-4723"><a href="#cb191-4723" aria-hidden="true" tabindex="-1"></a><span class="co"># PhenoFlex_GDHwrapper function)</span></span>
<span id="cb191-4724"><a href="#cb191-4724" aria-hidden="true" tabindex="-1"></a><span class="co">#          yc,  zc,  s1, Tu,    E0,      E1,     A0,         A1,   Tf, Tc, Tb,  slope</span></span>
<span id="cb191-4725"><a href="#cb191-4725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4726"><a href="#cb191-4726" aria-hidden="true" tabindex="-1"></a>par <span class="ot">&lt;-</span>   <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">190</span>, <span class="fl">0.5</span>, <span class="dv">25</span>, <span class="fl">3372.8</span>,  <span class="fl">9900.3</span>, <span class="fl">6319.5</span>,</span>
<span id="cb191-4727"><a href="#cb191-4727" aria-hidden="true" tabindex="-1"></a>           <span class="fl">5.939917e13</span>,  <span class="dv">4</span>, <span class="dv">36</span>,  <span class="dv">4</span>,  <span class="fl">1.60</span>)</span>
<span id="cb191-4728"><a href="#cb191-4728" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">41</span>, <span class="dv">200</span>, <span class="fl">1.0</span>, <span class="dv">30</span>, <span class="fl">4000.0</span>, <span class="fl">10000.0</span>, <span class="fl">7000.0</span>,  </span>
<span id="cb191-4729"><a href="#cb191-4729" aria-hidden="true" tabindex="-1"></a>           <span class="dv">6</span>.e13, <span class="dv">10</span>, <span class="dv">40</span>, <span class="dv">10</span>, <span class="fl">50.00</span>)</span>
<span id="cb191-4730"><a href="#cb191-4730" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">38</span>, <span class="dv">180</span>, <span class="fl">0.1</span>, <span class="dv">0</span> , <span class="fl">3000.0</span>,  <span class="fl">9000.0</span>, <span class="fl">6000.0</span>,   </span>
<span id="cb191-4731"><a href="#cb191-4731" aria-hidden="true" tabindex="-1"></a>           <span class="dv">5</span>.e13,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="fl">0.05</span>)</span>
<span id="cb191-4732"><a href="#cb191-4732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4733"><a href="#cb191-4733" aria-hidden="true" tabindex="-1"></a>SeasonList <span class="ot">&lt;-</span> <span class="fu">genSeasonList</span>(hourtemps<span class="sc">$</span>hourtemps,</span>
<span id="cb191-4734"><a href="#cb191-4734" aria-hidden="true" tabindex="-1"></a>                            <span class="at">mrange =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">6</span>),</span>
<span id="cb191-4735"><a href="#cb191-4735" aria-hidden="true" tabindex="-1"></a>                            <span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1959</span><span class="sc">:</span><span class="dv">2018</span>))</span>
<span id="cb191-4736"><a href="#cb191-4736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4737"><a href="#cb191-4737" aria-hidden="true" tabindex="-1"></a>Fit_res <span class="ot">&lt;-</span> </span>
<span id="cb191-4738"><a href="#cb191-4738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">phenologyFitter</span>(<span class="at">par.guess =</span> par, </span>
<span id="cb191-4739"><a href="#cb191-4739" aria-hidden="true" tabindex="-1"></a>                  <span class="at">modelfn =</span> PhenoFlex_GDHwrapper,</span>
<span id="cb191-4740"><a href="#cb191-4740" aria-hidden="true" tabindex="-1"></a>                  <span class="at">bloomJDays =</span> Roter_first<span class="sc">$</span>pheno[<span class="fu">which</span>(Roter_first<span class="sc">$</span>Year <span class="sc">&gt;</span> <span class="dv">1958</span>)],</span>
<span id="cb191-4741"><a href="#cb191-4741" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SeasonList =</span> SeasonList,</span>
<span id="cb191-4742"><a href="#cb191-4742" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lower =</span> lower,</span>
<span id="cb191-4743"><a href="#cb191-4743" aria-hidden="true" tabindex="-1"></a>                           <span class="at">upper =</span> upper,</span>
<span id="cb191-4744"><a href="#cb191-4744" aria-hidden="true" tabindex="-1"></a>                           <span class="at">control =</span> <span class="fu">list</span>(<span class="at">smooth =</span> <span class="cn">FALSE</span>,</span>
<span id="cb191-4745"><a href="#cb191-4745" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">verbose =</span> <span class="cn">FALSE</span>, </span>
<span id="cb191-4746"><a href="#cb191-4746" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">maxit =</span> <span class="dv">1000</span>,</span>
<span id="cb191-4747"><a href="#cb191-4747" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">nb.stop.improvement =</span> <span class="dv">5</span>))</span>
<span id="cb191-4748"><a href="#cb191-4748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4749"><a href="#cb191-4749" aria-hidden="true" tabindex="-1"></a>Roter_par <span class="ot">&lt;-</span> Fit_res<span class="sc">$</span>par</span>
<span id="cb191-4750"><a href="#cb191-4750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4751"><a href="#cb191-4751" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(Roter_par,</span>
<span id="cb191-4752"><a href="#cb191-4752" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/PhenoFlex_parameters_Roter_Boskoop.csv&quot;</span>)</span>
<span id="cb191-4753"><a href="#cb191-4753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4754"><a href="#cb191-4754" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(Roter_par)) <span class="sc">%&gt;%</span></span>
<span id="cb191-4755"><a href="#cb191-4755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="st">&quot;striped&quot;</span>, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>, <span class="at">font_size =</span> <span class="dv">10</span>)</span>
<span id="cb191-4756"><a href="#cb191-4756" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-4757"><a href="#cb191-4757" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Produce plots of predicted vs. observed bloom dates and distribution of prediction errors.</span>
<span id="cb191-4758"><a href="#cb191-4758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4759"><a href="#cb191-4759" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-4760"><a href="#cb191-4760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4761"><a href="#cb191-4761" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-4762"><a href="#cb191-4762" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb191-4763"><a href="#cb191-4763" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb191-4764"><a href="#cb191-4764" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb191-4765"><a href="#cb191-4765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4766"><a href="#cb191-4766" aria-hidden="true" tabindex="-1"></a>Roter_par <span class="ot">&lt;-</span></span>
<span id="cb191-4767"><a href="#cb191-4767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/PhenoFlex_parameters_Roter_Boskoop.csv&quot;</span>)[,<span class="dv">2</span>]</span>
<span id="cb191-4768"><a href="#cb191-4768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4769"><a href="#cb191-4769" aria-hidden="true" tabindex="-1"></a>SeasonList <span class="ot">&lt;-</span> <span class="fu">genSeasonList</span>(hourtemps<span class="sc">$</span>hourtemps,</span>
<span id="cb191-4770"><a href="#cb191-4770" aria-hidden="true" tabindex="-1"></a>                            <span class="at">mrange =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">6</span>),</span>
<span id="cb191-4771"><a href="#cb191-4771" aria-hidden="true" tabindex="-1"></a>                            <span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1959</span><span class="sc">:</span><span class="dv">2018</span>))</span>
<span id="cb191-4772"><a href="#cb191-4772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4773"><a href="#cb191-4773" aria-hidden="true" tabindex="-1"></a>Roter_PhenoFlex_predictions <span class="ot">&lt;-</span> Roter_first[<span class="fu">which</span>(Roter_first<span class="sc">$</span>Year <span class="sc">&gt;</span> <span class="dv">1958</span>),]</span>
<span id="cb191-4774"><a href="#cb191-4774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4775"><a href="#cb191-4775" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>Year))</span>
<span id="cb191-4776"><a href="#cb191-4776" aria-hidden="true" tabindex="-1"></a>   Roter_PhenoFlex_predictions<span class="sc">$</span>predicted[y] <span class="ot">&lt;-</span></span>
<span id="cb191-4777"><a href="#cb191-4777" aria-hidden="true" tabindex="-1"></a>    <span class="fu">PhenoFlex_GDHwrapper</span>(SeasonList[[y]],</span>
<span id="cb191-4778"><a href="#cb191-4778" aria-hidden="true" tabindex="-1"></a>                         Roter_par)</span>
<span id="cb191-4779"><a href="#cb191-4779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4780"><a href="#cb191-4780" aria-hidden="true" tabindex="-1"></a>Roter_PhenoFlex_predictions<span class="sc">$</span>Error <span class="ot">&lt;-</span></span>
<span id="cb191-4781"><a href="#cb191-4781" aria-hidden="true" tabindex="-1"></a>  Roter_PhenoFlex_predictions<span class="sc">$</span>predicted <span class="sc">-</span></span>
<span id="cb191-4782"><a href="#cb191-4782" aria-hidden="true" tabindex="-1"></a>  Roter_PhenoFlex_predictions<span class="sc">$</span>pheno</span>
<span id="cb191-4783"><a href="#cb191-4783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4784"><a href="#cb191-4784" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSEP</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>predicted,</span>
<span id="cb191-4785"><a href="#cb191-4785" aria-hidden="true" tabindex="-1"></a>      Roter_PhenoFlex_predictions<span class="sc">$</span>pheno)</span>
<span id="cb191-4786"><a href="#cb191-4786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4787"><a href="#cb191-4787" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>Error)</span>
<span id="cb191-4788"><a href="#cb191-4788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4789"><a href="#cb191-4789" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">abs</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>Error))</span>
<span id="cb191-4790"><a href="#cb191-4790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4791"><a href="#cb191-4791" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Roter_PhenoFlex_predictions,</span>
<span id="cb191-4792"><a href="#cb191-4792" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> pheno,</span>
<span id="cb191-4793"><a href="#cb191-4793" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> predicted)) <span class="sc">+</span></span>
<span id="cb191-4794"><a href="#cb191-4794" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb191-4795"><a href="#cb191-4795" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb191-4796"><a href="#cb191-4796" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb191-4797"><a href="#cb191-4797" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb191-4798"><a href="#cb191-4798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Observed bloom date (Day of the year)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-4799"><a href="#cb191-4799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Predicted bloom date (Day of the year)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-4800"><a href="#cb191-4800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Predicted vs. observed bloom dates&quot;</span>)</span>
<span id="cb191-4801"><a href="#cb191-4801" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-4802"><a href="#cb191-4802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4803"><a href="#cb191-4803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4804"><a href="#cb191-4804" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-4805"><a href="#cb191-4805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4806"><a href="#cb191-4806" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-4807"><a href="#cb191-4807" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Roter_PhenoFlex_predictions,</span>
<span id="cb191-4808"><a href="#cb191-4808" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(Error)) <span class="sc">+</span></span>
<span id="cb191-4809"><a href="#cb191-4809" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb191-4810"><a href="#cb191-4810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Distribution of prediction errors&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-4811"><a href="#cb191-4811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span>
<span id="cb191-4812"><a href="#cb191-4812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4813"><a href="#cb191-4813" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-4814"><a href="#cb191-4814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4815"><a href="#cb191-4815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4816"><a href="#cb191-4816" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Compute the model performance metrics RMSEP, mean error and mean absolute error.</span>
<span id="cb191-4817"><a href="#cb191-4817" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-4818"><a href="#cb191-4818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4819"><a href="#cb191-4819" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-4820"><a href="#cb191-4820" aria-hidden="true" tabindex="-1"></a>RMSEP <span class="ot">&lt;-</span> chillR<span class="sc">::</span><span class="fu">RMSEP</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>predicted, Roter_PhenoFlex_predictions<span class="sc">$</span>pheno)</span>
<span id="cb191-4821"><a href="#cb191-4821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4822"><a href="#cb191-4822" aria-hidden="true" tabindex="-1"></a>mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>Error)</span>
<span id="cb191-4823"><a href="#cb191-4823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4824"><a href="#cb191-4824" aria-hidden="true" tabindex="-1"></a>abs_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(Roter_PhenoFlex_predictions<span class="sc">$</span>Error))</span>
<span id="cb191-4825"><a href="#cb191-4825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4826"><a href="#cb191-4826" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">RMSEP =</span> RMSEP, <span class="at">Mean =</span> mean, <span class="st">`</span><span class="at">Absolute Mean</span><span class="st">`</span> <span class="ot">=</span> abs_mean, <span class="at">check.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb191-4827"><a href="#cb191-4827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4828"><a href="#cb191-4828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4829"><a href="#cb191-4829" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(result) <span class="sc">%&gt;%</span></span>
<span id="cb191-4830"><a href="#cb191-4830" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="st">&quot;striped&quot;</span>, <span class="at">position =</span> <span class="st">&quot;left&quot;</span>, <span class="at">font_size =</span> <span class="dv">10</span>)</span>
<span id="cb191-4831"><a href="#cb191-4831" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-4832"><a href="#cb191-4832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4833"><a href="#cb191-4833" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-4834"><a href="#cb191-4834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4835"><a href="#cb191-4835" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 31: The PhenoFlex model - a second look</span></span>
<span id="cb191-4836"><a href="#cb191-4836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4837"><a href="#cb191-4837" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on basic PhenoFlex diagnostics***</span></span>
<span id="cb191-4838"><a href="#cb191-4838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4839"><a href="#cb191-4839" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Make chill and heat response plots for the âRoter Boskoopâ PhenoFlex model for the location you did the earlier analyses for.</span>
<span id="cb191-4840"><a href="#cb191-4840" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-4841"><a href="#cb191-4841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4842"><a href="#cb191-4842" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-4843"><a href="#cb191-4843" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb191-4844"><a href="#cb191-4844" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb191-4845"><a href="#cb191-4845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4846"><a href="#cb191-4846" aria-hidden="true" tabindex="-1"></a>Roter_par <span class="ot">&lt;-</span></span>
<span id="cb191-4847"><a href="#cb191-4847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/PhenoFlex_parameters_Roter_Boskoop.csv&quot;</span>)[,<span class="dv">2</span>]</span>
<span id="cb191-4848"><a href="#cb191-4848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4849"><a href="#cb191-4849" aria-hidden="true" tabindex="-1"></a>E0 <span class="ot">&lt;-</span> Roter_par[<span class="dv">5</span>]</span>
<span id="cb191-4850"><a href="#cb191-4850" aria-hidden="true" tabindex="-1"></a>E1 <span class="ot">&lt;-</span> Roter_par[<span class="dv">6</span>]</span>
<span id="cb191-4851"><a href="#cb191-4851" aria-hidden="true" tabindex="-1"></a>A0 <span class="ot">&lt;-</span> Roter_par[<span class="dv">7</span>]</span>
<span id="cb191-4852"><a href="#cb191-4852" aria-hidden="true" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> Roter_par[<span class="dv">8</span>]</span>
<span id="cb191-4853"><a href="#cb191-4853" aria-hidden="true" tabindex="-1"></a>Tf <span class="ot">&lt;-</span> Roter_par[<span class="dv">9</span>]</span>
<span id="cb191-4854"><a href="#cb191-4854" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> Roter_par[<span class="dv">12</span>]</span>
<span id="cb191-4855"><a href="#cb191-4855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4856"><a href="#cb191-4856" aria-hidden="true" tabindex="-1"></a>apply_const_temp <span class="ot">&lt;-</span></span>
<span id="cb191-4857"><a href="#cb191-4857" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(temp, </span>
<span id="cb191-4858"><a href="#cb191-4858" aria-hidden="true" tabindex="-1"></a>           A0, A1, E0, E1, Tf, </span>
<span id="cb191-4859"><a href="#cb191-4859" aria-hidden="true" tabindex="-1"></a>           slope, <span class="at">portions =</span> <span class="dv">1200</span>, <span class="at">deg_celsius =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb191-4860"><a href="#cb191-4860" aria-hidden="true" tabindex="-1"></a>    temp_vector <span class="ot">&lt;-</span> <span class="fu">rep</span>(temp,</span>
<span id="cb191-4861"><a href="#cb191-4861" aria-hidden="true" tabindex="-1"></a>                       <span class="at">times =</span> portions)</span>
<span id="cb191-4862"><a href="#cb191-4862" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> chillR<span class="sc">::</span><span class="fu">DynModel_driver</span>(<span class="at">temp =</span> temp_vector,</span>
<span id="cb191-4863"><a href="#cb191-4863" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">A0 =</span> A0,</span>
<span id="cb191-4864"><a href="#cb191-4864" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">A1 =</span> A1,</span>
<span id="cb191-4865"><a href="#cb191-4865" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">E0 =</span> E0,</span>
<span id="cb191-4866"><a href="#cb191-4866" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">E1 =</span> E1,</span>
<span id="cb191-4867"><a href="#cb191-4867" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Tf =</span> Tf,</span>
<span id="cb191-4868"><a href="#cb191-4868" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">slope =</span> slope,</span>
<span id="cb191-4869"><a href="#cb191-4869" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">deg_celsius =</span> deg_celsius)</span>
<span id="cb191-4870"><a href="#cb191-4870" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(res<span class="sc">$</span>y[<span class="fu">length</span>(res<span class="sc">$</span>y)])</span>
<span id="cb191-4871"><a href="#cb191-4871" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb191-4872"><a href="#cb191-4872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4873"><a href="#cb191-4873" aria-hidden="true" tabindex="-1"></a><span class="fu">apply_const_temp</span>(<span class="dv">4</span>, A0, A1, E0, E1, Tf, </span>
<span id="cb191-4874"><a href="#cb191-4874" aria-hidden="true" tabindex="-1"></a>                 slope)</span>
<span id="cb191-4875"><a href="#cb191-4875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4876"><a href="#cb191-4876" aria-hidden="true" tabindex="-1"></a>gen_bell <span class="ot">&lt;-</span> <span class="cf">function</span>(par,</span>
<span id="cb191-4877"><a href="#cb191-4877" aria-hidden="true" tabindex="-1"></a>                     <span class="at">temp_values =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">20</span>, <span class="fl">0.1</span>)) {</span>
<span id="cb191-4878"><a href="#cb191-4878" aria-hidden="true" tabindex="-1"></a>  E0 <span class="ot">&lt;-</span> par[<span class="dv">5</span>]</span>
<span id="cb191-4879"><a href="#cb191-4879" aria-hidden="true" tabindex="-1"></a>  E1 <span class="ot">&lt;-</span> par[<span class="dv">6</span>]</span>
<span id="cb191-4880"><a href="#cb191-4880" aria-hidden="true" tabindex="-1"></a>  A0 <span class="ot">&lt;-</span> par[<span class="dv">7</span>]</span>
<span id="cb191-4881"><a href="#cb191-4881" aria-hidden="true" tabindex="-1"></a>  A1 <span class="ot">&lt;-</span> par[<span class="dv">8</span>]</span>
<span id="cb191-4882"><a href="#cb191-4882" aria-hidden="true" tabindex="-1"></a>  Tf <span class="ot">&lt;-</span> par[<span class="dv">9</span>]</span>
<span id="cb191-4883"><a href="#cb191-4883" aria-hidden="true" tabindex="-1"></a>  slope <span class="ot">&lt;-</span> par[<span class="dv">12</span>]</span>
<span id="cb191-4884"><a href="#cb191-4884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4885"><a href="#cb191-4885" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb191-4886"><a href="#cb191-4886" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(temp_values)) {</span>
<span id="cb191-4887"><a href="#cb191-4887" aria-hidden="true" tabindex="-1"></a>    y[i] <span class="ot">&lt;-</span> <span class="fu">apply_const_temp</span>(<span class="at">temp =</span> temp_values[i],</span>
<span id="cb191-4888"><a href="#cb191-4888" aria-hidden="true" tabindex="-1"></a>                             <span class="at">A0 =</span> A0,</span>
<span id="cb191-4889"><a href="#cb191-4889" aria-hidden="true" tabindex="-1"></a>                             <span class="at">A1 =</span> A1,</span>
<span id="cb191-4890"><a href="#cb191-4890" aria-hidden="true" tabindex="-1"></a>                             <span class="at">E0 =</span> E0,</span>
<span id="cb191-4891"><a href="#cb191-4891" aria-hidden="true" tabindex="-1"></a>                             <span class="at">E1 =</span> E1,</span>
<span id="cb191-4892"><a href="#cb191-4892" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Tf =</span> Tf,</span>
<span id="cb191-4893"><a href="#cb191-4893" aria-hidden="true" tabindex="-1"></a>                             <span class="at">slope =</span> slope)</span>
<span id="cb191-4894"><a href="#cb191-4894" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb191-4895"><a href="#cb191-4895" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(y))</span>
<span id="cb191-4896"><a href="#cb191-4896" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb191-4897"><a href="#cb191-4897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4898"><a href="#cb191-4898" aria-hidden="true" tabindex="-1"></a>temp_values <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">30</span>, <span class="fl">0.1</span>)</span>
<span id="cb191-4899"><a href="#cb191-4899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4900"><a href="#cb191-4900" aria-hidden="true" tabindex="-1"></a>bell <span class="ot">&lt;-</span> <span class="fu">gen_bell</span>(Roter_par,</span>
<span id="cb191-4901"><a href="#cb191-4901" aria-hidden="true" tabindex="-1"></a>                 temp_values)</span>
<span id="cb191-4902"><a href="#cb191-4902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4903"><a href="#cb191-4903" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bell)</span>
<span id="cb191-4904"><a href="#cb191-4904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4905"><a href="#cb191-4905" aria-hidden="true" tabindex="-1"></a>GDH_response <span class="ot">&lt;-</span> <span class="cf">function</span>(T, par) {</span>
<span id="cb191-4906"><a href="#cb191-4906" aria-hidden="true" tabindex="-1"></a>  Tb <span class="ot">&lt;-</span> par[<span class="dv">11</span>]</span>
<span id="cb191-4907"><a href="#cb191-4907" aria-hidden="true" tabindex="-1"></a>  Tu <span class="ot">&lt;-</span> par[<span class="dv">4</span>]</span>
<span id="cb191-4908"><a href="#cb191-4908" aria-hidden="true" tabindex="-1"></a>  Tc <span class="ot">&lt;-</span> par[<span class="dv">10</span>]</span>
<span id="cb191-4909"><a href="#cb191-4909" aria-hidden="true" tabindex="-1"></a>  GDH_weight <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(T))</span>
<span id="cb191-4910"><a href="#cb191-4910" aria-hidden="true" tabindex="-1"></a>  GDH_weight[<span class="fu">which</span>(T <span class="sc">&gt;=</span> Tb <span class="sc">&amp;</span> T <span class="sc">&lt;=</span> Tu)] <span class="ot">&lt;-</span></span>
<span id="cb191-4911"><a href="#cb191-4911" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">cos</span>(pi <span class="sc">+</span> pi <span class="sc">*</span> (T[<span class="fu">which</span>(T <span class="sc">&gt;=</span> Tb <span class="sc">&amp;</span> T <span class="sc">&lt;=</span> Tu)] <span class="sc">-</span> Tb)<span class="sc">/</span>(Tu <span class="sc">-</span> Tb)))</span>
<span id="cb191-4912"><a href="#cb191-4912" aria-hidden="true" tabindex="-1"></a>  GDH_weight[<span class="fu">which</span>(T <span class="sc">&gt;</span> Tu <span class="sc">&amp;</span> T <span class="sc">&lt;=</span> Tc)] <span class="ot">&lt;-</span></span>
<span id="cb191-4913"><a href="#cb191-4913" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">cos</span>(pi<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> pi<span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> (T[<span class="fu">which</span>(T <span class="sc">&gt;</span>  Tu <span class="sc">&amp;</span> T <span class="sc">&lt;=</span> Tc)] <span class="sc">-</span>Tu)<span class="sc">/</span>(Tc <span class="sc">-</span> Tu)))</span>
<span id="cb191-4914"><a href="#cb191-4914" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(GDH_weight)</span>
<span id="cb191-4915"><a href="#cb191-4915" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb191-4916"><a href="#cb191-4916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4917"><a href="#cb191-4917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4918"><a href="#cb191-4918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4919"><a href="#cb191-4919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4920"><a href="#cb191-4920" aria-hidden="true" tabindex="-1"></a>temp_values <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">30</span>, <span class="fl">0.1</span>)</span>
<span id="cb191-4921"><a href="#cb191-4921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4922"><a href="#cb191-4922" aria-hidden="true" tabindex="-1"></a>temp_response <span class="ot">&lt;-</span> </span>
<span id="cb191-4923"><a href="#cb191-4923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">Temperature =</span> temp_values,</span>
<span id="cb191-4924"><a href="#cb191-4924" aria-hidden="true" tabindex="-1"></a>             <span class="at">Chill_response =</span> <span class="fu">gen_bell</span>(Roter_par,</span>
<span id="cb191-4925"><a href="#cb191-4925" aria-hidden="true" tabindex="-1"></a>                                       temp_values),</span>
<span id="cb191-4926"><a href="#cb191-4926" aria-hidden="true" tabindex="-1"></a>             <span class="at">Heat_response =</span> <span class="fu">GDH_response</span>(temp_values,</span>
<span id="cb191-4927"><a href="#cb191-4927" aria-hidden="true" tabindex="-1"></a>                                          Roter_par))</span>
<span id="cb191-4928"><a href="#cb191-4928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4929"><a href="#cb191-4929" aria-hidden="true" tabindex="-1"></a>pivoted_response <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(temp_response, </span>
<span id="cb191-4930"><a href="#cb191-4930" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">c</span>(Chill_response,</span>
<span id="cb191-4931"><a href="#cb191-4931" aria-hidden="true" tabindex="-1"></a>                                   Heat_response))</span>
<span id="cb191-4932"><a href="#cb191-4932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4933"><a href="#cb191-4933" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pivoted_response,</span>
<span id="cb191-4934"><a href="#cb191-4934" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Temperature,</span>
<span id="cb191-4935"><a href="#cb191-4935" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb191-4936"><a href="#cb191-4936" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">2</span>,</span>
<span id="cb191-4937"><a href="#cb191-4937" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">col =</span> name)) <span class="sc">+</span></span>
<span id="cb191-4938"><a href="#cb191-4938" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Temperature response (arbitrary units)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-4939"><a href="#cb191-4939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Temperature (Â°C)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-4940"><a href="#cb191-4940" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(name),</span>
<span id="cb191-4941"><a href="#cb191-4941" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb191-4942"><a href="#cb191-4942" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> </span>
<span id="cb191-4943"><a href="#cb191-4943" aria-hidden="true" tabindex="-1"></a>               <span class="fu">labeller</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="at">Chill_response =</span> <span class="fu">c</span>(<span class="st">&quot;Chill response&quot;</span>),</span>
<span id="cb191-4944"><a href="#cb191-4944" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Heat_response =</span> <span class="fu">c</span>(<span class="st">&quot;Heat response&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb191-4945"><a href="#cb191-4945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Chill_response&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb191-4946"><a href="#cb191-4946" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;Heat_response&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb191-4947"><a href="#cb191-4947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb191-4948"><a href="#cb191-4948" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb191-4949"><a href="#cb191-4949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4950"><a href="#cb191-4950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4951"><a href="#cb191-4951" aria-hidden="true" tabindex="-1"></a><span class="co"># Using Rochester as location</span></span>
<span id="cb191-4952"><a href="#cb191-4952" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">&lt;-</span> <span class="fl">43.1</span></span>
<span id="cb191-4953"><a href="#cb191-4953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4954"><a href="#cb191-4954" aria-hidden="true" tabindex="-1"></a>month_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb191-4955"><a href="#cb191-4955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4956"><a href="#cb191-4956" aria-hidden="true" tabindex="-1"></a>Tmins <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb191-4957"><a href="#cb191-4957" aria-hidden="true" tabindex="-1"></a>Tmaxs <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span><span class="sc">:</span><span class="dv">30</span>)</span>
<span id="cb191-4958"><a href="#cb191-4958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4959"><a href="#cb191-4959" aria-hidden="true" tabindex="-1"></a>mins <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-4960"><a href="#cb191-4960" aria-hidden="true" tabindex="-1"></a>maxs <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-4961"><a href="#cb191-4961" aria-hidden="true" tabindex="-1"></a>chill_eff <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-4962"><a href="#cb191-4962" aria-hidden="true" tabindex="-1"></a>heat_eff <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-4963"><a href="#cb191-4963" aria-hidden="true" tabindex="-1"></a>month <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb191-4964"><a href="#cb191-4964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4965"><a href="#cb191-4965" aria-hidden="true" tabindex="-1"></a>Roter_par <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/PhenoFlex_parameters_Roter_Boskoop.csv&quot;</span>)[, <span class="dv">2</span>]</span>
<span id="cb191-4966"><a href="#cb191-4966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4967"><a href="#cb191-4967" aria-hidden="true" tabindex="-1"></a>simulation_par <span class="ot">&lt;-</span> Roter_par</span>
<span id="cb191-4968"><a href="#cb191-4968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4969"><a href="#cb191-4969" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (mon <span class="cf">in</span> month_range) {</span>
<span id="cb191-4970"><a href="#cb191-4970" aria-hidden="true" tabindex="-1"></a>    days_month <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="fu">ISOdate</span>(<span class="dv">2002</span>, mon <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">1</span>), <span class="fu">ISOdate</span>(<span class="dv">2002</span>, mon,</span>
<span id="cb191-4971"><a href="#cb191-4971" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>)))</span>
<span id="cb191-4972"><a href="#cb191-4972" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (mon <span class="sc">==</span> <span class="dv">12</span>)</span>
<span id="cb191-4973"><a href="#cb191-4973" aria-hidden="true" tabindex="-1"></a>        days_month <span class="ot">&lt;-</span> <span class="dv">31</span></span>
<span id="cb191-4974"><a href="#cb191-4974" aria-hidden="true" tabindex="-1"></a>    weather <span class="ot">&lt;-</span> <span class="fu">make_all_day_table</span>(<span class="fu">data.frame</span>(<span class="at">Year =</span> <span class="fu">c</span>(<span class="dv">2002</span>, <span class="dv">2002</span>), <span class="at">Month =</span> <span class="fu">c</span>(mon,</span>
<span id="cb191-4975"><a href="#cb191-4975" aria-hidden="true" tabindex="-1"></a>        mon), <span class="at">Day =</span> <span class="fu">c</span>(<span class="dv">1</span>, days_month), <span class="at">Tmin =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">Tmax =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb191-4976"><a href="#cb191-4976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4977"><a href="#cb191-4977" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (tmin <span class="cf">in</span> Tmins) <span class="cf">for</span> (tmax <span class="cf">in</span> Tmaxs) <span class="cf">if</span> (tmax <span class="sc">&gt;=</span> tmin) {</span>
<span id="cb191-4978"><a href="#cb191-4978" aria-hidden="true" tabindex="-1"></a>        hourtemps <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span></span>
<span id="cb191-4979"><a href="#cb191-4979" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">Tmin =</span> tmin, <span class="at">Tmax =</span> tmax) <span class="sc">%&gt;%</span></span>
<span id="cb191-4980"><a href="#cb191-4980" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stack_hourly_temps</span>(<span class="at">latitude =</span> latitude) <span class="sc">%&gt;%</span></span>
<span id="cb191-4981"><a href="#cb191-4981" aria-hidden="true" tabindex="-1"></a>            <span class="fu">pluck</span>(<span class="st">&quot;hourtemps&quot;</span>, <span class="st">&quot;Temp&quot;</span>)</span>
<span id="cb191-4982"><a href="#cb191-4982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4983"><a href="#cb191-4983" aria-hidden="true" tabindex="-1"></a>        chill_eff <span class="ot">&lt;-</span> <span class="fu">c</span>(chill_eff, <span class="fu">PhenoFlex</span>(<span class="at">temp =</span> hourtemps, <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(hourtemps)),</span>
<span id="cb191-4984"><a href="#cb191-4984" aria-hidden="true" tabindex="-1"></a>            <span class="at">A0 =</span> simulation_par[<span class="dv">7</span>], <span class="at">A1 =</span> simulation_par[<span class="dv">8</span>], <span class="at">E0 =</span> simulation_par[<span class="dv">5</span>],</span>
<span id="cb191-4985"><a href="#cb191-4985" aria-hidden="true" tabindex="-1"></a>            <span class="at">E1 =</span> simulation_par[<span class="dv">6</span>], <span class="at">Tf =</span> simulation_par[<span class="dv">9</span>], <span class="at">slope =</span> simulation_par[<span class="dv">12</span>],</span>
<span id="cb191-4986"><a href="#cb191-4986" aria-hidden="true" tabindex="-1"></a>            <span class="at">deg_celsius =</span> <span class="cn">TRUE</span>, <span class="at">basic_output =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>y[<span class="fu">length</span>(hourtemps)]<span class="sc">/</span>(<span class="fu">length</span>(hourtemps)<span class="sc">/</span><span class="dv">24</span>))</span>
<span id="cb191-4987"><a href="#cb191-4987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4988"><a href="#cb191-4988" aria-hidden="true" tabindex="-1"></a>        heat_eff <span class="ot">&lt;-</span> <span class="fu">c</span>(heat_eff, <span class="fu">cumsum</span>(<span class="fu">GDH_response</span>(hourtemps, simulation_par))[<span class="fu">length</span>(hourtemps)]<span class="sc">/</span>(<span class="fu">length</span>(hourtemps)<span class="sc">/</span><span class="dv">24</span>))</span>
<span id="cb191-4989"><a href="#cb191-4989" aria-hidden="true" tabindex="-1"></a>        mins <span class="ot">&lt;-</span> <span class="fu">c</span>(mins, tmin)</span>
<span id="cb191-4990"><a href="#cb191-4990" aria-hidden="true" tabindex="-1"></a>        maxs <span class="ot">&lt;-</span> <span class="fu">c</span>(maxs, tmax)</span>
<span id="cb191-4991"><a href="#cb191-4991" aria-hidden="true" tabindex="-1"></a>        month <span class="ot">&lt;-</span> <span class="fu">c</span>(month, mon)</span>
<span id="cb191-4992"><a href="#cb191-4992" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb191-4993"><a href="#cb191-4993" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb191-4994"><a href="#cb191-4994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4995"><a href="#cb191-4995" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Month =</span> month, <span class="at">Tmin =</span> mins, <span class="at">Tmax =</span> maxs, <span class="at">Chill_eff =</span> chill_eff,</span>
<span id="cb191-4996"><a href="#cb191-4996" aria-hidden="true" tabindex="-1"></a>    <span class="at">Heat_eff =</span> heat_eff) <span class="sc">%&gt;%</span></span>
<span id="cb191-4997"><a href="#cb191-4997" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Month))</span>
<span id="cb191-4998"><a href="#cb191-4998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4999"><a href="#cb191-4999" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(results, <span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/model_sensitivity_PhenoFlex_Roter.csv&quot;</span>)</span>
<span id="cb191-5000"><a href="#cb191-5000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5001"><a href="#cb191-5001" aria-hidden="true" tabindex="-1"></a><span class="co"># Chill response plot</span></span>
<span id="cb191-5002"><a href="#cb191-5002" aria-hidden="true" tabindex="-1"></a>Model_sensitivities_PhenoFlex <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/model_sensitivity_PhenoFlex_Roter.csv&quot;</span>)</span>
<span id="cb191-5003"><a href="#cb191-5003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5004"><a href="#cb191-5004" aria-hidden="true" tabindex="-1"></a>Rochester_weather <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Rochester_weather.csv&quot;</span>)</span>
<span id="cb191-5005"><a href="#cb191-5005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5006"><a href="#cb191-5006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5007"><a href="#cb191-5007" aria-hidden="true" tabindex="-1"></a><span class="fu">Chill_sensitivity_temps</span>(Model_sensitivities_PhenoFlex, Rochester_weather, <span class="at">temp_model =</span> <span class="st">&quot;Chill_eff&quot;</span>,</span>
<span id="cb191-5008"><a href="#cb191-5008" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">Tmins =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">20</span>), <span class="at">Tmaxs =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span><span class="sc">:</span><span class="dv">30</span>), <span class="at">legend_label =</span> <span class="st">&quot;Chill per day </span><span class="sc">\n</span><span class="st">(arbitrary)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-5009"><a href="#cb191-5009" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;PhenoFlex chill efficiency (&#39;Roter Boskoop&#39;)&quot;</span>)</span>
<span id="cb191-5010"><a href="#cb191-5010" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-5011"><a href="#cb191-5011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5012"><a href="#cb191-5012" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-5013"><a href="#cb191-5013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5014"><a href="#cb191-5014" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-5015"><a href="#cb191-5015" aria-hidden="true" tabindex="-1"></a><span class="co"># Heat response plot</span></span>
<span id="cb191-5016"><a href="#cb191-5016" aria-hidden="true" tabindex="-1"></a><span class="fu">Chill_sensitivity_temps</span>(Model_sensitivities_PhenoFlex, Rochester_weather, <span class="at">temp_model =</span> <span class="st">&quot;Heat_eff&quot;</span>,</span>
<span id="cb191-5017"><a href="#cb191-5017" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">Tmins =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">20</span>), <span class="at">Tmaxs =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span><span class="sc">:</span><span class="dv">30</span>), <span class="at">legend_label =</span> <span class="st">&quot;Heat per day </span><span class="sc">\n</span><span class="st">(arbitrary)&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-5018"><a href="#cb191-5018" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;PhenoFlex heat efficiency (&#39;Roter Boskoop&#39;)&quot;</span>)</span>
<span id="cb191-5019"><a href="#cb191-5019" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-5020"><a href="#cb191-5020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5021"><a href="#cb191-5021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5022"><a href="#cb191-5022" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-5023"><a href="#cb191-5023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5024"><a href="#cb191-5024" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 32: Can we improve the performance of PhenoFlex</span></span>
<span id="cb191-5025"><a href="#cb191-5025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5026"><a href="#cb191-5026" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on improving the performance of PhenoFlex***</span></span>
<span id="cb191-5027"><a href="#cb191-5027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5028"><a href="#cb191-5028" aria-hidden="true" tabindex="-1"></a>Describe (briefly) in your own words:</span>
<span id="cb191-5029"><a href="#cb191-5029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5030"><a href="#cb191-5030" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>What was the objective of this work? </span>
<span id="cb191-5031"><a href="#cb191-5031" aria-hidden="true" tabindex="-1"></a>The objective is to validate the  PhenoFlex model under different conditions. Also, some results obtained in the original publication suggest temperature responses during chill accumulation that seem implausible.</span>
<span id="cb191-5032"><a href="#cb191-5032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5033"><a href="#cb191-5033" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>What was the main conclusion? </span>
<span id="cb191-5034"><a href="#cb191-5034" aria-hidden="true" tabindex="-1"></a>Discussions on the major potential limitations of the PhenoFlex and other models. It has been obbserved that under extreme conditions, the process of dormancy breaking is modulated by mechanisms that are not considered in the PhenoFlex framework.</span>
<span id="cb191-5035"><a href="#cb191-5035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5036"><a href="#cb191-5036" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>What experiments could we conduct to test the hypothesis that emerged at the end of the conclusion?</span>
<span id="cb191-5037"><a href="#cb191-5037" aria-hidden="true" tabindex="-1"></a>It has been concluded that additional systematic studies would have to be conducted.</span>
<span id="cb191-5038"><a href="#cb191-5038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5039"><a href="#cb191-5039" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb191-5040"><a href="#cb191-5040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5041"><a href="#cb191-5041" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 33: Frost risk analysis</span></span>
<span id="cb191-5042"><a href="#cb191-5042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5043"><a href="#cb191-5043" aria-hidden="true" tabindex="-1"></a><span class="fu">## ***Exercises on frost risk analysis***</span></span>
<span id="cb191-5044"><a href="#cb191-5044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5045"><a href="#cb191-5045" aria-hidden="true" tabindex="-1"></a>1.Download the phenology dataset for the apple cultivar Roter Boskoop from Klein-Altendorf.</span>
<span id="cb191-5046"><a href="#cb191-5046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5047"><a href="#cb191-5047" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-5048"><a href="#cb191-5048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5049"><a href="#cb191-5049" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-5050"><a href="#cb191-5050" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb191-5051"><a href="#cb191-5051" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb191-5052"><a href="#cb191-5052" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb191-5053"><a href="#cb191-5053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5054"><a href="#cb191-5054" aria-hidden="true" tabindex="-1"></a>CKA_Roter_Boskoop <span class="ot">&lt;-</span> <span class="fu">read_tab</span>(<span class="st">&quot;C:/Users/Home/Documents/R Files/Trial Bookdown/data_New_York/Roter_Boskoop_bloom_1958_2019.csv.csv&quot;</span>)</span>
<span id="cb191-5055"><a href="#cb191-5055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5056"><a href="#cb191-5056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5057"><a href="#cb191-5057" aria-hidden="true" tabindex="-1"></a>Roter_Boskoop <span class="ot">&lt;-</span> CKA_Roter_Boskoop <span class="sc">%&gt;%</span></span>
<span id="cb191-5058"><a href="#cb191-5058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">&quot;First_bloom&quot;</span><span class="sc">:</span><span class="st">&quot;Last_bloom&quot;</span>,</span>
<span id="cb191-5059"><a href="#cb191-5059" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb191-5060"><a href="#cb191-5060" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to=</span><span class="st">&quot;YEARMODA&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb191-5061"><a href="#cb191-5061" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(YEARMODA, <span class="dv">1</span>, <span class="dv">4</span>)),</span>
<span id="cb191-5062"><a href="#cb191-5062" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(YEARMODA, <span class="dv">5</span>, <span class="dv">6</span>)),</span>
<span id="cb191-5063"><a href="#cb191-5063" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(YEARMODA, <span class="dv">7</span>, <span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb191-5064"><a href="#cb191-5064" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_JDay</span>() </span>
<span id="cb191-5065"><a href="#cb191-5065" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-5066"><a href="#cb191-5066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5067"><a href="#cb191-5067" aria-hidden="true" tabindex="-1"></a>2.Illustrate the development of the bloom period over the duration of the weather record. Use multiple ways to show this - feel free to be creative.</span>
<span id="cb191-5068"><a href="#cb191-5068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5069"><a href="#cb191-5069" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-5070"><a href="#cb191-5070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5071"><a href="#cb191-5071" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-5072"><a href="#cb191-5072" aria-hidden="true" tabindex="-1"></a><span class="co"># Illustrating with a scatter plot</span></span>
<span id="cb191-5073"><a href="#cb191-5073" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb191-5074"><a href="#cb191-5074" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb191-5075"><a href="#cb191-5075" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb191-5076"><a href="#cb191-5076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5077"><a href="#cb191-5077" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Roter_Boskoop,<span class="fu">aes</span>(Pheno_year, JDay, <span class="at">col =</span> variable)) <span class="sc">+</span></span>
<span id="cb191-5078"><a href="#cb191-5078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb191-5079"><a href="#cb191-5079" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm) <span class="sc">+</span></span>
<span id="cb191-5080"><a href="#cb191-5080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb191-5081"><a href="#cb191-5081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(</span>
<span id="cb191-5082"><a href="#cb191-5082" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Phenological event&quot;</span>,</span>
<span id="cb191-5083"><a href="#cb191-5083" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;First bloom&quot;</span>, <span class="st">&quot;Full bloom&quot;</span>, <span class="st">&quot;Last bloom&quot;</span>)) <span class="sc">+</span></span>
<span id="cb191-5084"><a href="#cb191-5084" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Phenological year&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-5085"><a href="#cb191-5085" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Julian date (day of the year)&quot;</span>)</span>
<span id="cb191-5086"><a href="#cb191-5086" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-5087"><a href="#cb191-5087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5088"><a href="#cb191-5088" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Evaluate the occurrence of frost events at Klein-Altendorf since 1958. Illustrate this in a plot.</span>
<span id="cb191-5089"><a href="#cb191-5089" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-5090"><a href="#cb191-5090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5091"><a href="#cb191-5091" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-5092"><a href="#cb191-5092" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb191-5093"><a href="#cb191-5093" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb191-5094"><a href="#cb191-5094" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb191-5095"><a href="#cb191-5095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5096"><a href="#cb191-5096" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating model for frost hours (temperatures &lt; 0Â°C)</span></span>
<span id="cb191-5097"><a href="#cb191-5097" aria-hidden="true" tabindex="-1"></a>frost_df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb191-5098"><a href="#cb191-5098" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1000</span>, <span class="dv">0</span>),</span>
<span id="cb191-5099"><a href="#cb191-5099" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>),</span>
<span id="cb191-5100"><a href="#cb191-5100" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb191-5101"><a href="#cb191-5101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5102"><a href="#cb191-5102" aria-hidden="true" tabindex="-1"></a>frost_model <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">step_model</span>(x,</span>
<span id="cb191-5103"><a href="#cb191-5103" aria-hidden="true" tabindex="-1"></a>                                      frost_df)</span>
<span id="cb191-5104"><a href="#cb191-5104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5105"><a href="#cb191-5105" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert temperature record to hourly values</span></span>
<span id="cb191-5106"><a href="#cb191-5106" aria-hidden="true" tabindex="-1"></a>hourly <span class="ot">&lt;-</span> <span class="fu">stack_hourly_temps</span>(CKA_weather,</span>
<span id="cb191-5107"><a href="#cb191-5107" aria-hidden="true" tabindex="-1"></a>                             <span class="at">latitude =</span> <span class="fl">50.625</span>)</span>
<span id="cb191-5108"><a href="#cb191-5108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5109"><a href="#cb191-5109" aria-hidden="true" tabindex="-1"></a>frost <span class="ot">&lt;-</span> <span class="fu">tempResponse</span>(hourly,</span>
<span id="cb191-5110"><a href="#cb191-5110" aria-hidden="true" tabindex="-1"></a>                      <span class="at">models =</span> <span class="fu">c</span>(<span class="at">frost =</span> frost_model))</span>
<span id="cb191-5111"><a href="#cb191-5111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5112"><a href="#cb191-5112" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot number of frost hours</span></span>
<span id="cb191-5113"><a href="#cb191-5113" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(frost,</span>
<span id="cb191-5114"><a href="#cb191-5114" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(End_year,</span>
<span id="cb191-5115"><a href="#cb191-5115" aria-hidden="true" tabindex="-1"></a>           frost)) <span class="sc">+</span></span>
<span id="cb191-5116"><a href="#cb191-5116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb191-5117"><a href="#cb191-5117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb191-5118"><a href="#cb191-5118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb191-5119"><a href="#cb191-5119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Frost hours per year&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-5120"><a href="#cb191-5120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Year&quot;</span>)</span>
<span id="cb191-5121"><a href="#cb191-5121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-5122"><a href="#cb191-5122" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb191-5123"><a href="#cb191-5123" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Produce an illustration of the relationship between spring frost events and the bloom period of âRoter Boskoopâ.</span>
<span id="cb191-5124"><a href="#cb191-5124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5125"><a href="#cb191-5125" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-5126"><a href="#cb191-5126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5127"><a href="#cb191-5127" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-5128"><a href="#cb191-5128" aria-hidden="true" tabindex="-1"></a><span class="co"># library(chillR)</span></span>
<span id="cb191-5129"><a href="#cb191-5129" aria-hidden="true" tabindex="-1"></a><span class="co"># library(leaflet)</span></span>
<span id="cb191-5130"><a href="#cb191-5130" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyverse)</span></span>
<span id="cb191-5131"><a href="#cb191-5131" aria-hidden="true" tabindex="-1"></a><span class="co"># library(kableExtra)</span></span>
<span id="cb191-5132"><a href="#cb191-5132" aria-hidden="true" tabindex="-1"></a><span class="co"># library(Kendall)</span></span>
<span id="cb191-5133"><a href="#cb191-5133" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5134"><a href="#cb191-5134" aria-hidden="true" tabindex="-1"></a><span class="co"># # Generating model for frost hours (temperatures &lt; 0Â°C)</span></span>
<span id="cb191-5135"><a href="#cb191-5135" aria-hidden="true" tabindex="-1"></a><span class="co"># frost_df = data.frame(</span></span>
<span id="cb191-5136"><a href="#cb191-5136" aria-hidden="true" tabindex="-1"></a><span class="co">#   lower = c(-1000, 0),</span></span>
<span id="cb191-5137"><a href="#cb191-5137" aria-hidden="true" tabindex="-1"></a><span class="co">#   upper = c(0, 1000),</span></span>
<span id="cb191-5138"><a href="#cb191-5138" aria-hidden="true" tabindex="-1"></a><span class="co">#   weight = c(1, 0))</span></span>
<span id="cb191-5139"><a href="#cb191-5139" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5140"><a href="#cb191-5140" aria-hidden="true" tabindex="-1"></a><span class="co"># frost_model &lt;- function(x) step_model(x,</span></span>
<span id="cb191-5141"><a href="#cb191-5141" aria-hidden="true" tabindex="-1"></a><span class="co">#                                       frost_df)</span></span>
<span id="cb191-5142"><a href="#cb191-5142" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5143"><a href="#cb191-5143" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert temperature record to hourly values</span></span>
<span id="cb191-5144"><a href="#cb191-5144" aria-hidden="true" tabindex="-1"></a><span class="co"># hourly &lt;- stack_hourly_temps(CKA_weather,</span></span>
<span id="cb191-5145"><a href="#cb191-5145" aria-hidden="true" tabindex="-1"></a><span class="co">#                              latitude = 50.625)</span></span>
<span id="cb191-5146"><a href="#cb191-5146" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5147"><a href="#cb191-5147" aria-hidden="true" tabindex="-1"></a><span class="co"># frost &lt;- tempResponse(hourly,</span></span>
<span id="cb191-5148"><a href="#cb191-5148" aria-hidden="true" tabindex="-1"></a><span class="co">#                       models = c(frost = frost_model))</span></span>
<span id="cb191-5149"><a href="#cb191-5149" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5150"><a href="#cb191-5150" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5151"><a href="#cb191-5151" aria-hidden="true" tabindex="-1"></a><span class="co"># # Ribbon for total bloom duration</span></span>
<span id="cb191-5152"><a href="#cb191-5152" aria-hidden="true" tabindex="-1"></a><span class="co"># Ribbon_Boskoop &lt;-</span></span>
<span id="cb191-5153"><a href="#cb191-5153" aria-hidden="true" tabindex="-1"></a><span class="co">#   Roter_Boskoop %&gt;%</span></span>
<span id="cb191-5154"><a href="#cb191-5154" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(Pheno_year, variable, JDay) %&gt;%</span></span>
<span id="cb191-5155"><a href="#cb191-5155" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = &quot;variable&quot;, values_from = &quot;JDay&quot;)</span></span>
<span id="cb191-5156"><a href="#cb191-5156" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5157"><a href="#cb191-5157" aria-hidden="true" tabindex="-1"></a><span class="co"># # Identify frost events that overlap with bloom </span></span>
<span id="cb191-5158"><a href="#cb191-5158" aria-hidden="true" tabindex="-1"></a><span class="co"># lookup_dates &lt;- Ribbon_Boskoop</span></span>
<span id="cb191-5159"><a href="#cb191-5159" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5160"><a href="#cb191-5160" aria-hidden="true" tabindex="-1"></a><span class="co"># row.names(lookup_dates) &lt;- lookup_dates$Pheno_year</span></span>
<span id="cb191-5161"><a href="#cb191-5161" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5162"><a href="#cb191-5162" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily_frost[, &quot;First_bloom&quot;]&lt;-</span></span>
<span id="cb191-5163"><a href="#cb191-5163" aria-hidden="true" tabindex="-1"></a><span class="co">#   lookup_dates[as.character(Daily_frost$Year),</span></span>
<span id="cb191-5164"><a href="#cb191-5164" aria-hidden="true" tabindex="-1"></a><span class="co">#                &quot;First_bloom&quot;]</span></span>
<span id="cb191-5165"><a href="#cb191-5165" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5166"><a href="#cb191-5166" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily_frost[, &quot;Last_bloom&quot;] &lt;-</span></span>
<span id="cb191-5167"><a href="#cb191-5167" aria-hidden="true" tabindex="-1"></a><span class="co">#   lookup_dates[as.character(Daily_frost$Year),</span></span>
<span id="cb191-5168"><a href="#cb191-5168" aria-hidden="true" tabindex="-1"></a><span class="co">#                &quot;Last_bloom&quot;]</span></span>
<span id="cb191-5169"><a href="#cb191-5169" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5170"><a href="#cb191-5170" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily_frost[which(!is.na(Daily_frost$Frost_hours)),</span></span>
<span id="cb191-5171"><a href="#cb191-5171" aria-hidden="true" tabindex="-1"></a><span class="co">#             &quot;Bloom_frost&quot;] &lt;-</span></span>
<span id="cb191-5172"><a href="#cb191-5172" aria-hidden="true" tabindex="-1"></a><span class="co">#   &quot;Before bloom&quot;</span></span>
<span id="cb191-5173"><a href="#cb191-5173" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5174"><a href="#cb191-5174" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily_frost[which(Daily_frost$JDay &gt;= Daily_frost$First_bloom),</span></span>
<span id="cb191-5175"><a href="#cb191-5175" aria-hidden="true" tabindex="-1"></a><span class="co">#             &quot;Bloom_frost&quot;] &lt;-</span></span>
<span id="cb191-5176"><a href="#cb191-5176" aria-hidden="true" tabindex="-1"></a><span class="co">#   &quot;During bloom&quot;</span></span>
<span id="cb191-5177"><a href="#cb191-5177" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5178"><a href="#cb191-5178" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily_frost[which(Daily_frost$JDay &gt; Daily_frost$Last_bloom),</span></span>
<span id="cb191-5179"><a href="#cb191-5179" aria-hidden="true" tabindex="-1"></a><span class="co">#             &quot;Bloom_frost&quot;] &lt;-</span></span>
<span id="cb191-5180"><a href="#cb191-5180" aria-hidden="true" tabindex="-1"></a><span class="co">#   &quot;After bloom&quot;</span></span>
<span id="cb191-5181"><a href="#cb191-5181" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5182"><a href="#cb191-5182" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily_frost[which(Daily_frost$JDay &gt; 180),</span></span>
<span id="cb191-5183"><a href="#cb191-5183" aria-hidden="true" tabindex="-1"></a><span class="co">#             &quot;Bloom_frost&quot;] &lt;-</span></span>
<span id="cb191-5184"><a href="#cb191-5184" aria-hidden="true" tabindex="-1"></a><span class="co">#   &quot;Before bloom&quot;</span></span>
<span id="cb191-5185"><a href="#cb191-5185" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot spring frost events that coincided with bloom</span></span>
<span id="cb191-5186"><a href="#cb191-5186" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(data = Ribbon_Boskoop,</span></span>
<span id="cb191-5187"><a href="#cb191-5187" aria-hidden="true" tabindex="-1"></a><span class="co">#        aes(Pheno_year)) +</span></span>
<span id="cb191-5188"><a href="#cb191-5188" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_ribbon(aes(ymin = First_bloom, </span></span>
<span id="cb191-5189"><a href="#cb191-5189" aria-hidden="true" tabindex="-1"></a><span class="co">#                   ymax = Last_bloom),</span></span>
<span id="cb191-5190"><a href="#cb191-5190" aria-hidden="true" tabindex="-1"></a><span class="co">#               fill = &quot;light gray&quot;) +</span></span>
<span id="cb191-5191"><a href="#cb191-5191" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(aes(y = Full_bloom)) +</span></span>
<span id="cb191-5192"><a href="#cb191-5192" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_bw(base_size = 15) +</span></span>
<span id="cb191-5193"><a href="#cb191-5193" aria-hidden="true" tabindex="-1"></a><span class="co">#   xlab(&quot;Phenological year&quot;) +</span></span>
<span id="cb191-5194"><a href="#cb191-5194" aria-hidden="true" tabindex="-1"></a><span class="co">#   ylab(&quot;Julian date (day of the year)&quot;) +</span></span>
<span id="cb191-5195"><a href="#cb191-5195" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(data = Daily_frost,</span></span>
<span id="cb191-5196"><a href="#cb191-5196" aria-hidden="true" tabindex="-1"></a><span class="co">#              aes(Year,</span></span>
<span id="cb191-5197"><a href="#cb191-5197" aria-hidden="true" tabindex="-1"></a><span class="co">#                  JDay,</span></span>
<span id="cb191-5198"><a href="#cb191-5198" aria-hidden="true" tabindex="-1"></a><span class="co">#                  size = Frost_hours,</span></span>
<span id="cb191-5199"><a href="#cb191-5199" aria-hidden="true" tabindex="-1"></a><span class="co">#                  col = Bloom_frost),</span></span>
<span id="cb191-5200"><a href="#cb191-5200" aria-hidden="true" tabindex="-1"></a><span class="co">#              alpha = 0.8) + </span></span>
<span id="cb191-5201"><a href="#cb191-5201" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_size(range = c(0, 5),</span></span>
<span id="cb191-5202"><a href="#cb191-5202" aria-hidden="true" tabindex="-1"></a><span class="co">#              breaks = c(1, 5, 10, 15, 20),</span></span>
<span id="cb191-5203"><a href="#cb191-5203" aria-hidden="true" tabindex="-1"></a><span class="co">#              labels = c(&quot;1&quot;, &quot;5&quot;, &quot;10&quot;, &quot;15&quot;, &quot;20&quot;),</span></span>
<span id="cb191-5204"><a href="#cb191-5204" aria-hidden="true" tabindex="-1"></a><span class="co">#              name = &quot;Frost hours&quot;) +</span></span>
<span id="cb191-5205"><a href="#cb191-5205" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(</span></span>
<span id="cb191-5206"><a href="#cb191-5206" aria-hidden="true" tabindex="-1"></a><span class="co">#     breaks = c(&quot;Before bloom&quot;,</span></span>
<span id="cb191-5207"><a href="#cb191-5207" aria-hidden="true" tabindex="-1"></a><span class="co">#                &quot;During bloom&quot;,</span></span>
<span id="cb191-5208"><a href="#cb191-5208" aria-hidden="true" tabindex="-1"></a><span class="co">#                &quot;After bloom&quot;),</span></span>
<span id="cb191-5209"><a href="#cb191-5209" aria-hidden="true" tabindex="-1"></a><span class="co">#     values = c(&quot;light green&quot;,</span></span>
<span id="cb191-5210"><a href="#cb191-5210" aria-hidden="true" tabindex="-1"></a><span class="co">#                &quot;red&quot;,</span></span>
<span id="cb191-5211"><a href="#cb191-5211" aria-hidden="true" tabindex="-1"></a><span class="co">#                &quot;light blue&quot;),</span></span>
<span id="cb191-5212"><a href="#cb191-5212" aria-hidden="true" tabindex="-1"></a><span class="co">#     name = &quot;Frost timing&quot;) +</span></span>
<span id="cb191-5213"><a href="#cb191-5213" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_bw(base_size = 15) +</span></span>
<span id="cb191-5214"><a href="#cb191-5214" aria-hidden="true" tabindex="-1"></a><span class="co">#   ylim(c(75, 140))</span></span>
<span id="cb191-5215"><a href="#cb191-5215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-5216"><a href="#cb191-5216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5217"><a href="#cb191-5217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5218"><a href="#cb191-5218" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Evaluate how the risk of spring frost for this cultivar has changed over time. Has there been a significant trend?</span>
<span id="cb191-5219"><a href="#cb191-5219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5220"><a href="#cb191-5220" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb191-5221"><a href="#cb191-5221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5222"><a href="#cb191-5222" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb191-5223"><a href="#cb191-5223" aria-hidden="true" tabindex="-1"></a><span class="co"># library(chillR)</span></span>
<span id="cb191-5224"><a href="#cb191-5224" aria-hidden="true" tabindex="-1"></a><span class="co"># library(leaflet)</span></span>
<span id="cb191-5225"><a href="#cb191-5225" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyverse)</span></span>
<span id="cb191-5226"><a href="#cb191-5226" aria-hidden="true" tabindex="-1"></a><span class="co"># library(kableExtra)</span></span>
<span id="cb191-5227"><a href="#cb191-5227" aria-hidden="true" tabindex="-1"></a><span class="co"># library(Kendall)</span></span>
<span id="cb191-5228"><a href="#cb191-5228" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5229"><a href="#cb191-5229" aria-hidden="true" tabindex="-1"></a><span class="co"># # Generating model for frost hours (temperatures &lt; 0Â°C)</span></span>
<span id="cb191-5230"><a href="#cb191-5230" aria-hidden="true" tabindex="-1"></a><span class="co"># frost_df = data.frame(</span></span>
<span id="cb191-5231"><a href="#cb191-5231" aria-hidden="true" tabindex="-1"></a><span class="co">#   lower = c(-1000, 0),</span></span>
<span id="cb191-5232"><a href="#cb191-5232" aria-hidden="true" tabindex="-1"></a><span class="co">#   upper = c(0, 1000),</span></span>
<span id="cb191-5233"><a href="#cb191-5233" aria-hidden="true" tabindex="-1"></a><span class="co">#   weight = c(1, 0))</span></span>
<span id="cb191-5234"><a href="#cb191-5234" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5235"><a href="#cb191-5235" aria-hidden="true" tabindex="-1"></a><span class="co"># frost_model &lt;- function(x) step_model(x,</span></span>
<span id="cb191-5236"><a href="#cb191-5236" aria-hidden="true" tabindex="-1"></a><span class="co">#                                       frost_df)</span></span>
<span id="cb191-5237"><a href="#cb191-5237" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5238"><a href="#cb191-5238" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert temperature record to hourly values</span></span>
<span id="cb191-5239"><a href="#cb191-5239" aria-hidden="true" tabindex="-1"></a><span class="co"># hourly &lt;- stack_hourly_temps(CKA_weather,</span></span>
<span id="cb191-5240"><a href="#cb191-5240" aria-hidden="true" tabindex="-1"></a><span class="co">#                              latitude = 50.625)</span></span>
<span id="cb191-5241"><a href="#cb191-5241" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5242"><a href="#cb191-5242" aria-hidden="true" tabindex="-1"></a><span class="co"># frost &lt;- tempResponse(hourly,</span></span>
<span id="cb191-5243"><a href="#cb191-5243" aria-hidden="true" tabindex="-1"></a><span class="co">#                       models = c(frost = frost_model))</span></span>
<span id="cb191-5244"><a href="#cb191-5244" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5245"><a href="#cb191-5245" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5246"><a href="#cb191-5246" aria-hidden="true" tabindex="-1"></a><span class="co"># # Investigate if there is a long-term trend in the number of frost hours during bloom</span></span>
<span id="cb191-5247"><a href="#cb191-5247" aria-hidden="true" tabindex="-1"></a><span class="co"># Bloom_frost_trend &lt;- </span></span>
<span id="cb191-5248"><a href="#cb191-5248" aria-hidden="true" tabindex="-1"></a><span class="co">#   aggregate(</span></span>
<span id="cb191-5249"><a href="#cb191-5249" aria-hidden="true" tabindex="-1"></a><span class="co">#     Daily_frost$Frost_hours,</span></span>
<span id="cb191-5250"><a href="#cb191-5250" aria-hidden="true" tabindex="-1"></a><span class="co">#     by = list(Daily_frost$Year,</span></span>
<span id="cb191-5251"><a href="#cb191-5251" aria-hidden="true" tabindex="-1"></a><span class="co">#               Daily_frost$Bloom_frost),</span></span>
<span id="cb191-5252"><a href="#cb191-5252" aria-hidden="true" tabindex="-1"></a><span class="co">#     FUN = function(x) sum(x,</span></span>
<span id="cb191-5253"><a href="#cb191-5253" aria-hidden="true" tabindex="-1"></a><span class="co">#                           na.rm = TRUE))</span></span>
<span id="cb191-5254"><a href="#cb191-5254" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5255"><a href="#cb191-5255" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(Bloom_frost_trend) &lt;- c(&quot;Year&quot;,</span></span>
<span id="cb191-5256"><a href="#cb191-5256" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  &quot;Frost_timing&quot;,</span></span>
<span id="cb191-5257"><a href="#cb191-5257" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  &quot;Frost_hours&quot;)</span></span>
<span id="cb191-5258"><a href="#cb191-5258" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5259"><a href="#cb191-5259" aria-hidden="true" tabindex="-1"></a><span class="co"># DuringBloom &lt;-</span></span>
<span id="cb191-5260"><a href="#cb191-5260" aria-hidden="true" tabindex="-1"></a><span class="co">#   Bloom_frost_trend[</span></span>
<span id="cb191-5261"><a href="#cb191-5261" aria-hidden="true" tabindex="-1"></a><span class="co">#     which(Bloom_frost_trend$Frost_timing == &quot;During bloom&quot;),]</span></span>
<span id="cb191-5262"><a href="#cb191-5262" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb191-5263"><a href="#cb191-5263" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(data = DuringBloom,</span></span>
<span id="cb191-5264"><a href="#cb191-5264" aria-hidden="true" tabindex="-1"></a><span class="co">#        aes(Year,</span></span>
<span id="cb191-5265"><a href="#cb191-5265" aria-hidden="true" tabindex="-1"></a><span class="co">#            Frost_hours)) +</span></span>
<span id="cb191-5266"><a href="#cb191-5266" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col() +</span></span>
<span id="cb191-5267"><a href="#cb191-5267" aria-hidden="true" tabindex="-1"></a><span class="co">#   ylab(&quot;Frost hours&quot;)</span></span>
<span id="cb191-5268"><a href="#cb191-5268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb191-5269"><a href="#cb191-5269" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->

</body>

</html>
